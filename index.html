<script>
// Función placeholder para evitar error de referencia
function cargarEmailsGuardados() {
    // Aquí puedes implementar la carga de emails guardados si es necesario
    console.log('cargarEmailsGuardados llamada (placeholder)');
}
</script>
<!-- Configuración de Notificaciones (oculto por defecto, mostrar con JS si es necesario) -->
<div id="notificationSettingsPanel" class="notification-settings" style="display:none;">
    <h2 style="margin-bottom:20px; color:#3366CC;">Configuración de Notificaciones</h2>
    <div style="display:flex; flex-direction:column; gap:18px;">
        <label style="display:flex; align-items:center; gap:10px;">
            <input type="checkbox" id="enableNotifications" checked>
            Habilitar notificaciones
        </label>
        <label style="display:none; align-items:center; gap:10px;">
            <input type="checkbox" id="enableSounds" checked>
            Sonido de notificación
        </label>
        <label style="display:flex; align-items:center; gap:10px;">
            Duración (segundos):
            <input type="number" id="notificationDuration" min="1" max="60" value="5" style="width:60px;">
        </label>
        <label style="display:flex; align-items:center; gap:10px;">
            Máx. notificaciones visibles:
            <input type="number" id="maxNotifications" min="1" max="20" value="5" style="width:60px;">
        </label>
        <button onclick="saveNotificationSettings()" style="background:#3366CC; color:white; border:none; padding:10px 20px; border-radius:8px; font-weight:600; cursor:pointer;">Guardar configuración</button>
    </div>
        <script>
            window.toggleBannerTicker = function(){
                try {
                    const ticker = document.getElementById('bannerTicker');
                    const btn = document.getElementById('bannerToggle');
                    if(!ticker || !btn) return;
                    const paused = ticker.classList.toggle('is-paused');
                    btn.textContent = paused ? '▶' : '❚❚';
                    btn.setAttribute('aria-label', paused ? 'Reanudar desplazamiento' : 'Pausar desplazamiento');
                    btn.title = paused ? 'Reanudar' : 'Pausar';
                } catch(e) { /* noop */ }
            };
        </script>
</div>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ACHS Ejecutivo Centralizado</title>
    <!-- ✅ CSS Y JS INTEGRADOS EN EL HTML - 2025-11-11 -->
    <style>
        /* ========================================
           ESTILOS MIGRADOS DESDE assets/css/styles.css
           ======================================== */
        
        /* Búsqueda rápida (Ctrl+K) */
                /* ===== Banner Ticker Superior ===== */
                .banner-ticker {
                    position:fixed; top:0; left:0; width:100%; height:44px;
                    background:linear-gradient(135deg, #002d5c 0%, #004c8c 50%, #002d5c 100%);
                    color:#fff; font-family:'Helvetica Rounded', 'Arial Rounded MT Bold', 'Helvetica Neue', 'Helvetica', sans-serif;
                    overflow:hidden; z-index:950; box-shadow:0 3px 12px rgba(0, 45, 92, 0.15);
                    display:flex; align-items:center; border-bottom:2px solid rgba(255,255,255,0.1);
                    padding:0 44px 0 12px;
                }
                .banner-ticker .banner-inner {
                    white-space:nowrap; display:inline-block;
                    animation: tickerScroll 20s linear infinite;
                    padding-left:100%; /* Empieza fuera de pantalla */
                }
                .banner-ticker .banner-text { font-size:1.15rem; letter-spacing:.5px; font-weight:600; }
                .banner-ticker:hover .banner-inner { animation-play-state: paused; }
                .banner-ticker.is-paused .banner-inner { animation-play-state: paused; }
                .banner-ticker .banner-toggle{
                    position:absolute; right:8px; top:50%; transform:translateY(-50%);
                    background:rgba(255,255,255,0.15); color:#fff; border:1px solid rgba(255,255,255,0.25);
                    padding:5px 10px; border-radius:20px; font-size:11px; cursor:pointer;
                    line-height:1; backdrop-filter:blur(8px); font-weight:500;
                    transition: all 0.3s ease;
                }
                .banner-ticker .banner-toggle:hover{ 
                    background:rgba(255,255,255,0.25); 
                    box-shadow: 0 2px 8px rgba(255,255,255,0.2);
                    transform:translateY(-50%) scale(1.05);
                }
                @keyframes tickerScroll {
                    0% { transform:translateX(0); }
                    100% { transform:translateX(-100%); }
                }
                /* Ajustar desplazamiento del resto del contenido para no quedar bajo el banner */
                body { padding-top:50px; }
        #busquedaRapidaOverlay {
          display: none;
          position: fixed;
          top: 0; left: 0; width: 100vw; height: 100vh;
          z-index: 120000;
          background: rgba(30,41,59,0.18);
          justify-content: center;
          align-items: flex-start;
        }
        #busquedaRapidaBox {
          margin-top: 10vh;
          background: #fff;
          border-radius: 14px;
          box-shadow: 0 8px 32px rgba(0,33,71,0.18);
          padding: 1.2rem 1.5rem 1.1rem 1.5rem;
          min-width: 340px;
          max-width: 90vw;
          width: 420px;
        }
        #busquedaRapidaInput {
          font-size: 1.1em;
          padding: 8px 12px;
          border-radius: 8px;
          border: 1px solid #cbd5e1;
          outline: none;
          width: 100%;
          box-sizing: border-box;
        }
        #busquedaRapidaResultados {
          list-style: none;
          margin: 14px 0 0 0;
          padding: 0;
          max-height: 260px;
          overflow-y: auto;
        }
        #busquedaRapidaResultados li {
          padding: 8px 10px;
          border-radius: 7px;
          cursor: pointer;
          font-size: 1.04em;
          color: #1e293b;
          transition: background 0.13s;
        }
        #busquedaRapidaResultados li.selected,
        #busquedaRapidaResultados li:hover {
          background: #e0e7ff;
          color: #3730a3;
        }
        #busquedaRapidaVacio {
          color: #64748b;
          font-size: .97em;
          margin-top: 10px;
        }
        
        .submenu-snl {
          position:fixed; top:115px; right:200px;
          background:linear-gradient(135deg,#ffffff 40%,#eef5ff 100%);
          border-radius:14px;
          box-shadow:0 10px 30px rgba(0,0,0,0.16);
          padding:14px; width:380px; display:none; z-index:9998;
          border:2px solid #3b82f6;
        }
        .submenu-snl.show { display:block; animation: slideInRight .35s ease; }
        .submenu-snl-item {
          padding:10px 12px; border-radius:10px; font-weight:600; cursor:pointer; margin-bottom:6px;
          background:linear-gradient(90deg,#ffffff 0%,#e0f2fe 100%);
          color:#1e3a8a; box-shadow:0 2px 6px rgba(59,130,246,0.12);
          border:1px solid #3b82f6;
          transition:background .18s, color .18s, box-shadow .18s, transform .18s;
        }
        .submenu-snl-item:hover, .submenu-snl-item:focus {
          background:linear-gradient(90deg,#bfdbfe 0%,#e0f2fe 100%);
          color:#0f172a;
          box-shadow:0 4px 14px rgba(59,130,246,0.28);
          transform:translateY(-2px);
        }
        .submenu-snl-item:active {
          transform:translateY(0);
          box-shadow:0 2px 8px rgba(59,130,246,0.25);
        }
        .submenu-snl-item.active {
          background:linear-gradient(90deg,#93c5fd 0%,#e0f2fe 100%);
          color:#0f172a;
          border:2px solid #2563eb;
          box-shadow:0 0 0 3px rgba(37,99,235,0.25),0 4px 14px rgba(59,130,246,0.28);
          position:relative;
        }
        .submenu-snl-item.active::after {
          content:"✔";
          position:absolute; right:10px; top:50%; transform:translateY(-50%);
          font-size:0.95em; color:#1e3a8a; opacity:.9;
        }

        @keyframes slideInRight { from { opacity:0; transform:translateX(40px);} to { opacity:1; transform:translateX(0);} }

        /* Calendario flotante */
        .panel-calendario { position:fixed; top:90px; right:20px; left:auto; background:#fff; border-radius:16px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1); padding:0; width:300px; z-index:1200; font-family:'Helvetica Rounded', 'Arial Rounded MT Bold', 'Helvetica Neue', 'Helvetica', sans-serif; }
        .cal-header { text-align:center; padding:6px 4px; font-weight:600; color:#6b7280; background:#f9fafb; font-size:0.75rem; }
        .cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; padding:10px; }
        .cal-day { text-align:center; padding:6px 4px; border-radius:6px; font-weight:500; color:#1f2937; background:#f9fafb; font-size:0.8rem; min-height:32px; display:flex; align-items:center; justify-content:center; }
        .cal-day:empty { background:transparent; }
        .cal-hoy { outline:2px solid #3498db !important; background:#dbeafe !important; font-weight:700 !important; color:#1e40af !important; }
        .cal-feriado { background:#fee2e2 !important; color:#b91c1c !important; font-weight:600 !important; }

        /* Transición suave al cambiar de mes */
        .cal-fade { animation: calFade .18s ease; }
        @keyframes calFade { from { opacity: .35; transform: translateY(4px); } to { opacity: 1; transform: translateY(0);} }

        /* Botón flotante de ayuda */
        .help-fab {
          position: fixed !important;
          right: 20px !important;
          bottom: 20px !important;
          z-index: 99999 !important;
          background: #2563eb;
          color: white;
          border: none;
          border-radius: 999px;
          padding: 10px 14px;
          font-weight: 700;
          box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1);
          cursor: pointer;
          transition: transform 150ms cubic-bezier(0.4, 0, 0.2, 1), box-shadow 150ms cubic-bezier(0.4, 0, 0.2, 1), background 150ms cubic-bezier(0.4, 0, 0.2, 1);
          display: block !important;
          opacity: 1 !important;
          pointer-events: auto !important;
        }
        .help-fab:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1); background:#1e40af; }
        .help-fab small { font-weight:600; opacity:.95; }

        /* Modal Siglas de Agencias */
        .sigla-lista-vertical { display:flex; flex-direction:column; gap:14px; max-height:55vh; overflow-y:auto; margin-bottom:10px; }
        .titulo-seccion { color:#007bff; font-weight:700; font-size:1.2em; margin-bottom:10px; }
        .importante { background:#fff3cd; border:1px solid #ffc107; padding:10px; border-radius:5px; color:#856404; font-weight:bold; }
        .destacado { background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold; }
        .contacto { background:#e3f2fd; border:1px solid #2196f3; padding:15px; border-radius:8px; text-align:center; }
        .alerta-critica { background:#ffcdd2; border:2px solid #f44336; padding:15px; border-radius:8px; text-align:center; color:#c62828; font-weight:bold; margin:15px 0; }
        .pregunta { font-weight:bold; color:#007bff; }

        /* Estilo del modal de ayuda */
        .modal-ayuda-contenido {
          max-width: 760px;
          background: #fff;
          border-radius: 16px;
          box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1);
          padding: 1.5rem;
          position: relative;
          max-height: 90vh;
          overflow-y: auto;
        }
        .modal-ayuda-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px; }
        .modal-ayuda-title { font-size:1.2rem; font-weight:800; color:#1f2937; }
        .modal-ayuda-close { background:transparent; border:none; font-size:1.2rem; cursor:pointer; color:#6b7280; }
        .modal-ayuda-close:hover { color:#111827; }
        .modal-ayuda-section h4 { margin:.6rem 0 .25rem; font-size:1rem; color:#111827; }
        .modal-ayuda-section p { margin:0 0 .5rem; color:#374151; font-size:.95rem; }
        .modal-ayuda-section ul { margin:.25rem 0 .75rem 1rem; }
        .badge { display:inline-block; background:#eef2ff; color:#3730a3; border:1px solid #c7d2fe; border-radius:999px; padding:2px 8px; font-size:.75rem; font-weight:700; }

        /* Encuesta Satisfacción / Script LE bloques comunes */
        .escala { background:#eef2ff; border:1px solid #6366f1; padding:8px 12px; border-radius:6px; font-size:0.85rem; color:#374151; margin:8px 0 14px; font-weight:600; }
        .nota { background:#f0f9ff; border:1px solid #0ea5e9; padding:10px 14px; border-radius:8px; font-size:0.85rem; color:#075985; margin:12px 0; }
        .seccion hr { border:none; border-top:1px solid #e5e7eb; margin:24px 0; }
        .sigla-tarjeta-grande { display:flex; align-items:center; gap:18px; background:linear-gradient(90deg,#e3eafc 70%,#f8fafc 100%); border:2px solid #b8c2c9; border-radius:12px; padding:16px 20px; box-shadow:0 2px 12px rgba(30,58,138,0.08); transition:box-shadow .2s, border-color .2s; cursor:pointer; }
        .sigla-tarjeta-grande:hover { box-shadow:0 4px 18px rgba(30,58,138,0.18); border-color:#2563eb; }
        .sigla-tarjeta-icono { font-size:2.1em; color:#2563eb; flex-shrink:0; }
        .sigla-tarjeta-info { display:flex; flex-direction:column; }
        .sigla-tarjeta-sigla { font-weight:bold; color:#1e3a8a; font-size:1.18em; letter-spacing:1px; }
        .sigla-tarjeta-agencia { color:#222; font-size:1.05em; }

        /* Estilos para impresión Script SNL */
        .print-snl-body { font-family: 'Helvetica Rounded', 'Arial Rounded MT Bold', 'Helvetica Neue', 'Helvetica', Arial, sans-serif; line-height:1.6; margin:40px; color:#2c3e50; background:#f8f9fa; }
        .print-snl-header { text-align:center; margin-bottom:30px; padding:20px; background:linear-gradient(135deg,#27ae60,#2ecc71); color:#fff; border-radius:10px; box-shadow:0 4px 15px rgba(39,174,96,0.3); }
        .print-snl-section { margin:20px 0; padding:15px; border-left:4px solid #27ae60; background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
        .print-snl-title { font-weight:700; color:#27ae60; font-size:1.2em; margin-bottom:10px; }
        .print-snl-important { background:#d5f4e6; padding:10px; border-radius:5px; border:1px solid #27ae60; margin:10px 0; }
        .print-snl-destacado { background:#fff3cd; padding:2px 6px; border-radius:3px; font-weight:700; }
        .print-snl-contacto { background:#e1f5fe; padding:10px; border-radius:5px; border:1px solid #03a9f4; margin:10px 0; text-align:center; }
        .print-snl-pregunta { font-weight:700; color:#2980b9; margin:8px 0; }
        .print-snl-escala { background:#e8f5e8; padding:8px; border-radius:5px; font-style:italic; }

        /* Estilos para impresión Script LE */
        .print-le-body { font-family: 'Helvetica Rounded', 'Arial Rounded MT Bold', 'Helvetica Neue', 'Helvetica', Arial, sans-serif; line-height:1.6; margin:40px; color:#2c3e50; background:#f8f9fa; }
        .print-le-header { text-align:center; margin-bottom:30px; padding:20px; background:linear-gradient(135deg,#9b59b6,#8e44ad); color:#fff; border-radius:10px; box-shadow:0 4px 15px rgba(155,89,182,0.3); }
        .print-le-section { margin:20px 0; padding:15px; border-left:4px solid #9b59b6; background:#fff; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
        .print-le-title { font-weight:700; font-size:1.2em; color:#8e44ad; margin-bottom:10px; display:flex; align-items:center; gap:10px; }
        .print-le-destacado { background:#fff3cd; padding:2px 6px; border-radius:4px; font-weight:700; color:#856404; }
        .print-le-importante { background:#f8d7da; border:1px solid #f5c6cb; padding:15px; border-radius:8px; margin:10px 0; color:#721c24; }
        .print-le-nota { background:#d1ecf1; border:1px solid #bee5eb; padding:15px; border-radius:8px; margin:10px 0; color:#0c5460; }
        .print-le-footer { margin-top:40px; text-align:center; color:#6c757d; font-size:0.9em; }
        .print-le-pregunta { font-weight:700; color:#2980b9; margin:8px 0; }
        .print-le-faq { background:#e8f5e8; padding:10px; border-radius:5px; margin:8px 0; }
        .print-le-faq-titulo { font-weight:700; color:#155724; }
        .print-le-hr { border:none; height:2px; background:linear-gradient(90deg,#9b59b6,#8e44ad); margin:30px 0; }
        
        /* ========================================
           FIN ESTILOS MIGRADOS - Inicio estilos legados
           ======================================== */
                /* INICIO BLOQUE LEGADO: Será migrado a assets/css/styles.css en pasos.
                   Fecha inicio migración: 2025-11-10 */
                :root {
                        --primary-blue: #080606;
                        --secondary-blue: #0c0101;
                        --accent-blue: #040c72;
                        --light-blue: #00A1E0;
                        --dark-navy: #0f172a;
                        --success-green: #c50e1e;
                        --warning-amber: #d97706;
                        --error-red: #dc2626;
                        --neutral-gray: #3076e3;
                        --soft-white: #e8eef3;
                        --pure-white: #f2f6f9;
                        /* Gradientes */
                        --gradient-primary: linear-gradient(135deg, #00A1E0 100%);
                        --gradient-secondary: linear-gradient(135deg, #00A1E0 100%);
                        --gradient-accent: linear-gradient(135deg, #00A1E0 100%);
                        --gradient-background: linear-gradient(135deg, #00A1E0 100%);
                        /* Sombras */
                        --shadow-sm: 0 1px 3px rgb(238, 231, 231), 0 1px 2px rgba(0, 0, 0, 0.06);
                        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
                        --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
                        --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.1);
                        /* Espaciado consistente */
                        --spacing-xs: 0.5rem;    /* 8px - espaciado mínimo entre elementos */
                        --spacing-sm: 0.75rem;   /* 12px - espaciado pequeño */
                        --spacing-md: 1rem;      /* 16px - espaciado medio */
                        --spacing-lg: 1.5rem;    /* 24px - espaciado grande */
                        --spacing-xl: 2rem;      /* 32px - espaciado extra grande */
                        --spacing-2xl: 3rem;     /* 48px - espaciado entre secciones */
                        /* Border radius */
                        --radius-sm: 6px;
                        --radius-md: 10px;
                        --radius-lg: 16px;
                        --radius-xl: 20px;
                }

/* 
<!-- Botón LEY KARIN al lado de INFORMACION EP y Modal (ubica esto en el body donde corresponda) -->
<!-- Modal LEY KARIN eliminado - versión completa está en línea 3180 -->

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->
*/

        /* Tipografía modernizada: pila de fuentes del sistema para rendimiento y legibilidad.
           Incluye variables para escalas y line-height consistentes.
           Se evita carga externa (Google Fonts) para mantener velocidad. */
        :root {
            --font-sans: 'Helvetica Rounded', 'Arial Rounded MT Bold', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            --font-mono: ui-monospace, SFMono-Regular, 'Segoe UI Mono', 'Roboto Mono', Menlo, Consolas, 'Liberation Mono', monospace;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.85rem;
            --font-size-base: 0.95rem;
            --font-size-md: 1.05rem;
            --font-size-lg: 1.25rem;
            --font-size-xl: 1.6rem;
            --line-height-tight: 1.2;
            --line-height-base: 1.5;
            --line-height-relaxed: 1.65;
            --letter-spacing-tight: -0.015em;
            --letter-spacing-normal: 0;
        }

        body {
            font-family: var(--font-sans);
            font-size: var(--font-size-base);
            line-height: var(--line-height-base);
            letter-spacing: var(--letter-spacing-normal);
            background: #ffffff;
            margin: 0;
            padding: var(--spacing-lg);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .container-principal {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(200, 215, 225, 0.98);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(20px);
            border: 1px solid rgb(224, 229, 231);

         
        }
        
        .titulo {
            color: var(--primary-blue);
            font-weight: 700;
            font-size: clamp(2.1rem, 4vw, 3.1rem);
            margin-bottom: var(--spacing-md);
            text-align: center;
            text-shadow: 0 2px 4px rgba(30, 58, 138, 0.12);
            border-bottom: 3px solid var(--accent-blue);
            padding-bottom: var(--spacing-md);
            letter-spacing: var(--letter-spacing-tight);
            line-height: var(--line-height-tight);
            font-family: var(--font-sans);
        }

        .subtitulo {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: clamp(1.15rem, 2.3vw, 1.5rem);
            margin-bottom: var(--spacing-2xl);
            text-align: center;
            font-style: normal;
            opacity: 0.85;
            letter-spacing: var(--letter-spacing-normal);
            line-height: var(--line-height-relaxed);
            font-family: var(--font-sans);
        }
        
        .seccion-formulario {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }
        
        .formulario-principal {
            background: rgba(210, 220, 230, 0.98);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg); /* 24px de padding interno */
            border: 2px solid var(--light-blue);
            box-shadow: var(--shadow-md);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .formulario-principal:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }
        
        .form-group {
            margin-bottom: var(--spacing-md); /* 16px entre grupos de formulario */
        }
        
        .form-label {
            color: var(--primary-blue);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: var(--spacing-xs); /* 8px entre label e input */
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: var(--spacing-sm); /* 12px de padding interno */
            border: 3px solid var(--secondary-blue);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background: rgba(238, 244, 248, 0.95);
            color: var(--dark-navy);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            border-width: 4px;
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.2);
            background: rgba(245, 249, 252, 0.98);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }
        
        .seccion-calendario {
            margin-bottom: var(--spacing-2xl);
        }
        
        .calendario-container {
            background: rgba(238, 244, 248, 0.98);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--light-blue);
        }
        
        .reloj-digital {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            color: white;
        }
        
        .reloj-tiempo {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: var(--spacing-sm);
            font-variant-numeric: tabular-nums;
        }
        
        .reloj-fecha {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 400;
        }
        
        .calendario-dia {
            padding: 8px 6px;
            text-align: center;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            min-height: 32px;
            font-size: 0.8em;
        }
        
        .calendario-dia:hover {
            background: #e3f2fd;
            transform: scale(1.05);
        }
        
        .dia-actual {
            background: #007bff !important;
            color: white !important;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        }
        
        .dia-feriado {
            background: #ffebee !important;
            color: #c62828 !important;
            font-weight: bold;
        }
        
        .dia-feriado::after {
            content: "🎊";
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7em;
        }
        
        .dia-otro-mes {
            color: #bbb;
            background: #e0e8f0;
        }
        
        .dia-fin-semana {
            background: #d8e5d8;
        }
        
        .tooltip-feriado {
            position: absolute;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            max-width: 200px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .tooltip-feriado::before {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .calendario-dia.seleccionado {
            background: #28a745 !important;
            color: white !important;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        
        select, input[type="text"], input[type="date"] {
            width: 100%;
            padding: 5px;
            margin-top: 5px;
            margin-bottom: 10px;
            font-size: 1em;
        }
        
        form {
            max-width: 400px;
            margin-left: 0;
            margin-right: auto;
            border: 2px solid #002147;
            border-radius: 10px;
            padding: 20px;
            background: #e8f0f8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        /* Sistema de botones por prioridad */
        .botones-principales {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg); /* 24px entre secciones de botones */
        }
        
        .botones-primarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: var(--spacing-sm); /* 12px entre botones primarios */
            margin-bottom: 0; /* Removido, se usa gap del contenedor */
        }
        
        .botones-consulta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: var(--spacing-sm); /* 12px entre botones de consulta */
            margin-bottom: 0; /* Removido, se usa gap del contenedor */
        }
        
        .botones-herramientas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-xs); /* 8px entre herramientas (más compacto) */
        }
        
        .btn-primario {
            /* Paleta moderna solo para botones (no se altera fondo general) */
            background: linear-gradient(135deg, #0EA5E9 0%, #2563EB 100%); /* cyan->indigo */
            color: #ffffff;
            padding: var(--spacing-sm) var(--spacing-md); /* 12px vertical, 16px horizontal */
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            border: none;
            cursor: pointer;
            min-height: 42px; /* Aumentado de 36px a 42px para mejor clickabilidad */
            box-shadow: 0 6px 14px rgba(37, 99, 235, 0.25);
            transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs); /* 8px entre icono y texto */
        }
        
        .btn-primario:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 24px rgba(37, 99, 235, 0.35);
            filter: brightness(1.05);
        }
        .btn-primario:active { transform: translateY(0); }
        .btn-primario:focus { outline: none; box-shadow: 0 0 0 3px rgba(37,99,235,.25); }
        
        .btn-secundario {
            background: #ffffff;
            color: #2563EB;
            border: 2px solid #3B82F6; /* azul medio moderno */
            padding: var(--spacing-sm) var(--spacing-md); /* 12px vertical, 16px horizontal */
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            min-height: 42px; /* Consistente con botones primarios */
            transition: transform .18s ease, box-shadow .18s ease, background .18s ease, color .18s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs); /* 8px entre icono y texto */
        }
        
        .btn-secundario:hover {
            background: #EFF6FF; /* azul muy claro */
            color: #1D4ED8;
            border-color: #2563EB;
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.15);
        }
        .btn-secundario:active { transform: translateY(0); }
        .btn-secundario:focus { outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,.25); }
        
        .btn-herramienta {
            background: #3366CC;
            color: #fff;
            padding: var(--spacing-xs) var(--spacing-sm); /* 8px vertical, 12px horizontal (más compacto) */
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
            border: 2px solid #348fff;
            cursor: pointer;
            min-height: 36px; /* Ligeramente más pequeño que primarios/secundarios */
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px; /* Gap fijo más pequeño para herramientas */
        }
        
        .btn-herramienta:hover {
            background: #2176d2;
            color: #fff;
            border: 2px solid #2176d2;
            /* Sin cambio de color ni sombra al pasar el mouse */
            transform: none;
            box-shadow: none;
        }
        
        .btn-especial {
            background: var(--error-red);
            color: white;
        }
        
        .btn-especial:hover {
            background: #b91c1c;
        }
        
        /* ===== ESTILOS DEL BOTÓN ANEXO ENTRETENIDO ===== */
        .btn-anexo-entretenido {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            overflow: hidden;
            min-width: 120px;
            width: 100%;
            min-height: 42px; /* igual altura que .btn-primario */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transform-style: preserve-3d;
            animation: pulsoSuave 3s infinite ease-in-out;
        }
        
        .btn-anexo-entretenido::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s;
        }
        
        .btn-anexo-entretenido:hover::before {
            left: 100%;
        }
        
        .btn-anexo-entretenido:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.5);
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            animation: none;
        }
        
        .btn-anexo-entretenido:active {
            transform: translateY(-1px) scale(1.02);
            transition: all 0.1s;
        }
        
        .btn-anexo-icono {
            font-size: 16px;
            animation: giroSuave 4s infinite linear;
            display: inline-block;
        }
        
        .btn-anexo-texto {
            font-size: 13px;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .btn-anexo-efectos {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .btn-anexo-entretenido:hover .btn-anexo-efectos {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.7;
        }
        
        .btn-anexo-entretenido:hover .btn-anexo-icono {
            animation: saltarIcono 0.6s ease-in-out;
        }
        
        /* Animaciones especiales */
        @keyframes pulsoSuave {
            0%, 100% { 
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            }
            50% { 
                box-shadow: 0 12px 30px rgba(102, 126, 234, 0.5);
            }
        }
        
        @keyframes giroSuave {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        
        @keyframes saltarIcono {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(10deg); }
            50% { transform: translateY(-3px) rotate(-5deg); }
            75% { transform: translateY(-2px) rotate(5deg); }
        }
        
        /* Efectos de partículas para el botón anexo */
        .btn-anexo-entretenido:hover::after {
            content: '✨';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 12px;
            animation: brillar 1s ease-in-out;
            pointer-events: none;
        }
        
        @keyframes brillar {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
        
        /* Responsive para el botón anexo */
        @media (max-width: 768px) {
            .btn-anexo-entretenido {
                min-width: 120px;
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .btn-anexo-icono {
                font-size: 18px;
            }
        }
        /* ===== FIN ESTILOS BOTÓN ANEXO ENTRETENIDO ===== */
        
        
        .seccion-historial {
            background: rgba(200, 215, 225, 0.98);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--light-blue);
        }
        
        .historial-header {
            color: var(--primary-blue);
            font-weight: 700;
            font-size: 1.4rem;
            text-align: center;
            margin-bottom: var(--spacing-md);
            position: relative;
        }
        
        .historial-header::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: var(--accent-blue);
            border-radius: 2px;
        }
        
        .botones-historial {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .tabla-container {
            overflow-x: auto;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--light-blue);
        }
        
        .tabla-historial {
            width: 100%;
            border-collapse: collapse;
            background: rgba(215, 225, 235, 0.98);
            font-size: 0.85rem;
        }
        
        .tabla-historial thead {
            background: var(--gradient-primary);
            color: white;
        }
        
        .tabla-historial th {
            padding: var(--spacing-sm) var(--spacing-sm);
            font-weight: 700;
            text-align: left;
            border-bottom: 2px solid var(--accent-blue);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: black;
        }
        
        .tabla-historial tbody tr {
            transition: all 0.2s ease;
        }
        
        .tabla-historial tbody tr:nth-child(even) {
            background: rgba(232, 240, 246, 0.95);
        }
        
        .tabla-historial tbody tr:hover {
            background: var(--light-blue);
            transform: scale(1.005);
            box-shadow: var(--shadow-sm);
        }
        
        .tabla-historial td {
            padding: var(--spacing-sm);
            border-bottom: 1px solid var(--light-blue);
            vertical-align: middle;
        }
        
        
        /* Animaciones y transiciones globales */
        * {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Animaciones de entrada */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .fade-in-up {
            animation: slideInUp 0.6s ease-out;
        }
        
        .fade-in-scale {
            animation: fadeInScale 0.5s ease-out;
        }
        
        .slide-in-right {
            animation: slideInRight 0.7s ease-out;
        }
        
        /* Efectos hover mejorados */
        .hover-lift:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
        }
        
        /* Indicadores de carga */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Pulso para elementos activos */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        /* Estilos para botones flotantes */
        .btn-flotante-ep {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #ff6b6b 100%);
            background-size: 200% 200%;
            animation: gradientFloating 4s ease infinite;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3), 
                        0 8px 25px rgba(255, 107, 107, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }
        
        /* Estilos para el botón flotante SCRIPT SNL */
        .btn-flotante-snl {
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 50%, #2ecc71 100%);
            background-size: 200% 200%;
            animation: gradientFloatingSNL 4s ease infinite;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3), 
                        0 8px 25px rgba(46, 204, 113, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }
          .btn-flotante-ep:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4), 
                        0 12px 35px rgba(255, 107, 107, 0.3);
        }
        
        .btn-flotante-snl:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4), 
                        0 12px 35px rgba(46, 204, 113, 0.3);
        }

        .btn-flotante-ep:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }
        
        .btn-flotante-snl:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 8px rgba(46, 204, 113, 0.3);
        }
          @keyframes gradientFloating {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes gradientFloatingSNL {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes sparkle {
            0%, 100% { 
                opacity: 0; 
                transform: scale(0.5) rotate(0deg); 
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1) rotate(180deg); 
            }
        }
          .btn-flotante-ep::before {
            content: '✨';
            position: absolute;
            top: -8px;
            left: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(255,215,0,0.5));
        }

        .btn-flotante-ep::after {
            content: '💼';
            position: absolute;
            bottom: -8px;
            right: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite 1.5s;
            filter: drop-shadow(0 2px 4px rgba(255,215,0,0.5));
        }
        
        .btn-flotante-snl::before {
            content: '⭐';
            position: absolute;
            top: -8px;
            left: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(255,215,0,0.5));
        }

        .btn-flotante-snl::after {
            content: '💚';
            position: absolute;
            bottom: -8px;
            right: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite 1.5s;
            filter: drop-shadow(0 2px 4px rgba(255,215,0,0.5));
        }

        /* Estilos para el submenú desplegable SNL */
        .submenu-snl {
            position: fixed;
            top: 115px;
            right: 200px;
            z-index: 9998;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(46, 204, 113, 0.3);
            padding: 8px 0;
            min-width: 380px;
            display: none;
            animation: slideInRight 0.3s ease;
            border: 2px solid #27ae60;
        }

        .submenu-snl.show {
            display: block;
        }

        .submenu-snl-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #2c3e50;
            font-weight: 500;
            font-size: 14px;
            border-left: 3px solid transparent;
        }

        .submenu-snl-item:hover {
            background: linear-gradient(90deg, #eafaf1 0%, #fff 100%);
            border-left: 3px solid #27ae60;
            color: #27ae60;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Estilos para el botón flotante SCRIPT SNL 2.0 */
        .btn-flotante-snl2 {
            position: fixed;
            top: 170px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 50%, #00d2ff 100%);
            background-size: 200% 200%;
            animation: gradientFloatingSNL2 4s ease infinite;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3), 
                        0 8px 25px rgba(0, 210, 255, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }
        
        .btn-flotante-snl2:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 210, 255, 0.4), 
                        0 12px 35px rgba(0, 210, 255, 0.3);
        }

        .btn-flotante-snl2:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 8px rgba(0, 210, 255, 0.3);
        }
        
        @keyframes gradientFloatingSNL2 {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .btn-flotante-snl2::before {
            content: '📞';
            position: absolute;
            top: -8px;
            left: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(0,210,255,0.5));
        }

        .btn-flotante-snl2::after {
            content: '🏥';
            position: absolute;
            bottom: -8px;
            right: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite 1.5s;
            filter: drop-shadow(0 2px 4px rgba(0,210,255,0.5));
        }

        /* Estilos para el submenú desplegable SNL 2.0 */
        .submenu-snl2 {
            position:fixed; top:225px; right:200px;
            background:linear-gradient(135deg,#ffffff 40%,#e0f7ff 100%);
            border-radius:14px;
            box-shadow:0 10px 30px rgba(0,0,0,0.16);
            padding:14px; width:420px; display:none; z-index:9998;
            border:2px solid #00d2ff;
            max-height:70vh;
            overflow-y:auto;
        }
        .submenu-snl2.show { display:block; animation: slideInRight .35s ease; }
        .submenu-snl2-item {
            padding:10px 12px; border-radius:10px; font-weight:600; cursor:pointer; margin-bottom:6px;
            background:linear-gradient(90deg,#ffffff 0%,#d0f2ff 100%);
            color:#006494; box-shadow:0 2px 6px rgba(0,210,255,0.12);
            border:1px solid #00d2ff;
            transition:background .18s, color .18s, box-shadow .18s, transform .18s;
            font-size:13px;
        }
        .submenu-snl2-item:hover, .submenu-snl2-item:focus {
            background:linear-gradient(90deg,#a8e8ff 0%,#d0f2ff 100%);
            color:#003d5c;
            box-shadow:0 4px 14px rgba(0,210,255,0.28);
            transform:translateY(-2px);
        }
        .submenu-snl2-item:active {
            transform:translateY(0);
            box-shadow:0 2px 8px rgba(0,210,255,0.25);
        }
        
        /* Estilos para el botón flotante SCRIPT LE */
        .btn-flotante-le {
            position: fixed;
            top: 120px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 50%, #9b59b6 100%);
            background-size: 200% 200%;
            animation: gradientFloatingLE 4s ease infinite;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3), 
                        0 8px 25px rgba(155, 89, 182, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            backdrop-filter: blur(10px);
        }
        
        .btn-flotante-le:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.4), 
                        0 12px 35px rgba(155, 89, 182, 0.3);
        }

        .btn-flotante-le:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 2px 8px rgba(155, 89, 182, 0.3);
        }
        
        @keyframes gradientFloatingLE {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .btn-flotante-le::before {
            content: '🏥';
            position: absolute;
            top: -8px;
            left: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(155,89,182,0.5));
        }

        .btn-flotante-le::after {
            content: '📋';
            position: absolute;
            bottom: -8px;
            right: -8px;
            font-size: 14px;
            animation: sparkle 3s ease-in-out infinite 1.5s;
            filter: drop-shadow(0 2px 4px rgba(155,89,182,0.5));
        }
        
        /* Botón flotante Calendario Chile */
        .btn-flotante-cal {
            position: fixed;
            top: 220px;
            right: 20px;
            z-index: 9999;
            background: linear-gradient(45deg, #2c3e50, #3498db);
            background-size: 400% 400%;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 40px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            box-shadow: 0 8px 32px rgba(52, 152, 219, 0.4);
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .btn-flotante-cal:hover { transform: scale(1.08) translateY(-4px); box-shadow: 0 15px 40px rgba(52,152,219,0.55); }
        .btn-flotante-cal:active { transform: scale(0.95); }

        /* Panel Calendario Chile flotante */
        .panel-calendario {
            position: fixed;
            top: 270px;
            right: 20px;
            width: 320px;
            max-height: 80vh;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            border: 1px solid #e5e7eb;
            overflow: hidden;
            z-index: 10050;
        }
        .cal-header { display:flex; justify-content:space-between; align-items:center; padding:10px 12px; background:linear-gradient(135deg, #3498db, #2c3e50); color:#fff; }
        .cal-header .cal-nav { display:flex; gap:8px; }
        .cal-header button { background: rgba(255,255,255,0.2); border:none; color:#fff; padding:6px 10px; border-radius:6px; cursor:pointer; font-weight:600; }
        .cal-header button:hover { background: rgba(255,255,255,0.3); }
        .cal-body { padding: 10px 12px 12px; }
        .cal-weekdays { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; margin-bottom:6px; font-weight:700; color:#374151; font-size:12px; text-align:center; }
        .cal-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:6px; transition: opacity 0.18s ease; }
        .cal-grid.cal-fade { opacity: 0.4; }
        .cal-cell { text-align:center; padding:8px 0; border-radius:8px; font-weight:600; color:#1f2937; background:#f9fafb; }
        .cal-cell.muted { color:#9ca3af; background:#f3f4f6; }
        .cal-cell.hoy { outline:2px solid #3498db; background:#eaf4fe; }
        .cal-cell.feriado { background:#fdecec; color:#b91c1c; border:1px solid #fecaca; }
        .cal-legend { margin-top:10px; font-size:12px; color:#374151; display:flex; gap:10px; align-items:center; }
        .cal-dot { width:10px; height:10px; border-radius:50%; display:inline-block; }
        .cal-dot.feriado { background:#ef4444; }
        .cal-footer { padding:8px 12px 12px; border-top:1px solid #e5e7eb; font-size:12px; color:#6b7280; }
        
       
        /* Estilos para modales */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.4);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: rgb(9, 18, 24);
            border-radius: 10px;
            padding: 30px 20px;
            max-width: 700px;
            width: 95%;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            position: relative;
        }
        
        #accesoLinks {
            display: none;
            position: absolute;
            background: rgb(14, 108, 145);
            border: 2px solid #002147;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,33,71,0.2);
            z-index: 1001;
            min-width: 300px;
            padding: 10px;
        }
        
        #accesoLinks a {
            display: block;
            color: #002147;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 5px;
            background: #e0e8f0;
            transition: all 0.3s ease;
        }
        
        #accesoLinks a:hover {
            background: #d0e0f0;
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,33,71,0.15);
        }
        
        /* Animaciones para pop-ups de atención */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        
        /* Responsive Design Mejorado */        
        /* Calendario y reloj compacto */
        .calendario-reloj-compacto {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-md);
            margin: var(--spacing-md) 0;
            padding: var(--spacing-sm);
            background: linear-gradient(135deg, #e8eef3 0%, #d8e1e8 100%);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-soft);
            border: 1px solid #c5d0d8;
        }

        /* ===== ANIMACIONES SUTILES Y EFECTOS HOVER AVANZADOS ===== */
        
        /* Transiciones globales suaves */
        * {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        /* Efectos hover para botones principales */
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.25);
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        }
        
        .btn:active {
            transform: translateY(0px);
            transition: all 0.1s ease;
        }
        
        /* Efectos hover para botones específicos */
        .btn-success:hover {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.25);
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #ffc107 0%, #d39e00 100%);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.25);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.25);
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.25);
        }
        
        /* Animación de pulso para botones importantes */
        @keyframes pulso-suave {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .btn-pulse:hover {
            animation: pulso-suave 2s infinite;
        }
        
        /* Efectos hover para elementos de lista */
        .lista-documentos li:hover,
        .list-group-item:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            transform: translateX(5px);
            border-left: 4px solid #007bff;
            cursor: pointer;
        }
        
        /* Animación de aparición suave */
        @keyframes aparecer-suave {
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .modal {
            animation: aparecer-suave 0.4s ease-out;
        }
        
        .modal-content {
            animation: aparecer-suave 0.5s ease-out;
        }
        
        /* Efectos hover para modales */
        .modal-header:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        /* Animación de shimmer para elementos de carga */
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, rgba(255,255,255,0.5) 50%, #f0f0f0 75%);
            background-size: 200px 100%;
            animation: shimmer 1.5s infinite;
        }
        
        /* Efectos hover para formularios */
        .form-control:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
            border-color: #80bdff;
        }
        
        .form-control:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }
        
        /* Animación de rebote suave */
        @keyframes rebote-suave {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0, -8px, 0); }
            70% { transform: translate3d(0, -4px, 0); }
            90% { transform: translate3d(0, -2px, 0); }
        }
        
        .btn-bounce:hover {
            animation: rebote-suave 1s ease;
        }
        
        /* Efectos hover para cards y contenedores */
        .card:hover,
        .alert:hover,
        .badge:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Animación de rotación suave para iconos */
        @keyframes rotar-suave {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .icono-giratorio:hover {
            animation: rotar-suave 2s linear infinite;
        }
        
        /* Efectos hover para tablas */
        .table-hover tbody tr:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            transform: scale(1.01);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1);
        }
        
        /* Animación de deslizamiento lateral */
        @keyframes deslizar-entrada {
            from { 
                opacity: 0; 
                transform: translateX(-30px); 
            }
            to { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }
        
        .slide-in {
            animation: deslizar-entrada 0.6s ease-out;
        }
        
        /* Efectos hover para navegación */
        .navbar-nav .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transform: translateY(-2px);
        }
        
        /* Animación de parpadeo suave */
        @keyframes parpadeo-suave {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .parpadeo-suave {
            animation: parpadeo-suave 2s infinite;
        }
        
        /* Efectos hover para elementos interactivos */
        .clickable:hover {
            cursor: pointer;
            background: rgba(0, 123, 255, 0.05);
            border-radius: 8px;
            transform: scale(1.02);
        }
        
        /* Animación de ondas para botones de acción */
        @keyframes onda {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        .btn-onda {
            position: relative;
            overflow: hidden;
        }
        
        .btn-onda:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-onda:active:before {
            width: 300px;
            height: 300px;
        }
        
        /* Efectos hover para elementos de estado */
        .estado-activo:hover {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-color: #28a745;
        }
        
        .estado-inactivo:hover {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-color: #dc3545;
        }
        
        /* Animación de zoom suave */
        @keyframes zoom-suave {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .zoom-hover:hover {
            animation: zoom-suave 0.8s ease;
        }
        
        /* Efectos hover para elementos de menú */
        .dropdown-menu .dropdown-item:hover {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            transform: translateX(5px);
            border-radius: 6px;
        }
        
        /* Animación de flujo para elementos de progreso */
        @keyframes flujo {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .progress-animated {
            background: linear-gradient(-45deg, #007bff, #0056b3, #007bff, #0056b3);
            background-size: 400% 400%;
            animation: flujo 3s ease infinite;
        }
        
        /* Efectos hover para badges y etiquetas */
        .badge:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        /* Animación de escritura para texto */
        @keyframes escribir {
            from { width: 0; }
            to { width: 100%; }
        }
        
        .texto-escribir {
            overflow: hidden;
            border-right: 2px solid #007bff;
            white-space: nowrap;
            animation: escribir 3s steps(40, end), parpadeo-cursor 0.75s step-end infinite;
        }
        
        @keyframes parpadeo-cursor {
            from, to { border-color: transparent; }
            50% { border-color: #007bff; }
        }
        
        /* Efectos hover para iconos */
        .icono:hover {
            color: #007bff;
            transform: scale(1.2) rotate(10deg);
        }
        
        /* Animación de flotación suave */
        @keyframes flotar {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .flotante:hover {
            animation: flotar 2s ease-in-out infinite;
        }
        
        /* Efectos hover para controles de media */
        .control-media:hover {
            background: rgba(0, 123, 255, 0.1);
            border-radius: 50%;
            transform: scale(1.2);
        }
        
        /* Animación de deslizamiento hacia arriba */
        @keyframes deslizar-arriba {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .slide-up {
            animation: deslizar-arriba 0.6s ease-out;
        }
        
        /* Efectos hover para elementos de notificación */
        .notification:hover {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 5px solid #ffc107;
            transform: translateX(10px);
        }
        
        /* ===== SISTEMA DE NOTIFICACIONES PUSH EN TIEMPO REAL ===== */
        
        /* Contenedor principal de notificaciones */
        .notifications-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            width: 100%;
            pointer-events: none;
        }
        
        /* Icono contador de notificaciones */
        .notification-icon {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .notification-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(255, 107, 107, 0.6);
        }
        
        /* Badge contador */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            min-width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: pulse-badge 2s infinite;
        }
        
        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Notificación individual */
        .notification-toast {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #007bff;
            pointer-events: auto;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }
        
        .notification-toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification-toast.hide {
            transform: translateX(100%);
            opacity: 0;
            margin-bottom: 0;
            padding: 0;
            max-height: 0;
        }
        
        /* Tipos de notificación */
        .notification-toast.success {
            border-left-color: #28a745;
        }
        
        .notification-toast.warning {
            border-left-color: #ffc107;
        }
        
        .notification-toast.error {
            border-left-color: #dc3545;
        }
        
        .notification-toast.info {
            border-left-color: #17a2b8;
        }
        
        .notification-toast.urgent {
            border-left-color: #fd7e14;
            background: linear-gradient(135deg, #fff5e6 0%, #ffe0b8 100%);
            animation: urgent-pulse 1s infinite;
        }
        
        @keyframes urgent-pulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15); }
            50% { box-shadow: 0 8px 30px rgba(253, 126, 20, 0.4); }
        }
        
        /* Header de notificación */
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .notification-title {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
            line-height: 1.3;
            margin: 0;
            flex: 1;
            padding-right: 8px;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .notification-close:hover {
            background: #f8f9fa;
            color: #dc3545;
        }
        
        /* Contenido de notificación */
        .notification-body {
            color: #495057;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        /* Footer de notificación */
        .notification-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6c757d;
        }
        
        .notification-time {
            font-style: italic;
        }
        
        .notification-actions {
            display: flex;
            gap: 8px;
        }
        
        .notification-action {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .notification-action:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .notification-action.secondary {
            background: #6c757d;
        }
        
        .notification-action.secondary:hover {
            background: #545b62;
        }
        
        /* Barra de progreso para auto-dismiss */
        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(0, 123, 255, 0.3);
            width: 100%;
            transform-origin: left;
            transition: transform linear;
        }
        
        .notification-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #007bff;
            width: 100%;
            transform: scaleX(0);
            transform-origin: left;
            animation: progress-fill linear;
        }
        
        @keyframes progress-fill {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        /* Panel de notificaciones */
        .notifications-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 9998;
            transition: left 0.3s ease;
            overflow-y: auto;
            border-right: 1px solid #dee2e6;
        }
        
        .notifications-panel.open {
            left: 0;
        }
        
        .notifications-panel-header {
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notifications-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .notifications-panel-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
        }
        
        .notifications-panel-body {
            padding: 20px;
        }
        
        .notification-item {
            padding: 16px;
            border-bottom: 1px solid #f1f3f4;
            transition: background 0.2s ease;
            cursor: pointer;
        }
        
        .notification-item:hover {
            background: #f8f9fa;
        }
        
        .notification-item.unread {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        /* Configuración de notificaciones */
        .notification-settings {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 10001;
            max-width: 500px;
            width: 90%;
            display: none;
        }
        
        .notification-settings.show {
            display: block;
            animation: fadeInScale 0.3s ease;
        }
        
        /* Sonidos de notificación */
        .notification-sound-test {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.2s ease;
        }
        
        .notification-sound-test:hover {
            background: #218838;
        }
        
        /* Responsive para notificaciones */
        @media (max-width: 768px) {
            .notifications-container {
                max-width: 320px;
                right: 10px;
                top: 10px;
            }
            
            .notification-icon {
                top: 10px;
                left: 10px;
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .notifications-panel {
                width: 100%;
                left: -100%;
            }
            
            .notifications-panel.open {
                left: 0;
            }
        }
        
        /* Animación de respiración para elementos importantes */
        @keyframes respirar {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        
        .respirar {
            animation: respirar 4s ease-in-out infinite;
        }
        
        /* Efectos hover para elementos de búsqueda */
        .search-container:hover {
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
            border-radius: 12px;
        }
        
        .search-input:focus + .search-button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            transform: scale(1.05);
        }
        
        /* Animación de ondulación para superficie de agua */
        @keyframes ondular {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(1deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(-2px) rotate(-1deg); }
        }
        
        .ondular:hover {
            animation: ondular 2s ease-in-out infinite;
        }
        
            
        .nivel-volumen:hover {
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.5);
        }
        
        /* Animación de latido para indicadores activos */
        @keyframes latido {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        
        .latido-activo {
            animation: latido 1.5s ease-in-out infinite;
        }
        
        /* Efectos de transición para cambios de estado */
        .transicion-estado {
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        /* Animación de entrada en escena */
        @keyframes entrada-escena {
            0% { 
                opacity: 0; 
                transform: scale(0.3) rotate(-10deg); 
            }
            50% { 
                opacity: 0.8; 
                transform: scale(1.05) rotate(2deg); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1) rotate(0deg); 
            }
        }
        
        .entrada-escena {
            animation: entrada-escena 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        /* Animación de brillo para elementos destacados */
        @keyframes brillo {
            0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 255, 255, 0.8), 0 0 30px rgba(0, 123, 255, 0.3); }
            100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        }
        
        .brillo:hover {
            animation: brillo 2s ease-in-out infinite;
        }
        
        /* Efectos de escalado suave para interacciones */
        .escalar-suave:hover {
            transform: scale(1.05);
            transition: transform 0.3s ease;
        }
        
        .escalar-suave:active {
            transform: scale(0.98);
            transition: transform 0.1s ease;
        }
        
        /* Animación de desvanecimiento elegante */
        @keyframes desvanecer-elegante {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .desvanecer-elegante {
            animation: desvanecer-elegante 0.6s ease-out;
        }
        
        /* Efectos hover específicos para el sistema de comunicación */
        .modal-comunicacion .opcion-envio:hover {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border: 2px solid #28a745;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
        }
        
        /* Animación de carga punteada */
        @keyframes puntos-carga {
            0%, 20% { color: rgba(0, 0, 0, 0); text-shadow: 0.25em 0 0 rgba(0, 0, 0, 0), 0.5em 0 0 rgba(0, 0, 0, 0); }
            40% { color: #007bff; text-shadow: 0.25em 0 0 rgba(0, 0, 0, 0), 0.5em 0 0 rgba(0, 0, 0, 0); }
            60% { text-shadow: 0.25em 0 0 #007bff, 0.5em 0 0 rgba(0, 0, 0, 0); }
            80%, 100% { text-shadow: 0.25em 0 0 #007bff, 0.5em 0 0 #007bff; }
        }
        
        .carga-puntos:after {
            content: ' ...';
            animation: puntos-carga 1.5s steps(5, end) infinite;
        }
        
        /* Efectos hover para elementos de estado del sistema */
        .estado-sistema:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            transform: translateX(5px);
            border-left: 4px solid #17a2b8;
            padding-left: 12px;
        }
        
        /* Suavizado de movimientos para elementos móviles */
        .elemento-movil {
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        box-shadow 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94),
                        background 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .reloj-compacto,
        .calendario-compacto {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-sm);
            background: rgba(232, 240, 245, 0.98);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-subtle);
            border: 1px solid #c8d5dc;
        }
        
        .reloj-display {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            padding: var(--spacing-xs);
        }
        
        .fecha-display {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-color);
            text-align: center;
            padding: var(--spacing-xs);
        }
        
        @media (max-width: 1200px) {
            .seccion-formulario {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }
            
            .botones-primarios {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            }
            
            .botones-consulta {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .container-principal {
                padding: var(--spacing-lg);
                margin: var(--spacing-sm);
            }
            
            .titulo {
                font-size: 2rem;
                margin-bottom: var(--spacing-lg);
            }
            
            .botones-primarios,
            .botones-consulta {
                grid-template-columns: 1fr;
            }
            
            .btn-herramienta {
                background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%); /* verde moderno */
                color: #fff;
                padding: var(--spacing-xs) var(--spacing-sm);
                border-radius: var(--radius-sm);
                font-size: 0.85rem;
                font-weight: 600;
            }

            .reloj-tiempo {
                font-size: 2rem;
                box-shadow: 0 6px 14px rgba(22, 163, 74, 0.25);
                transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
            }
            .calendario-reloj-compacto {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .btn-herramienta:hover { transform: translateY(-1px); box-shadow: 0 10px 20px rgba(22,163,74,.35); filter: brightness(1.05); }
            .btn-herramienta:active { transform: translateY(0); }
            .btn-herramienta:focus { outline: none; box-shadow: 0 0 0 3px rgba(34,197,94,.25); }
            .reloj-display {
                font-size: 1.3rem;
            }
            
            .fecha-display {
                font-size: 1rem;
            }
            
            .seccion-calendario-compacta > div {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .reloj-digital-compacto {
                min-width: auto !important;
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: var(--spacing-sm);
            }
            
            .container-principal {
                padding: var(--spacing-md);
            }
            
            .botones-herramientas {
                grid-template-columns: 1fr;
            }
            
            .btn-flotante-ep {
                top: var(--spacing-sm);
                right: var(--spacing-sm);
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
<!-- Franja superior azul con texto desplazándose (ticker informativo) -->
<div class="banner-ticker" role="status" aria-live="polite" id="bannerTicker">
    <div class="banner-inner" id="bannerInner">
        <span class="banner-text" id="bannerText"> 📌 Personaliza la atención: usa el nombre del cliente y agradece el tiempo en espera.</span>
    </div>
    <button type="button" class="banner-toggle" id="bannerToggle" aria-label="Pausar desplazamiento" title="Pausar/Continuar" onclick="toggleBannerTicker()">❚❚</button>
</div>
<!-- Cuadro de búsqueda rápida (Ctrl+K) -->
<div id="busquedaRapidaOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:120000; background:rgba(30,41,59,0.18); justify-content:center; align-items:flex-start;">
    <div id="busquedaRapidaBox" style="margin-top:10vh; background:#fff; border-radius:14px; box-shadow:0 8px 32px rgba(0,33,71,0.18); padding:1.2rem 1.5rem 1.1rem 1.5rem; min-width:340px; max-width:90vw; width:420px;">
        <div style="display:flex; align-items:center; gap:10px;">
            <input id="busquedaRapidaInput" type="text" placeholder="Buscar acceso rápido..." autocomplete="off" style="flex:1; font-size:1.1em; padding:8px 12px; border-radius:8px; border:1px solid #cbd5e1; outline:none;" />
            <button id="busquedaRapidaCerrar" type="button" style="background:transparent; border:none; font-size:1.3em; color:#64748b; cursor:pointer; margin-left:4px;" aria-label="Cerrar búsqueda">✕</button>
        </div>
        <ul id="busquedaRapidaResultados" style="list-style:none; margin:14px 0 0 0; padding:0; max-height:260px; overflow-y:auto;"></ul>
        <div id="busquedaRapidaVacio" style="display:none; color:#64748b; font-size:.97em; margin-top:10px;">Sin resultados.</div>
    </div>
</div>
<!-- Banner superior de ayuda eliminado a solicitud del usuario -->
<!-- Botón flotante Ayuda Global (ubicado en primer body para que siempre cargue) -->
<button type="button" class="help-fab" onclick="abrirModalAyuda()" aria-label="Ayuda general del sistema">ℹ <small>Ayuda</small></button>
<!-- Contenedor de notificaciones toast -->
<div id="notificationsContainer" style="position:fixed; top:70px; right:20px; z-index:10000; display:flex; flex-direction:column; gap:10px; pointer-events:none;">
    <!-- Aquí se agregarán las notificaciones dinámicamente -->
</div>
<!-- Modal Ayuda Global (overlay) -->
<div id="modalAyuda" class="modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); z-index:3000; justify-content:center; align-items:center;">
    <div class="modal-ayuda-contenido" role="dialog" aria-modal="true" aria-labelledby="ayudaTitulo">
        <div class="modal-ayuda-header">
            <h2 id="ayudaTitulo" class="modal-ayuda-title">Guía rápida y feriados</h2>
            <button class="modal-ayuda-close" aria-label="Cerrar ayuda" onclick="cerrarModalAyuda()">✕</button>
        </div>
        <div class="modal-ayuda-section">
            <h4>1. Módulos principales</h4>
            <ul>
                <li><span class="badge">Calendario</span> Navega meses, destaca hoy y feriados (map en <code>app.js</code>).</li>
                <li><span class="badge">Modales</span> Información contextual (apertura/cierre genérico).</li>
                <li><span class="badge">Submenú SNL</span> Acceso rápido scripts SNL.</li>
                <li><span class="badge">Grabar</span> Guarda sin recargar, feedback visual.</li>
            </ul>
        </div>
        <div class="modal-ayuda-section">
            <h4>2. Actualizar feriados</h4>
            <p>Pasos para cambiar el año o agregar feriados:</p>
            <ol style="margin:0 0 .75rem 1.2rem; padding:0;">
                <li>Abrir <code>assets/js/app.js</code>.</li>
                <li>Buscar <code>Feriados Chile</code>.</li>
                <li>Editar el <code>Map</code> <code>feriadosCL</code> agregando/eliminando líneas: formato <code>'YYYY-MM-DD','Descripción'</code>.</li>
                <li>Si cambia el año, ajustar comentario y fechas movibles.</li>
                <li>Guardar y recargar (Ctrl+F5).</li>
            </ol>
            <pre style="background:#1f2937;color:#f8fafc;padding:.75rem 1rem;border-radius:8px;overflow:auto;font-size:.7rem;line-height:1.25;">// Ejemplo
const feriadosCL = new Map([
    ['2026-01-01','Año Nuevo'],
    // ...
]);</pre>
        </div>
        <div class="modal-ayuda-section">
            <h4>3. Próximas mejoras</h4>
            <ul>
                <li>Accesibilidad: foco inicial, ESC para cerrar.</li>
                <li>Persistencia avanzada (config).</li>
                <li>Lazy load y minificación.</li>
                <li>Feriados desde JSON externo.</li>
            </ul>
        </div>
        <div class="modal-ayuda-section" style="margin-top:1rem;font-size:.7rem;color:#6b7280;">
            <em>Versión ayuda 2025-11-10</em>
        </div>
    </div>
</div>
    <div class="container-principal fade-in-scale">
        <div class="titulo">🏢 ACHS EJECUTIVO CENTRALIZADO</div>
        <div class="subtitulo">Panel de gestión para ejecutivos </div>
        
        <div class="seccion-formulario">
            <div class="botones-principales slide-in-right">
                <!-- Botones Primarios (Más importantes) - Reorganizados -->
                <div class="seccion-botones">
                    <h3 style="color: var(--primary-blue); margin: 0 0 var(--spacing-sm) 0; font-size: 1rem; font-weight: 600; text-align: center; border-bottom: 2px solid var(--accent-blue); padding-bottom: var(--spacing-xs);">🎯 Acciones Principales</h3>
                    <div class="botones-primarios">
                        <button id="btnAccesoDirecto" class="btn-primario hover-lift escalar-suave zoom-hover" data-tooltip="Enlaces de acceso rápido" onclick="toggleAccesoLinks()">📋 ACCESO DIRECTO</button>
                        <button id="btnSalesforce" class="btn-primario hover-lift escalar-suave zoom-hover" data-tooltip="Ir a Salesforce" onclick="window.open('https://achs.lightning.force.com/lightning/o/Account/list?filterName=__Recent', '_blank')">🔗 SALESFORCE</button>
                        <button id="btnNovedades" class="btn-primario hover-lift escalar-suave zoom-hover" data-tooltip="Ver novedades" onclick="abrirModalNovedades()">🆕 NOVEDADES</button>
                        <button id="exportar" class="btn-primario hover-lift escalar-suave" data-tooltip="Exportar datos a Excel">📥 EXPORTAR EXCEL</button>
                        <div class="anexo-wrapper" style="position:relative; display:block; width:100%;">
                            <button id="btnAnexo" class="btn-anexo-entretenido" data-tooltip="📊 Anexo interactivo de contactos y transferencias - Haz clic para ver menú" aria-haspopup="true" aria-expanded="false" onclick="toggleSubmenuAnexo(event)">
                                <span class="btn-anexo-icono">📊</span>
                                <span class="btn-anexo-texto">ANEXO</span>
                                <span style="margin-left:6px; font-size:0.9em;">▾</span>
                            </button>
                            <div id="submenuAnexo" class="submenu-anexo" style="display:none; position:absolute; top:100%; left:0; background:#ffffff; border:2px solid #002147; border-radius:10px; padding:10px 12px; box-shadow:0 6px 20px rgba(0,33,71,0.25); min-width:240px; z-index:300;">
                                <div style="font-weight:700; color:#002147; font-size:0.85rem; letter-spacing:.5px; margin-bottom:6px; display:flex; align-items:center; gap:6px;">📂 Menú Anexo</div>
                                <button type="button" class="submenu-item-anexo" onclick="abrirModalAnexo()" style="display:block; width:100%; text-align:left; background:#f1f5f9; color:#002147; border:1px solid #cbd5e1; border-radius:8px; padding:8px 10px; font-size:0.85rem; font-weight:600; cursor:pointer; margin-bottom:6px;">📊 Ver Anexo Completo</button>
                                <button type="button" class="submenu-item-anexo" onclick="abrirModalIVR()" style="display:block; width:100%; text-align:left; background:#e0f2fe; color:#1e3a8a; border:1px solid #93c5fd; border-radius:8px; padding:8px 10px; font-size:0.85rem; font-weight:600; cursor:pointer;">📞 Diagrama IVR</button>
                                <div style="margin-top:10px; font-size:0.65rem; color:#64748b; font-weight:500;">Actualizado 02-06-2025</div>
                            </div>
                        </div>
                        <button id="btnReclamo" class="btn-primario hover-lift escalar-suave zoom-hover" data-tooltip="Formulario de reclamos y quejas" onclick="abrirModalReclamo()">📢 RECLAMO</button>
                    </div>
                </div>
                
                <!-- Botones de Consulta (Frecuentes) -->
                <div class="seccion-botones">
                    <h3 style="color: var(--secondary-blue); margin: 0 0 var(--spacing-sm) 0; font-size: 0.9rem; font-weight: 600; text-align: center; border-bottom: 2px solid var(--accent-blue); padding-bottom: var(--spacing-xs);">💬 Consulta y Comunicación</h3>
                    <div class="botones-consulta">
                        <button id="btnPrecios" class="btn-secundario hover-scale" data-tooltip="Valores de prestaciones ACHS">💰 PRECIOS</button>
                        <button id="btnMedicosBonos" class="btn-secundario hover-scale" data-tooltip="Ver profesionales para compra de bonos" onclick="abrirModalMedicosBonos()">🩺 Nombres de médicos para compra de bonos</button>
<!-- Modal Nombres de Médico para Bonos -->
<div id="modalMedicosBonos" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:600px; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(0,150,136,0.15); padding:2rem 2rem 1.4rem; position:relative;">
        <button onclick="cerrarModalMedicosBonos()" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.6rem; color:#009688; cursor:pointer;">&times;</button>
        <h2 style="color:#009688; margin-bottom:.9rem; text-align:center; font-size:1.55rem;">🩺 Profesionales por Zona – Compra de Bonos ACHS</h2>
        <style>
            #modalMedicosBonos .mb-toolbar{display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center; margin:.1rem 0 .8rem;}
            #modalMedicosBonos .mb-toolbar button{background:#009688; color:#fff; border:none; padding:.45rem .85rem; font-size:.7rem; font-weight:700; border-radius:7px; cursor:pointer; box-shadow:0 3px 10px rgba(0,150,136,.28);}            
            #modalMedicosBonos .mb-toolbar button:hover{filter:brightness(1.08);}            
            #modalMedicosBonos .accordion-medicos details{border:1px solid #b2dfdb; border-radius:10px; padding:.55rem .9rem .7rem; background:#f1fafa; margin-bottom:.55rem; box-shadow:0 2px 6px rgba(0,150,136,0.09);}            
            #modalMedicosBonos .accordion-medicos details[open]{background:#e0f2f1; border-color:#009688; box-shadow:0 4px 14px rgba(0,150,136,0.18);}            
            #modalMedicosBonos .accordion-medicos summary{list-style:none; cursor:pointer; display:flex; align-items:center; gap:.55rem; font-weight:700; color:#00695c; font-size:1.01em;}
            #modalMedicosBonos .accordion-medicos summary::marker{display:none;}
            #modalMedicosBonos .accordion-medicos ul{margin:.55rem 0 .4rem .9rem; padding:0;}
            #modalMedicosBonos .nota{color:#c0392b; font-size:.75rem; font-weight:600; background:#fdecea; padding:.4rem .6rem; border-radius:6px; border:1px solid #f5c6cb;}
        </style>
        <div class="mb-toolbar">
            <button onclick="(function(){document.querySelectorAll('#modalMedicosBonos .accordion-medicos details').forEach(d=>d.open=true);})()">Expandir todo</button>
            <button onclick="(function(){document.querySelectorAll('#modalMedicosBonos .accordion-medicos details').forEach(d=>d.open=false);})()">Contraer todo</button>
        </div>
        <div class="accordion-medicos">
            <details>
                <summary>👨‍⚕️ Médico General – Traumatología – Dermatología <span style="font-weight:400; font-size:.85em; color:#004d40;">(Código 0101001)</span></summary>
                <ul>
                    <li>🧭 Norte: <b>María José Seguí Arcos</b> (Antofagasta)</li>
                    <li>🏙️ Centro: <b>Miguel José Ayala Angarita</b> (Maipú)</li>
                    <li>🌧️ Sur: <b>Luis Diego Bermúdez Jiménez</b> (Valdivia)</li>
                </ul>
                <div class="nota">📝 Importante: Elegir al profesional según la zona de la sede donde se atenderá el paciente.</div>
            </details>
            <details>
                <summary>🧘‍♂️ Kinesiología</summary>
                <ul>
                    <li>🧭 Norte: <b>Nelson Ignacio Arancibia Figueroa</b> (Antofagasta)</li>
                    <li>🏙️ Centro: <b>Krish Rayen García González</b> (Maipú)</li>
                    <li>🌧️ Sur: <b>Claudia Andrea Daetz Medina</b> (Osorno)</li>
                </ul>
            </details>
            <details>
                <summary>🧠 Psicología – Asignación por sedes</summary>
                <ul>
                    <li><b>Francisca Peñafiel</b><br><span style="font-size:.78em; color:#007bff;">🔹 La Serena · Valparaíso · San Antonio</span></li>
                    <li><b>Eileen Yamile Green Jara</b><br><span style="font-size:.78em; color:#007bff;">🔹 San Felipe · San Miguel</span></li>
                </ul>
            </details>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->
<!-- Modal Novedades -->
<div id="modalNovedades" class="modal" style="display:none; justify-content:center; align-items:center;">
        <div class="modal-contenido" id="contenidoNovedades" style="max-width:720px; background:white; border-radius:12px; box-shadow:0 8px 32px rgba(0,33,71,0.15); padding:1.2rem; position:relative; max-height:85vh; overflow-y:auto; transform:scale(1); transition:transform 0.2s ease;">
                <div style="position:absolute; top:10px; right:10px; display:flex; gap:5px; align-items:center;">
                    <button onclick="ajustarZoomModal('contenidoNovedades', -0.1)" style="background:#e2e8f0; color:#1e3a8a; border:none; border-radius:4px; width:28px; height:28px; cursor:pointer; font-size:1.1rem; font-weight:bold;" title="Reducir zoom">−</button>
                    <button onclick="ajustarZoomModal('contenidoNovedades', 0)" style="background:#e2e8f0; color:#1e3a8a; border:none; border-radius:4px; padding:4px 8px; cursor:pointer; font-size:0.75rem; font-weight:bold;" title="Restablecer zoom">100%</button>
                    <button onclick="ajustarZoomModal('contenidoNovedades', 0.1)" style="background:#e2e8f0; color:#1e3a8a; border:none; border-radius:4px; width:28px; height:28px; cursor:pointer; font-size:1.1rem; font-weight:bold;" title="Aumentar zoom">+</button>
                    <button onclick="cerrarModalNovedades()" style="background:none; border:none; font-size:1.3rem; color:#1e3a8a; cursor:pointer;">&times;</button>
                </div>
                <h2 style="color:#1e3a8a; margin-bottom:0.7rem; text-align:center; font-size:1.3rem;">🆕 Novedades</h2>
                <div style="margin-bottom:0.8rem; color:#334155; font-size:0.85rem;">
                        <p style="margin:0 0 0.6rem;">Aquí podrás listar comunicados, cambios y mejoras recientes de todos los procedimientos</p>
                        
                </div>
                <!-- Subtema solicitado (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:8px; background:#f8fafc; color:#0f172a; margin-bottom:6px;">
                    <summary style="list-style:none; cursor:pointer; padding:7px 10px; display:flex; align-items:center; gap:7px;">
                        <span style="flex:0 0 auto; width:14px; height:14px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a; font-size:0.75rem;">▸</span>
                        <span style="color:#1e3a8a; font-size:0.85rem; font-weight:600;">Consultas sobre estado de solicitudes de reembolso por compras de bonos en forma presencial</span>
                    </summary>
                    <div style="padding:7px 10px; border-top:1px solid #e5e7eb; display:grid; gap:6px; font-size:0.8rem;">
                        <div style="background:#e8eef3; border-radius:6px; padding:7px;">
                            <b>Recordatorio:</b>
                            <p style="margin:4px 0 0;">
                                Las consultas sobre el estado de solicitudes de reembolso deben gestionarse directamente en los centros ACHS Salud, ya que se trata de compras de bonos realizadas en forma presencial.<br>
                                No se entregan actualizaciones por teléfono ni por otros canales.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:6px; padding:7px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:4px 0 0;">
                                Evita derivaciones incorrectas, reduce tiempos de espera y asegura que el paciente reciba información oficial y actualizada en el lugar correspondiente.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:6px; padding:7px;">
                            <b>Tip práctico:</b>
                            <p style="margin:4px 0 5px;">
                                En la llamada, puedes decir:<br>
                                “Como su bono fue comprado presencialmente, el estado de su reembolso debe consultarlo directamente en el centro donde lo gestionó. Ellos tienen acceso al detalle y podrán orientarlo mejor.”
                            </p>
                            <ul style="margin:0; padding-left:1rem; font-size:0.75rem;">
                                <li>Tarjeta de crédito: se realiza la reversa del cobro, el plazo dependerá de cada banco.</li>
                                <li>Tarjeta de débito: se realiza la devolución del dinero a través de una transferencia bancaria (completar formulario) con un plazo de 21 días hábiles.</li>
                                <li>Pago con efectivo: Devolución inmediata.</li>
                            </ul>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Tipos de solicitudes por formulario SNL (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:8px; background:#f8fafc; color:#0f172a; margin-bottom:6px;">
                    <summary style="list-style:none; cursor:pointer; padding:7px 10px; display:flex; align-items:center; gap:7px;">
                        <span style="flex:0 0 auto; width:14px; height:14px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a; font-size:0.75rem;">▸</span>
                        <span style="color:#1e3a8a; font-size:0.85rem; font-weight:600;">Tipos de solicitudes que se gestionan por formulario SNL</span>
                    </summary>
                    <div style="padding:7px 10px; border-top:1px solid #e5e7eb; display:grid; gap:6px; font-size:0.8rem;">
                        <div style="background:#fff; border:1px solid #e2e8f0; border-radius:6px; padding:7px;">
                            <p style="margin:0; color:#0f172a;">
                                📌 Recuerden que existen distintas solicitudes que deben ingresarse exclusivamente por el formulario oficial de <b>Solicitudes Salud No Laboral (SNL) ACHS</b>.
                            </p>
                        </div>
                        <div style="background:#f1f5f9; border-radius:6px; padding:7px;">
                            <b style="color:#334155;">🔹 Ejemplos de solicitudes válidas:</b>
                            <ul style="margin:4px 0 0; padding-left:1rem; font-size:0.75rem;">
                                <li>📄 Certificado de atención</li>
                                <li>❌ Informe de rechazo o reducción de licencia</li>
                                <li>🩺 Informe médico</li>
                                <li>📋 Informe de atenciones médicas</li>
                                <li>🕒 Cita pendiente para entrega de diagnóstico</li>
                                <li>🔄 Paciente derivado por Enfermedad Profesional u otras patologías</li>
                                <li>📦 Otras solicitudes SNL (boletas, recetas, órdenes clínicas, etc.)</li>
                            </ul>
                        </div>
                        <div style="background:#e8eef3; border-radius:6px; padding:7px;">
                            <p style="margin:0;">
                                🔗 <b>Formulario oficial</b> disponible en el canal interno o SharePoint correspondiente.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <p style="margin:0; color:#065f46;">
                                💡 <b>Centralizar las solicitudes</b> agiliza la gestión y asegura trazabilidad.
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Tiempo límite para pagar cita de Telemedicina SNL (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Tiempo límite para pagar cita de Telemedicina SNL</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Una vez que se graba la cita, el paciente tiene <b>15 minutos</b> para realizar el pago.<br>
                                Si paga después de ese plazo, el sistema realiza el descuento, pero la cita se anula automáticamente y no se agenda.<br>
                                Esto aplica especialmente para citas de <b>Telemedicina SNL</b>.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita que el paciente pierda su atención y que se generen reclamos por cobros sin prestación. También permite liberar el cupo para otro paciente.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Desde que se graba la cita, tiene 15 minutos para pagar. Si lo hace después, el sistema cobra igual, pero no agenda la atención. Es importante pagar dentro del plazo para asegurar su cita."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Plazo de entrega de resultados de Rayos en centros ACHS (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Plazo de entrega de resultados de Rayos en centros ACHS</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Si el paciente se tomó rayos en un centro ACHS, podrá acceder a sus resultados dentro de <b>48 horas hábiles</b>.<br>
                                Debe ingresar al siguiente enlace y validar su identidad:<br>
                                🔗 <a href="https://www.hospitaldeltrabajador.cl/resultados-imagenologia/" target="_blank" style="color:#2563eb; text-decoration:underline;">Resultados de Imagenología – Hospital del Trabajador</a>
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita que el paciente espere innecesariamente o llame antes del plazo. También permite entregar una respuesta clara y confiable desde el primer contacto.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Sus resultados estarán disponibles en 48 horas hábiles. Puede acceder directamente en el portal del Hospital del Trabajador, ingresando su RUT y clave."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: ¿Quién entrega los diagnósticos en SNL? (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">¿Quién entrega los diagnósticos en SNL?</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Todas las citas de diagnóstico en SNL son realizadas por un <b>Médico General</b>, con experiencia en traumatología o dermatología, según corresponda.<br>
                                Este profesional se guía por las indicaciones del Traumatólogo tratante o Dermatólogo, asegurando una atención precisa y alineada con el caso clínico.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita confusiones sobre el tipo de especialista que atiende y refuerza la confianza del paciente en el proceso. También permite entregar una respuesta clara y segura desde el primer contacto.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "La entrega de diagnóstico la realiza un Médico General con experiencia en el área, guiado por las indicaciones del (Traumatólogo o Dermatólogo). Así aseguramos continuidad y claridad en su atención."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Agendamiento de citas por término de licencia médica – Paciente SNL (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Agendamiento de citas por término de licencia médica – Paciente SNL</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                El paciente debe agendar con anticipación su cita médica antes del término de su licencia.<br>
                                Nosotros <b>no realizamos llamados</b> para programar estas citas.<br>
                                La extensión de la licencia será determinada exclusivamente por el Médico tratante durante la atención.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita que el paciente quede sin continuidad de atención y aclara que la responsabilidad de agendar es del propio paciente. También previene expectativas erróneas sobre llamados automáticos o garantías de extensión.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Debe agendar su cita antes de que termine su licencia. Nosotros no llamamos para programarla, y será el médico quien evalúe si corresponde extenderla."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: ¿Cuál es el nombre del médico que me va a atender? (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">¿Cuál es el nombre del médico que me va a atender?</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                El sistema de asignación de médicos funciona según la disponibilidad del centro, por lo que no se puede garantizar un nombre específico al momento de agendar.<br>
                                Siempre se cuenta con <b>Médicos Generales de alto estándar</b>, con experiencia en áreas como traumatología y dermatología, según el tipo de atención.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita generar expectativas específicas y refuerza la confianza en la calidad profesional del equipo médico. También permite entregar una respuesta clara y segura desde el primer contacto.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "La asignación del médico depende de la disponibilidad del centro, pero siempre contamos con profesionales generales altamente capacitados para atender su caso."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Descuento de seguro complementario no aplicado al pagar bono (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Descuento de seguro complementario no aplicado al pagar bono</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Si al momento de pagar el bono no aparece el descuento del seguro complementario, el paciente debe realizar el reembolso <b>directamente con su aseguradora</b>.<br>
                                Este proceso se gestiona de forma externa, fuera del sistema ACHS Salud.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita que el paciente espere una corrección en el momento del pago y permite entregar una respuesta clara y orientadora desde el primer contacto.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Si su seguro complementario no aplicó el descuento al pagar el bono, debe solicitar el reembolso directamente con su aseguradora. Nosotros no gestionamos ese proceso."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Renovación de licencia/receta médica sin hora disponible con psicólogo (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Renovación de licencia/receta médica sin hora disponible con psicólogo</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Si el paciente necesita renovar licencia o receta médica con médico de salud mental, pero no encuentra hora disponible con psicólogo, se debe <b>levantar el caso por Teams</b> para que sea gestionado por el Back Office.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Permite dar continuidad a tratamientos y evitar interrupciones en licencias o recetas, especialmente en casos de salud mental. También asegura que el paciente reciba atención oportuna mediante gestión interna.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Si no encuentra hora con psicólogo, vamos a levantar el caso por nuestro canal interno para que lo gestione y pueda continuar con su tratamiento."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Derivación a Traumatólogo Especialista – Región Metropolitana (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Derivación a Traumatólogo Especialista – Región Metropolitana</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Si el paciente es de la Región Metropolitana y busca atención con Traumatólogo Especialista, puede ser derivado al <b>CEM – Centro Médico del Hospital del Trabajador</b>, ubicado en:<br>
                                📍 <b>Vicuña Mackenna 210, Providencia</b> (a pasos del Metro Parque Bustamante).<br><br>
                                🔹 <b>Especialidades traumatológicas disponibles:</b><br>
                                • Cadera y Pelvis<br>
                                • Columna<br>
                                • Extremidad Superior<br>
                                • Hombro<br>
                                • Rodilla<br>
                                • Tobillo y Pie<br><br>
                                📞 Podemos transferir directamente al Centro Médico.<br>
                                📲 El ejecutivo debe marcar el <b>anexo 8021</b> para realizar la transferencia.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Facilita el acceso a atención especializada, mejora la experiencia del paciente y permite una derivación directa y efectiva.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Podemos transferirlo directamente al Centro Médico del Hospital del Trabajador, donde atienden especialistas en traumatología. El centro está ubicado en Vicuña Mackenna 210, Providencia."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Derivación a servicios de imagenología – Región Metropolitana (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Derivación a servicios de imagenología – Región Metropolitana</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Si el paciente es de la Región Metropolitana y busca servicios de imagenología, puede ser derivado al <b>CEM – Centro Médico del Hospital del Trabajador</b>, ubicado en:<br>
                                📍 <b>Vicuña Mackenna 210, Providencia</b> (a pasos del Metro Parque Bustamante).<br><br>
                                🔹 <b>Servicios disponibles en el CEM:</b><br>
                                • Resonancia Magnética<br>
                                • Tomografía Computada<br>
                                • Radiología<br>
                                • Ecocardiograma<br><br>
                                📞 Podemos transferir directamente al Centro Médico.<br>
                                📲 El ejecutivo debe marcar el <b>anexo 8023</b> para realizar la transferencia.<br><br>
                                ⚠️ <b>Importante:</b><br>
                                Solo se deriva al CEM si el servicio solicitado no está disponible en ACHS Salud. Validar siempre antes de transferir.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Facilita el acceso a servicios especializados, mejora la orientación desde el primer contacto y evita derivaciones innecesarias.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Si necesita imagenología como resonancia o ecocardiograma, podemos transferirlo al Centro Médico del Hospital del Trabajador. Está en Vicuña Mackenna 210, Providencia."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Ingreso EP-SM para colaboradores ACHS (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Ingreso EP-SM para colaboradores ACHS</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Cuando llama un ejecutivo de ACHS o cualquier colaborador de la institución solicitando ingreso por <b>EP-SM (Evaluación Psicológica – Salud Mental)</b>, se debe aplicar el mismo protocolo que usamos para pacientes comunes.<br><br>
                                🔹 <b>Esto incluye:</b><br>
                                • Validar si ya tuvo ingreso previo en SAP.<br>
                                • Revisar carpeta de documentos en "TOTAL".<br>
                                • Confirmar si corresponde nueva cita o seguimiento.<br>
                                • Aplicar criterios de derivación y atención según procedimiento vigente.<br><br>
                                ⚠️ No se debe asumir prioridad ni aplicar protocolos distintos por ser colaborador. La atención debe ser igualitaria, clara y profesional.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Garantiza equidad en la atención, evita sesgos o trato preferencial y mantiene la transparencia del proceso de gestión de salud mental.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Si llama un colaborador ACHS por ingreso EP-SM, seguimos el mismo protocolo que con cualquier paciente. Revisamos SAP, validamos ingreso y gestionamos según procedimiento."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Validación de siniestro y derivación en EP Salud Mental (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Validación de siniestro y derivación en EP Salud Mental</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Antes de gestionar cualquier cita en <b>EP Salud Mental</b>, es fundamental revisar el siniestro del paciente para determinar el tipo de ingreso y aplicar el protocolo correspondiente.<br><br>
                                🔍 <b>Pasos clave para validar y derivar correctamente:</b><br>
                                • Revisar el siniestro antes de considerar las horas visibles en SAP.<br>
                                • Identificar si el caso corresponde a una EP Salud Mental.<br>
                                • Verificar el estado del siniestro:<br>
                                &nbsp;&nbsp;&nbsp;- Si está <b>en estudio</b>, se gestiona como Enfermedad Profesional y se aplica el protocolo interno.<br>
                                &nbsp;&nbsp;&nbsp;- Si está <b>acogido</b>, es un paciente ley y debe ser derivado a <b>Informaciones</b>, quienes pueden reagendar usando el mismo formulario que el equipo.<br>
                                • Validar si el paciente está en tratamiento por accidente laboral traumático. En ese caso, también se deriva a Informaciones.<br><br>
                                ⚠️ Evitar agendar directamente sin revisar el siniestro, ya que muchas veces las horas en SAP no reflejan el contexto legal o clínico del paciente.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Garantiza que cada paciente reciba la atención correcta según su situación legal y clínica, evita derivaciones incorrectas y asegura el cumplimiento de protocolos internos.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En el equipo, puedes recordar:<br>
                                "Antes de agendar una cita en EP Salud Mental, revisa el siniestro. Si es acogido, deriva a Informaciones. Si está en estudio, lo trabajamos como EP con protocolo."
                            </p>
                        </div>
                    </div>
                </details>
                <!-- Subtema: Horarios de continuidad en Kinesiología (plegable) -->
                <details style="border:1px solid #e5e7eb; border-radius:12px; background:#f8fafc; color:#0f172a; margin-top:12px;">
                    <summary style="list-style:none; cursor:pointer; padding:12px 14px; display:flex; align-items:center; gap:10px;">
                        <span style="flex:0 0 auto; width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; color:#1e3a8a;">▸</span>
                        <span style="color:#1e3a8a; font-size:1.05rem; font-weight:600;">Horarios de continuidad en Kinesiología</span>
                    </summary>
                    <div style="padding:12px 14px; border-top:1px solid #e5e7eb; display:grid; gap:10px;">
                        <div style="background:#e8eef3; border-radius:8px; padding:10px;">
                            <b>Recordatorio:</b>
                            <p style="margin:6px 0 0;">
                                Los horarios de atención para citas de continuidad en Kinesiología (posteriores a la evaluación inicial) <b>no pueden ser asegurados por el Call Center</b>.<br><br>
                                🔹 <b>Esto se debe a que:</b><br>
                                • Dependen del capacity y disponibilidad interna de cada centro.<br>
                                • Se ajustan según la malla horaria del terapeuta y la organización local de la agencia.<br>
                                • El horario específico será definido directamente por el profesional tratante.<br><br>
                                ⚠️ No podemos garantizar si las sesiones serán en jornada AM o PM. El paciente debe consultarlo directamente con el terapeuta en el centro.
                            </p>
                        </div>
                        <div style="background:#dbeafe; border-radius:8px; padding:10px;">
                            <b>Por qué es importante:</b>
                            <p style="margin:6px 0 0;">
                                Evita generar expectativas erróneas sobre horarios específicos y permite entregar información clara y realista desde el primer contacto.
                            </p>
                        </div>
                        <div style="background:#ecfdf5; border-radius:8px; padding:10px;">
                            <b>Tip práctico:</b>
                            <p style="margin:6px 0 0;">
                                En la llamada, puedes decir:<br>
                                "Los horarios de continuidad en Kinesiología dependen del terapeuta y la disponibilidad del centro. No podemos asegurar si serán en la mañana o tarde, eso se define directamente en la sede."
                            </p>
                        </div>
                    </div>
                </details>
        </div>
    </div>
    <script>
        function abrirModalNovedades(){
            const m = document.getElementById('modalNovedades');
            if (m) m.style.display = 'flex';
        }
        function cerrarModalNovedades(){
            const m = document.getElementById('modalNovedades');
            if (m) m.style.display = 'none';
        }
    </script>

                        <button id="btnCorreos" class="btn-secundario hover-scale" data-tooltip="Directorio de correos">✉️ CORREOS</button>
                        <button id="btnPacientesSMP" class="btn-secundario hover-scale" onclick="abrirModal('modalPacientesSMP')" style="background:white; color:#111; font-weight:600; border:2px solid #3076e3;">🏥 SEDES BLOQUEADAS PARA AGENDAMIENTO PSICOLÓGICO</button>
<!-- Modal PACIENTES QUE PUEDEN AGENDAR CENTROS SMP -->
<div id="modalPacientesSMP" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:600px; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(48,118,227,0.15); padding:2rem; position:relative;">
    <button onclick="cerrarModal('modalPacientesSMP')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.5rem; color:#3076e3; cursor:pointer;">&times;</button>
        <h2 style="color:#3076e3; margin-bottom:1rem; text-align:center;">🏥 Pacientes que pueden agendar centros SMP</h2>
        <div style="overflow-x:auto; margin-bottom:1rem;">
            <table style="width:100%; border-collapse:collapse; font-size:1em;">
                <thead>
                    <tr style="background:#e8eef3; color:#222;">
                        <th style="padding:8px; border-bottom:2px solid #3076e3;">Centros Bloqueados</th>
                        <th style="padding:8px; border-bottom:2px solid #3076e3;">Psicólogo</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Puerto Montt</td><td>Andrés Céspedes Jara</td></tr>
                    <tr><td>Telemedicina</td><td>Valentina Andrea González Cid</td></tr>
                    <tr><td>Temuco</td><td>Sebastián Caniumil Candia</td></tr>
                    <tr><td>Copiapo</td><td>Macarena Cáceres Morales</td></tr>
                    <tr><td>Talcahuano</td><td>Camila Soto Melín</td></tr>
                    <tr><td>San Antonio</td><td>Nanjareth Arriagada De Luzia</td></tr>
                    <tr><td>Los Andes</td><td>Cristóbal Celedón Porzio</td></tr>
                    <tr><td>Viña del Mar</td><td>Daniela Salazar Arancibia</td></tr>
                    <tr><td>Viña del Mar</td><td>Silvia Moyano</td></tr>
                    <tr><td>La Serena</td><td>Débora Muñoz Zúñiga</td></tr>
                    <tr><td>Talca</td><td>Javiera Rojas Espinosa</td></tr>
                    <tr><td>Antofagasta</td><td>Kimberliee Julio Ñúñez</td></tr>
                    <tr><td>Talca</td><td>Marcela Chacón Flández</td></tr>
                    <tr><td>Rancagua</td><td>Maximiliano Peña Celis</td></tr>
                    <tr><td>Santiago Centro</td><td>Nicolás Castro Rodríguez</td></tr>
                    <tr><td>Temuco</td><td>Paloma Baeza Fernández</td></tr>
                    <tr><td>San Miguel</td><td>Sebastián Arias Corvalán</td></tr>
                    <tr><td>Peñaflor</td><td>Alejandra Pavone</td></tr>
                    <tr><td>Calama</td><td>Valentina Vergara Maturana</td></tr>
                    <tr><td>Concepción</td><td>AdafFrancis Cid Pizarro</td></tr>
                    <tr><td>Rancagua</td><td>Felipe Plaza Espinoza</td></tr>
                    <tr><td>San Felipe</td><td>Yetsemani Castro</td></tr>
                    <tr><td>La Serena</td><td>Consuelo Elorza</td></tr>
                </tbody>
            </table>
        </div>
        <script>
            // Ordenar alfabéticamente por "Centros Bloqueados" (1a columna)
            document.addEventListener('DOMContentLoaded', function(){
                try {
                    const tbody = document.querySelector('#modalPacientesSMP table tbody');
                    if (!tbody) return;
                    const rows = Array.from(tbody.querySelectorAll('tr'));
                    const coll = new Intl.Collator('es', { sensitivity: 'base' });
                    rows.sort((a,b) => {
                        const at = (a.cells[0]?.textContent || '').trim();
                        const bt = (b.cells[0]?.textContent || '').trim();
                        return coll.compare(at, bt);
                    });
                    rows.forEach(r => tbody.appendChild(r));
                } catch(e) { /* no-op */ }
            });
        </script>
        <div style="margin-bottom:1rem; font-size:0.97em; color:#666;">
            <b>Nota:</b> Algunos centros tienen 2 psicólogos y solo uno de ellos tiene la malla cerrada, por lo que dependerá del psicólogo con quien se atiende el paciente.
        </div>
        <!-- Botón guía: qué psicólogo agendar cuando la agencia tiene más de uno -->
        <div style="margin:0 0 1rem 0;">
            <button id="btnGuiaPsicologoSMP" style="background:#e0f2fe; color:#0369a1; border:1px solid #7dd3fc; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer;">
                ❓ ¿Qué psicólogo agendar en agencia bloqueada?
            </button>
            <div id="guiaPsicologoSMP" style="display:none; margin-top:10px; background:#f8fafc; border:1px solid #cbd5e1; border-radius:10px; padding:12px;">
                <div style="font-weight:700; color:#0f172a; margin-bottom:8px;">Guía rápida (agencias con más de un psicólogo):</div>
                <ul style="margin:0; padding-left:16px; color:#1f2937;">
                    <li><b>Puerto Montt:</b> Catalina Navarro Bocaz</li>
                    <li><b>Los Andes:</b> Nicolás Prado Ligeti</li>
                    <li><b>Viña del Mar:</b> Angela Morales Silva</li>
                </ul>
                <div style="margin-top:8px; font-size:0.9em; color:#475569;">Si necesitas agregar más centros a esta guía, indícamelos y los sumo.</div>
            </div>
            <script>
                (function(){
                    var btn = document.getElementById('btnGuiaPsicologoSMP');
                    var box = document.getElementById('guiaPsicologoSMP');
                    // Ordenar alfabéticamente la lista de la guía por nombre de agencia
                    try {
                        var ul = document.querySelector('#guiaPsicologoSMP ul');
                        if (ul) {
                            var items = Array.from(ul.querySelectorAll('li'));
                            var coll = new Intl.Collator('es', { sensitivity: 'base' });
                            items.sort(function(a,b){
                                var at = (a.querySelector('b')?.textContent || a.textContent || '').replace(':','').trim();
                                var bt = (b.querySelector('b')?.textContent || b.textContent || '').replace(':','').trim();
                                return coll.compare(at, bt);
                            });
                            items.forEach(function(li){ ul.appendChild(li); });
                        }
                    } catch(e) { /* no-op */ }
                    if(btn && box){
                        btn.addEventListener('click', function(){
                            var visible = box.style.display === 'block';
                            box.style.display = visible ? 'none' : 'block';
                        });
                    }
                })();
            </script>
        </div>
        <div style="margin-bottom:1rem;">
            <a href="https://achs.sharepoint.com/:x:/s/SaludIntegral/Eehipz2oYspAtLxZ5Onbs5UBQK4OU2bKfBBIAtDTw9GZwA?wdOrigin=TEAMS-MAGLEV.p2p_ns.rwc&wdExp=TEAMS-TREATMENT&wdhostclicktime=1759155374934&web=1" target="_blank" style="color:#3076e3; font-weight:600; text-decoration:underline;">📄 Ver Excel: Pacientes que pueden agendar centros</a>
        </div>
        <div style="background:#fff3cd; border:1px solid #ffc107; padding:12px; border-radius:6px; color:#856404; font-weight:600;">
            ⚠️ <b>Importante:</b> No se estarán aceptando nuevos pacientes por el minuto en estos centros.<br>
            <span style="font-size:0.97em; font-weight:400;">Refuerza: <b>NO agendar a ningún paciente que no esté en este listado para estos centros.</b></span>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

                        <button id="btnPlanillaRespuestas" class="btn-secundario hover-scale" data-tooltip="Respuestas predefinidas">📋 PLANILLA RESPUESTAS</button>
                        <button id="btnInformacionEP" class="btn-secundario hover-scale" onclick="abrirModal('modalInformacionEP')" data-tooltip="Información sobre Enfermedades Profesionales">📚 INFORMACION EP</button>
                        <button id="btnLeyKarin" class="btn-secundario hover-scale" onclick="abrirModal('modalLeyKarin')" data-tooltip="Preguntas Frecuentes Ley Karin">⚖️ LEY KARIN</button>
<!-- Modal LEY KARIN -->
<div id="modalLeyKarin" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:760px; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(0,33,71,0.15); padding:2rem; position:relative; overflow-y:auto; max-height:90vh;">
        <button onclick="cerrarModal('modalLeyKarin')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.5rem; color:#1e3a8a; cursor:pointer;">&times;</button>
        <h2 style="color:#1e3a8a; margin-bottom:.9rem; text-align:center;">⚖️ Ley Karin – Preguntas Frecuentes ACHS Seguro Laboral</h2>
        <style>
            #modalLeyKarin .lk-toolbar{display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; margin:.2rem 0 .9rem;}
            #modalLeyKarin .lk-toolbar button{background:#1e3a8a; color:#fff; border:none; padding:.5rem .9rem; font-size:.75rem; font-weight:700; border-radius:8px; cursor:pointer; box-shadow:0 3px 10px rgba(30,58,138,.25);}            
            #modalLeyKarin .lk-toolbar button:hover{filter:brightness(1.08);}            
            #modalLeyKarin .accordion-leykarin details{border:1px solid #c7d2fe; border-radius:10px; padding:.45rem .9rem .75rem; background:#f8fafc; margin-bottom:.6rem; box-shadow:0 2px 6px rgba(30,58,138,0.08);}            
            #modalLeyKarin .accordion-leykarin details[open]{background:#eef2ff; border-color:#1e3a8a; box-shadow:0 4px 14px rgba(30,58,138,0.18);}            
            #modalLeyKarin .accordion-leykarin summary{list-style:none; cursor:pointer; display:flex; align-items:center; gap:.55rem; font-weight:700; color:#1e3a8a; font-size:1.02em;}
            #modalLeyKarin .accordion-leykarin summary::marker{display:none;}
            #modalLeyKarin .accordion-leykarin p{margin:.55rem 0 .4rem;}
            #modalLeyKarin .callout{background:#e0e7ff; border-left:5px solid #1e3a8a; padding:.75rem .9rem; border-radius:8px; font-weight:600; font-size:.95em; color:#0f172a; margin-bottom:.75rem;}
            #modalLeyKarin .subnote{font-size:.88em; color:#334155; margin:.2rem 0 .7rem;}
            #modalLeyKarin .icon{font-size:1.1em;}
        </style>
        <div class="lk-toolbar">
            <button onclick="(function(){document.querySelectorAll('#modalLeyKarin .accordion-leykarin details').forEach(function(d){d.open=true;});})()">Expandir todo</button>
            <button onclick="(function(){document.querySelectorAll('#modalLeyKarin .accordion-leykarin details').forEach(function(d){d.open=false;});})()">Contraer todo</button>
        </div>
        <div style="font-size:1em; color:#222; line-height:1.6; max-height:70vh; overflow-y:auto; padding-right:8px;">
            <div class="accordion-leykarin">
                <details open>
                    <summary><span class="icon">🟦</span>Nueva información – Activación de Ley Karin</summary>
                    <p>📞 Si llama el trabajador o afectado: el agendamiento se realiza de forma espontánea en la Agencia. No se solicita por formulario.</p>
                    <p>🏢 Si llama la empresa: debe realizar la gestión por el <strong>1404 opción 3</strong> o por <strong>ACHS Virtual</strong>. Esto permite que se realice la APT correspondiente.</p>
                    <p>🟢 Recordar: aplica de inmediato para todas las atenciones relacionadas con Ley Karin.</p>
                    <div class="subnote">Admisión y Agenda APT.</div>
                </details>

                <div class="callout">PREGUNTAS FRECUENTES LEY KARIN – GESTIÓN CCENTER</div>

                <details>
                    <summary>¿Cómo solicitar APT por Ley Karin?</summary>
                    <p>Ingresando en <strong>achsvirtual.achs.cl</strong> o llamando al <strong>1404 opción 3</strong>.</p>
                </details>
                <details>
                    <summary>¿Quién debe solicitar la APT?</summary>
                    <p>El empleador.</p>
                </details>
                <details>
                    <summary>¿Qué necesito para solicitar la APT?</summary>
                    <p>Rut empresa, correo de la empresa y nombre, RUT del trabajador, teléfono y correo del trabajador afectado.</p>
                </details>
                <details>
                    <summary>¿La empresa recibe algún comprobante de la solicitud?</summary>
                    <p>Sí. Recibirá un correo confirmando la solicitud, el motivo y los datos del/la trabajador(a).</p>
                </details>
                <details>
                    <summary>¿Cómo se entera el trabajador de su ingreso en la ACHS?</summary>
                    <p>En un máximo de <strong>24 horas hábiles</strong> un ejecutivo contactará al trabajador para realizar la admisión y agendar la APT.</p>
                </details>
                <details>
                    <summary>¿Qué ocurre si no se logra contacto con el trabajador?</summary>
                    <p>El empleador recibirá una notificación tras <strong>3 intentos</strong> dentro de 24 horas hábiles.</p>
                </details>
                <details>
                    <summary>¿Qué ocurre si el trabajador no desea recibir la APT?</summary>
                    <p>En caso de rechazo, el empleador recibirá una notificación.</p>
                </details>
                <details>
                    <summary>Si el trabajador desiste del rechazo y desea ser atendido, ¿qué hacer?</summary>
                    <p>El empleador debe realizar nuevamente la solicitud vía ACHS Virtual o llamando al <strong>1404 opción 3</strong>.</p>
                </details>
                <details>
                    <summary>¿Cuál es el flujo una vez contactado el trabajador?</summary>
                    <p>Se realiza la admisión y se agenda la APT (en un plazo máximo de <strong>72 horas</strong>).</p>
                </details>
                <details>
                    <summary>La empresa llama para activar APT, y el trabajador ya se presentó en un centro ACHS, ¿qué procede?</summary>
                    <p>Si ya existe un siniestro por el mismo motivo, <strong>no</strong> se debe admisionar de forma remota por Call Center.</p>
                </details>
                <details>
                    <summary>¿La empresa debe subir una denuncia DIAT/DIEP?</summary>
                    <p>Sí. Debe cargar en ACHS Virtual la <strong>DIAT/DIEP</strong> dentro de <strong>24 horas</strong> desde la notificación del hecho.</p>
                </details>
                <details>
                    <summary>Si hubo agresión física o física y verbal, ¿puedo activar Ley Karin por Call Center?</summary>
                    <p>No. En casos con agresión física, derivar presencialmente al centro de salud ACHS más cercano para evaluar su estado, independiente de que el trabajador indique no presentar molestias.</p>
                </details>
                <details>
                    <summary>¿Es obligación del trabajador asistir a la APT de ACHS?</summary>
                    <p>No es obligación.</p>
                </details>
                <details>
                    <summary>Presenciaron un "turbazo" sin amenazas directas, ¿deben ser admisionados?</summary>
                    <p>No existe un evento que exponga la vida o integridad; corresponde <strong>prestación preventiva UIC</strong>. Si alguno fue agredido o amenazado, debe ser admisionado, agendado y atendido individualmente.</p>
                </details>
                <details>
                    <summary>Expuestos a alto impacto emocional, ¿puede solicitarse solo intervención preventiva?</summary>
                    <p>No. Según circular 3869, debe respaldarse la APT con DIAT/DIEP por la gravedad. La intervención preventiva es para casos de bajo impacto y no reemplaza la APT individual.</p>
                </details>
                <details>
                    <summary>¿La atención individual por violencia/alta complejidad genera informe para la empresa?</summary>
                    <p>No se genera informe posterior. La notificación y avance se informan por los canales regulares. <strong>La intervención preventiva sí</strong> genera informe de cierre.</p>
                </details>
                <details>
                    <summary>Quien recibió APT individual, ¿puede participar de la intervención preventiva?</summary>
                    <p>Sí, puede participar. Es una instancia grupal que complementa su experiencia y fortalece al equipo.</p>
                </details>
                <details>
                    <summary>¿La empresa puede activar por 1404 sin DIAT/DIEP y regularizar luego?</summary>
                    <p>Sí. La normativa exige generarla en <strong>24 horas</strong> desde la denuncia. ACHS ingresará al trabajador, agendará la APT y atención médica en la agencia correspondiente, independiente de si la DIAT/DIEP ya fue cargada.</p>
                </details>
                <details>
                    <summary>Sin denuncia, ¿el trabajador puede recibir atención psicológica temprana?</summary>
                    <p>Puede presentarse directamente en un centro de salud ACHS donde recibirá la APT si corresponde; el <strong>OAL</strong> generará el documento según instrucción de la autoridad. Si la activación es por canal empresa (1404 opción 3), el empleador debe cargar la DIAT/DIEP en los plazos normativos.</p>
                </details>
                <details>
                    <summary>¿La atención por Ley Karin genera informe posterior?</summary>
                    <p>No. La notificación y eventuales agendamientos se comunican por los medios regulares.</p>
                </details>
                <details>
                    <summary>Si el trabajador no asiste a su cita de APT, ¿se reagenda?</summary>
                    <p>Tiene hasta <strong>1 reagendamiento</strong> si no rechaza la APT. Si nuevamente no se realiza por inasistencia u otra incidencia del trabajador, se cierra el caso y avanza a calificación.</p>
                </details>
                <details>
                    <summary>¿Qué información se necesita para activar servicio UIC?</summary>
                    <p>Nombre y RUT de la empresa, datos de contacto, número de personas afectadas y resumen del evento, diferenciando personas de primera y segunda línea.</p>
                    <p>Para casos de Ley Karin, el empleador puede activar vía <strong>1404</strong> para solicitar la APT; se pedirán datos básicos de empresa y trabajador.</p>
                </details>
                <details>
                    <summary>¿Cuándo aplica la activación de la UIC?</summary>
                    <p>Para casos Ley <strong>sin violencia física</strong>, incorporando personas afectadas y quienes participaron en la contención o coordinaciones (primera y segunda línea).</p>
                </details>
                <details>
                    <summary>¿Cuándo no aplica la activación de la UIC?</summary>
                    <p>Eventos no relacionados al contexto laboral o con <strong>violencia física</strong>. Estos deben ingresar directo a centro de salud ACHS para evaluar estado físico; si corresponde, las prestaciones psicológicas serán en centro ACHS.</p>
                </details>
                <details>
                    <summary>¿Toda atención por Ley Karin implica dupla de especialistas en centro ACHS?</summary>
                    <p>Se evalúa en agencia de salud ACHS la presencia de <strong>alto impacto emocional</strong>. De existir, se agenda con la dupla de especialistas.</p>
                </details>
            </div>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<!-- Modal INFORMACION EP -->
<div id="modalInformacionEP" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:540px; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(0,33,71,0.15); padding:2rem; position:relative;">
        <button onclick="cerrarModal('modalInformacionEP')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.5rem; color:#1e3a8a; cursor:pointer;">&times;</button>
        <h2 style="color:#1e3a8a; margin-bottom:1rem; text-align:center;">📚 Información EP</h2>
        <div style="display:flex; justify-content:center; margin-bottom:1.2rem;">
            <div style="display:flex; flex-wrap:wrap; gap:12px; width:100%; justify-content:center;">
                <button onclick="abrirModal('modalRecetasEP')" style="background:linear-gradient(145deg, #009688, #26a69a); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,150,136,0.2);">💊 Retiro de Medicamento</button>
                <button onclick="abrirModal('modalPreguntasEP')" style="background:linear-gradient(145deg, #2563eb, #5ea0ef); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(30,99,235,0.15);">❓ Preguntas Frecuentes</button>
                <button onclick="abrirModal('modalQuiebreEPSM')" style="background:linear-gradient(145deg, #f59e42, #f7c873); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(245,158,66,0.15);">🧠 Quiebre de ingreso EP-SM y cita psicológico</button>
                <button onclick="abrirModal('modalIngresoEPMEOP')" style="background:linear-gradient(145deg, #4caf50, #81c784); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(76,175,80,0.15);">🩺 Ingreso EP-ME / EP-OP</button>
                <button onclick="abrirModal('modalMediosPrueba')" style="background:linear-gradient(145deg, #1976d2, #64b5f6); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(25,118,210,0.15);">📎 Medios de Prueba</button>
                <button onclick="window.open('https://www.asociaciondemutuales.cl/buscador-mutualidades/', '_blank')" style="background:linear-gradient(145deg, #6d28d9, #a78bfa); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(109,40,217,0.15);">🔎 Buscador Mutualidades</button>
                <button onclick="abrirModal('modalNotificacionEP')" style="background:linear-gradient(145deg, #2563eb, #5ea0ef); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(30,99,235,0.15);">🛎️ Notificación EP</button>
                <button onclick="abrirModal('modalDocumentosEgreso')" style="background:linear-gradient(145deg, #d97706, #f59e0b); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(217,119,6,0.15);">📄 Documentos de egreso – Pacientes EP-SM Telemedicina</button>
                <button onclick="abrirModal('modalEstacionamiento')" style="background:linear-gradient(145deg, #059669, #10b981); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(5,150,105,0.15);">🚗 Estacionamiento</button>
            </div>
<!-- Modal Preguntas Frecuentes EP (submodal) -->
<!-- Modal Notificación EP (submodal) -->
<div id="modalNotificacionEP" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:520px; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(30,99,235,0.15); padding:2rem; position:relative;">
        <button onclick="cerrarModal('modalNotificacionEP')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.5rem; color:#2563eb; cursor:pointer;">&times;</button>
        <h2 style="color:#2563eb; margin-bottom:1rem; text-align:center;">🛎️ Notificación EP</h2>
                <div style="font-size:1.02em; color:#222; line-height:1.55;">
                        <style>
                                .accordion-notif details { 
                                        border:1px solid #d0e2ff; 
                                        border-radius:10px; 
                                        padding:.4rem .85rem .75rem; 
                                        background:#f8fbff; 
                                        margin-bottom:.65rem; 
                                        box-shadow:0 2px 6px rgba(37,99,235,0.08);
                                }
                                .accordion-notif details[open]{
                                        background:#eef5ff;
                                        border-color:#2563eb;
                                        box-shadow:0 4px 14px rgba(37,99,235,0.18);
                                }
                                .accordion-notif summary { 
                                        font-weight:700; 
                                        cursor:pointer; 
                                        list-style:none; 
                                        display:flex; 
                                        align-items:center; 
                                        gap:.5rem; 
                                        color:#1e3a8a; 
                                        font-size:1.02em;
                                }
                                .accordion-notif summary::marker { display:none; }
                                .accordion-notif summary span.icon { font-size:1.15em; }
                                .accordion-notif p { margin:.55rem 0 .4rem; }
                        </style>
                        <p style="background:#e0edff; border-left:5px solid #2563eb; padding:.75rem .9rem; border-radius:8px; font-weight:600; font-size:.95em; color:#0f2647;">
                                Alineamiento sobre notificación de pacientes STP/CTP EP – Revisión de flujos y mesa de trabajo conjunta.
                        </p>
                        <div class="accordion-notif">
                                <details>
                                        <summary><span class="icon">🕒</span>Pacientes con tiempo perdido</summary>
                                        <p>La notificación será responsabilidad de la <strong>Agencia de Tratamiento</strong>, es decir, aquella donde el paciente tuvo su último control de EP.</p>
                                        <p>En el caso de atenciones por <strong>Telemedicina SM</strong>, la sede responsable será <strong>Providencia</strong>.</p>
                                </details>
                                <details>
                                        <summary><span class="icon">🌍</span>Pacientes de región</summary>
                                        <p>Todas las atenciones de pacientes de otras regiones deberán retirar su resolución en la <strong>sede ACHS más cercana</strong> a su domicilio.</p>
                                </details>
                                <details>
                                        <summary><span class="icon">📬</span>Plazo de notificación y acceso a resolución</summary>
                                        <p>Pasados los <strong>5 días hábiles</strong> establecidos por normativa para la notificación, si el paciente no ha recibido el correo o la carta certificada, podrá acceder a su resolución a través de <strong>Achs Virtual</strong>, ingresando con su usuario y clave, en el apartado <em>Siniestro → Descargar documento</em>.</p>
                                        <p>En caso de personas sin acceso tecnológico o que residan en zonas rurales, podrán acercarse a la sede ACHS Salud de ingreso para recibir la notificación de manera presencial.</p>
                                </details>
                                <details>
                                        <summary><span class="icon">🏙️</span>Territorio Metropolitano</summary>
                                        <p>Se elimina la distinción del Territorio Metro para EP, dejando de ser de cargo exclusivo de la Agencia Providencia. Ya no corresponde notificar en Providencia solo por tratarse de un paciente RM.</p>
                                        <p>Si el paciente finalizó sus atenciones en una sede específica de la RM, deberá acercarse a esa misma sede de tratamiento para solicitar su documento.</p>
                                        <p>En el caso de telemedicina, la sede Providencia continúa siendo la responsable de la notificación:</p>
                                        <ul style="margin:.4rem 0 .2rem .9rem; padding:0;">
                                                <li><strong>CTP:</strong> cita presencial de notificación.</li>
                                                <li><strong>STP:</strong> envío según autorización del paciente (correo o carta certificada).</li>
                                        </ul>
                                </details>
                                <details>
                                        <summary><span class="icon">🚫</span>Pacientes con tiempo perdido – Inasistencias</summary>
                                        <p>Bastará <strong>una inasistencia injustificada</strong> para generar alta administrativa y proceder con la notificación no presencial (ya no se requieren dos citaciones).</p>
                                        <p><strong>Call Center:</strong> Si existe una cita previa a la notificación o el paciente declara no haber podido asistir, se debe:</p>
                                        <ul style="margin:.4rem 0 .2rem .9rem; padding:0;">
                                                <li>Revisar en <em>Siniestro</em> si el documento fue enviado (correo o carta certificada).</li>
                                                <li>Informar el canal y plazo de entrega.</li>
                                                <li>Recordar que, una vez cumplido dicho plazo, el paciente puede descargar la resolución desde Achs Virtual.</li>
                                        </ul>
                                </details>
                                <details>
                                    <summary><span class="icon">🏥</span>Pacientes sin tiempo perdido</summary>
                                    <p>La notificación se mantiene a cargo de la <strong>Agencia de Ingreso</strong>, correspondiente al lugar donde el paciente fue atendido inicialmente (urgencia, atención ambulatoria o espontánea).</p>
                                </details>
                        </div>
                </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<!-- Modal Documentos de Egreso EP-SM Telemedicina -->
<div id="modalDocumentosEgreso" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:700px; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(217,119,6,0.15); padding:2rem; position:relative; max-height:85vh; overflow-y:auto;">
        <button onclick="cerrarModal('modalDocumentosEgreso')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.5rem; color:#d97706; cursor:pointer;">&times;</button>
        <h2 style="color:#d97706; margin-bottom:.75rem; text-align:center;">📄 Documentos de egreso – Pacientes EP-SM Telemedicina</h2>
        <style>
            #modalDocumentosEgreso .doc-toolbar{display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; margin:.25rem 0 1rem;}
            #modalDocumentosEgreso .doc-toolbar button{background:#d97706; color:#fff; border:none; padding:.5rem .9rem; font-size:.7rem; font-weight:600; border-radius:8px; cursor:pointer; box-shadow:0 3px 10px rgba(217,119,6,.3);}            
            #modalDocumentosEgreso .doc-toolbar button:hover{filter:brightness(1.08);}            
            #modalDocumentosEgreso details summary{list-style:none; cursor:pointer; display:flex; align-items:center; gap:.55rem; font-weight:700;}
            #modalDocumentosEgreso details summary::marker{display:none;}
        </style>
        <div class="doc-toolbar">
            <button type="button" onclick="docEgresoExpand(true)">Expandir todo</button>
            <button type="button" onclick="docEgresoExpand(false)">Colapsar todo</button>
        </div>
        <details class="doc-egreso" open style="background:#fff7ed; border-left:4px solid #d97706; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#d97706; font-size:1.05em;">📌 Recordatorio</summary>
            <p style="margin:5px 0; color:#222; line-height:1.7;">Cuando un paciente EP-SM llama posterior a su atención indicando que no ha recibido los documentos para firmar, se debe aplicar el siguiente protocolo:</p>
        </details>
        <details class="doc-egreso" style="background:#f0fdf4; border-left:4px solid #16a34a; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#16a34a;">🔹 Plazo de envío</summary>
            <ul style="margin:8px 0; padding-left:20px;">
                <li>Informar que el documento será enviado dentro de un plazo de <strong>24 horas</strong>.</li>
                <li>Remitente del correo: <strong style="color:#2563eb;">Salud Digital TM sdtelemedicina@achs.cl</strong></li>
                <li>Asunto: <strong>"Documentos de egreso paciente telemedicina"</strong></li>
            </ul>
        </details>
        <details class="doc-egreso" style="background:#fef3c7; border-left:4px solid #f59e0b; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#f59e0b;">🔹 Si han pasado más de 24 horas</summary>
            <p style="margin:8px 0;">El paciente debe solicitarlo directamente al correo: <strong style="color:#2563eb;">ejecutivoachs@achs.cl</strong></p>
        </details>
        <details class="doc-egreso" style="background:#eff6ff; border-left:4px solid #2563eb; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#2563eb;">🔹 Si el paciente no sabe cómo firmar</summary>
            <p style="margin:8px 0;">Indicar que debe ingresar al siguiente enlace:</p>
            <p style="margin:8px 0; background:white; padding:10px; border-radius:6px; text-align:center;">👉 <a href="https://prod.salud.achs.cl/web-firmadigital/" target="_blank" style="color:#2563eb; font-weight:bold; text-decoration:none;">https://prod.salud.achs.cl/web-firmadigital/</a></p>
            <p style="margin:8px 0;">Debe ingresar su número de documento y aceptar.</p>
        </details>
        <details class="doc-egreso" style="background:#fef2f2; border-left:4px solid #dc2626; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#dc2626;">🔹 Problemas técnicos</summary>
            <p style="margin:8px 0;">Transferir a <strong>Soporte Web</strong> para asistencia directa.</p>
        </details>
        <details class="doc-egreso" style="background:#e0e7ff; border-left:4px solid #4f46e5; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#4f46e5;">📎 Correo que reciben los pacientes</summary>
            <p style="margin:8px 0;">Es importante que revisen su <strong>bandeja de entrada</strong> y <strong>correo no deseado</strong>.</p>
        </details>
        <details class="doc-egreso" style="background:#fee2e2; border:2px solid #dc2626; padding:15px; border-radius:8px; margin-bottom:15px;">
            <summary style="color:#dc2626;">⚠️ Importante</summary>
            <p style="margin:5px 0; font-weight:600;">Siempre validar si el paciente está dentro del plazo de espera y ofrecer alternativas claras si no ha recibido el documento.</p>
        </details>
        <script>
            function docEgresoExpand(exp){try{document.querySelectorAll('#modalDocumentosEgreso .doc-egreso').forEach(d=>exp?d.setAttribute('open',''):d.removeAttribute('open'));}catch(e){}}
        </script>
    </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<!-- Modal Estacionamiento -->
<div id="modalEstacionamiento" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:750px; max-height:90vh; overflow-y:auto; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(5,150,105,0.15); padding:2rem; position:relative;">
        <button onclick="cerrarModal('modalEstacionamiento')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.5rem; color:#059669; cursor:pointer; z-index:10;">&times;</button>
        <h2 style="color:#059669; margin-bottom:1.5rem; text-align:center;">🚗 Estacionamiento Hospital del Trabajador</h2>
        
        <div style="font-size:1.02em; color:#222; line-height:1.6;">
            <style>
                #modalEstacionamiento .estac-toolbar{display:flex; gap:.6rem; flex-wrap:wrap; justify-content:center; margin:-.3rem 0 1rem;}
                #modalEstacionamiento .estac-toolbar button{background:#059669; color:#fff; border:none; padding:.5rem .9rem; font-size:.75rem; font-weight:600; border-radius:8px; cursor:pointer; box-shadow:0 3px 10px rgba(5,150,105,.3);}                
                #modalEstacionamiento .estac-toolbar button:hover{filter:brightness(1.08);}
                #modalEstacionamiento details summary{list-style:none; cursor:pointer; display:flex; align-items:center; gap:.55rem; font-weight:700;}
                #modalEstacionamiento details summary::marker{display:none;}
            </style>
            <div class="estac-toolbar">
                <button type="button" onclick="estacExpand(true)">Expandir todo</button>
                <button type="button" onclick="estacExpand(false)">Colapsar todo</button>
            </div>
            <details class="estac-faq" open style="background:#d1fae5; border-left:4px solid #059669; padding:16px; border-radius:8px; margin-bottom:15px;">
                <summary style="color:#059669; margin:0 0 4px;">📌 Información General</summary>
                <ul style="margin:0; padding-left:20px;">
                    <li><strong>Tarifa por minuto:</strong> $28</li>
                    <li><strong>Horario:</strong> Abierto 24 horas</li>
                    <li><strong>Monto límite de pago:</strong> No hay</li>
                    <li><strong>Dirección de acceso:</strong> Ramón Carnicer 201</li>
                </ul>
            </details>
            <details class="estac-faq" style="background:#fef3c7; border-left:4px solid #f59e0b; padding:16px; border-radius:8px; margin-bottom:15px;">
                <summary style="color:#f59e0b; margin:0 0 4px;">💳 Pago de Ticket</summary>
                <ul style="margin:0; padding-left:20px;">
                    <li><strong>Cajeros de pago ubicados en:</strong> Piso -5 y Piso -6</li>
                    <li><strong>Formas de pago:</strong> Efectivo o tarjeta de crédito (en ambos pisos)</li>
                </ul>
            </details>
            <details class="estac-faq" style="background:#fee2e2; border-left:4px solid #dc2626; padding:16px; border-radius:8px; margin-bottom:15px;">
                <summary style="color:#dc2626; margin:0 0 4px;">🎫 En caso de Pérdida de Ticket</summary>
                <p style="margin:0;">Dirigirse al <strong>Piso -6</strong>, Oficina de Administración EC Parking<br>(Ubicada a un costado de las máquinas de pago)</p>
            </details>
            <details class="estac-faq" style="background:#e0f2fe; border-left:4px solid #0284c7; padding:16px; border-radius:8px; margin-bottom:15px;">
                <summary style="color:#0284c7; margin:0 0 4px;">🔒 Lockers Gratuitos</summary>
                <p style="margin:0;">Disponibles en el <strong>Piso -6</strong>, a un costado de las máquinas de pago.</p>
            </details>
            <details class="estac-faq" style="background:#f3e8ff; border-left:4px solid #9333ea; padding:16px; border-radius:8px; margin-bottom:15px;">
                <summary style="color:#9333ea; margin:0 0 4px;">🏥 Conexiones desde los Ascensores del Estacionamiento</summary>
                <p style="margin:0 0 10px; font-weight:600; color:#9333ea;">Los ascensores del estacionamiento conectan directamente con:</p>
                <ul style="margin:0; padding-left:20px; line-height:1.8;">
                    <li><strong>Piso -1:</strong> Urgencia (ingreso vehicular por el mismo acceso de estacionamientos públicos)</li>
                    <li><strong>Piso -2:</strong> Imagenología y Conexión a Centro Médico</li>
                    <li><strong>Piso 1:</strong> Rehabilitación, Policlínico, Admisión Central y Hall Central</li>
                    <li><strong>Pisos 3 y 4:</strong> Hospitalizados Edificio E y B</li>
                    <li><strong>Piso 5:</strong> UPC, Cirugía Plástica y Quemados</li>
                    <li><strong>Piso 6:</strong> Pabellón Central, Preanestesia y Recuperación</li>
                </ul>
            </details>
            <details class="estac-faq" style="background:#fff1f2; border:2px solid #dc2626; padding:16px; border-radius:8px; margin-bottom:15px;">
                <summary style="color:#dc2626; margin:0 0 4px;">❌ Demás centros ACHS Salud</summary>
                <p style="margin:0; font-weight:600;">No contamos con estacionamientos habilitados.</p>
            </details>
            <details class="estac-faq" style="background:#ecfdf5; border-left:4px solid #10b981; padding:16px; border-radius:8px;">
                <summary style="color:#10b981; margin:0 0 4px;">💬 Tip para la llamada</summary>
                <div style="background:white; padding:12px; border-radius:6px; border:1px solid #10b981; font-style:italic;">
                    <p style="margin:0; color:#334155;">"El <strong>Hospital del Trabajador</strong> cuenta con estacionamiento disponible 24/7. El acceso es por <strong>Ramón Carnicer 201</strong>. La tarifa es de <strong>$28 por minuto</strong> y puede pagar en efectivo o tarjeta en los pisos -5 o -6. Desde el estacionamiento hay ascensores directos a todos los servicios del hospital. Los demás centros ACHS no tienen estacionamiento habilitado."</p>
                </div>
            </details>
            <script>
                function estacExpand(exp){try{document.querySelectorAll('#modalEstacionamiento .estac-faq').forEach(d=>exp?d.setAttribute('open',''):d.removeAttribute('open'));}catch(e){}}
            </script>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<div id="modalPreguntasEP" class="modal" style="display:none; justify-content:center; align-items:center;">
                <div class="modal-contenido" style="width:90vw; max-width:1200px; max-height:480px; background:white; border-radius:10px; box-shadow:0 4px 12px rgba(0,33,71,0.10); padding:0.12rem 0.12rem; position:relative; margin:0 auto; overflow-y:auto;">
        <button onclick="cerrarModal('modalPreguntasEP')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.7rem; color:#2563eb; cursor:pointer;">&times;</button>
        <h2 style="color:#2563eb; margin-bottom:1.2rem; text-align:center;">🛡️ Enfermedades Profesionales (EP) – Guía Rápida ACHS</h2>
    <div style="font-size:1.40em; line-height:1.55;">
        <style>
            #modalPreguntasEP .ep-faq {border:1px solid #d0e2ff; background:#f8fbff; border-radius:10px; padding:.65rem .9rem; margin:.55rem .65rem; box-shadow:0 2px 6px rgba(37,99,235,0.08);}
            #modalPreguntasEP .ep-faq[open]{background:#eef5ff; border-color:#2563eb; box-shadow:0 4px 14px rgba(37,99,235,0.18);}            
            #modalPreguntasEP .ep-faq summary{cursor:pointer; font-weight:700; display:flex; align-items:center; gap:.55rem; list-style:none; font-size:.72em; color:#1e3a8a;}
            #modalPreguntasEP .ep-faq summary::marker{display:none;}
            #modalPreguntasEP .ep-faq p{margin:.45rem 0 0; font-size:.70em; line-height:1.35;}
            #modalPreguntasEP .faq-toolbar{display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin:.4rem 0 .2rem;}
            #modalPreguntasEP .faq-toolbar button{background:#2563eb; color:#fff; border:none; padding:.45rem .8rem; border-radius:8px; font-size:.55em; font-weight:600; cursor:pointer; box-shadow:0 2px 8px rgba(37,99,235,.35);}            
            #modalPreguntasEP .faq-toolbar button:hover{filter:brightness(1.08);}
        </style>
        <div class="faq-toolbar">
            <button type="button" onclick="epFaqExpand(true)">Expandir todo</button>
            <button type="button" onclick="epFaqExpand(false)">Colapsar todo</button>
        </div>
        <details class="ep-faq">
            <summary>1️⃣ ¿Qué es una Enfermedad Profesional?</summary>
            <p>📘 Según la Ley N° 16.744, es una enfermedad causada directamente por el trabajo que realiza una persona y que puede provocar incapacidad o muerte.</p>
        </details>
        <details class="ep-faq">
            <summary>2️⃣ ¿Qué son las Mutualidades?</summary>
            <p>🏥 Son organismos que administran el seguro de la Ley 16.744. Protegen al trabajador con:<br>• Prevención de riesgos<br>• Capacitaciones<br>• Cobertura médica y compensaciones<br>🔹 Mutualidades reconocidas:<br>• ACHS – Asociación Chilena de Seguridad<br>• MUTUAL DE SEGURIDAD<br>• IST – Instituto de Seguridad del Trabajo<br>• ISL – Instituto de Seguridad Laboral</p>
        </details>
        <details class="ep-faq">
            <summary>3️⃣ ¿Cómo se inicia el proceso?</summary>
            <p>📞 Llamando al Call Center 600 600 2247:<br>• Empleador: Opción 4 → Empresa → 2 EP<br>• Trabajador: Opción 3 → 3 EP</p>
        </details>
        <details class="ep-faq">
            <summary>4️⃣ ¿Qué tipos de EP se agendan?</summary>
            <p>🧠 Salud Mental (SM): estrés, acoso, burnout<br>💪 Musculoesquelético (ME): dolor corporal, dermatitis, disfonías, etc.<br>⚠️ Eventos puntuales → se ingresan como accidente</p>
        </details>
        <details class="ep-faq">
            <summary>5️⃣ Atenciones en Región Metropolitana</summary>
            <p>📍 CEEP – Vicuña Mackenna 200, 4° piso (Metro Parque Bustamante)<br>🕘 Solo con cita previa:<br>• ME presencial<br>• SM telemedicina (nacional)<br>• SM presencial (excepcional)</p>
        </details>
        <details class="ep-faq">
            <summary>6️⃣ Atenciones en Regiones</summary>
            <p>📂 Consultar archivo PIZARRA 2023 para sucursales y agendamiento.</p>
        </details>
        <details class="ep-faq">
            <summary>7️⃣ Tipos de citas que se agendan</summary>
            <p>📌 Ingreso EP ME<br>📌 Ingreso EP SM (telemedicina preferente)<br>📌 Notificación de resultado (solo RM en CEEP)<br>📌 Control EPMe-Otros (solo reagendamiento)</p>
        </details>
        <details class="ep-faq">
            <summary>8️⃣ ¿Cómo saber si se puede agendar?</summary>
            <p>🔍 Verificar cotizaciones en SAP → ZFI_CONSULTA con RUT del trabajador.</p>
        </details>
        <details class="ep-faq">
            <summary>9️⃣ ¿Y si no aparecen cotizaciones?</summary>
            <p>🔎 Verificar RUT del empleador en Salesforce.<br>📢 Si empresa no está vigente → derivar a su mutualidad correspondiente.</p>
        </details>
        <details class="ep-faq">
            <summary>🔟 ¿Se agenda a trabajadores independientes?</summary>
            <p>✅ Sí, si tienen cotizaciones. Verificar en Salesforce como “independiente”.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣1️⃣ ¿Pacientes con Licencia Médica?</summary>
            <p>✅ Se agendan si tienen:<br>• Licencia tipo 6 (EP)<br>• Licencia tipo 1 rechazada por Isapre<br>• Derivación médica<br>• Licencia por otra patología</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣2️⃣ ¿Pacientes ISL?</summary>
            <p>❌ No se agendan directamente.<br>📌 Deben denunciar en ISL.<br>📞 Si ISL deriva a ACHS → se contacta al paciente.<br>👩‍⚕️ Agendamiento autorizado: Paloma Crettón / Constanza Velásquez.<br>📝 Registrar en nota externa.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣3️⃣ ¿Cómo es el proceso de evaluación?</summary>
            <p>🩺 Médico general + comité → investigación (30 días).<br>🏭 Puede incluir visita al puesto de trabajo.<br>📋 Si se confirma origen laboral → derivación a especialistas.<br>📌 Para SM: traer nombre y teléfono de 2 testigos.<br>🎥 Video explicativo.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣4️⃣ ¿Qué es la DIEP?</summary>
            <p>📄 Formulario de Denuncia Individual de EP.<br>📥 Descargar aquí.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣5️⃣ ¿La denuncia es anónima?</summary>
            <p>🚫 No. Se debe notificar a la empresa y evaluar el puesto de trabajo.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣6️⃣ ¿Se puede reagendar si se pierde la cita?</summary>
            <p>✅ Solo si es:<br>• Primera cita<br>• Control EPMe<br>• Notificación en CEEP<br>📌 Para otras especialidades → justificar presencialmente.<br>📋 Para ingreso SM perdido → llenar formulario con datos del paciente.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣7️⃣ ¿Qué es el Estudio de Puesto de Trabajo?</summary>
            <p>🔍 Análisis de condiciones laborales para evaluar riesgos.</p>
        </details>
        <details class="ep-faq">
            <summary>1️⃣8️⃣ a 2️⃣2️⃣ ¿Dónde se agenda cada tipo?</summary>
            <p>📌 SM Telemedicina → malla nacional.<br>📌 SM Presencial → RM: Providencia / Regiones: agencia local.<br>📌 ME → RM: Providencia / Regiones: agencia local.<br>📌 Control EPMe-Otros → solo reagendamos en Providencia.<br>📌 Notificaciones → RM: Providencia / Regiones: presencial en agencia.</p>
        </details>
        <script>
            function epFaqExpand(exp){try{document.querySelectorAll('#modalPreguntasEP .ep-faq').forEach(d=>exp?d.setAttribute('open',''):d.removeAttribute('open'));}catch(e){}}
        </script>
    </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<!-- Modal Ingreso EP-ME / EP-OP (submodal) -->
<div id="modalIngresoEPMEOP" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:760px; background:white; border-radius:18px; box-shadow:0 6px 24px rgba(76,175,80,0.18); padding:1.8rem 1.6rem; position:relative;">
        <button onclick="cerrarModal('modalIngresoEPMEOP')" style="position:absolute; top:16px; right:16px; background:none; border:none; font-size:1.9rem; color:#2e7d32; cursor:pointer; line-height:1;">&times;</button>
        <h2 style="color:#2e7d32; margin:0 0 1.1rem; text-align:center; font-size:2.05rem; letter-spacing:.5px; font-weight:800;">🩺 Malla de Agendamiento según Situación del Paciente</h2>
        <div style="font-size:1.15em; line-height:1.65; font-weight:500;">
            <div style="margin-bottom:1.0em;">🔹 <b>Dolor o molestia desde la punta del dedo hasta el cuello (extremidades superiores):</b><br><span style="color:#0d47a1;">➡️ Agendar en <b>Ingreso EP ME</b></span></div>
            <div style="margin-bottom:1.0em;">🔹 <b>Lesiones cutáneas, alergias o problemas en la piel:</b><br><span style="color:#0d47a1;">➡️ Agendar en <b>Ingreso EP OP</b></span></div>
            <div style="margin-bottom:1.0em;">🔹 <b>Síntomas respiratorios (tos, dificultad para respirar, etc.):</b><br><span style="color:#0d47a1;">➡️ Agendar en <b>Ingreso EP OP</b></span></div>
            <div style="margin-bottom:1.0em;">🔹 <b>Síntomas auditivos (pérdida de audición, zumbidos, etc.):</b><br><span style="color:#0d47a1;">➡️ Agendar en <b>Ingreso EP OP</b></span></div>
            <div style="margin-bottom:1.0em;">🔹 <b>Dolor o molestia en piernas, rodillas, caderas o región inguinal (extremidades inferiores):</b><br><span style="color:#0d47a1;">➡️ Agendar en <b>Ingreso EP OP</b></span></div>
            <div style="margin-bottom:1.0em;">🔹 <b>Dolor en extremidades superiores + otra dolencia adicional:</b><br><span style="color:#0d47a1;">➡️ Agendar <b>1 cupo en Ingreso EP ME</b> + <b>1 cupo en Ingreso EP OP</b></span></div>
            <div style="margin-bottom:1.0em;">🔹 <b>¿No sabes dónde encaja la consulta del paciente?</b><br><span style="color:#0d47a1;">➡️ Ante la duda, agendar en <b>Ingreso EP OP</b></span></div>
            <div style="margin:1.4em 0; background:#e8f5e9; border-left:5px solid #2e7d32; padding:1rem 1rem .9rem; border-radius:10px; font-size:.95em;">
                📌 <b>Tip útil:</b> Si el paciente presenta más de una dolencia, asegúrate de agendar los cupos necesarios para una evaluación completa.
            </div>
            <div style="margin-bottom:.9em; background:#e3f2fd; border-left:5px solid #1976d2; padding:.9rem 1rem .85rem; border-radius:10px; font-size:.95em;">
                🔎 <b>¿Qué significa “+ 1 cupo adicional”?</b><br>📌 Se debe agendar una segunda cita en la misma malla de Ingreso EP ME para asegurar evaluación completa del caso con irradiación.
            </div>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<!-- Modal Medios de Prueba (submodal) -->
<div id="modalMediosPrueba" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:760px; background:white; border-radius:18px; box-shadow:0 6px 28px rgba(25,118,210,0.18); padding:1.8rem 1.5rem; position:relative;">
        <button onclick="cerrarModal('modalMediosPrueba')" style="position:absolute; top:16px; right:16px; background:none; border:none; font-size:1.9rem; color:#1565c0; cursor:pointer; line-height:1;">&times;</button>
        <h2 style="color:#0d47a1; margin:0 0 1.2rem; text-align:center; font-size:2.05rem; font-weight:800; letter-spacing:.5px;">📎 Medios de Prueba</h2>
        <div style="font-size:1.15em; line-height:1.65; font-weight:500;">
            <div style="margin-bottom:1.05em; background:#e3f2fd; border-left:5px solid #1976d2; padding:1rem 1rem .85rem; border-radius:12px;">
                📌 <b>¡Importante!</b> Si estás en proceso de estudio por Enfermedad Profesional (EP) y deseas agregar más evidencia, sigue estos pasos.
            </div>
            <div style="margin-bottom:1.05em; background:#e8f5e9; border-left:5px solid #2e7d32; padding:1rem 1rem .85rem; border-radius:12px;">
                ✉️ <b>¿Dónde enviar?</b><br>📧 <b>Correo:</b> <span style="color:#1976d2; font-weight:700;">mediosdeprueba@achs.cl</span><br>🕒 Envía tu información lo antes posible para que sea revisada antes de tu calificación.
            </div>
            <div style="margin-bottom:1.05em; background:#fff8e1; border-left:5px solid #f9a825; padding:1rem 1rem .85rem; border-radius:12px;">
                📎 <b>Requisitos para los documentos:</b><br>✅ <b>Formato:</b> PDF<br>📦 <b>Peso máximo:</b> 25 MB<br>📝 <b>Asunto del correo:</b> Número de siniestro (en documento de indicaciones médicas del correo que recibiste).
            </div>
            <div style="margin-bottom:1.05em; background:#ffebee; border-left:5px solid #d32f2f; padding:1rem 1rem .85rem; border-radius:12px;">
                🚫 <b>No se aceptan:</b><br>• Audios ni videos<br>• Testigos (se entregan presencialmente en ingreso médico o psicológico)
            </div>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

<!-- Modal Quiebre de ingreso EP-SM y cita psicológico (submodal) -->
<div id="modalQuiebreEPSM" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:760px; background:white; border-radius:18px; box-shadow:0 6px 28px rgba(245,158,66,0.2); padding:1.8rem 1.5rem; position:relative;">
        <button onclick="cerrarModal('modalQuiebreEPSM')" style="position:absolute; top:16px; right:16px; background:none; border:none; font-size:1.9rem; color:#d97706; cursor:pointer; line-height:1;">&times;</button>
        <h2 style="color:#d97706; margin:0 0 1.15rem; text-align:center; font-size:2.05rem; font-weight:800; letter-spacing:.4px;">🧠 Quiebre de ingreso EP-SM y cita psicológico</h2>
        <div style="font-size:1.15em; line-height:1.65; font-weight:500;">
            <div style="margin-bottom:1.05em; background:#fff7ed; border-left:5px solid #d97706; padding:1rem 1rem .85rem; border-radius:12px;">
                ✅ <b>1. Paciente sin llamado administrativo y hora ya pasada más 20 minutos:</b><br><span style="color:#7c2d12;">➡️ Deben gestionar directamente el reagendamiento a través de Forms.</span>
            </div>
            <div style="margin-bottom:1.05em; background:#fef3c7; border-left:5px solid #f59e0b; padding:1rem 1rem .85rem; border-radius:12px;">
                ✅ <b>2. Paciente en sala de espera:</b><br><span style="color:#92400e;">➡️ Debe permanecer en espera.<br>➡️ Si no es atendido oportunamente, será contactado para reagendar.<br>➡️ Si es la segunda vez que ocurre, gestionar directamente el reagendamiento a través de Forms.</span>
            </div>
            <div style="margin-bottom:1.05em; background:#ffe8e3; border-left:5px solid #f97316; padding:1rem 1rem .85rem; border-radius:12px;">
                <b>Por qué es importante:</b><br>Evita que el paciente se retire sin atención ni seguimiento y permite mantener trazabilidad de los casos reagendados.
            </div>
            <div style="margin-bottom:1.05em; background:#ecfdf5; border-left:5px solid #10b981; padding:1rem 1rem .85rem; border-radius:12px;">
                💡 <b>Tip operativo:</b><br>Confirma siempre hora agendada original y registro de intento de atención antes de reagendar para evitar duplicidades.
            </div>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

        </div>
    </div>
</div>
<!-- Modal RECETAS EP -->
<div id="modalRecetasEP" class="modal" style="display:none; justify-content:center; align-items:center;">
    <div class="modal-contenido" style="max-width:760px; background:#ffffff; border-radius:18px; box-shadow:0 8px 36px rgba(0,33,71,0.18); padding:2.2rem 2.4rem; position:relative; line-height:1.5;">
        <button onclick="cerrarModal('modalRecetasEP')" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.75rem; color:#00796b; cursor:pointer; line-height:1;">&times;</button>
        <h2 style="color:#00695c; margin:0 0 1.4rem; text-align:center; font-size:2.05rem; letter-spacing:.5px;">🩺💊 Retiro de Medicamentos Indicados por tu Médico</h2>

        <div style="background:#e8f5e9; border-left:6px solid #2e7d32; padding:1rem 1.25rem 1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
            <div style="font-weight:600; color:#1b5e20; font-size:1.05rem; margin-bottom:.4rem;">📍 ¿Dónde y cuándo retirar?</div>
            <ul style="margin:.4rem 0 .8rem 1.1rem; padding:0; list-style:disc;">
                <li style="margin-bottom:.55rem;">🧠 <b>Atención de Salud Mental:</b> Retiro en agencia ACHS más cercana, <b>24 horas hábiles</b> después de tu atención (09:00 a 16:00).</li>
                <li style="margin-bottom:.55rem;">🧑‍⚕️ <b>Atención Psiquiátrica:</b> Retiro en agencia ACHS más cercana, <b>48 a 72 horas hábiles</b> después de tu atención (09:00 a 16:00).</li>
            </ul>
            <div style="font-weight:600; color:#1b5e20; margin-top:.25rem;">🏥 Si retiras en el Hospital del Trabajador</div>
            <ul style="margin:.35rem 0 .8rem 1.1rem; padding:0; list-style:disc;">
                <li><b>Receta retenida:</b> Ingresa por Vicuña Mackenna 200, sube al 4° piso (CEEP) para regularizar tu receta y luego baja al piso -1 (farmacia).</li>
            </ul>
            <div style="font-weight:600; color:#1b5e20; margin-top:.25rem;">🏢 Si retiras en Agencia con receta retenida</div>
            <ul style="margin:.35rem 0 0 1.1rem; padding:0; list-style:disc;">
                <li>⏳ La receta debe ser regularizada por el médico antes del retiro. Esto puede tomar algunos minutos: organiza tus tiempos.</li>
            </ul>
        </div>

        <div style="background:#e3f2fd; border-left:6px solid #1565c0; padding:1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
            <div style="font-weight:600; color:#0d47a1; font-size:1.05rem; margin-bottom:.4rem;">✅ Requisitos para el retiro</div>
            <ul style="margin:.35rem 0 0 1.1rem; padding:0; list-style:disc;">
                <li style="margin-bottom:.5rem;">🎟️ Sacar ticket de farmacia o botiquín para ser atendido.</li>
                <li style="margin-bottom:.5rem;">🪪 Llevar tu documento de identidad.</li>
                <li>👥 Puede retirar un tercero mayor de 18 años con poder simple.</li>
            </ul>
        </div>

        <div style="background:#fff8e1; border-left:6px solid #ffb300; padding:1rem 1.25rem; border-radius:12px;">
            <div style="font-weight:600; color:#b37400; font-size:1.05rem; margin-bottom:.4rem;">📌 Recuerda</div>
            <p style="margin:.35rem 0 0;">Sigue siempre las indicaciones de tu médico para el uso correcto de tus medicamentos. ¡Tu salud es lo primero! 💚</p>
        </div>
    </div>
</div>

<!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->

                    </div>
                </div>
                
                <!-- Botones de herramientas (entre Consulta y Formulario) -->

                                <!-- Modal Reclamo -->
                                                <!-- Modal Reclamo eliminado - versión completa está en línea 7379 -->

                                <script>
                                function derivarATeams() {
                                    window.open('https://teams.microsoft.com/l/chat/19:2f38f239bed249eeb7eacf9be535c94d@thread.v2/conversations?context=%7B%22contextType%22%3A%22chat%22%7D', '_blank');
                                }

                                function copiarReclamoATexto() {
                                    var nombre = document.getElementById('reclamoNombre').value;
                                    var rut = document.getElementById('reclamoRut').value;
                                    var correo = document.getElementById('reclamoCorreo').value;
                                    var detalle = document.getElementById('reclamoDetalle').value;
                                    var texto = `🛑 Reclamo/Quiebre Paciente\nNombre: ${nombre}\nRUT: ${rut}\nCorreo: ${correo}\nDetalle: ${detalle}`;
                                    if (navigator.clipboard && window.isSecureContext) {
                                        navigator.clipboard.writeText(texto).then(function() {
                                            alert('✅ Reclamo copiado. Ahora puedes pegarlo en Teams.');
                                        }, function() {
                                            fallbackCopyTextToClipboard(texto);
                                        });
                                    } else {
                                        fallbackCopyTextToClipboard(texto);
                                    }
                                }

                                function fallbackCopyTextToClipboard(text) {
                                    var textArea = document.createElement('textarea');
                                    textArea.value = text;
                                    textArea.style.position = 'fixed';
                                    textArea.style.top = '-1000px';
                                    textArea.style.left = '-1000px';
                                    document.body.appendChild(textArea);
                                    textArea.focus();
                                    textArea.select();
                                    try {
                                        var successful = document.execCommand('copy');
                                        if (successful) {
                                            alert('✅ Reclamo copiado. Ahora puedes pegarlo en Teams.');
                                        } else {
                                            alert('❌ Error al copiar el reclamo.');
                                        }
                                    } catch (err) {
                                        alert('❌ Error al copiar el reclamo.');
                                    }
                                    document.body.removeChild(textArea);
                                }
                                function abrirModalReclamo() {
                                    var modal = document.getElementById('modalReclamo');
                                    modal.style.display = 'flex';
                                    modal.style.justifyContent = 'center';
                                    modal.style.alignItems = 'center';
                                }
                                function cerrarModalReclamo() {
                                    document.getElementById('modalReclamo').style.display = 'none';
                                }
                                function enviarReclamo(event) {
                                    event.preventDefault();
                                    cerrarModalReclamo();
                                    alert('✅ Reclamo enviado correctamente. ¡Gracias por tu feedback!');
                                }
                                </script>

                <!-- Modal Siglas de Agencias ACHS -->
                <div id="modalSiglasAgencias" class="modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.4); z-index:3000; justify-content:center; align-items:center;">
                    <div class="modal-contenido" style="background:white; border-radius:16px; padding:32px 24px; max-width:480px; width:95%; box-shadow:0 8px 32px rgba(30,58,138,0.18); position:relative;">
                        <button onclick="cerrarModal('modalSiglasAgencias')" class="btn-cerrar-modal" aria-label="Cerrar" style="position:absolute; top:10px; right:12px; background:none; border:none; font-size:1.5rem; color:#1e3a8a; cursor:pointer; line-height:1;">&times;</button>
                        <h2 style="color:#1e3a8a; margin-top:0; margin-bottom:22px; font-size:1.5em; text-align:center; letter-spacing:1px;">Siglas de Agencias ACHS</h2>
                        <input id="buscadorSiglasAgencias" type="text" placeholder="🔍 Buscar sigla o agencia..." style="width:100%; margin-bottom:10px; padding:10px 12px; border:2px solid #cbd5e1; border-radius:8px; font-size:1em; transition:border-color 0.3s;" onfocus="this.style.borderColor='#1e3a8a'" onblur="this.style.borderColor='#cbd5e1'">
                        <div id="contadorResultados" style="text-align:center; margin-bottom:12px; font-size:0.9em; color:#64748b; font-weight:600;"></div>
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var input = document.getElementById('buscadorSiglasAgencias');
                            var contador = document.getElementById('contadorResultados');
                            if (!input) return;
                            input.addEventListener('input', function() {
                                var filtro = input.value.toLowerCase().normalize('NFD').replace(/[00-6f]/g, '');
                                var items = document.querySelectorAll('#modalSiglasAgencias .sigla-item');
                                var visibles = 0;
                                
                                items.forEach(function(card) {
                                    var sigla = card.querySelector('.sigla-tarjeta-sigla').textContent.toLowerCase().normalize('NFD').replace(/[00-6f]/g, '');
                                    var agencia = card.querySelector('.sigla-tarjeta-agencia').textContent.toLowerCase().normalize('NFD').replace(/[00-6f]/g, '');
                                    if (busqueda === '' || sigla.indexOf(busqueda) >= 0 || agencia.indexOf(busqueda) >= 0) {
                                        card.style.display = 'flex';
                                        visibles++;
                                    } else {
                                        card.style.display = 'none';
                                    }
                                });
                                
                                if (busqueda === '') {
                                    contador.textContent = '';
                                } else {
                                    contador.textContent = visibles + ' resultado' + (visibles !== 1 ? 's' : '') + ' encontrado' + (visibles !== 1 ? 's' : '');
                                }
                            });
                        });
                        </script>
                        <!-- estilos migrados a assets/css/styles.css -->
                        <!-- Script del buscador movido a assets/js/buscador-siglas.js (14/11/2025) -->
                        <div style="max-height:400px; overflow-y:auto; padding:8px 4px;">
                          <ul style="list-style:none; padding:0; margin:0;">
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">TEMTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">TEMUCO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">VINTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">VIÑA DEL MAR</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">STGTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SANTIAGO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">PMOTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">PUERTO MONTT</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CNCTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CONCEPCION</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">VLDTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">VALDIVIA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">MAITCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">MAIPU</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">LANTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">LOS ANGELEZ</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">TLCTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">TALCA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">IQUTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">IQUIQUE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">MIGTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SAN MIGUEL</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">FELTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SAN FELIPE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">RANTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">RANCAGUA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">VLPTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">VALPARAISO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">PALTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">PUENTE ALTO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">LCNTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">LAS CONDES</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">OVATCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">OVALLE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CURTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CURICO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">PUNTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">PUNTA ARENAS</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">TLHTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">TALCAHUANO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">REITCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">LA REINA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">QUITCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">QUILICURA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">COLTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">COLINA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">FERTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SAN FERNANDO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CASTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CASTRO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">COQTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">COQUIMBO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CORTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CORONEL</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">COYTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">COYAIQUE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">SVCTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SAN VICENTE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">COPTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">COPIAPO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">MELTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">MELIPILLA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">PLATCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">PARQUE LAS AMERICAS</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">ILLTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">ILLAPEL</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CHITCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CHILLAN</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">OSOTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">OSORNO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">ANGTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">ANGOL</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">ANFTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">ANTOFAGASTA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">AYSTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">AYSEN</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CLMTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CALAMA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">TLGTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">TALAGANTE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">ANDTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">LOS ANDES</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">BUITCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">BUIN</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">SBDTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SAN BERNARDO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">FLOTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">LA FLORIDA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">SERTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">LA SERENA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">SANTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">SAN ANTONIO</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">PENTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">PEÑAFLOR</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">ARITCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">ARICA</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">CRNTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">CURANILAHUE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">VOETCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">VESPUCIO OESTE</span></li>
                            <li class="sigla-item" style="padding:12px 16px; margin-bottom:8px; background:#f8fafc; border-left:4px solid #1e3a8a; border-radius:6px; display:flex; justify-content:space-between; align-items:center; transition:all 0.2s;"><span class="sigla-tarjeta-sigla" style="font-weight:700; color:#1e3a8a; font-size:0.95em;">PARTCAPR</span><span class="sigla-tarjeta-agencia" style="color:#475569; font-size:0.9em;">PARRAL</span></li>
                          </ul>
                        </div>
                        <div style="text-align:center; margin-top:22px; display:flex; justify-content:center; gap:12px; flex-wrap:wrap;">
                            <button onclick="cerrarModal('modalSiglasAgencias')" style="background:#2563eb; color:white; border:none; border-radius:8px; padding:10px 28px; font-weight:bold; font-size:1.05em; cursor:pointer; box-shadow:0 2px 8px rgba(30,58,138,0.10);">Cerrar</button>
                        </div>
                    </div>
                </div>

                <!-- ✅ Script migrado a assets/js/app.js - Sistema de Modales (10/11/2025) -->
                
                <div class="botones-herramientas">
                    <button id="btnTerapiaFisica" class="btn-herramienta" onclick="abrirTerapiaFisica()">🏥 Terapia Física</button>
                    <button id="btnBuscadorTF" class="btn-herramienta" onclick="abrirModalBuscadorTF()" style="background:linear-gradient(135deg, #10b981 0%, #059669 100%); color:white; border:none;">🔎 Buscador Terapia Física</button>
                    <button id="btnDuracionTF" class="btn-herramienta" onclick="abrirModalDuracionTF()">⏱️ Duración de la atención en Terapia Física</button>
                                <!-- Modal Duración Terapia Física -->
                                <div id="modalDuracionTF" class="modal" style="display:none; justify-content:center; align-items:center;">
                                    <div class="modal-contenido" style="max-width:760px; background:#ffffff; border-radius:18px; box-shadow:0 8px 36px rgba(30,58,138,0.18); padding:2.2rem 2.4rem; position:relative; line-height:1.5;">
                                        <button onclick="cerrarModalDuracionTF()" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.75rem; color:#1e3a8a; cursor:pointer; line-height:1;">&times;</button>
                                        <h2 style="color:#1e3a8a; margin:0 0 1.4rem; text-align:center; font-size:2.05rem; letter-spacing:.5px;">⏱️ Duración de la atención en Terapia Física</h2>

                                        <div style="background:#e8f5e9; border-left:6px solid #2e7d32; padding:1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
                                            <div style="font-weight:600; color:#1b5e20; font-size:1.05rem; margin-bottom:.45rem;">🕒 Duración estándar</div>
                                            <p style="margin:.35rem 0 .55rem; font-weight:600; color:#0d5d33;">La sesión de Terapia Física dura entre <span style="color:#056a35;">45 y 60 minutos</span> en modalidad simultánea.</p>
                                            <ul style="margin:.2rem 0 0 1.1rem; padding:0; list-style:disc;">
                                                <li style="margin-bottom:.45rem;">👥 Modalidad simultánea: hasta 4 pacientes por sesión.</li>
                                                <li>📝 Evaluación inicial: 30 minutos.</li>
                                            </ul>
                                        </div>

                                        <div style="background:#e3f2fd; border-left:6px solid #1565c0; padding:1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
                                            <div style="font-weight:600; color:#0d47a1; font-size:1.05rem; margin-bottom:.4rem;">¿Por qué es importante informarlo?</div>
                                            <p style="margin:.35rem 0 0;">Evita confusiones o expectativas erróneas respecto al tiempo efectivo, modalidad de acompañamiento y duración total del proceso terapéutico.</p>
                                        </div>

                                        <div style="background:#fff8e1; border-left:6px solid #ffb300; padding:1rem 1.25rem; border-radius:12px;">
                                            <div style="font-weight:600; color:#b37400; font-size:1.05rem; margin-bottom:.4rem;">Tip práctico para comunicar en llamada</div>
                                            <p style="margin:.35rem 0 .55rem; font-style:italic;">“La evaluación dura 30 minutos. Luego, cada sesión de terapia física dura entre 45 y 60 minutos y se realiza junto a otros tres pacientes en modalidad simultánea.”</p>
                                            <p style="margin:0;">👥 Modalidad simultánea = atención compartida con hasta 4 pacientes (optimiza tiempos y continuidad).</p>
                                        </div>
                                    </div>
                                </div>
                                <script>
                                function abrirModalDuracionTF() {
                                    document.getElementById('modalDuracionTF').style.display = 'flex';
                                }
                                function cerrarModalDuracionTF() {
                                    document.getElementById('modalDuracionTF').style.display = 'none';
                                }
                                </script>
                                                                <!-- Modal Buscador Terapia Física (Diagnósticos) -->
                                                                <div id="modalBuscadorTF" class="modal" style="display:none; justify-content:center; align-items:center;">
                                                                        <div class="modal-contenido" id="contenidoBuscadorTF" style="max-width:780px; width:96%; background:white; border-radius:16px; box-shadow:0 8px 32px rgba(30,58,138,0.15); padding:1.5rem; position:relative; transform:scale(1); transition:transform 0.2s ease;">
                                                                                <div style="position:absolute; top:14px; right:16px; display:flex; gap:5px; align-items:center;">
                                                                                    <button onclick="ajustarZoomModal('contenidoBuscadorTF', -0.1)" style="background:#e0f2fe; color:#0369a1; border:none; border-radius:4px; width:28px; height:28px; cursor:pointer; font-size:1.1rem; font-weight:bold;" title="Reducir zoom">−</button>
                                                                                    <button onclick="ajustarZoomModal('contenidoBuscadorTF', 0)" style="background:#e0f2fe; color:#0369a1; border:none; border-radius:4px; padding:4px 8px; cursor:pointer; font-size:0.75rem; font-weight:bold;" title="Restablecer zoom">100%</button>
                                                                                    <button onclick="ajustarZoomModal('contenidoBuscadorTF', 0.1)" style="background:#e0f2fe; color:#0369a1; border:none; border-radius:4px; width:28px; height:28px; cursor:pointer; font-size:1.1rem; font-weight:bold;" title="Aumentar zoom">+</button>
                                                                                    <button onclick="cerrarModalBuscadorTF()" style="background:none; border:none; font-size:1.6rem; color:#1e3a8a; cursor:pointer;" aria-label="Cerrar">&times;</button>
                                                                                </div>
                                                                                <h2 style="color:#1e3a8a; margin:0 0 0.8rem; text-align:center;">🔎 Buscador de diagnósticos para Terapia Física</h2>
                                                                                <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:12px;">
                                                                                        <input id="inputBuscarTF" type="text" placeholder="Escribe para filtrar…" oninput="filtrarDiagnosticosTF()" style="flex:1; min-width:240px; padding:10px 12px; border:2px solid #dbeafe; border-radius:10px; font-size:0.98rem; outline:none;">
                                                                                        <div style="display:flex; gap:8px; align-items:center;">
                                                                                                <span id="contadorTF" style="color:#475569; font-size:0.95rem;">0 resultados</span>
                                                                                                <button onclick="limpiarBusquedaTF()" style="background:#eef2ff; color:#3730a3; border:none; border-radius:8px; padding:8px 12px; font-weight:600; cursor:pointer;">Limpiar</button>
                                                                                        </div>
                                                                                </div>
                                                                                <div id="contenedorListaTF" style="max-height:52vh; overflow:auto; border:1px solid #e5e7eb; border-radius:12px;">
                                                                                        <ul id="listaDiagnosticosTF" style="list-style:none; margin:0; padding:0;">
                                                                                                <!-- items renderizados por JS -->
                                                                                        </ul>
                                                                                </div>
                                                                                <div id="toastTF" style="position:absolute; left:50%; bottom:12px; transform:translateX(-50%); background:rgba(16,185,129,0.95); color:white; padding:8px 12px; border-radius:8px; font-weight:600; font-size:0.95rem; display:none; box-shadow:0 6px 16px rgba(16,185,129,0.25);">Copiado</div>
                                                                        </div>
                                                                </div>
                                                                <script>
                                                                // Dataset de diagnósticos para el buscador de TF
                                                                const DIAGNOSTICOS_TF = `
AMPUTACION TRAUMATICO DEDO MANO KINESIOLOGIA
CONDROCALCINOSIS EN LA RODILLA
OPERACION DE PROTESIS DE RODILLA
CONTUSION DE DEDO DE LA MANO, SIN DAÑO DE LA(S) U
ABOMBAMIENTO DISCAL
ABSCESO FALANGE DISTAL DEDO IZQUIERDO
ACORTAMIENTO DEL TENDON DE AQUILES (ADQUIRIDO) 
AFLOJAMIENTO DE PROTESIS TOTAL DE CADERA
AMPUTACION TRAUMATICA DE DEDOS DE LA MAN
AMPUTACION TRAUMATICA DE EXTREMIDAD INFERIOR  A NI
AMPUTACION TRAUMATICA DE EXTREMIDAD SUPERIOR A NIV
AMPUTACION TRAUMATICA DE EXTREMIDADES SUPERIOR(ES)
AMPUTACION TRAUMATICA DE ORTEJOS 
AMPUTACION TRAUMATICA DEL PULGAR (COMPLETA O PARCI
ARTRALGIA RODILLA 
ARTRITIS EN OTRAS ENFERMEDADES BACTERIANAS CLASIFI
ARTRITIS NO ESPECIFICADA
ARTRITIS SEPTICA DE CODO 
ARTRITIS SEPTICA DE RODILLA 
ARTRITIS SEPTICA DE TOBILLO 
ARTRITIS SEPTICA INFERFALANGICA 
ARTROPATIA DE CHARCOT
ARTROSIS  DE LA  PRIMERA ARTICULACION CARPOMETACAR
ARTROSIS ACROMIOCLAVICULAR
ARTROSIS CARPOMETACARPIANA 
ARTROSIS CODO 
ARTROSIS DE CADERA 
ARTROSIS DE TOBILLO
ARTROSIS GLENOHUMERAL
ARTROSIS GLENOHUMERAL POST INSUFICIENCIACRÓNICA MA
ARTROSIS INTERFALANGICAS
ARTROSIS MANO
ARTROSIS MUÑECA
ARTROSIS PIE 
ARTROSIS RODILLA . GONARTROSIS
ARTROSIS SECUNDARIA DE CUALQUIER ARTICULACION
ARTROSIS SECUNDARIA DE EXTREMIDAD INFERIOR
ARTROSIS TIBIO-TALAR 
ARTROSIS TOBILLO
ARTROSIS, NO ESPECIFICADA
ATROFIA Y DESGASTE MUSCULARES, NO CLASIFICADOS EN
BRAQUIALGIA MIOFASCIAL 
BUNIONETTE DERECHA(O)
BURSITIS  DE LA MANO
BURSITIS DE CODO
BURSITIS DE RODILLA
BURSITIS DEL OLECRANON
BURSITIS DEL PIE 
BURSITIS PRERROTULIANA
BURSITIS SUBACROMIAL
BURSITIS SUBACROMIODELTOIDEA 
BURSITIS TROCANTERIANA
CAPSULITIS ADHESIVA DE HOMBRO
CELULITIS DE ANTEBRAZO
CELULITIS DE EXTREMIDAD INFERIOR
CELULITIS DE LOS DEDOS  DEL PIE
CELULITIS DE MANO O DEDOS
CELULITIS DE SITIO NO ESPECIFICADO
CERVICALGIA
CIATICA
CONDROMALACIA
CONDROMALACIA DE LA ROTULA
CONTRACTURA ARTICULAR
CONTRACTURA MUSCULAR
CONTUSION ANTEPIE LEVE
CONTUSION ANTEPIE MODERADA
CONTUSION ANTEPIE SEVERA
CONTUSION DE ANTEBRAZO LEVE
CONTUSION DE ANTEBRAZO MODERADA
CONTUSION DE ANTEBRAZO SEVERA
CONTUSION DE BRAZO LEVE
CONTUSION DE BRAZO MODERADA
CONTUSION DE BRAZO SEVERA
CONTUSION DE CADERA LEVE
CONTUSION DE CADERA MODERADA
CONTUSION DE CADERA SEVERA
CONTUSION DE CODO LEVE
CONTUSION DE DEDO DE LA MANO, CON DAÑO D
CONTUSION DE DEDO DE LA MANO, CON DAÑO DE LA(S) UÑ
CONTUSION DE DEDO DE LA MANO, SIN DAÑO D
CONTUSION DE DEDO(S) DEL PIE, CON DAÑO DE LA(S) UÑ
CONTUSION DE DEDO(S) DEL PIE, SIN DAÑO D
CONTUSION DE DEDO(S) DEL PIE, SIN DAÑO DE LA(S) UÑ
CONTUSION DE HOMBRO LEVE
CONTUSION DE HOMBRO MODERADA
CONTUSION DE HOMBRO SEVERA
CONTUSION DE LA MANO
CONTUSION DE LA MANO Y/O MUÑECA SEVERA
CONTUSIÓN DE MANO LEVE
CONTUSION DE MEPIE SEVERA 
CONTUSION DE MUSLO MODERADA
CONTUSION DE MUSLO SEVERA
CONTUSION DE PIE LEVE
CONTUSION DE PIE MODERADA
CONTUSION DE PIE SEVERA
CONTUSION DE PIERNA LEVE
CONTUSION DE PIERNA MODERADA
CONTUSION DE PIERNA SEVERA
CONTUSION DE RODILLA LEVE
CONTUSION DE RODILLA MODERADA
CONTUSION DE RODILLA SEVERA
CONTUSION DE TOBILLO  LEVE
CONTUSION DE TOBILLO MODERADA
CONTUSION DE TOBILLO SEVERA
CONTUSION DE TRONCO LEVE
CONTUSION DEL CODO MODERADA
CONTUSION DEL CODO SEVERA
CONTUSION LUMBAR SEVERA
CONTUSION LUMBOSACRA Y PELVIS LEVE
CONTUSION LUMBOSACRA Y PELVIS MODERADA
CONTUSION MEDIOPIE LEVE
CONTUSION MEDIOPIE MODERADA
CONTUSION MEDIOPIE MODERADA IZQUIERDA(O)
CONTUSION MUSLO LEVE
CONTUSION PRIMER ORTEJO
CONTUSION RETROPIE LEVE
CONTUSION RETROPIE MODERADA
CONTUSION RETROPIE SEVERA 
CONTUSION SEVERA DEDO PULGAR MANO DERECHA
CONTUSIÓN TENDON DE AQUILES
COSTOCONDRITIS
COXARTROSIS A CONSECUENCIA DE DISPLASIA
COXARTROSIS BILATERAL
COXARTROSIS PRIMARIA (ARTROSIS DE CADERA)
COXIGODINIA
CUERPO EXTRAÑO PARTES BLANDAS DE EXTREMIDAD SUPERI
CUERPO LIBRE INTRA-ARTICULAR EN LA RODILLA 
DEDO EN GATILLO
DEDO EN GATILLO, TENOVAGINOSIS ESTENOSANTE
DEFORMIDAD EN BOUTONIERE 
DEFORMIDADES ADQUIRIDAS DE LOS DEDOS DELA MANO 
DEFORMIDADES ADQUIRIDAS DE LOS DEDOS DELPIE IZQUIE
DERRAME ARTICULAR
DESGARRO MUSCULAR DE EXTREMIDAD INFERIOR
DESGARRO MUSCULAR EXTREMIDAD SUPERIOR LEVE
DESGARRO MUSCULAR EXTREMIDAD SUPERIOR MODERADO
DESGARRO MUSCULAR EXTREMIDAD SUPERIOR SEVERO
DESGARRO PARAVERTEBRAL CUALQUIER NIVEL
DISFUNCION PATELO FEMORAL 
DISYUNCION ACROMIOCLAVICULAR GRADO I
DISYUNCION ACROMIOCLAVICULAR GRADO II
DISYUNCION ACROMIOCLAVICULAR GRADO III
DISYUNCION ACROMIOCLAVICULAR GRADO V
DOLOR CRONICO DE ANTEBRAZO
DOLOR CRONICO DE BRAZO
DOLOR CRONICO DE CADERA
DOLOR CRONICO DE CODO
DOLOR CRONICO DE HOMBRO
DOLOR CRONICO DE MANO
DOLOR CRONICO DE MUÑECA
DOLOR CRONICO DE PIE
DOLOR CRONICO DE TOBILLO
DOLOR DE CADERA 
DOLOR DE CODO EN ESTUDIO
DOLOR DE DEDOS
DOLOR DE EXTREMIDAD INFERIOR EN ESTUDO
DOLOR DE EXTREMIDAD SUPERIOR EN ESTUDIO
DOLOR DE HOMBRO EN ESTUDO
DOLOR DE MUÑECA
DOLOR DE PIE
DOLOR DE RODILLA EN ESTUDIO
DOLOR DE TOBILLO EN ESTUDIO
DOLOR DEL TALO EN ESTUDIO, TALALGIA
DOLOR LUMBAR CRONICO MULTIFACTORIAL
DORSALGIA
ENFERMEDAD DE DUPUYTREN 
ENTESOPATIA DE PATA DE GANSO 
ENTESOPATIA, NO ESPECIFICADA 
EPICONDILITIS  
EPITROCLEITIS (EPICONDILITS MEDIAL)
ESGUINCE CERVICAL
ESGUINCE CERVICAL   CONTRACTURA MUSCULAR
ESGUINCE DE CODO LEVE
ESGUINCE DE LOS ORTEJOS Y ANTEPIE GRADOI
ESGUINCE DE LOS ORTEJOS Y ANTEPIE GRADOI-II 
ESGUINCE DE LOS ORTEJOS Y ANTEPIE GRADOIII
ESGUINCE DE MUÑECA GRADO I
ESGUINCE DE MUÑECA GRADO II
ESGUINCE DE MUÑECA GRADO III
ESGUINCE DE TOBILLO GRADO III
ESGUINCE DEL PIE GRADO I
ESGUINCE DEL PIE GRADO II-III 
ESGUINCE GRADO I ARTICULACIÓN TRAPECIO-MTC
ESGUINCE INTERFALÁNGICO DEDO DE LA MANO GRADO II 
ESGUINCE INTERFALÁNGICO DEDO DE LA MANO GRADO II-I
ESGUINCE INTERFALÁNGICO DEDO DE LA MANOGRADO I
ESGUINCE LUMBAR
ESGUINCE METACARPOFALÁNGICO GRADO I
ESGUINCE METACARPOFALÁNGICO GRADO II
ESGUINCE METACARPOFALÁNGICO GRADO III
ESGUINCE O DESGARRO DE CADERA LEVE
ESGUINCE O DESGARRO DE CADERA MODERADO
ESGUINCE O DESGARRO DE CADERA SEVERO
ESGUINCE O DESGARRO DE CODO MODERADO
ESGUINCE O DESGARRO DE CODO SEVERO
ESGUINCE O DESGARRO MUSCULAR DEL HOMBRO LEVE
ESGUINCE O DESGARRO MUSCULAR DEL HOMBRO SEVERO IZQ
ESGUINCE O DESGARRO MUSCULAR DEL HOMBROMODERADO
ESGUINCE O DESGARRO SACROILIACO
ESGUINCE PIE GRADO I-II
ESGUINCE RODILLA G III
ESGUINCE RODILLA GRADO I
ESGUINCE RODILLA GRADO II
ESGUINCE TOBILLO GRADO I
ESGUINCE TOBILLO GRADO I-II
ESPOLON CALCANEO
ESPONDILOLISIS
ESPONDILOLISTESIS
ESPONDILOLISTESIS CERVICAL DEGENERATIVA
ESPONDILOLISTESIS LUMBAR
ESPONDILOLISTESIS LUMBAR DEGENERATIVA
ESPONDILOPATIA EN OTRAS ENFERMEDADES INFECCIOSAS Y
ESPONDILOSIS SIN MIELOPATIA
ESPONDILOSIS, NO ESPECIFICADA
ESTENOSIS RAQUIDEA DORSAL O LUMBAR
FALTA DE CONSOLIDACION DE  FRACTURA  PSEUDOARTROSI
FASCITIS PLANTAR
FIBROMATOSIS PALMAR (DUPUYTREN)
FRACTURA ABIERTA  DE COSTILLA 
FRACTURA ABIERTA DE APOFISIS TRANSVERSADE VERTEBRA
FRACTURA ABIERTA DE PELVIS IZQUIERDA(O)
FRACTURA ABIERTA FALANGE DISTAL DEL PULGAR
FRACTURA ABIERTA FALANGE PROXIMAL DEL PULGAR
FRACTURA ASTRAGALO CERRADA
FRACTURA AVULSIVA DEL CARPO
FRACTURA BASE PRIMER METACARPIANO 
FRACTURA CALCANEO CERRADA
FRACTURA CERRADA  DE APOFISIS TRANSVERSA DE VERTEB
FRACTURA CERRADA  DE COLUMNA LUMBOSACRA
FRACTURA CERRADA  DE ISQUION IZQUIERDA(O)
FRACTURA CERRADA  DE PELVIS
FRACTURA CERRADA  DE VERTEBRA LUMBAR
FRACTURA CERRADA  DE VERTEBRA LUMBOSACRA
FRACTURA CERRADA  DEL ACETABULO 
FRACTURA CERRADA  DEL COCCIX
FRACTURA CERRADA  DEL SACRO
FRACTURA CERRADA DE APOFISIS ESPINOSA DEVERTEBRA C
FRACTURA CERRADA DE APOFISIS ESPINOSA DEVERTEBRA T
FRACTURA CERRADA DE APOFISIS TRANSVERSADE VERTEBRA
FRACTURA CERRADA DE CARTILAGO TIROIDES
FRACTURA CERRADA DE COLUMNA CERVICAL
FRACTURA CERRADA DE COLUMNA DORSAL
FRACTURA CERRADA DE COSTILLA
FRACTURA CERRADA DE LA SEGUNDA VERTEBRACERVICAL
FRACTURA CERRADA DE OTRAS VERTEBRAS CERVICALES ESP
FRACTURA CERRADA DE VERTEBRA TORACICA
FRACTURA CERRADA DEL ACROMION (APOFISIS) IZQUIERDA
FRACTURA CERRADA DEL ESTERNON
FRACTURA CERRADA DEL HUESO GANCHOSO  UNCIFORME
FRACTURA CERRADA DEL HUESO GRANDE  OS MAGNUM  DERE
FRACTURA CERRADA DEL HUESO PIRAMIDAL
FRACTURA CERRADA DEL HUESO PISIFORME 
FRACTURA CERRADA DEL HUESO SEMILUNAR  LUNAR 
FRACTURA CERRADA DEL HUESO TRAPECIO  MULTANGULAR M
FRACTURA CERRADA DEL HUESO TRAPEZOIDE Y HUESO GRAN
FRACTURA CERRADA FALANGE DISTAL DEL PULGAR
FRACTURA CERRADA FALANGE PROXIMAL DEL PULGAR
FRACTURA CERRADA S MULTIPLES DE LA COLUMNA LUMBAR
FRACTURA CERRADAS MULTIPLES DE COLUMNA TORACICA
FRACTURA CLAVICULA, DIAFISIARIA CERRADA
FRACTURA CLAVICULA, TERCIO LATERAL CERRADA
FRACTURA CLAVICULA, TERCIO MEDIAL ABIERTA 
FRACTURA CLAVICULA, TERCIO MEDIAL CERRADA
FRACTURA CUBITO DIAFISIARIA NO DESPLAZADA CERRADA
FRACTURA CUBITO EPIFISIS SUPERIOR CERRADA 
FRACTURA CUBITO, DIAFISIARIA ABIERTA
FRACTURA CUBITO, EPIFISIS INFERIOR ABIERTA
FRACTURA CUBITO, EPIFISIS INFERIOR CERRADA
FRACTURA CUELLO HUMERO IZQUIERDO
FRACTURA CUELLO TALO CERRADA 
FRACTURA CUERPO TALO CERRADA
FRACTURA CUPULA RADIAL
FRACTURA DE CADERA CERRADA SIN ESPECIFICAR
FRACTURA DE CODO CORONOIDES CERRADA
FRACTURA DE CUÑAS PIE 
FRACTURA DE LA EPIFISIS INFERIOR DEL FEMUR CERRADA
FRACTURA DORSAL SIN COMPROMISO NEUROLOGICO
FRACTURA EDR (MUÑECA) CERRADA 
FRACTURA EDR MUÑECA DERECHA
FRACTURA EN HUESO PATOLOGICO DE COSTILLAS 
FRACTURA EN HUESO PATOLOGICO DE EXTREMIDAD SUPERIOR
FRACTURA ESCAFOIDES ABIERTA
FRACTURA ESCAFOIDES CERRADA
FRACTURA ESCAPULA CON COMPROMISO DE GLENOIDES CERR
FRACTURA ESCAPULA SIN COMPROMISO DE GLENOIDES CERR
FRACTURA ESTERNAL
FRACTURA EXPUESTA TIBIA DERECHA
FRACTURA FALANGE DISTAL ABIERTA
FRACTURA FALANGE DISTAL CERRADA
FRACTURA FALANGE MEDIA ABIERTA
FRACTURA FALANGE MEDIA CERRADA
FRACTURA FALANGE PROXIMAL ABIERTA
FRACTURA FALANGE PROXIMAL CERRADA 
FRACTURA FEMUR, DIAFISIARIA CERRADA
FRACTURA HUESO PIRAMIDAL DERECHO
FRACTURA HUESO SESAMOIDEO
FRACTURA HUMERO, DIAFISIARIA ABIERTA
FRACTURA HUMERO, DIAFISIARIA CERRADA
FRACTURA HUMERO, EPICONDILO DERECHO
FRACTURA LUMBAR CON COMPROMISO NEUROLOGICO Y ESFIN
FRACTURA LUMBAR SIN COMPROMISO NEUROLOGICO
FRACTURA MALEOLO PERONEO ABIERTA
FRACTURA MALEOLO PERONEO CERRADA
FRACTURA MALEOLO PERONEO CERRADA IZQUIERDA(O)
FRACTURA MALEOLO TIBIAL CERRADA
FRACTURA METACARPIANA ABIERTA
FRACTURA METACARPIANO CERRADA
FRACTURA METATARSIANO ABIERTA 
FRACTURA METATARSIANO CERRADA
FRACTURA OLECRANON ABIERTA
FRACTURA OLECRANON CERRADA
FRACTURA ORTEJO DISTAL ABIERTA
FRACTURA ORTEJO MAYOR
FRACTURA ORTEJOS CERRADA (EXCEPTO PRIMERORTEJO)
FRACTURA PERONE, CABEZA O CUELLO CERRADA
FRACTURA PERONE, DIAFISIARIA ABIERTA 
FRACTURA PERONE, DIAFISIARIA CERRADA
FRACTURA PILON TIBIAL ABIERTA 
FRACTURA PILON TIBIAL CERRADA
FRACTURA PLATILLOS TIBIALES ABIERTA
FRACTURA PLATILLOS TIBIALES CERRADA
FRACTURA PRIMER METACARPIANO 
FRACTURA PRIMER ORTEJO CERRADA
FRACTURA PROTESIS TOTAL DE CADERA DERECHA(O)
FRACTURA RADIO Y CUBITO, DIAFISIARIAS ABIERTA 
FRACTURA RADIO Y CUBITO, DIAFISIARIAS CERRADA
FRACTURA RADIO, DIAFISIARIA ABIERTA 
FRACTURA RADIO, DIAFISIARIA CERRADA
FRACTURA RADIO, EPIFISIS INFERIOR CERRADA 
FRACTURA RADIO, EPIFISIS INFERIOR DEL ABIERTA DERE
FRACTURA RADIO, EPIFISIS SUPERIOR ABIERTA
FRACTURA ROTULA ABIERTA
FRACTURA ROTULA CERRADA
FRACTURA SACROCOXIS CON COMPROMISO NEUROLOGICO
FRACTURA SACROCOXIS SIN COMPROMISO NEUROLOGICO
FRACTURA SEMILUNAR CERRADA
FRACTURA TALO
FRACTURA TIBIA Y PERONE, DIAFISIARIAS ABIERTA
FRACTURA TIBIA Y PERONE, DIAFISIARIAS CERRADA
FRACTURA TIBIA, DIAFISIARIA CERRADA
FRACTURA TOBILLO BIMALEOLAR ABIERTA 
FRACTURA TOBILLO BIMALEOLAR CERRADA
FRACTURA TOBILLO TRIMALEOLAR CERRADA
FRACTURA TOBILLO WEBER C
FRACTURA TROCANTERIANA DE FEMUR CERRADA IZQUIERDA(
FRACTURAS ABIERTA  MULTIPLES DE COSTILLAS 
FRACTURAS ABIERTAS MULTIPLES DE LOS DEDOS DE LA MA
FRACTURAS CERRADAS MULTIPLES DE COSTILLAS
FRACTURAS CERRADAS MULTIPLES DE LOS DEDOS DE LA MA
FRACTURAS CERRADAS MULTIPLES DEL FEMUR IZQUIERDA(O
FRACTURAS CERRADAS MULTIPLES METACARPIANOS
FRACTURAS PERIFERICAS TALO CERRADA
GANGLION
GONARTROSIS POSTRAUMATICA, BILATERAL
GONARTROSIS PRIMARIA 
GONARTROSIS, NO ESPECIFICADA
GRANULOMA POR CUERPO EXTRAÑO EN TEJIDO BLANDO, NO
HALLUX VALGUS
HEMARTROSIS DE RODILLA DERECHA(O)
HERIDA  MUÑECA CON LESION DE TENDON 
HERIDA ANTEBRAZO  CON LESION DE TENDON
HERIDA ANTEBRAZO COMPLICADA
HERIDA CONTUSA CODO 
HERIDA DE  O BRAZO CON COMPROMISO DE TENDON 
HERIDA DE BRAZO COMPLICADA
HERIDA DE CADERA O MUSLO COMPLICADA
HERIDA DE CADERA O MUSLO MODERADA
HERIDA DE CADERA O MUSLO SIMPLE
HERIDA DE DEDO CON LESION DE TENDON EXTENSOR
HERIDA DE DEDO CON LESION DE TENDON FLEX
HERIDA DE DEDOS DEL PIE
HERIDA DE DEDOS DEL PIE SIMPLE
HERIDA DE LA MANO CON PERDIDA DE SUSTANCIA 
HERIDA DE LA MANO MODERADA 
HERIDA DE LA MANO MODERADA DERECHA
HERIDA DE LA MANO SIMPLE
HERIDA DE LA PIERNA BILATERAL
HERIDA DE LA PIERNA CON LESION DE TENDON
HERIDA DE LA PIERNA MODERADA
HERIDA DE LA PIERNA SIMPLE
HERIDA DE LA REGION LUMBOSACRA Y DE LA PELVIS
HERIDA DE LA RODILLA COMPLICADA
HERIDA DE LA RODILLA CON LESION DE TENDON 
HERIDA DE LA RODILLA MODERADA
HERIDA DE LA RODILLA SIMPLE
HERIDA DE LOS DEDOS DE LA MANO COMPLICA 
HERIDA DE LOS DEDOS DE LA MANO LEVE
HERIDA DE LOS DEDOS DE LA MANO MODERADA
HERIDA DE MANO CON LESION DE TENDON
HERIDA DE MIEMBRO INFERIOR, NIVEL NO ESPECIFICADO
HERIDA DE MUÑECA MODERADA
HERIDA DE MUÑECA SIMPLE
HERIDA DE PIE MODERADA
HERIDA DE PIE U ORTEJOS CON COMPROMISO DE TENDON
HERIDA DE PIE U ORTEJOS SIMPLE
HERIDA DE PIERNA CON LESION NEUROVASCULAR 
HERIDA DE PIERNA SIMPLE
HERIDA DE RODILLA
HERIDA DE RODILLA CON LESION TENDINEA
HERIDA DE RODILLA SIMPLE
HERIDA DE TOBILLO SIMPLE
HERIDA DEDO DE LA MANO CON PERDIDA DE SUSTANCIA
HERIDA DEL ANTEBRAZO MODERADA
HERIDA DEL ANTEBRAZO SIMPLE
HERIDA DEL BRAZO MODERADA
HERIDA DEL BRAZO SEVERA
HERIDA DEL BRAZO SIMPLE
HERIDA DEL CODO CON LESION DE TENDON IZQUIERDA(O)
HERIDA DEL CODO MODERADA
HERIDA DEL CODO SIMPLE
HERIDA DEL HOMBRO MODERADA
HERIDA DEL HOMBRO SIMPLE
HERIDA DEL TOBILLO MODERADA
HERIDA DEL TOBILLO SIMPLE
HERIDA MUÑECA COMPLEJA
HERIDA PIE MODERADA
HERIDA REFRACTARIA
HERIDAS DE OTRAS PARTES DEL ANTEBRAZO
HERIDAS MULTIPLES DE LA CADERA Y DEL MUSLO
HERIDAS MULTIPLES DE LA MUÑECA Y DE LA MANO
HERIDAS MULTIPLES DE LA PIERNA
HERIDAS MULTIPLES DEL ANTEBRAZO 
HERIDAS MULTIPLES DEL HOMBRO Y DEL BRAZO
HERIDAS MULTIPLES, EN CODO Y BRAZO IZQUIERDOS
HERIDAS QUE AFECTAN MULTIPLES REGIONES DEL(DE LOS)
HERIDAS QUE AFECTAN OTRAS COMBINACIONESDE REGIONES
HERNIA LUMBAR
HIDROARTROSIS DE RODILLA 
HIPERTROFIA SINOVIAL Y TENDINOSO, NO ESPECIFICADO
HNP CERVICAL
HNP DORSAL
HNP LUMBAR
HOMBRO DOLOROSO
INESTABILIDAD CRONICA DE LA RODILLA
INFLAMACIÓN DE ARTICULACION ESTERNOCLAVICULAR IZQU
LAXITUD LIGAMENTOSA DE RODILLA
LESION DE LIGAMENTO ESCAFOLUNAR AGUDO IZQUIERDA(O)
LESION DE LIGAMENTO ESCAFOLUNAR CRÓNICO
LESION DE MÚLTIPLES TENDONES EXTENSORESEN MANO/MUÑ
LESION DE MÚLTIPLES TENDONES FLEXORES ENANTEBRAZO
LESION DE MÚLTIPLES TENDONES FLEXORES ENMANO/MUÑEC
LESION DE NERVIO CUBITAL EN ANTEBRAZO/CODO 
LESION DE NERVIO CUBITAL EN MUÑECA/MANO DERECHA(O)
LESION DE TENDON EXTENSOR DEDOS  EN MANO/MUÑECA (E
LESION DE TENDON EXTENSOR DEDOS EN ANTEBRAZO 
LESION DE TENDON EXTENSOR DEL CARPO DERECHA(O)
LESION DE TENDON EXTENSOR LARGO PULGAR
LESION DE TENDON EXTENSOR PULGAR  EN ANTEBRAZO 
LESION DE TENDON EXTENSOR PULGAR  EN MANO/MUÑECA
LESION DE TENDON FLEXOR DEDOS  EN ANTEBRAZO (EXCEP
LESION DE TENDON FLEXOR DEDOS  EN MANO/MUÑECA (EXC
LESION DE TENDON FLEXOR DEL CARPO 
LESION DE TENDON FLEXOR PULGAR EN MANO/MUÑECA 
LESION LIGAMENTOSA MULTIPLE RODILLA
LESIÓN MUSCULO TENDINEA CADERA
LESION STENER PULGAR 
LESION TENDONES EXTENSORES EN ANTEBRAZO
LESIONES DEL HOMBRO, NO ESPECIFICADA
LUMBAGO MECANICO
LUMBOCIATICA
LUMBOCRURALGIA 
LUXACIÓN CODO DERECHO
LUXACION DE ARTICULACION SACROCOCCIGEA YSACROILIAC
LUXACION DE CODO
LUXACION DE DEDO (MCF, IFP, IFD)
LUXACION DE DEDOS DE LA MANO 
LUXACION DE HOMBRO 
LUXACION DE LA MUÑECA
LUXACION DE ORTEJOS
LUXACION DE OTRAS PARTES DE LA CINTURA ESCAPULAR Y
LUXACION DE OTRAS PARTES Y DE LAS NO ESP
LUXACION DE OTROS SITIOS Y LOS NO ESPECIFICADOS DE
LUXACION DE RODILLA
LUXACION DE ROTULA
LUXACION DE TOBILLO
LUXACION DEL PIE IZQUIERDA(O)
LUXACION ESTERNOCLAVICULAR
LUXACION GLENOHUMERAL
LUXACION HOMBRO DERECHA(O)
LUXACION HUESOS DEL CARPO O CARPOMETACARPIANA 
LUXACION INTERFALANGICA DISTAL DEDO
LUXACION INTERFALANGICA PROXIMAL DEDO
LUXACIÓN RECIDIVANTE DE PATELA BILATERAL
LUXACION RECIDIVANTE DE ROTULA
LUXACION TRAUMATICA DE CADERA 
LUXACION Y SUBLUXACION RECIDIVANTE DE LAARTICULACI
LUXACION, ESGUINCE O TORCEDURA DE ARTICULACION Y L
LUXACION/LUXOFRACTURA  PERILUNAR DEL CARPO DERECHA
LUXACIONES MULTIPLES DE DEDOS DE LA MANO
LUXACIONES, TORCEDURAS Y ESGUINCES MULTIPLES, NO E
LUXACIONES, TORCEDURAS Y ESGUINCES QUE AFECTAN MUL
LUXOFRACTURA DE BENNET CERRADA
LUXOFRACTURA DE CHOPART CERRADA 
LUXOFRACTURA DE CODO
LUXOFRACTURA DE GALEAZZI CERRADA
LUXOFRACTURA DE LISFRANC CERRADA
LUXOFRACTURA DEL PIE ABIERTA
LUXOFRACTURA DEL PIE CERRADA
LUXOFRACTURA DEL PIE CERRADA DERECHA(O)
LUXOFRACTURA DEL PIE CERRADA IZQUIERDA(O)
MALLET FINGER O MALLET FRACTURE
man
MANO GRAVEMENTE LESIONADA
MANO O PIE EN GARRA O EN TALIPES, PIE EQUINOVARO O
MENISCO DISCOIDEO 
MENISCO QUISTICO 
METATARSALGIA
MIALGIA
MONOARTRITIS DE EXTREMIDAD INFERIOR 
MONOARTRITIS DE EXTREMIDAD SUPERIOR 
MONOARTRITIS, NO CLASIFICADA EN OTRA PARTE
NECROSIS AVASCULAR DEL SEMILUNAR 
NEURORRAFIA
NODULOS DE HEBERDEN (CON ARTROPATIA) IZQUIERDA(O)
NODULOS DE SCHMORL
NODULOS INTERFALANGICOS
OBS. ROTURA DEL MANGUITO DE LOS ROTADORES
OBS.SÍNDROME DE TUNEL DEL TARSO DER.
OSTEOARTROSIS PRIMARIA GENERALIZADA
OSTEOCONDRITIS
OSTEOCONDROPATIA, NO  ESPECIFICADA
OSTEOLISIS DE CLAVICULAR DISTAL 
OSTEONECROSIS DISBÁRICA
OSTEONECROSIS DISBARICA CABEZA HUMERAL
PANADIZO DE ORTEJO DERECHA(O)
PANADIZO DEDO DE LA MANO
PERDIDA DE PULPEJO DEDO MEDIO IZQUIERDO
PERIARTRITIS DE LA MUÑECA 
PINZAMIENTO INCIPIENTE FEMOROACETABULAR
PLICA MEDIOPATELAR 
POLIARTRITIS, NO ESPECIFICADA
PSEUDOARTROSIS DE COLUMNA
PSEUDOARTROSIS DE ESCAFOIDES 
PSEUDOARTROSIS DE LOS HUESOS DEL PIE 
PSEUDOARTROSIS FALANGE 
PSEUDOARTROSIS TOBILLO 
PSEUDOCOXALGIA
QUISTE SINOVIAL DE EXTREMIDAD INFERIOR
QUISTE SINOVIAL DEL HUECO POPLITEO  DE BAKER  DERE
RABDOMIOLISIS
RADICULOPATIA
RETARDO DE CONSOLIDACION DE FRACTURA
RIGIDEZ ARTICULAR  METACARPOFALANGICA 
RIGIDEZ ARTICULAR DE HOMBRO
RIGIDEZ ARTICULAR DE MANO 
RIGIDEZ ARTICULAR DE MUÑECA BILATERAL
RIGIDEZ ARTICULAR DE RODILLA
RIGIDEZ ARTICULAR DE TOBILLO
RIGIDEZ ARTICULAR INTERFALANGICA
ROTURA  TENDON TIBIAL POSTERIOR
ROTURA ANTIGUA DE LIGAMENTO DE RODILLA 
ROTURA ANTIGUA DE MENISCO EXTERNO
ROTURA ANTIGUA DE MENISCO INTERNO
ROTURA CERRADA DE TENDON DE EXTREMIDAD INFERIOR 
ROTURA CERRADA DE TENDON DE EXTREMIDAD SUPERIOR
ROTURA DE LIGAMENTO COLATERAL LATERAL DE RODILLA 
ROTURA DE LIGAMENTO COLATERAL MEDIAL DE RODILLA
ROTURA DE LIGAMENTO CRUZADO ANTERIOR 
ROTURA DE LIGAMENTOS A NIVEL DEL TOBILLO Y DEL PIE
ROTURA DE QUISTE SINOVIAL POPLITEO 
ROTURA DEGENERATIVA DEL TENDON DE AQUILES
ROTURA DEGENERATIVA PORCIÓN LARGA DEL BÍCEPS DEREC
ROTURA ESPONTANEA  DE TENDONES EXTENSORES
ROTURA ESPONTANEA DE  TENDONES FLEXORES
ROTURA ESPONTANEA DE OTROS TENDONES
ROTURA LIGAMENTO CRUZADO POSTERIOR
ROTURA RECIENTE DE MENISCO EXTERNO
ROTURA RECIENTE DE MENISCO INTERNO
ROTURA TENDON DE AQUILES AGUDA
ROTURA TENDON DE AQUILES CRONICA 
ROTURA TENDONES EXTENSORES ORTEJO DERECHA(O)
ROTURA TRAUMATICA DE DISCO INTERVERTEBRAL LUMBAR
ROTURA TRAUMATICA DE LIGAMENTOS DE LA MUÑECA Y DEL
ROTURA TRAUMÁTICA MANGUITO ROTADOR
ROTURA TRAUMÁTICA PORCIÓN LARGA DEL BÍCEPS IZQUIER
SACROILIITIS,  NO CLASIFICADA EN OTRA PARTE
SECCION DE ARTERIA Y VENA ILIACA BILATERAL
SECUELA DE FRACTURA DE EXTREMIDAD SUPERIOR
SECUELAS DE FRACTURA DE LA COLUMNA VERTEBRAL
SECUELAS DE OTRA FRACTURA DEL TORAX Y DELA PELVIS
SINDROME DE DOLOR LUMBAR
SINDROME DE ENTRECRUZAMIENTO
SINDROME DE PELLIZCAMIENTO FEMORO-ACETABULAR
SINDROME DE PELLIZCAMIENTO SUBACROMIAL
SINDROME DEL TENDON DEL  TENSOR DE LA FASCIA LATA
SINDROME DOLOR REGIONAL COMPLEJO MIEMBRO INFERIOR
SINDROME DOLOR REGIONAL COMPLEJO MIEMBRO SUPERIOR
SINDROME FACETARIO, LUMBAGO
SINDROME HIPERLAXITUD LIGAMENTOSA ARTICULAR.  ESGU
SINDROME MIOFASCIAL
SINOVITIS CREPITANTE CRONICA MANO Y MUÑECA
SINOVITIS DE RODILLA
SINOVITIS TRANSITORIA
SINOVITIS Y TENOSINOVITIS DE EXTREMIDAD INFERIOR
SUPRAESPINOSO
TENDINITIS AQUILIANA
TENDINITIS BICIPITAL
TENDINITIS CALCICA MANGUITO ROTADOR
TENDINITIS CALCIFICADA
TENDINITIS DE FLEXORES DE MUÑECA
TENDINITIS DE PIE
TENDINITIS DE QUERVAIN
TENDINITIS DEL PSOAS
TENDINITIS GLUTEA
TENDINITIS LEVE
TENDINITIS PIE
TENDINITIS ROTULIANA
TENDINOPATÍA BICEPS DISTAL
TENDINOPATIA DEGENERATIVA BICIPITAL 
TENDINOPATIA EXTENSORES  ORTEJOS
TENDINOPATIA TENDON DE AQUILES INSERCIONAL
TENDINOPATIA TENDON DE AQUILES NO INSERCIONAL
TENDINOPATIA TENDON TIBIAL ANTERIOR
TENDINOPATIA TENDON TIBIAL POSTERIOR
TENDINOPATIA TENDONES PERONEOS CON LUXACION 
TENDINOPATIA TENDONES PERONEOS SIN LUXACION 
TENOSINOVITIS DE  FLEXORES DE LOS DEDOS
TENOSINOVITIS DE EXTENSORES DE LOS DEDOS
TENOSINOVITIS SEPTICA DE TENDONES IZQUIERDA(O)
TENOSINOVITIS Y/O SINOVITIS DE EXTREMIDAD SUPERIOR
TENOSINOVITIS Y/O TENDINITIS DE MANO Y/O MUÑECA
TERCIO MEDIO
TRASTORNO DE DISCO  LUMBAR Y OTROS, CONRADICULOPAT
TRASTORNO DE DISCO CERVICAL CON RADICULOPATIA
TRASTORNO DE DISCO CERVICAL, NO ESPECIFICADO
TRASTORNO DE LA ROTULA, NO ESPECIFICADO
TRASTORNO DE LOS TEJIDOS BLANDOS, NO ESPECIFICADO
TRASTORNO MUSCULAR, NO ESPECIFICADO
TRASTORNOS DE DISCOS INTERVERTEBRALES LUMBARES Y O
TRASTORNOS DE LOS DISCOS INTERVERTEBRALES, NO ESPE
TRASTORNOS INTERNO DE LA RODILLA, GONALGIA
TRASTORNOS ROTULOFEMORALES
TRASTORNOS SACROCOCCIGEOS, NO CLASIFICADOS EN OTRA
TRAUMATISMO (contusion leve) DE  COLUMNA SACRA
TRAUMATISMO DE ESTRUCTURAS MULTIPLES DELA RODILLA
TRAUMATISMO DE LA PIERNA, NO ESPECIFICADO DERECHA(
TRAUMATISMO DE MULTIPLES TENDONES Y MUSCULOS A NIV
TRAUMATISMO DE MULTIPLES TENDONES Y MUSCULOS EXTEN
TRAUMATISMO DE MULTIPLES TENDONES Y MUSCULOS Y LOS
TRAUMATISMO DE NERVIO NO ESPECIFICADO DEMIEMBRO SU
TRAUMATISMO DE NERVIOS MULTIPLES A NIVELDE LA CADE
TRAUMATISMO DE OTRO TENDON Y MUSCULO EXTENSOR A NI
TRAUMATISMO DE OTROS TENDONES Y MUSCULOS
TRAUMATISMO DE OTROS TENDONES Y MUSCULOSA NIVEL DE
TRAUMATISMO DE OTROS TENDONES Y MUSCULOSY DE LOS N
TRAUMATISMO DE OTROS TENDONES Y MUSCULOSY LOS NO E
TRAUMATISMO DE TENDON DEL MANGUITO ROTATORIO DEL H
TRAUMATISMO DE TENDON Y MUSCULO DE LA CABEZA LARGA
TRAUMATISMO DE TENDON Y MUSCULO DEL TRICEPS 
TRAUMATISMO DE TENDON Y MUSCULO NO ESPECIFICADO, A
TRAUMATISMO DE TENDON Y MUSCULO NO ESPECIFICADOS
TRAUMATISMO DE TENDON Y MUSCULO NO ESPECIFICADOS A
TRAUMATISMO DE TENDONES Y MUSCULOS ABDUCTORES Y EX
TRAUMATISMO DE TENDONES Y MUSCULOS INTRINSECOS A N
TRAUMATISMO DE TENDONES Y MUSCULOS NO ESPECIFICADO
TRAUMATISMO DE VASO(S) SANGUINEO(S) DE OTRO DEDO
TRAUMATISMO DEL MUSCULO Y TENDON INTRINSECO DE OTR
TRAUMATISMO DEL NERVIO CIATICO A NIVEL DE LA CADER
TRAUMATISMO DEL NERVIO CUBITAL A NIVEL DE LA MUÑEC
TRAUMATISMO DEL NERVIO DIGITAL DE OTRO DEDO DERECH
TRAUMATISMO DEL NERVIO FEMOROCUTANEO A NIVEL DE LA
TRAUMATISMO DEL NERVIO SENSORIAL CUTANEOA NIVEL DE
TRAUMATISMO DEL PLEXO LUMBOSACRO
TRAUMATISMO DEL TENDON DE AQUILES
TRAUMATISMO DEL TENDON Y MUSCULO ADUCTORMAYOR DEL
TRAUMATISMO DEL TENDON Y MUSCULO CUADRICEPS
TRAUMATISMO DEL TENDON Y MUSCULO DE LA CADERA IZQU
TRAUMATISMO DEL TENDON Y MUSCULO DEL EXTENSOR LARG
TRAUMATISMO DEL TENDON Y MUSCULO DEL GRUPO MUSCULA
TRAUMATISMO DEL TENDON Y MUSCULO EXTENSOR DE OTRO(
TRAUMATISMO DEL TENDON Y MUSCULO EXTENSOR DEL PULG
TRAUMATISMO DEL TENDON Y MUSCULO FLEXORDE OTRO DED
TRAUMATISMO DEL TENDON Y MUSCULO FLEXORLARGO DEL P
TRAUMATISMO NO ESPECIFICADO DE LA CADERAY DEL MUSL
TRAUMATISMO POR APLASTAMIENTO DE DEDO(S)DEL PIE 
TRAUMATISMO POR APLASTAMIENTO DE LA RODILLA 
TRAUMATISMO POR APLASTAMIENTO DE OTRAS PARTES DEL
TRAUMATISMO POR APLASTAMIENTO DE OTRAS PARTES Y DE
TRAUMATISMO POR APLASTAMIENTO DEL ANTEBRAZO, PARTE
TRAUMATISMO POR APLASTAMIENTO DEL CODO DERECHA(O)
TRAUMATISMO POR APLASTAMIENTO DEL HOMBROY DEL BRAZ
TRAUMATISMO POR APLASTAMIENTO DEL TOBILLO 
TRAUMATISMO SUPERFICIAL DE LA CADERA Y DEL MUSLO,
TRAUMATISMO SUPERFICIAL DE LA MUÑECA Y DE LA MANO
TRAUMATISMO SUPERFICIAL DEL PIE Y DEL TOBILLO, NO
TRAUMATISMOS MULTIPLES DE LA PIERNA- FISTULA PIERN
TRAUMATISMOS SUPERFICIALES MULTIPLES DELA CADERA Y
TRAUMATISMOS SUPERFICIALES MULTIPLES DELA PIERNA 
TRAUMATISMOS SUPERFICIALES MULTIPLES DELPIE Y DEL
TRIADA TERRIBLE DE CODO 
VERTEBRA COLAPSADA, NO CLASIFICADA EN OTRA PARTE
QUISTE SENOVIAL MUÑECA IZQUIERDA
DESGARRO MENISCAL RODILLA
EDEMA OSEO RODILLA IZQUIERDA
PINZAMIENTO FEMURO ACETABULAR DERECHO (CADERA)
HIPERLORDOSIS LUMBAR
BANDA LIDIOTIDAL DISCAL DE RODILLA
LUMBAGO TENDINITIS
BERTOLOTTI
RADICULOPATÍA LUMBAR
ESCOLIOSIS LUMBAR
`.split('\n')
 .map(s => s.trim())
 .filter(Boolean)
 .map(s => s.toUpperCase())
 .sort((a,b) => new Intl.Collator('es', { sensitivity: 'base' }).compare(a,b));

                                                                const normalizarTF = (s) => s
                                                                    .toLowerCase()
                                                                    .normalize('NFD')
                                                                    .replace(/[\u0300-\u036f]/g, '');

                                                                function abrirModalBuscadorTF() {
                                                                    const modal = document.getElementById('modalBuscadorTF');
                                                                    if (!modal) return;
                                                                    modal.style.display = 'flex';
                                                                    // Render inicial (sin filtro)
                                                                    renderDiagnosticosTF(DIAGNOSTICOS_TF);
                                                                    // Focus input
                                                                    setTimeout(()=> document.getElementById('inputBuscarTF')?.focus(), 50);
                                                                }

                                                                function cerrarModalBuscadorTF() {
                                                                    const modal = document.getElementById('modalBuscadorTF');
                                                                    if (!modal) return;
                                                                    modal.style.display = 'none';
                                                                }

                                                                function limpiarBusquedaTF() {
                                                                    const input = document.getElementById('inputBuscarTF');
                                                                    if (input) { input.value = ''; }
                                                                    renderDiagnosticosTF(DIAGNOSTICOS_TF);
                                                                    input?.focus();
                                                                }

                                                                                                                                function filtrarDiagnosticosTF() {
                                                                    const termino = document.getElementById('inputBuscarTF')?.value || '';
                                                                    const t = normalizarTF(termino);
                                                                                                                                        if (!t) { renderDiagnosticosTF(DIAGNOSTICOS_TF); return; }
                                                                                                                                        const filtrados = DIAGNOSTICOS_TF
                                                                                                                                            .filter(item => normalizarTF(item).includes(t))
                                                                                                                                            .sort((a,b) => new Intl.Collator('es', { sensitivity: 'base' }).compare(a,b));
                                                                                                                                        renderDiagnosticosTF(filtrados);
                                                                }

                                                                function renderDiagnosticosTF(lista) {
                                                                    const ul = document.getElementById('listaDiagnosticosTF');
                                                                    const contador = document.getElementById('contadorTF');
                                                                    if (!ul) return;
                                                                    ul.innerHTML = '';
                                                                    const termRaw = document.getElementById('inputBuscarTF')?.value || '';
                                                                    const term = normalizarTF(termRaw);
                                                                    lista.forEach(txt => {
                                                                        const li = document.createElement('li');
                                                                        li.textContent = txt;
                                                                        li.style.padding = '10px 12px';
                                                                        li.style.borderBottom = '1px solid #eef2f7';
                                                                        li.style.cursor = 'pointer';
                                                                        li.style.userSelect = 'none';
                                                                        // Resaltar coincidencias cambiando color cuando hay término de búsqueda
                                                                        if (term) {
                                                                            li.style.color = '#059669';
                                                                            li.style.fontWeight = '600';
                                                                        } else {
                                                                            li.style.color = '';
                                                                            li.style.fontWeight = '';
                                                                        }
                                                                        li.onmouseenter = () => { li.style.background = '#f8fafc'; };
                                                                        li.onmouseleave = () => { li.style.background = 'transparent'; };
                                                                        li.onclick = () => copiarDiagnosticoTF(txt);
                                                                        ul.appendChild(li);
                                                                    });
                                                                    if (contador) {
                                                                        contador.textContent = `${lista.length} resultado${lista.length === 1 ? '' : 's'}`;
                                                                    }
                                                                }

                                                                async function copiarDiagnosticoTF(texto) {
                                                                    try {
                                                                        if (navigator.clipboard?.writeText) {
                                                                            await navigator.clipboard.writeText(texto);
                                                                        } else {
                                                                            const ta = document.createElement('textarea');
                                                                            ta.value = texto; document.body.appendChild(ta);
                                                                            ta.select(); document.execCommand('copy');
                                                                            ta.remove();
                                                                        }
                                                                        mostrarToastTF('Copiado');
                                                                    } catch (e) {
                                                                        console.warn('No se pudo copiar automáticamente', e);
                                                                        mostrarToastTF('No se pudo copiar');
                                                                    }
                                                                }

                                                                function mostrarToastTF(msg) {
                                                                    const toast = document.getElementById('toastTF');
                                                                    if (!toast) return;
                                                                    toast.textContent = msg || 'Copiado';
                                                                    toast.style.display = 'block';
                                                                    setTimeout(() => { toast.style.display = 'none'; }, 1200);
                                                                }
                                                                </script>
                    <button id="btnPizarra" class="btn-herramienta" onclick="window.open('https://docs.google.com/spreadsheets/d/1Ns8SHbNU0IbPt__zqj6PPXAgzsuerTz2/edit?usp=drive_link&ouid=105816801899706270671&rtpof=true&sd=true', '_blank')">🧑‍🏫 Pizarra</button>
                    <button id="btnHoario" class="btn-herramienta" onclick="window.open('https://docs.google.com/spreadsheets/d/12T6gNxczkdbRAaga8-Yt42aVA8hzQO7y/edit?usp=sharing&ouid=105816801899706270671&rtpof=true&sd=true', '_blank')">🧰 Horario de Botiquin</button>
                    <button id="btnHorarioImagen" class="btn-herramienta" onclick="abrirModalHorarioImagen()">🩻 Horario de Imagología</button>
                    <button id="btnBloqueTF" class="btn-herramienta" onclick="window.open('https://docs.google.com/spreadsheets/d/1B3_8skimxD8C-MFv37FIWcoAMciyyMq8/edit?usp=sharing&ouid=105816801899706270671&rtpof=true&sd=true', '_blank')">📅 Bloque Horario TF Ley y SNL (No HT)</button>
                    <button id="btnRutificador2025" class="btn-herramienta" onclick="window.open('https://rutificador.net/rut/', '_blank')">🆔 Rutificador 2025</button>
                    <button id="btnBuscadorMutualidades" class="btn-herramienta" onclick="window.open('https://www.asociaciondemutuales.cl/buscador-mutualidades/', '_blank')">🔎 Buscador Mutualidades</button>
                    <button id="btnCitaGratis" class="btn-herramienta" onclick="window.open('https://achs.sharepoint.com/:x:/s/SaludIntegral/Edm5ZMDTNj5Et-T1CQFCF_sB1NTPBvBoSbWsiLQkgR4vWA?wdOrigin=TEAMS-MAGLEV.p2p_ns.rwc&wdExp=TEAMS-TREATMENT&wdhostclicktime=1758921351341&web=1', '_blank')">🎁 Beneficio de Cita Gratis</button>
                                <!-- Modal Horario Imagología -->
                                <div id="modalHorarioImagen" class="modal" style="display:none; justify-content:center; align-items:center;">
                                    <div class="modal-contenido" style="max-width:760px; background:#ffffff; border-radius:18px; box-shadow:0 8px 36px rgba(30,58,138,0.18); padding:2.2rem 2.4rem; position:relative; line-height:1.5;">
                                        <button onclick="cerrarModalHorarioImagen()" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.75rem; color:#1e3a8a; cursor:pointer; line-height:1;">&times;</button>
                                        <h2 style="color:#1e3a8a; margin:0 0 1.4rem; text-align:center; font-size:2.05rem; letter-spacing:.5px;">🩻 Horario de Imagología SNL</h2>

                                        <div style="background:#e8f5e9; border-left:6px solid #2e7d32; padding:1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
                                            <div style="font-weight:600; color:#1b5e20; font-size:1.05rem; margin-bottom:.45rem;">🕘 Radiografías (RX)</div>
                                            <p style="margin:.35rem 0 .55rem; font-weight:600; color:#0d5d33;">Disponibles de <span style="color:#056a35;">09:00 a 18:00 hrs</span> (orden de llegada, sin agendamiento).</p>
                                            <ul style="margin:.2rem 0 0 1.1rem; padding:0; list-style:disc;">
                                                <li style="margin-bottom:.45rem;">👥 Atención por orden de llegada (sin reserva previa).</li>
                                                <li style="margin-bottom:.45rem;">⚠️ Solo radiografías de extremidades superiores e inferiores.</li>
                                                <li style="margin-bottom:.45rem;">🚫 No se realizan columna, tronco, TAC ni resonancia.</li>
                                                <li>🔎 Validar disponibilidad en “Centros Abiertos RX” (SharePoint SNL) o web oficial.</li>
                                            </ul>
                                        </div>

                                        <div style="background:#e3f2fd; border-left:6px solid #1565c0; padding:1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
                                            <div style="font-weight:600; color:#0d47a1; font-size:1.05rem; margin-bottom:.4rem;">¿Por qué informar estos límites?</div>
                                            <p style="margin:.35rem 0 0;">Evita que el paciente llegue esperando otros tipos de estudios (TAC, resonancia) o horarios fuera de rango. Alinea expectativas desde el primer contacto.</p>
                                        </div>

                                        <div style="background:#fff8e1; border-left:6px solid #ffb300; padding:1rem 1.25rem; border-radius:12px; margin-bottom:1.25rem;">
                                            <div style="font-weight:600; color:#b37400; font-size:1.05rem; margin-bottom:.4rem;">Tip para comunicar en la llamada</div>
                                            <p style="margin:.35rem 0 .55rem; font-style:italic;">“Puede acudir entre las 9 y las 18 horas, por orden de llegada. Solo hacemos radiografías de extremidades y algunos centros no tienen el servicio, por eso validaremos primero.”</p>
                                        </div>

                                        <!-- Botón para abrir segunda ventana (modal) de sedes RX -->
                                        <div style="margin-top:.6rem; display:flex; justify-content:center;">
                                            <button onclick="abrirModalSedesRayosX()" style="background:linear-gradient(135deg,#1e3a8a,#3b82f6); color:#fff; border:none; padding:1rem 1.4rem; border-radius:14px; cursor:pointer; font-size:1.05rem; font-weight:600; letter-spacing:.5px; display:flex; align-items:center; gap:10px; box-shadow:0 6px 18px rgba(30,58,138,0.35); position:relative; overflow:hidden; animation:pulseRX 2s ease-in-out infinite;">
                                                <span style="font-size:1.3rem;">📡</span>
                                                <span>Ver Sedes Abiertas RX</span>
                                                <span style="position:absolute; inset:0; background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25), transparent 60%); opacity:.4; animation:glowRX 4s linear infinite; pointer-events:none;"></span>
                                            </button>
                                            <style>
                                                @keyframes pulseRX {0%{transform:scale(1);}50%{transform:scale(1.035);}100%{transform:scale(1);} }
                                                @keyframes glowRX {0%{transform:translate(0,0);}50%{transform:translate(8px,6px);}100%{transform:translate(0,0);} }
                                                @media (prefers-reduced-motion: reduce){
                                                    button[onclick="abrirModalSedesRayosX()"]{animation:none;}
                                                    button[onclick="abrirModalSedesRayosX()"] span[style*='radial-gradient']{animation:none;}
                                                }
                                            </style>
                                        </div>
                                    </div>
                                </div>
                                <!-- Segundo Modal: Sedes abiertas para venta de rayos X -->
                                <div id="modalSedesRayosX" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.55); z-index:2100; justify-content:center; align-items:center;">
                                    <div style="background:#ffffff; border-radius:16px; padding:1.6rem; max-width:640px; width:94%; max-height:88vh; overflow:auto; box-shadow:0 12px 40px rgba(0,0,0,0.25); position:relative;">
                                        <button onclick="cerrarModalSedesRayosX()" style="position:absolute; top:14px; right:14px; background:#dc2626; color:#fff; border:none; width:34px; height:34px; border-radius:50%; font-size:1.2rem; cursor:pointer;">&times;</button>
                                        <h2 style="margin:0 0 0.4rem 0; color:#1e3a8a; font-size:1.15rem;">📡 Sedes abiertas para venta de rayos X</h2>
                                        <p style="margin:0 0 0.9rem 0; font-size:0.8rem; color:#475569;">Listado de sedes con autorización (Resolución) para venta de radiografías FONASA. Estado operativo actual.</p>
                                        <div style="overflow-x:auto;">
                                            <table style="width:100%; border-collapse:collapse; font-size:0.75rem;">
                                                <thead>
                                                    <tr style="background:#1e3a8a; color:#fff;">
                                                        <th style="padding:6px 8px; text-align:left; border:1px solid #1e3a8a;">Sede</th>
                                                        <th style="padding:6px 8px; text-align:left; border:1px solid #1e3a8a;">FONASA</th>
                                                        <th style="padding:6px 8px; text-align:center; border:1px solid #1e3a8a;">ACTIVO/NO ACTIVO</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Antofagasta</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Calama</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">La Florida</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Concepción</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Maipú</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">San Bernardo</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">San Miguel</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Santiago</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">La Reina</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">La Serena</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Copiapó</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Los Andes</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Los Ángeles</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Iquique</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Puente Alto</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Chillán</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Rancagua</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">San Antonio</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Curicó</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Valdivia</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#ffffff;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Temuco</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                    <tr style="background:#f8fafc;"><td style="padding:6px 8px; border:1px solid #e2e8f0;">Viña del Mar</td><td style="padding:6px 8px; border:1px solid #e2e8f0;">Con Resolución</td><td style="padding:6px 8px; border:1px solid #e2e8f0; text-align:center; color:#059669; font-weight:600;">Activo</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div style="margin-top:0.6rem; font-size:0.65rem; color:#64748b; text-align:right;">Actualizado: 20-11-2025</div>
                                    </div>
                                </div>
                                <script>
                                function abrirModalSedesRayosX(){
                                    const m = document.getElementById('modalSedesRayosX');
                                    if(m){ m.style.display='flex'; }
                                }
                                function cerrarModalSedesRayosX(){
                                    const m = document.getElementById('modalSedesRayosX');
                                    if(m){ m.style.display='none'; }
                                }
                                // ===== Filtro rápido sedes RX =====
                                // Inserta UI de filtro al cargar por primera vez
                                (function initFiltroSedesRX(){
                                    const modal = document.getElementById('modalSedesRayosX');
                                    if(!modal) return;
                                    const caja = modal.querySelector('h2');
                                    const tabla = modal.querySelector('table');
                                    if(!caja || !tabla) return;
                                    // Evitar duplicar si ya existe
                                    if(modal.querySelector('#filtroSedeRX')) return;
                                    const ui = document.createElement('div');
                                    ui.style.display='flex';
                                    ui.style.flexWrap='wrap';
                                    ui.style.gap='6px';
                                    ui.style.margin='0 0 .8rem 0';
                                    ui.innerHTML = `
                                        <input id="filtroSedeRX" type="text" placeholder="Filtrar sede..." style="flex:1 1 160px; padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; font-size:.75rem;" />
                                        <select id="filtroEstadoRX" style="flex:0 0 130px; padding:6px 8px; border:1px solid #cbd5e1; border-radius:6px; font-size:.75rem;">
                                            <option value="">Todos estados</option>
                                            <option value="Activo">Activo</option>
                                            <option value="No Activo">No Activo</option>
                                        </select>
                                        <button id="resetFiltroRX" style="flex:0 0 70px; background:#1e3a8a; color:#fff; border:none; padding:6px 10px; border-radius:6px; font-size:.7rem; cursor:pointer;">Reset</button>
                                        <span id="contadorSedesRX" style="flex:1 1 100%; font-size:.65rem; color:#475569; text-align:right;">&nbsp;</span>
                                    `;
                                    caja.insertAdjacentElement('afterend', ui);
                                    // Eventos
                                    ui.querySelector('#filtroSedeRX').addEventListener('input', filtrarSedesRX);
                                    ui.querySelector('#filtroEstadoRX').addEventListener('change', filtrarSedesRX);
                                    ui.querySelector('#resetFiltroRX').addEventListener('click', function(){
                                        ui.querySelector('#filtroSedeRX').value='';
                                        ui.querySelector('#filtroEstadoRX').value='';
                                        filtrarSedesRX();
                                    });
                                    filtrarSedesRX();
                                })();
                                function filtrarSedesRX(){
                                    const modal = document.getElementById('modalSedesRayosX');
                                    if(!modal) return;
                                    const filtroTexto = (modal.querySelector('#filtroSedeRX')?.value || '').toLowerCase();
                                    const filtroEstado = modal.querySelector('#filtroEstadoRX')?.value || '';
                                    const filas = modal.querySelectorAll('table tbody tr');
                                    let visibles = 0;
                                    filas.forEach(tr => {
                                        const cels = tr.querySelectorAll('td');
                                        if(cels.length < 3) return;
                                        const sede = cels[0].textContent.toLowerCase();
                                        const estado = cels[2].textContent.trim();
                                        let ok = true;
                                        if(filtroTexto && !sede.includes(filtroTexto)) ok=false;
                                        if(filtroEstado && estado !== filtroEstado) ok=false;
                                        tr.style.display = ok ? '' : 'none';
                                        if(ok){
                                            visibles++;
                                            // Resaltar coincidencia
                                            if(filtroTexto){
                                                cels[0].innerHTML = sede.replace(new RegExp(filtroTexto,'gi'), m => `<mark style="background:#fde68a; color:#7c2d12;">${m}</mark>`);
                                            } else {
                                                cels[0].innerHTML = cels[0].textContent; // limpiar
                                            }
                                        }
                                    });
                                    const contador = modal.querySelector('#contadorSedesRX');
                                    if(contador){ contador.textContent = `Coincidencias: ${visibles}`; }
                                }
                                </script>
                                <script>
                                function abrirModalHorarioImagen() {
                                    document.getElementById('modalHorarioImagen').style.display = 'flex';
                                }
                                function cerrarModalHorarioImagen() {
                                    document.getElementById('modalHorarioImagen').style.display = 'none';
                                }
                                </script>
                    <button id="btnDireccion" class="btn-herramienta" onclick="abrirDireccion()">📍 Dirección</button>
                    <button id="btnAtencion" class="btn-herramienta">⚠️ Atención</button>
                    
                
                <script>
                // --- Paginación ---
                var paginaActualBloqueoCitas = 1;
                var registrosPorPaginaBloqueoCitas = 5;
                // --- Persistencia en localStorage ---
                function getRegistrosBloqueoCitas() {
                  let datos = localStorage.getItem('bloqueoCitasRegistros');
                  return datos ? JSON.parse(datos) : [];
                }
                function setRegistrosBloqueoCitas(registros) {
                  localStorage.setItem('bloqueoCitasRegistros', JSON.stringify(registros));
                }

                function renderTablaBloqueoCitas() {
                  var tabla = document.getElementById('tablaBloqueoCitas').getElementsByTagName('tbody')[0];
                  tabla.innerHTML = '';
                  var registros = getRegistrosBloqueoCitas();
                  // Paginación
                  var totalRegistros = registros.length;
                  var totalPaginas = Math.ceil(totalRegistros / registrosPorPaginaBloqueoCitas) || 1;
                  if (paginaActualBloqueoCitas > totalPaginas) paginaActualBloqueoCitas = totalPaginas;
                  var inicio = totalRegistros - (paginaActualBloqueoCitas * registrosPorPaginaBloqueoCitas);
                  var fin = inicio + registrosPorPaginaBloqueoCitas;
                  if (inicio < 0) { fin += inicio; inicio = 0; }
                  for (var i = fin - 1; i >= inicio; i--) {
                    var r = registros[i];
                    var fila = tabla.insertRow(-1);
                    fila.insertCell(0).innerText = r.profesional;
                    fila.insertCell(1).innerText = r.fecha;
                    fila.insertCell(2).innerText = r.remitente;
                    fila.insertCell(3).innerText = r.gestionado;
                    var celdaAccion = fila.insertCell(4);
                    celdaAccion.style.textAlign = 'center';
                    var btn = document.createElement('button');
                    btn.innerHTML = '🗑️';
                    btn.title = 'Eliminar este registro';
                    btn.style.background = '#dc2626';
                    btn.style.color = 'white';
                    btn.style.border = 'none';
                    btn.style.borderRadius = '4px';
                    btn.style.padding = '4px 10px';
                    btn.style.cursor = 'pointer';
                    btn.onclick = (function(idxReal) {
                      return function() { eliminarRegistroBloqueoCitasPorIndice(idxReal); };
                    })(i);
                    celdaAccion.appendChild(btn);
                  }
                  renderPaginacionBloqueoCitas(totalPaginas);
                function renderPaginacionBloqueoCitas(totalPaginas) {
                  var cont = document.getElementById('paginacionBloqueoCitas');
                  cont.innerHTML = '';
                  if (totalPaginas <= 1) return;
                  var btnPrev = document.createElement('button');
                  btnPrev.textContent = 'Anterior';
                  btnPrev.disabled = paginaActualBloqueoCitas === 1;
                  btnPrev.style.background = '#e5e7eb';
                  btnPrev.style.border = 'none';
                  btnPrev.style.borderRadius = '4px';
                  btnPrev.style.padding = '4px 10px';
                  btnPrev.style.cursor = 'pointer';
                  btnPrev.onclick = function() {
                    if (paginaActualBloqueoCitas > 1) {
                      paginaActualBloqueoCitas--;
                      renderTablaBloqueoCitas();
                    }
                  };
                  cont.appendChild(btnPrev);
                  for (var p = 1; p <= totalPaginas; p++) {
                    var btnPag = document.createElement('button');
                    btnPag.textContent = p;
                    btnPag.disabled = p === paginaActualBloqueoCitas;
                    btnPag.style.background = p === paginaActualBloqueoCitas ? '#eab308' : '#e5e7eb';
                    btnPag.style.border = 'none';
                    btnPag.style.borderRadius = '4px';
                    btnPag.style.padding = '4px 10px';
                    btnPag.style.cursor = 'pointer';
                    btnPag.style.margin = '0 2px';
                    btnPag.onclick = (function(pag) {
                      return function() {
                        paginaActualBloqueoCitas = pag;
                        renderTablaBloqueoCitas();
                      };
                    })(p);
                    cont.appendChild(btnPag);
                  }
                  var btnNext = document.createElement('button');
                  btnNext.textContent = 'Siguiente';
                  btnNext.disabled = paginaActualBloqueoCitas === totalPaginas;
                  btnNext.style.background = '#e5e7eb';
                  btnNext.style.border = 'none';
                  btnNext.style.borderRadius = '4px';
                  btnNext.style.padding = '4px 10px';
                  btnNext.style.cursor = 'pointer';
                  btnNext.onclick = function() {
                    if (paginaActualBloqueoCitas < totalPaginas) {
                      paginaActualBloqueoCitas++;
                      renderTablaBloqueoCitas();
                    }
                  };
                  cont.appendChild(btnNext);
                }
                function eliminarTodosBloqueoCitas() {
                  paginaActualBloqueoCitas = 1;
                  if (confirm('¿Seguro que deseas eliminar todos los registros de Bloqueo Citas?')) {
                    localStorage.removeItem('bloqueoCitasRegistros');
                    renderTablaBloqueoCitas();
                  }
                }

                function exportarBloqueoCitasExcel() {
                  var registros = getRegistrosBloqueoCitas();
                  if (!registros.length) {
                    alert('No hay registros para exportar.');
                    return;
                  }
                  var csv = 'Profesional,Fecha,Remitente,Gestionado\n';
                  registros.forEach(function(r) {
                    csv += '"' + r.profesional.replace(/"/g,'""') + '",';
                    csv += '"' + r.fecha + '",';
                    csv += '"' + r.remitente.replace(/"/g,'""') + '",';
                    csv += '"' + r.gestionado + '"\n';
                  });
                  var blob = new Blob([csv], { type: 'text/csv' });
                  var url = URL.createObjectURL(blob);
                  var a = document.createElement('a');
                  a.href = url;
                  a.download = 'bloqueo_citas.csv';
                  document.body.appendChild(a);
                  a.click();
                  setTimeout(function() {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                  }, 100);
                }

                function eliminarRegistroBloqueoCitasPorIndice(idx) {
                  // Si la página queda vacía tras eliminar, retroceder una página si es posible
                  setTimeout(function() {
                    var registros = getRegistrosBloqueoCitas();
                    var totalPaginas = Math.ceil(registros.length / registrosPorPaginaBloqueoCitas) || 1;
                    if (paginaActualBloqueoCitas > totalPaginas) {
                      paginaActualBloqueoCitas = totalPaginas;
                      renderTablaBloqueoCitas();
                    }
                  }, 0);
                  var registros = getRegistrosBloqueoCitas();
                  registros.splice(idx, 1);
                  setRegistrosBloqueoCitas(registros);
                  renderTablaBloqueoCitas();
                }
                }

                function abrirModalBloqueoCitas() {
                  document.getElementById('modalBloqueoCitas').style.display = 'flex';
                  document.getElementById('modalBloqueoCitas').style.justifyContent = 'center';
                  document.getElementById('modalBloqueoCitas').style.alignItems = 'center';
                  renderTablaBloqueoCitas();
                }
                function cerrarModalBloqueoCitas() {
                  document.getElementById('modalBloqueoCitas').style.display = 'none';
                }
                function guardarBloqueoCitas(event) {
                  event.preventDefault();
                  var profesional = document.getElementById('bloqueoProfesional').value.trim();
                  var fecha = document.getElementById('bloqueoFecha').value;
                  var remitente = document.getElementById('bloqueoRemitente').value.trim();
                  var gestionado = document.getElementById('bloqueoGestionado').value;
                  if (!profesional || !fecha || !remitente || !gestionado) return;
                  var registros = getRegistrosBloqueoCitas();
                  registros.push({ profesional, fecha, remitente, gestionado });
                  setRegistrosBloqueoCitas(registros);
                  renderTablaBloqueoCitas();
                  document.getElementById('formBloqueoCitas').reset();
                }

                // Renderizar al cargar la página si el modal ya está abierto (por si acaso)
                window.addEventListener('DOMContentLoaded', function() {
                  // Solo renderizar si existe la tabla (por si el modal aún no está en el DOM)
                  if (document.getElementById('tablaBloqueoCitas')) {
                    renderTablaBloqueoCitas();
                  }
                });
                </script>
                </div>
                
                <!-- Formulario horizontal después de Consulta y Comunicación -->
                <form class="formulario-principal hover-lift" onsubmit="event.preventDefault();" style="margin-left: calc(-1 * var(--spacing-2xl)); margin-right: calc(-1 * var(--spacing-2xl)); width: calc(100% + 2 * var(--spacing-2xl)); max-width: none; border-radius: 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); align-items: start; padding: var(--spacing-xl);">
                        
                        <!-- Fila 1: Fecha, RUT y Nombre en la misma línea -->
                        <div class="form-row-5" style="grid-column: 1 / -1; display:grid; grid-template-columns: minmax(95px, 0.4fr) minmax(105px, 0.45fr) minmax(160px, 0.9fr) minmax(170px, 1.2fr) minmax(240px, 1.5fr); gap: var(--spacing-lg); align-items: end;">
                            <div class="form-group">
                                <label for="fecha" class="form-label">📅 Fecha:</label>
                                <input type="date" id="fecha" name="fecha" readonly class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="rut" class="form-label">🆔 RUT:</label>
                                <input type="text" id="rut" name="rut" class="form-input" placeholder="12.345.678-9">
                            </div>
                            <div class="form-group">
                                <label for="nombre" class="form-label">👤 Nombre:</label>
                                <input type="text" id="nombre" name="nombre" class="form-input" placeholder="Nombre completo del cliente">
                            </div>
                            <div class="form-group">
                                <label for="motivo" class="form-label">📋 Motivo:</label>
                                <select id="motivo" name="motivo" class="form-select">
                                    <option>ELIGE UNA OPCIÓN</option>
                                    <option>SNL</option>
                                    <option>EP</option>
                                    <option>TRANSFERENCIA</option>
                                    <option>AGENCIA</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="submotivo" class="form-label">📝 Sub-motivo:</label>
                                <select id="submotivo" name="submotivo" class="form-select">
                                    <option>ELIGE UNA OPCIÓN</option>
                                    <option>Consulta SNL</option>
                                    <option>Anula Hora</option>
                                    <option>Consulta EP</option>
                                    <option>TRANSFERENCIA</option>
                                    <option>Ingreso EP-SM flujo normal</option>
                                    <option>Ley Karin // Ingreso EP-SM</option>
                                    <option>Ingreso EP-ME</option>
                                    <option>Paciente solicita ingreso de EP-SM y PSICO se ingresa por form</option>
                                    <option>Sin ingreso administrativo se agenda por Form</option>
                                    <option>Reagendamiento administrativo se agenda por Form</option>
                                    <option>Reagendamiento PSICO se agenda por Form</option>
                                    <option>Reagendamiento de EP-SM y PSICO se agenda por Form</option>
                                    <option>Se agenda notificación</option>
                                    <option>Ingreso EP-SM presencial</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Fila 3: Motivo y Sub-motivo (lado a lado) -->
                        
                        <!-- Fila 4: Observación (ocupa todo el ancho) -->
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="observacion" class="form-label">💭 Observación:</label>
                            <textarea id="observacion" name="observacion" rows="3" class="form-textarea" placeholder="Detalles adicionales..." style="min-height: 72px; resize: vertical;"></textarea>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1; margin-top: 8px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                            <button id="grabar" type="button" class="btn-primario hover-lift escalar-suave btn-bounce" data-tooltip="Guardar registro actual">✅ GRABAR REGISTRO</button>
                            <button id="borrarTodoPrincipal" type="button" class="btn-secundario" data-tooltip="Limpiar todos los campos" onclick="limpiarFormularioPrincipal()">🧹 LIMPIAR TODO</button>
                        </div>
                        
                    </div>
                </form>
                <script>
                // Evitar recarga y dar feedback visual al grabar sin parpadeo
                (function() {
                    try {
                        var form = document.querySelector('form.formulario-principal');
                        if (form) {
                            form.addEventListener('submit', function(e) { e.preventDefault(); });
                        }

                        var btn = document.getElementById('grabar');
                        if (!btn) return;
                        var originalHTML = btn.innerHTML;
                        var guardando = false;

                        btn.addEventListener('click', async function(e) {
                            if (guardando) return; // evitar clicks múltiples
                            guardando = true;
                            btn.disabled = true;
                            btn.innerHTML = '⏳ Guardando...';
                            try {
                                // TODO: Reemplazar con lógica real de guardado si aplica
                                await new Promise(function(r) { setTimeout(r, 600); });
                                btn.innerHTML = '✅ Guardado';
                            } catch (err) {
                                console.error('Error al guardar', err);
                                btn.innerHTML = '❌ Error, reintenta';
                            } finally {
                                setTimeout(function() {
                                    btn.innerHTML = originalHTML;
                                    btn.disabled = false;
                                    guardando = false;
                                }, 1200);
                            }
                        });
                    } catch (e) {
                        console.error('Init grabar handler error:', e);
                    }
                })();
                </script>
                <script>
                // Limpia los campos principales del formulario superior
                function limpiarFormularioPrincipal(){
                    try {
                        var fechaEl = document.getElementById('fecha');
                        var rutEl = document.getElementById('rut');
                        var nombreEl = document.getElementById('nombre');
                        var motivoEl = document.getElementById('motivo');
                        var submotivoEl = document.getElementById('submotivo');
                        var obsEl = document.getElementById('observacion');

                        if (rutEl) rutEl.value = '';
                        if (nombreEl) nombreEl.value = '';
                        if (motivoEl) motivoEl.selectedIndex = 0;
                        if (submotivoEl) submotivoEl.selectedIndex = 0;
                        if (obsEl) obsEl.value = '';
                        if (fechaEl) {
                            var hoy = new Date();
                            fechaEl.value = hoy.toISOString().split('T')[0];
                        }

                        if (typeof mostrarMensajeTemp === 'function') {
                            mostrarMensajeTemp('🧹 Formulario limpiado', '#6c757d');
                        }
                    } catch(e) {
                        console.error('Error al limpiar formulario principal:', e);
                    }
                }
                </script>
                <script>
                // Dependencia: cuando Motivo = SNL, limitar Sub-motivo
                (function(){
                    function configurarMotivoSubmotivo(){
                        var motivoEl = document.getElementById('motivo');
                        var submotivoEl = document.getElementById('submotivo');
                        if(!motivoEl || !submotivoEl) return;

                        // Guardar todas las opciones originales una sola vez
                        if(!submotivoEl._todasLasOpciones){
                            submotivoEl._todasLasOpciones = Array.from(submotivoEl.options).map(function(o){
                                return {value:o.value, text:o.text};
                            });
                        }

                        // Mapa de filtros por motivo (texto exacto mostrado)
                        var filtros = {
                            'SNL': [
                                'Consulta SNL',
                                'Anula Hora'
                            ],
                            'AGENCIA': [
                                'Ingreso EP-SM flujo normal',
                                'Ley Karin // Ingreso EP-SM',
                                'Ingreso EP-SM presencial',
                                'Ingreso EP-ME'
                            ],
                            'EP': [
                                'Consulta EP',
                                'Paciente solicita ingreso de EP-SM y PSICO se ingresa por form',
                                'Sin ingreso administrativo se agenda por Form',
                                'Reagendamiento administrativo se agenda por Form',
                                'Reagendamiento PSICO se agenda por Form',
                                'Reagendamiento de EP-SM y PSICO se agenda por Form',
                                'Se agenda notificación',
                                'Ingreso EP-SM presencial'
                            ],
                            'TRANSFERENCIA': [
                                'TRANSFERENCIA'
                            ]
                        };

                        function setOptions(options){
                            while(submotivoEl.options.length) submotivoEl.remove(0);
                            options.forEach(function(opt){
                                var o = document.createElement('option');
                                o.value = opt.value; o.text = opt.text;
                                submotivoEl.add(o);
                            });
                            submotivoEl.selectedIndex = 0;
                        }

                        function aplicarFiltro(){
                            var valorMotivo = (motivoEl.value || '').toUpperCase();
                            var todas = submotivoEl._todasLasOpciones;
                            var base = todas.filter(function(o){ return o.text.toUpperCase().includes('ELIGE'); });

                            if(filtros[valorMotivo]){
                                var listaPermitida = filtros[valorMotivo].map(function(t){ return t.toUpperCase(); });
                                var filtradas = todas.filter(function(o){ return listaPermitida.indexOf(o.text.toUpperCase()) !== -1; });
                                setOptions(base.concat(filtradas));
                            } else {
                                setOptions(todas);
                            }
                        }

                        motivoEl.removeEventListener('change', aplicarFiltro);
                        motivoEl.addEventListener('change', aplicarFiltro);
                        aplicarFiltro();
                    }

                    window.configurarMotivoSubmotivo = configurarMotivoSubmotivo;
                    if(document.readyState === 'loading'){
                        document.addEventListener('DOMContentLoaded', configurarMotivoSubmotivo);
                    } else {
                        configurarMotivoSubmotivo();
                    }
                })();
                </script>
                
                <!-- Menú desplegable de ACCESO DIRECTO mejorado -->
                <div id="accesoLinks" class="acceso-links-container" style="display:none;">
                                <script>
                                function toggleAccesoLinks() {
                                    var menu = document.getElementById('accesoLinks');
                                    if (menu.style.display === 'none' || menu.style.display === '') {
                                        menu.style.display = 'block';
                                    } else {
                                        menu.style.display = 'none';
                                    }
                                }
                                // Cerrar el menú si se hace clic fuera
                                document.addEventListener('click', function(e) {
                                    var btn = document.getElementById('btnAccesoDirecto');
                                    var menu = document.getElementById('accesoLinks');
                                    if (!btn.contains(e.target) && !menu.contains(e.target)) {
                                        menu.style.display = 'none';
                                    }
                                });
                                </script>
                    <div class="acceso-header">
                        <h4 style="color: var(--primary-blue); margin: 0; font-weight: 600;">🔗 Enlaces de Acceso Directo</h4>
                    </div>
                    
                    <div class="acceso-grid">
                        <a href="https://forms.office.com/pages/responsepage.aspx?id=Cr5LbVRWaUymgr99za7Y54zBkYtXGQFNm-bkdCACrIlUQlpUVDRXNVJCOTJMSkpIV1VGWkRWUkpQOS4u&origin=lprLink&route=shorturl" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">🧠</span>
                            <span class="acceso-text">Ingreso EP Salud Mental</span>
                        </a>

                        <a href="https://achs.sharepoint.com/:x:/r/sites/SaludIntegral/_layouts/15/Doc.aspx?sourcedoc=%7B81C27AB8-E408-411F-813B-2FB30D79C78C%7D&file=Preguntas%20Frecuentes%20BO%20-%20Call%20Center.xlsx&action=default&mobileredirect=true" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">❓</span>
                            <span class="acceso-text">Preguntas Frecuentes</span>
                        </a>
                        
                        <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=Cr5LbVRWaUymgr99za7Y57U9PtZU_wFOgk_1LJx_qvZUMzBTTTJXRlQ5N0RLUzhFQzRWOVgzRDRVSS4u" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">📋</span>
                            <span class="acceso-text">Solicitudes SNL ACHS</span>
                        </a>
                        
                        <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=Cr5LbVRWaUymgr99za7Y5-0-yAyIGqdLjTQ7442j2KtURDJXTVZDR1k5TkZGUTM3VEtKMUZWN0M3TC4u" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">📞</span>
                            <span class="acceso-text">Envío Links Contact Center</span>
                        </a>
                        
                        <a href="https://achs.sharepoint.com/teams/ListasdeEspera/Lists/ListaDeEspera/Vista02_Contactabilidad.aspx" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">⏰</span>
                            <span class="acceso-text">Listas de Espera</span>
                        </a>
                        
                        <a href="https://www.clinicasachssalud.cl/" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">🏥</span>
                            <span class="acceso-text">Clínica ACHS Salud</span>
                        </a>


                        <a href="https://www.achssalud.cl/convenios/centros" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">🤝 </span>
                            <span class="acceso-text">Clínica ACHS Salud-CONVENIO</span>
                        </a>
                        
                        <a href="https://www.achssalud.cl/centros/" target="_blank" class="acceso-link hover-scale">
                            <span class="acceso-icon">⚕️</span>
                            <span class="acceso-text">Centros ACHS Salud</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección del historial mejorada -->
        <div class="seccion-historial fade-in-up">
            <h2 class="historial-header">📋 Historial de Registros</h2>
            
            </div>
            
            <!-- Sección de calendario y reloj compacto -->
            <div class="calendario-reloj-compacto">
                <div class="reloj-compacto">
                    <div class="reloj-display">
                        <span id="reloj-compacto">00:00:00</span>
                    </div>
                </div>
                <div class="calendario-compacto">
                    <div class="fecha-display">
                        <span id="fecha-compacta">Cargando...</span>
                    </div>
                </div>
            </div>
            
            <!-- Tabla con diseño mejorado -->
            <div class="tabla-container">
                <table id="historial" class="tabla-historial">
                    <thead>
                        <tr>
                            <th>📅 Fecha</th>
                            <th>🆔 RUT</th>
                            <th>👤 Nombre</th>
                            <th>📋 Motivo</th>
                            <th>📝 Sub-Motivo</th>
                            <th>💭 Observación</th>
                            <th style="text-align: center;">🗑️ Eliminar</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Filas se agregarán aquí dinámicamente -->
                    </tbody>
                </table>
                <div id="paginacionHistorial" style="display:flex; justify-content:center; align-items:center; gap:8px; margin-top:10px;"></div>
            </div>
        </div>

    <script>
    // --- Paginación para Historial de Registros ---
    var paginaActualHistorial = 1;
    var registrosPorPaginaHistorial = 10;

    // Simulación: función para obtener los registros del historial (ajusta según tu lógica de almacenamiento)
    function getRegistrosHistorial() {
      // Aquí deberías obtener los datos reales, por ejemplo desde localStorage o una variable global
      // Ejemplo: return JSON.parse(localStorage.getItem('historialRegistros')) || [];
      // Por ahora, se asume que hay una función global llamada getRegistrosHistorial
      return window.historialRegistros || [];
    }

    function setRegistrosHistorial(registros) {
      // Aquí deberías guardar los datos reales, por ejemplo en localStorage
      // localStorage.setItem('historialRegistros', JSON.stringify(registros));
      window.historialRegistros = registros;
    }

    function renderTablaHistorial() {
      var tabla = document.getElementById('historial').getElementsByTagName('tbody')[0];
      tabla.innerHTML = '';
      var registros = getRegistrosHistorial();
      var totalRegistros = registros.length;
      var totalPaginas = Math.ceil(totalRegistros / registrosPorPaginaHistorial) || 1;
      if (paginaActualHistorial > totalPaginas) paginaActualHistorial = totalPaginas;
      var inicio = (paginaActualHistorial - 1) * registrosPorPaginaHistorial;
      var fin = Math.min(inicio + registrosPorPaginaHistorial, totalRegistros);
      for (var i = inicio; i < fin; i++) {
        var r = registros[i];
        var fila = tabla.insertRow(-1);
        fila.insertCell(0).innerText = r.fecha || '';
        fila.insertCell(1).innerText = r.rut || '';
        fila.insertCell(2).innerText = r.nombre || '';
        fila.insertCell(3).innerText = r.motivo || '';
        fila.insertCell(4).innerText = r.submotivo || '';
        fila.insertCell(5).innerText = r.observacion || '';
        var celdaAccion = fila.insertCell(6);
        celdaAccion.style.textAlign = 'center';
        var btn = document.createElement('button');
        btn.innerHTML = '🗑️';
        btn.title = 'Eliminar este registro';
        btn.style.background = '#dc2626';
        btn.style.color = 'white';
        btn.style.border = 'none';
        btn.style.borderRadius = '4px';
        btn.style.padding = '4px 10px';
        btn.style.cursor = 'pointer';
        btn.onclick = (function(idx) {
          return function() { eliminarRegistroHistorialPorIndice(idx); };
        })(i);
        celdaAccion.appendChild(btn);
      }
      renderPaginacionHistorial(totalPaginas);
    }

    function renderPaginacionHistorial(totalPaginas) {
      var cont = document.getElementById('paginacionHistorial');
      cont.innerHTML = '';
      if (totalPaginas <= 1) return;
      var btnPrev = document.createElement('button');
      btnPrev.textContent = 'Anterior';
      btnPrev.disabled = paginaActualHistorial === 1;
      btnPrev.style.background = '#e5e7eb';
      btnPrev.style.border = 'none';
      btnPrev.style.borderRadius = '4px';
      btnPrev.style.padding = '4px 10px';
      btnPrev.style.cursor = 'pointer';
      btnPrev.onclick = function() {
        if (paginaActualHistorial > 1) {
          paginaActualHistorial--;
          renderTablaHistorial();
        }
      };
      cont.appendChild(btnPrev);
      for (var p = 1; p <= totalPaginas; p++) {
        var btnPag = document.createElement('button');
        btnPag.textContent = p;
        btnPag.disabled = p === paginaActualHistorial;
        btnPag.style.background = p === paginaActualHistorial ? '#eab308' : '#e5e7eb';
        btnPag.style.border = 'none';
        btnPag.style.borderRadius = '4px';
        btnPag.style.padding = '4px 10px';
        btnPag.style.cursor = 'pointer';
        btnPag.style.margin = '0 2px';
        btnPag.onclick = (function(pag) {
          return function() {
            paginaActualHistorial = pag;
            renderTablaHistorial();
          };
        })(p);
        cont.appendChild(btnPag);
      }
      var btnNext = document.createElement('button');
      btnNext.textContent = 'Siguiente';
      btnNext.disabled = paginaActualHistorial === totalPaginas;
      btnNext.style.background = '#e5e7eb';
      btnNext.style.border = 'none';
      btnNext.style.borderRadius = '4px';
      btnNext.style.padding = '4px 10px';
      btnNext.style.cursor = 'pointer';
      btnNext.onclick = function() {
        if (paginaActualHistorial < totalPaginas) {
          paginaActualHistorial++;
          renderTablaHistorial();
        }
      };
      cont.appendChild(btnNext);
    }

    function eliminarRegistroHistorialPorIndice(idx) {
      var registros = getRegistrosHistorial();
      registros.splice(idx, 1);
      setRegistrosHistorial(registros);
      // Si la página queda vacía tras eliminar, retroceder una página si es posible
      setTimeout(function() {
        var totalPaginas = Math.ceil(registros.length / registrosPorPaginaHistorial) || 1;
        if (paginaActualHistorial > totalPaginas) {
          paginaActualHistorial = totalPaginas;
          renderTablaHistorial();
        }
      }, 0);
      renderTablaHistorial();
    }

    // Renderizar historial al cargar la página
    window.addEventListener('DOMContentLoaded', function() {
      if (document.getElementById('historial')) {
        renderTablaHistorial();
      }
    });
    </script>
    </div>

    <!-- Botón Flotante SCRIPT EP -->
    <button id="btnFloranteEP" class="btn-flotante-ep" onclick="abrirModalScriptEP()">
        🏥 SCRIPT EP
    </button>

    <!-- Botón Flotante SCRIPT SNL 2.0 (Contact Center ACHS Salud) -->
    <button id="btnFloranteSNL2" class="btn-flotante-snl2" onclick="toggleSubmenuSNL2()">
        📞 SCRIPT SNL 2.0
    </button>

    <!-- Submenú desplegable SNL 2.0 -->
    <div id="submenuSNL2" class="submenu-snl2" style="display:none;">
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('intro')">
            🎤 Intro Contact Center ACHS Salud
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('menu')">
            📋 Menú Principal y Submenús
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('procedimiento')">
            📝 Procedimiento de Agendamiento
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('saludmental')">
            🧠 Agendamiento Salud Mental
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('traumatologia')">
            🦴 Agendamiento Traumatología
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('kinesiologia')">
            🏃 Agendamiento Kinesiología
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('medicinageneral')">
            🩺 Agendamiento Medicina General
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('medicinacuidado')">
            💚 Agendamiento Medicina del Cuidado
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('dermatologia')">
            🧴 Agendamiento Dermatología
        </div>
        <div class="submenu-snl2-item" onclick="abrirModalScriptSNL2('despedida')">
            👋 Despedida
        </div>
    </div>

    <!-- Overlay para cerrar submenú SNL 2.0 -->
    <div id="overlaySubmenuSNL2" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:9997; background:transparent;" onclick="cerrarSubmenuSNL2()"></div>

    <!-- Botón Flotante Calendario Chile -->
    <button id="btnCalendarioCL" class="btn-flotante-cal" onclick="toggleCalendarioCL()">📅 Calendario</button>

    <!-- Panel Calendario Chile -->
    <div id="panelCalendarioCL" class="panel-calendario" style="display:none;">
        <div class="cal-header">
            <div id="calTitulo">Calendario Chile</div>
            <div class="cal-nav">
                <button id="calPrev" onclick="calCambiarMes(-1)">◀</button>
                <button id="calHoy" onclick="calIrAHoy()">Hoy</button>
                <button id="calNext" onclick="calCambiarMes(1)">▶</button>
                <button onclick="toggleCalendarioCL()" title="Cerrar" style="margin-left:6px;">✖</button>
            </div>
        </div>
        <div class="cal-body">
            <div class="cal-weekdays">
                <div>L</div><div>M</div><div>X</div><div>J</div><div>V</div><div>S</div><div>D</div>
            </div>
            <div id="calGrid" class="cal-grid"></div>
            <div class="cal-legend">
                <span class="cal-dot feriado"></span> Feriado en Chile
            </div>
        </div>
        <div id="calFooter" class="cal-footer"></div>
    </div>

    <!-- Botón Flotante SCRIPT LE -->
    <button id="btnFloranteLE" class="btn-flotante-le" onclick="abrirModalScriptLE()">
        🏥 SCRIPT LE
    </button>

    <!-- Overlay para modales -->
    <div id="notificationOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 10000;" onclick="closeNotificationSettings()"></div>

    <!-- Audio para notificaciones -->
    <audio id="notificationSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShsGIHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTCOzOPgSQoUXrTo66hUFAlFn+HyvmEZBTCOzOPgShs=" type="audio/wav">
    </audio>

    <!-- ✅ Script Calendario migrado a assets/js/app.js (10/11/2025) -->

    <!-- Modal Script SNL 2.0 (Contact Center ACHS Salud) -->
    <div id="modalScriptSNL2" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center;">
        <div id="contenidoScriptSNL2" style="background:white; border-radius:20px; padding:36px; max-width:95vw; max-height:95vh; width:850px; min-width:320px; position:relative; display:flex; flex-direction:column; box-shadow:0 12px 40px rgba(0,210,255,0.18); overflow-y:auto; transform:scale(1); transition:transform 0.2s ease;">
            <!-- Botón cerrar y zoom -->
            <div style="position:absolute; top:18px; right:18px; display:flex; gap:6px; align-items:center;">
                <button onclick="ajustarZoomModal('contenidoScriptSNL2', -0.1)" style="background:rgba(0,210,255,0.15); color:#00d2ff; border:2px solid #00d2ff; border-radius:6px; width:34px; height:34px; cursor:pointer; font-size:1.2rem; font-weight:bold;" title="Reducir zoom">−</button>
                <button onclick="ajustarZoomModal('contenidoScriptSNL2', 0)" style="background:rgba(0,210,255,0.15); color:#00d2ff; border:2px solid #00d2ff; border-radius:6px; padding:6px 10px; cursor:pointer; font-size:0.8rem; font-weight:bold;" title="Restablecer zoom">100%</button>
                <button onclick="ajustarZoomModal('contenidoScriptSNL2', 0.1)" style="background:rgba(0,210,255,0.15); color:#00d2ff; border:2px solid #00d2ff; border-radius:6px; width:34px; height:34px; cursor:pointer; font-size:1.2rem; font-weight:bold;" title="Aumentar zoom">+</button>
                <button onclick="cerrarModalScriptSNL2()" style="background:rgba(255,255,255,0.2); color:#00d2ff; border:2px solid #00d2ff; border-radius:50%; width:48px; height:48px; cursor:pointer; font-size:1.7em; font-weight:bold; transition:all 0.3s ease;" onmouseover="this.style.background='rgba(0,210,255,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">&times;</button>
            </div>
            
            <!-- Header -->
            <div style="text-align:center; margin-bottom:30px; padding:20px 0; border-bottom:3px solid #00d2ff;">
                <h1 style="color:#006494; font-size:2.1em; font-weight:bold; margin:0; text-shadow:2px 2px 4px rgba(0,100,148,0.2); letter-spacing:0.5px;">
                    📞 SCRIPT SNL 2.0 - Contact Center ACHS Salud
                </h1>
                <div style="background:linear-gradient(90deg, #00d2ff, #3a7bd5); height:4px; width:220px; margin:15px auto; border-radius:2px; box-shadow:0 2px 10px rgba(0,210,255,0.3);"></div>
            </div>
            
            <!-- Contenido dinámico -->
            <div id="modalScriptSNL2Content" style="flex:1; overflow-y:auto;">
                <!-- El contenido se cargará aquí dinámicamente -->
            </div>
            
            <!-- Botones de acción -->
            <div style="display:flex; gap:12px; justify-content:center; margin-top:24px; padding-top:18px; border-top:1px solid #e0e0e0;">
                <button onclick="imprimirScriptSNL2()" style="background:linear-gradient(145deg, #00d2ff, #3a7bd5); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,210,255,0.2);">🖨️ Imprimir</button>
                <button onclick="copiarScriptSNL2()" style="background:linear-gradient(145deg, #3a7bd5, #006494); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(58,123,213,0.2);">📋 Copiar</button>
                <button onclick="cerrarModalScriptSNL2()" style="background:#6c757d; color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease;">❌ Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Script LE -->
    <div id="modalScriptLE" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:20px; padding:36px; max-width:95vw; max-height:95vh; width:750px; min-width:320px; position:relative; display:flex; flex-direction:column; box-shadow:0 12px 40px rgba(155,89,182,0.18); overflow-y:auto;">
            <!-- Header del modal -->
                        <div style="display:flex; gap:15px; justify-content:center; margin-bottom:18px;">
                                <button onclick="abrirModalMedicosBonos()" style="background:linear-gradient(145deg, #009688, #26a69a); color:white; border:none; padding:14px 28px; border-radius:12px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 5px 20px rgba(0,150,136,0.2);">🩺 Nombres de médico para compra de bonos</button>
                        </div>
                        <!-- Modal Nombres de Médico para Bonos -->
                        <!-- Modal Medicos Bonos eliminado - versión principal está en línea 2599 -->
                        <script>
                        function abrirModalMedicosBonos() {
                            document.getElementById('modalMedicosBonos').style.display = 'flex';
                        }
                        function cerrarModalMedicosBonos() {
                            document.getElementById('modalMedicosBonos').style.display = 'none';
                        }
                        </script>
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #9b59b6; padding-bottom:14px; margin-bottom:18px;">
                <h2 style="color:#9b59b6; margin:0; font-size:1.5em; font-weight:bold; letter-spacing:0.5px;">✨ Contactabilidad pacientes LE (Lista Espera Fonasa) <span style='color:#673ab7;'>2024-2027</span></h2>
                <button onclick="cerrarModalScriptLE()" style="background:#d9534f; color:white; border:none; border-radius:50%; width:36px; height:36px; cursor:pointer; font-size:1.4em;">&times;</button>
            </div>
            <div style="margin:10px 0 20px 0; color:#222; font-size:1.08em; line-height:1.7;">
                <div style="background:#f3e9fa; border-radius:10px; padding:18px 22px; margin-bottom:18px; box-shadow:0 2px 10px rgba(155,89,182,0.07);">
                    <b style="color:#8e44ad; font-size:1.15em;">🎯 Objetivos de la contactabilidad</b>
                    <ol style="margin-top:10px;">
                        <li><span style="color:#2e86de; font-weight:bold;">Notificar</span> al paciente que fue derivado al HT desde Fonasa/Hospital de base por su problema de salud</li>
                        <li><span style="color:#27ae60; font-weight:bold;">Solicitar confirmación</span> de intención de resolver su problema de salud en el HT</li>
                        <li><span style="color:#e67e22; font-weight:bold;">Obtener información médica relevante</span> para evaluar si somos resolutivos</li>
                        <li><span style="color:#9b59b6; font-weight:bold;">Entregar información clara</span> sobre el proceso y próximos pasos</li>
                    </ol>
                </div>
                <div style="background:#eafaf1; border-radius:10px; padding:14px 20px; margin-bottom:18px;">
                    <b style="color:#27ae60; font-size:1.08em;">📝 Registro de pacientes</b><br>
                    <span style="color:#222;">Plataforma de registro:</span> <a href="https://achs.sharepoint.com/teams/ListasdeEspera/Lists/ListaDeEspera/Vista02_Contactabilidad.aspx" target="_blank" style="color:#2e86de; font-weight:bold;">Ir a registro</a><br>
                    <ul style="margin-top:8px;">
                        <li>Buscar paciente por <b>nombre, rut o ID de derivación</b></li>
                        <li>Apretar en <span style="color:#9b59b6; font-weight:bold;">“Editar Formulario”</span></li>
                        <li>Completar información en base a guion. <span style="color:#27ae60; font-weight:bold;">Dependiendo de respuesta:</span>
                            <ul>
                                <li><span style="color:#27ae60;">Paciente acepta cirugía:</span> llenar información relevante y apretar <b>“Aprobar registro”</b></li>
                                <li><span style="color:#e74c3c;">Paciente rechaza cirugía:</span> seleccionar <b>“Pcte Rechaza Cirugía”</b> y apretar <b>“Rechazar Paciente”</b></li>
                                <li><span style="color:#f39c12;">Dudas:</span> apretar <b>“Guardar Cambios”</b></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div style="background:#fffbe6; border-radius:10px; padding:16px 20px; margin-bottom:18px;">
                    <b style="color:#e67e22; font-size:1.08em;">📢 Script de atención</b>
                    <ol style="margin-top:10px;">
                        <li><b style="color:#2e86de;">Notificación:</b><br>
                            <span style="color:#222;">Hola, ¿hablo con <b>[Nombre del Paciente]</b>? Soy <b>[Tu Nombre]</b> y te llamo del <b>Hospital del Trabajador Achs Salud</b>. ¿Cómo estás hoy?<br>
                            Te llamo para informarte que <b style='color:#9b59b6;'>Fonasa/Tu hospital</b> nos derivó tu caso para resolver tu problema de salud <b>[Problema de salud]</b>.<br>
                            <span style="color:#e74c3c; font-weight:bold;">Fonasa solo nos derivó el caso para la resolución de ese problema de salud.</span><br>
                            <span style="color:#e67e22;">Si no es el paciente, reforzar que se llama por una cirugía pendiente de LE y pedir números de paciente o que indiquen horario de llamado.</span></span>
                        </li>
                        <li><b style="color:#27ae60;">Proceso y participación:</b><br>
                            <span style="color:#222;">Todo el proceso se realiza en el <b>Centro Médico del Hospital del Trabajador</b>. Incluye exámenes, consulta y cirugía <span style="color:#27ae60; font-weight:bold;">sin costo para el paciente</span> (solo traslado).<br>
                            <span style="color:#2e86de; font-weight:bold;">¿Deseas atenderte con nosotros?</span></span>
                        </li>
                        <li><b style="color:#9b59b6;">Información de contacto</b> <span style="color:#222;">(si acepta operarse):</span><br>
                            <span style="color:#222;">¿Te puedo hacer algunas preguntas?</span>
                            <ul>
                                <li>¿Número de teléfono principal y secundario?</li>
                                <li>¿Correo electrónico?</li>
                                <li>¿Fecha de nacimiento?</li>
                                <li>¿Dirección y comuna?</li>
                            </ul>
                        </li>
                        <li><b style="color:#e67e22;">Información médica</b> <span style="color:#222;">(si acepta operarse):</span><br>
                            <ul>
                                <li>¿La condición afecta un lado en particular? ¿Cuál?</li>
                                <li>¿Operación previa por este diagnóstico?</li>
                                <li>¿Cuánto tiempo esperando cirugía?</li>
                                <li>¿Embarazo? (si aplica)</li>
                                <li>¿Infarto?</li>
                                <li>¿Dializado?</li>
                            </ul>
                        </li>
                        <li><b style="color:#e74c3c;">Información rechazo</b> <span style="color:#222;">(si rechaza):</span><br>
                            <ul>
                                <li>¿Cuándo y dónde se operó?</li>
                                <li>¿Cuándo falleció?</li>
                                <li>Motivo rechazo: <span style="color:#e67e22;">Lejanía</span>, <span style="color:#e74c3c;">Salud</span>, <span style="color:#9b59b6;">No lo necesita</span></li>
                            </ul>
                        </li>
                        <li><b style="color:#27ae60;">Despedida e información:</b><br>
                            <span style="color:#222;">Todas tus atenciones serán en <b>Vicuña Mackenna 210, Providencia</b> (metro Parque Bustamante).<br>
                            <span style="color:#2e86de; font-weight:bold;">¡Estate atento a tu teléfono!</span><br>
                            <span style="color:#9b59b6; font-weight:bold;">Gracias por tu tiempo 🙌</span></span>
                        </li>
                    </ol>
                </div>
                <div style="background:#e8f6ff; border-radius:10px; padding:16px 20px; margin-bottom:18px;">
                    <b style="color:#3498db; font-size:1.08em;">❓ Preguntas frecuentes</b>
                    <ul style="margin-top:8px;">
                        <li><b style="color:#e74c3c;">¿Esto tiene algún costo para mí?</b><br>
                            <span style="color:#222;">Consultas, exámenes y cirugía <b style='color:#27ae60;'>no tienen costo</b>. <span style='color:#e74c3c; font-weight:bold;'>El traslado sí es por cuenta del paciente</span> <span style='background:#fffbe6; border-radius:4px; padding:2px 6px;'>[¡Recalcar a pacientes de región!]</span></span>
                        </li>
                        <li><b style="color:#e67e22;">¿Qué sucede si no puedo decidir ahora?</b><br>
                            <span style="color:#222;">Fonasa da <b>24 horas</b> para decidir.</span>
                        </li>
                        <li><b style="color:#9b59b6;">¿Puedo iniciar el proceso en el HT si ya estoy en otro hospital?</b><br>
                            <span style="color:#222;">Sí, pero debe avisar si decide mantenerse en su hospital de base.</span>
                        </li>
                        <li><b style="color:#2e86de;">¿Todas mis atenciones pasan al HT?</b><br>
                            <span style="color:#222;">Solo el diagnóstico y cirugía derivada por Fonasa.</span>
                        </li>
                        <li><b style="color:#27ae60;">¿Cuándo inicia el proceso?</b><br>
                            <span style="color:#222;">Inicia tras la ficha. <span style='color:#2e86de;'>¡Te contactarán esta semana!</span></span>
                        </li>
                        <li><b style="color:#e67e22;">¿Cuándo tengo mi consulta/cirugía?</b><br>
                            <span style="color:#222;">Te contactarán para agendar exámenes y consulta. La cirugía será dentro de un mes aprox.</span>
                        </li>
                        <li><b style="color:#9b59b6;">¿Debo repetir exámenes?</b><br>
                            <span style="color:#222;">Si tienes exámenes de menos de 3 meses, tráelos igual. Se repetirán todos.</span>
                        </li>
                        <li><b style="color:#e74c3c;">¿Dónde están ubicados?</b><br>
                            <span style="color:#222;">Vicuña Mackenna 210, metro Parque Bustamante.</span>
                        </li>
                        <li><b style="color:#27ae60;">¿Por qué necesitan mi información?</b><br>
                            <span style="color:#222;">Es esencial para crear tu ficha y contactarte.</span>
                        </li>
                        <li><b style="color:#2e86de;">¿Dónde puedo revisar que esto no es una estafa?</b><br>
                            <span style="color:#222;">Revisa <a href="https://www.hospitaldeltrabajador.cl/" target="_blank" style="color:#2e86de; font-weight:bold;">hospitaldeltrabajador.cl</a> o <a href="https://www.hospitaldeltrabajador.cl/detalle-noticia/2024/hospital-del-trabajador-achs-salud-es-uno-de-los-prestadores-que-resolvera-parte-de-las-cirugias-de-lista-de-espera-fonasa-durante-los-proximos-3-anos" target="_blank" style="color:#2e86de; font-weight:bold;">noticia Fonasa</a>, o consulta a Fonasa/hospital de base.</span>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- Botones de acción -->
            <div style="display:flex; gap:15px; justify-content:center; margin-top:10px;">
                <button onclick="copiarScriptLE()" style="background:linear-gradient(145deg, #9b59b6, #8e44ad); color:white; border:none; padding:14px 28px; border-radius:12px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 5px 20px rgba(155,89,182,0.3);">📋 Copiar Script</button>
                <button onclick="imprimirScriptLE()" style="background:linear-gradient(145deg, #3498db, #5dade2); color:white; border:none; padding:14px 28px; border-radius:12px; cursor:pointer; font-size:1.08em; font-weight:600; transition:all 0.3s ease; box-shadow:0 5px 20px rgba(52,152,219,0.3);">🖨️ Imprimir Script</button>
                <button onclick="cerrarModalScriptLE()" style="background:linear-gradient(145deg, #6c757d, #545b62); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(108,117,125,0.3);">❌ Cerrar</button>
            </div>
        </div>
    </div>
            
            <!-- Modal de Precios -->
    <div id="modalPrecios" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:900px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,33,71,0.2); position:relative;">
            
            <!-- Header del modal -->
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #002147; padding-bottom:15px; margin-bottom:12px; gap:10px;">
                <div style="display:flex; flex-direction:column; gap:4px;">
                    <h2 style="color:#002147; margin:0; font-size:1 em;">💰 Valores de Prestaciones ACHS</h2>
                    <h4 style="color:#002147; margin:0; font-size:1 em;"> Convenio con Banmédica, Colmena, Vida Tres y Consalud (solo MG, TMT y DMT) </h4>
                </div>
                <div style="display:flex; align-items:center; gap:6px;">
                    <button onclick="ajustarZoomModal('contenidoPrecios', -0.1)" style="background:#e2e8f0; color:#1e3a8a; border:none; border-radius:4px; width:32px; height:32px; cursor:pointer; font-size:1.1rem; font-weight:bold;" title="Reducir zoom">−</button>
                    <button onclick="ajustarZoomModal('contenidoPrecios', 0)" style="background:#e2e8f0; color:#1e3a8a; border:none; border-radius:4px; padding:6px 10px; cursor:pointer; font-size:0.8rem; font-weight:bold;" title="Restablecer zoom">100%</button>
                    <button onclick="ajustarZoomModal('contenidoPrecios', 0.1)" style="background:#e2e8f0; color:#1e3a8a; border:none; border-radius:4px; width:32px; height:32px; cursor:pointer; font-size:1.1rem; font-weight:bold;" title="Aumentar zoom">+</button>
                    <button onclick="cerrarModalPrecios()" style="background:#dc3545; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease;">&times;</button>
                </div>
            </div>
            
            <!-- Tabla de precios -->
            <div style="overflow:auto;">
                <div id="contenidoPrecios" style="transform:scale(1); transform-origin: 0 0; transition: transform 0.2s ease; display:inline-block;">
                <table style="width:100%; border-collapse:collapse; font-size:0.9em; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background:linear-gradient(145deg, #002147, #003366); color:white;">
                            <th style="border:1px solid #002147; padding:12px 8px; text-align:left; font-weight:bold;">Especialidad</th>
                            <th style="border:1px solid #002147; padding:12px 8px; text-align:left; font-weight:bold;">Prestación</th>
                            <th style="border:1px solid #002147; padding:12px 8px; text-align:center; font-weight:bold;">Copago Fonasa</th>
                            <th style="border:1px solid #002147; padding:12px 8px; text-align:center; font-weight:bold;">Isapre / Particular</th>
                            <th style="border:1px solid #002147; padding:12px 8px; text-align:center; font-weight:bold;">Código Fonasa en IMED</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Salud Mental -->
                        <tr style="background:#f8f9fa;">
                            <td rowspan="2" style="border:1px solid #ddd; padding:10px 8px; font-weight:bold; color:#002147; vertical-align:top;">
                                Salud Mental<br>
                                <small style="color:#666; font-weight:normal;">RUT: 70360100-6</small>
                            </td>
                            <td style="border:1px solid #ddd; padding:10px 8px;">Consulta online</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$5.470</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$23.847</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Consulta presencial</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$6.440</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$28.048</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#dc3545;">902002</td>
                        </tr>
                        
                        <!-- Traumatología -->
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:10px 8px; font-weight:bold; color:#002147;">Traumatología</td>
                            <td style="border:1px solid #ddd; padding:10px 8px;">Consulta presencial</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$4.750</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$24.704</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#dc3545;">101001</td>
                        </tr>
 
                       <!-- Dermatología -->
                       <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:10px 8px; font-weight:bold; color:#002147;">Dermatología</td>
                            <td style="border:1px solid #ddd; padding:10px 8px;">Consulta presencial</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$4.750</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$24.704</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#dc3545;">101001</td>
                        </tr>
                                        

                        <!-- Kinesiología -->
                        <tr style="background:#ffffff;">
                            <td rowspan="9" style="border:1px solid #ddd; padding:10px 8px; font-weight:bold; color:#002147; vertical-align:top;">Kinesiología</td>
                            <td style="border:1px solid #ddd; padding:10px 8px;">Evaluación integra</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$1.130</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$6.573</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#dc3545;">601101</td>
                        </tr>
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Sesión de Kinesiología</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$3.500</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$20.242</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#dc3545;">601105</td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Radiografía de extremidades superiores e inferiores</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$4.730</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$15.150</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Radiografía de hombro, fémur, rodilla, pierna, costilla o esternón frontal y lateral</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$5.600</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$17.920</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Radiografía de proyecciones especiales oblicuas u otras</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$3.890</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$12.460</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#f9f9f9;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Radiografía de clavícula</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$5.540</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$17.730</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Estudio radiológico de muñeca o tobillo frontal, lateral y oblicuas</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$5.350</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$17.140</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Estudio radiológico de escafoide</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$6.190</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$19.820</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:10px 8px; font-weight:bold; color:#6f42c1;">10 Sesiones más 2 Evaluaciones integrales</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$37.260</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$228.712</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        
                        <!-- Medicina General -->
                        <tr style="background:#f8f9fa;">
                            <td rowspan="2" style="border:1px solid #ddd; padding:10px 8px; font-weight:bold; color:#002147; vertical-align:top;">Medicina General</td>
                            <td style="border:1px solid #ddd; padding:10px 8px;">Consulta online</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$4.030</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$21.005</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; color:#666;">-</td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:10px 8px;">Consulta presencial</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#28a745;">$4.750</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#007bff;">$24.704</td>
                            <td style="border:1px solid #ddd; padding:10px 8px; text-align:center; font-weight:bold; color:#dc3545;">101001</td>
                        </tr>
                    </tbody>
                </table>
                </div>
            </div>
            
            <!-- Footer con información adicional -->
            <div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:8px; border-left:4px solid #002147;">
                <p style="margin:0; font-size:0.9em; color:#666;">
                    <strong style="color:#002147;">📋 Información importante:</strong><br>
                    • Los precios están vigentes al ${new Date().toLocaleDateString()}<br>
                    • Copago Fonasa: Valor que paga el paciente con Fonasa<br>
                    • Isapre/Particular: Valor total de la prestación<br>
                    • Los códigos IMED son necesarios para facturación Fonasa
                    
                </p>
            </div>
        </div>
    </div>

    <!-- Modal de Anexo -->
    <div id="modalAnexo" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:1200px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,33,71,0.2); position:relative;">
            
            <!-- Header del modal -->
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #002147; padding-bottom:15px; margin-bottom:20px;">
                <h2 style="color:#002147; margin:0; font-size:1.8em;">📊 Anexo de Contactos y Transferencias ACHS</h2>
                <button onclick="cerrarModalAnexo()" style="background:#dc3545; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease;">&times;</button>
            </div>
            
            <!-- Contenido del modal dividido en secciones -->
            <div style="display:grid; gap:25px;">
                
                <!-- Sección 1: Servicios de Transferencia -->
                <div style="background:#f8f9fa; border-radius:8px; padding:20px; border-left:4px solid #002147;">
                    <h3 style="color:#002147; margin-top:0; margin-bottom:15px;">📞 Servicios de Transferencia</h3>
                    <div style="overflow-x:auto;">
                        <table style="width:100%; border-collapse:collapse; font-size:0.9em;">
                            <thead>
                                <tr style="background:#002147; color:white;">
                                    <th style="border:1px solid #002147; padding:10px; text-align:left; font-weight:bold;">Servicio</th>
                                    <th style="border:1px solid #002147; padding:10px; text-align:left; font-weight:bold;">Transferir a</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#002147;">INFORMACIONES ACHS</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_INFORMACIONES</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#002147;">TRANSPORTE ACHS (RED)</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_TRANSPORTES</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#002147;">RESCATE AMBULANCIA</td>
                                    <td style="border:1px solid #ddd; padding:10px; color:#dc3545; font-weight:bold;">+568000</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#002147;">LICENCIAS MÉDICAS</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_LICENCIAS_MEDICAS</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#002147;">SOPORTE PÁGINA WEB</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_EMPRESAS_SOP_PAG_WEB<br>AG_VOZ_ACHS_TRABAJADORES_SOP_PAG_WEB</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sección 2: Servicios SNL -->
                <div style="background:#e8f5e8; border-radius:8px; padding:20px; border-left:4px solid #28a745;">
                    <h3 style="color:#28a745; margin-top:0; margin-bottom:15px;">🏥 Servicios SNL (Salud No Laboral)</h3>
                    <div style="overflow-x:auto;">
                        <table style="width:100%; border-collapse:collapse; font-size:0.9em;">
                            <thead>
                                <tr style="background:#28a745; color:rgb(22, 1, 1);">
                                    <th style="border:1px solid #28a745; padding:10px; text-align:left; font-weight:bold;">Servicio SNL</th>
                                    <th style="border:1px solid #28a745; padding:10px; text-align:left; font-weight:bold;">Transferir a</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL IMÁGENES</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_IMAGENES</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL KINE</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_AGENDAMIENTO_KINESIOLOGIA</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL MED GRAL</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_AGENDAMIENTO_MED_GRAL</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL SM</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_AGENDAMIENTO_SALUD_MENTAL</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL ANULACIÓN</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_ANULACIÓN_DE_HORAS</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL OTRAS CONSULTAS</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_OTRAS_CONSULTAS</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#28a745;">SNL TMT</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_SNL_AGENDAMIENTO_TRAUMATOLOGIA</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sección 3: Otros Servicios -->
                <div style="background:#fff3cd; border-radius:8px; padding:20px; border-left:4px solid #ffc107;">
                    <h3 style="color:#856404; margin-top:0; margin-bottom:15px;">🏢 Otros Servicios ACHS</h3>
                    <div style="overflow-x:auto;">
                        <table style="width:100%; border-collapse:collapse; font-size:0.9em;">
                            <thead>
                                <tr style="background:#ffc107; color:#212529;">
                                    <th style="border:1px solid #ffc107; padding:10px; text-align:left; font-weight:bold;">Servicio</th>
                                    <th style="border:1px solid #ffc107; padding:10px; text-align:left; font-weight:bold;">Transferir a</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#856404;">ENFERMEDADES PROFESIONALES (EMPRESAS)</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_EMPRESAS_EP</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#856404;">ENFERMEDADES PROFESIONALES (TRABAJADORES)</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_TRABAJADORES_EP</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#856404;">EXPERTO PREVENCIÓN</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_PREVENCIÓN</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#856404;">ASESOR COMERCIAL</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_COMERCIAL</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#856404;">CAPTACIÓN</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_ACHS_CAPTACIÓN</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#856404;">1404</td>
                                    <td style="border:1px solid #ddd; padding:10px;">AG_VOZ_1404_INFORMACIONES</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sección 5: Teléfonos y WhatsApp -->
                <div style="background:#f0f8f0; border-radius:8px; padding:20px; border-left:4px solid #198754;">
                    <h3 style="color:#198754; margin-top:0; margin-bottom:15px;">📱 Teléfonos y WhatsApp</h3>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <h4 style="color:#198754; margin-top:0;">📞 Teléfonos Principales</h4>
                            <ul style="list-style:none; padding:0; margin:0;">
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>Cuentas Corrientes:</strong> 226853735 / 3752</li>
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>SNL:</strong> 225157000</li>
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>CEM / Hora Particular:</strong> 7970801 - 225157777</li>
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>Vacunación:</strong> 228714444 - 226853333 - 225157777</li>
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>Prevención al Suicidio:</strong> *4141</li>
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>Rescate/Ambulancia 1404:</strong> 9226782910</li>
                                <li style="padding:8px 0; border-bottom:1px solid #ddd;"><strong>Resonancia de Temuco</strong> 452218118</li>
                            </ul>
                        </div>
                        <div>
                            
                  
                        </div>
                    </div>
                </div

                <!-- Sección 6: Otras Instituciones -->
                <div style="background:#fdf2e9; border-radius:8px; padding:20px; border-left:4px solid #fd7e14;">
                    <h3 style="color:#fd7e14; margin-top:0; margin-bottom:15px;">🏛️ Otras Instituciones</h3>
                    <div style="overflow-x:auto;">
                        <table style="width:100%; border-collapse:collapse; font-size:0.9em;">
                            <thead>
                                <tr style="background:#fd7e14; color:rgb(22, 2, 2);">
                                    <th style="border:1px solid #fd7e14; padding:10px; text-align:left; font-weight:bold;">Institución</th>
                                    <th style="border:1px solid #fd7e14; padding:10px; text-align:left; font-weight:bold;">Teléfono</th>
                                    <th style="border:1px solid #fd7e14; padding:10px; text-align:left; font-weight:bold;">Información Adicional</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">CURSOS EMPRESAS NO AFILIADAS</td>
                                    <td style="border:1px solid #ddd; padding:10px;">226852022 - 225746900</td>
                                    <td style="border:1px solid #ddd; padding:10px;">-</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">SUSESO</td>
                                    <td style="border:1px solid #ddd; padding:10px;">226204500 - 226204400</td>
                                    <td style="border:1px solid #ddd; padding:10px;">Superintendencia de Seguridad Social</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">ISL</td>
                                    <td style="border:1px solid #ddd; padding:10px;">600 586 90 90</td>
                                    <td style="border:1px solid #ddd; padding:10px;">Instituto de Seguridad Laboral</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">IST</td>
                                    <td style="border:1px solid #ddd; padding:10px;">600 58 40 000</td>
                                    <td style="border:1px solid #ddd; padding:10px;">Instituto de Seguridad del Trabajo</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">MUTUAL DE SEGURIDAD</td>
                                    <td style="border:1px solid #ddd; padding:10px;">600 2000 555</td>
                                    <td style="border:1px solid #ddd; padding:10px;">-</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">VIOLENCIA INTRAFAMILIAR</td>
                                    <td style="border:1px solid #ddd; padding:10px;">1455</td>
                                    <td style="border:1px solid #ddd; padding:10px;">-</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">MINSAL SALUD RESPONDE</td>
                                    <td style="border:1px solid #ddd; padding:10px;">6003607777</td>
                                    <td style="border:1px solid #ddd; padding:10px;">-</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">ASISTENCIA VICTORIA</td>
                                    <td style="border:1px solid #ddd; padding:10px;">228976600 - 233397600</td>
                                    <td style="border:1px solid #ddd; padding:10px;">-</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:10px; font-weight:bold; color:#fd7e14;">MESA PUC</td>
                                    <td style="border:1px solid #ddd; padding:10px;">800004155</td>
                                    <td style="border:1px solid #ddd; padding:10px;">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sección 7: Directorio Equipo SM-ME -->
                <div style="background:#f8f4ff; border-radius:8px; padding:20px; border-left:4px solid #6f42c1;">
                    <h3 style="color:#6f42c1; margin-top:0; margin-bottom:15px;">👥 Directorio Equipo SM-ME (Salud Mental - Medicina Especializada)</h3>
                    <div style="overflow-x:auto;">
                        <table style="width:100%; border-collapse:collapse; font-size:0.85em;">
                            <thead>
                                <tr style="background:#6f42c1; color:rgb(19, 4, 4);">
                                    <th style="border:1px solid #6f42c1; padding:8px; text-align:left; font-weight:bold;">Nombre</th>
                                    <th style="border:1px solid #6f42c1; padding:8px; text-align:center; font-weight:bold;">Área</th>
                                    <th style="border:1px solid #6f42c1; padding:8px; text-align:left; font-weight:bold;">Agencias a Cargo</th>
                                    <th style="border:1px solid #6f42c1; padding:8px; text-align:center; font-weight:bold;">Teléfono</th>
                                    <th style="border:1px solid #6f42c1; padding:8px; text-align:left; font-weight:bold;">Correo Institucional</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Javiera San Martín</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#28a745;">ME</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">Araucanía - Aysén - Bíobío - Libertador - Los Lagos - Los Ríos</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">9465480256</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptmeregiones@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Pedro Araya</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#007bff;">SM</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">Sur (Desde Libertador Bernardo O'Higgins)</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">-</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptsmregiones@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Nadia Chandia</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#007bff;">SM</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">RM</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">-</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptsm@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Cesar vergara</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#28a745;">ME</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">Antofagasta - Coquimbo - Valparaíso - Maule - Ñuble</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">967313649</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptmenorte@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Valeria Rivera</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#007bff;">SM</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">Norte (Arica - Coquimbo - Valparaíso)</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">939242835</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptsmnorte@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Valeria Salgado</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#007bff;">SM</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">RM</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">944246059</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptsm@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Carolina Gatica</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#28a745;">ME</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">RM</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">934440457</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptmeregiones@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Yvonne Vargas</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#007bff;">SM</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">Sur (Desde Libertador Bernardo O'Higgins)</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">939103141</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptsmregiones@achsservicios.cl</td>
                                </tr>
                                <tr style="background:#ffffff;">
                                    <td style="border:1px solid #ddd; padding:8px; font-weight:bold; color:#6f42c1;">Fernanda Recabarren</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center; font-weight:bold; color:#28a745;">SM</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">Norte (Iquique - Antofagasta - Calama - Copiapó)</td>
                                    <td style="border:1px solid #ddd; padding:8px; text-align:center;">962286406</td>
                                    <td style="border:1px solid #ddd; padding:8px; font-size:0.8em;">eptsmnorte@achsservicios.cl</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Footer con información adicional -->
                <div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:8px; border-left:4px solid #002147; text-align:center;">
                    <p style="margin:0; font-size:0.9em; color:#666;">
                        <strong style="color:#002147;">📋 Información del Anexo ACHS</strong><br>
                        Actualizado al 6 de julio de 2025 • Para uso interno del Contact Center ACHS
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal IVR (Submenú del botón ANEXO) -->
    <div id="modalIVR" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.55); z-index:2100; justify-content:center; align-items:center;">
        <div style="background:#ffffff; border-radius:18px; padding:1.4rem 1.6rem 2.4rem; max-width:1180px; width:96%; max-height:92vh; overflow:auto; box-shadow:0 14px 42px rgba(0,33,71,0.38); position:relative; line-height:1.4;">
            <button onclick="cerrarModalIVR()" style="position:absolute; top:14px; right:14px; background:#dc2626; color:#fff; border:none; width:40px; height:40px; border-radius:50%; font-size:1.2rem; cursor:pointer;">&times;</button>
            <div style="position:absolute; top:14px; left:14px; display:flex; gap:8px;">
                <button onclick="imprimirIVR()" title="Imprimir diagrama" style="background:#f1f5f9; color:#003366; border:1px solid #cbd5e1; padding:6px 12px; border-radius:8px; font-size:.75rem; font-weight:600; cursor:pointer;">🖨️ Imprimir</button>
                <button onclick="copiarIVR()" title="Copiar diagrama" style="background:#eef2ff; color:#1e3a8a; border:1px solid #cbd5e1; padding:6px 12px; border-radius:8px; font-size:.75rem; font-weight:600; cursor:pointer;">📋 Copiar</button>
            </div>
            <div style="background:#5d87c9; color:#fff; font-weight:700; letter-spacing:.8px; text-align:center; padding:10px 16px; border-radius:10px; font-size:1.15rem;">DIAGRAMA DE IVR ACTUALIZADO 02-06-2025</div>
            <div style="display:grid; grid-template-columns:310px 330px 1fr; gap:18px; margin-top:18px; align-items:start;">
                <!-- Columna izquierda (Menú principal numerado) -->
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <details style="border:1px solid #ffd874; border-left:6px solid #f59e0b; border-radius:10px; overflow:hidden;">
                        <summary style="list-style:none; cursor:pointer; padding:8px 10px; background:#ffe8a6; color:#7a5200; font-weight:700; display:flex; align-items:center; gap:8px;">
                            <span style="min-width:26px; color:#7a7a7a;">1</span>
                            <span>OPCIÓN 1: INCORPORACIÓN ACHS</span>
                        </summary>
                        <div style="padding:8px 10px; background:#fff8dc;">
                            <div style="display:grid; gap:4px;">
                                <span style="background:#ffefc2; padding:4px 6px; border-radius:4px; display:inline-block;">1 INDEPENDIENTE</span>
                                <span style="background:#ffefc2; padding:4px 6px; border-radius:4px; display:inline-block;">2 PYME</span>
                                <span style="background:#ffefc2; padding:4px 6px; border-radius:4px; display:inline-block;">3 CASA PARTICULAR</span>
                                <span style="background:#fff3d9; padding:4px 6px; border-radius:4px; display:inline-block; font-weight:600;">9 VOLVER AL MENÚ PRINCIPAL</span>
                            </div>
                        </div>
                    </details>
                    <details style="border:1px solid #c2e5c2; border-left:6px solid #2e7d32; border-radius:10px; overflow:hidden;">
                        <summary style="list-style:none; cursor:pointer; padding:8px 10px; background:#d9eed9; color:#0f4d17; font-weight:700; display:flex; align-items:center; gap:8px;">
                            <span style="min-width:26px; color:#7a7a7a;">2</span>
                            <span>OPCIÓN 2: SEL</span>
                        </summary>
                        <div style="padding:8px 10px; background:#eff7ef;">
                            <div style="display:grid; gap:4px;">
                                <span style="background:#eaf7ea; padding:4px 6px; border-radius:4px; display:inline-block;">1 EMPRESAS</span>
                                <span style="background:#eaf7ea; padding:4px 6px; border-radius:4px; display:inline-block;">2 TRABAJADORES</span>
                                <span style="background:#f2faf2; padding:4px 6px; border-radius:4px; display:inline-block; font-weight:600;">9 VOLVER AL MENÚ PRINCIPAL</span>
                                <span style="background:#eaf4ff; padding:4px 6px; border-radius:4px; display:inline-block;">SERVICIO DE EVALUACIONES LABORALES <b style="color:#0d47a1;">sel@achs.cl</b></span>
                            </div>
                        </div>
                    </details>
                    <details style="border:1px solid #c4dbf5; border-left:6px solid #1e3a8a; border-radius:10px; overflow:hidden;">
                        <summary style="list-style:none; cursor:pointer; padding:8px 10px; background:#dce9f9; color:#122c63; font-weight:700; display:flex; align-items:center; gap:8px;">
                            <span style="min-width:26px; color:#7a7a7a;">3</span>
                            <span>OPCIÓN 3: TRABAJADORES</span>
                        </summary>
                        <div style="padding:8px 10px; background:#edf4fe;">
                            <div style="display:grid; gap:4px;">
                                <span style="background:#eef5fc; padding:4px 6px; border-radius:4px; display:inline-block;">1 LICENCIAS MÉDICAS</span>
                                <span style="background:#eef5fc; padding:4px 6px; border-radius:4px; display:inline-block;">2 TRANSPORTE</span>
                                <span style="background:#eef5fc; padding:4px 6px; border-radius:4px; display:inline-block;">3 ENFERMEDAD PROFESIONAL</span>
                                <span style="background:#eef5fc; padding:4px 6px; border-radius:4px; display:inline-block;">4 SOPORTE PÁGINA WEB</span>
                                <span style="background:#eef5fc; padding:4px 6px; border-radius:4px; display:inline-block;">5 INFORMACIONES</span>
                            </div>
                        </div>
                    </details>
                    <details style="border:1px solid #f5d1b7; border-left:6px solid #d97706; border-radius:10px; overflow:hidden;">
                        <summary style="list-style:none; cursor:pointer; padding:8px 10px; background:#fbe4d1; color:#7a3e04; font-weight:700; display:flex; align-items:center; gap:8px;">
                            <span style="min-width:26px; color:#7a7a7a;">4</span>
                            <span>OPCIÓN 4: EMPRESAS</span>
                        </summary>
                        <div style="padding:8px 10px; background:#fff1e6;">
                            <div style="display:grid; gap:4px;">
                                <span style="background:#fdf0e3; padding:4px 6px; border-radius:4px; display:inline-block;">0 JUNTA DE ASOCIADOS / DIRECTORIO</span>
                                <span style="background:#fdf0e3; padding:4px 6px; border-radius:4px; display:inline-block;">1 SOPORTE PÁGINA WEB</span>
                                <span style="background:#fdf0e3; padding:4px 6px; border-radius:4px; display:inline-block;">2 ASESORÍA EN PREVENCIÓN</span>
                                <span style="background:#fdf0e3; padding:4px 6px; border-radius:4px; display:inline-block;">3 ASESORÍA COMERCIAL</span>
                                <span style="background:#fdf0e3; padding:4px 6px; border-radius:4px; display:inline-block;">4 ENFERMEDAD PROFESIONAL</span>
                            </div>
                        </div>
                    </details>
                    <details style="border:1px solid #d5d5d5; border-left:6px solid #6b7280; border-radius:10px; overflow:hidden;">
                        <summary style="list-style:none; cursor:pointer; padding:8px 10px; background:#e2e2e2; color:#333; font-weight:700; display:flex; align-items:center; gap:8px;">
                            <span style="min-width:26px; color:#7a7a7a;">5</span>
                            <span>OPCIÓN 5: SALUD NO LABORAL (SNL)</span>
                        </summary>
                        <div style="padding:8px 10px; background:#ededed;">
                            <div style="display:grid; gap:4px;">
                                <span style="background:#ebebeb; padding:4px 6px; border-radius:4px; display:inline-block;">1 NOSOTROS</span>
                            </div>
                        </div>
                    </details>
                </div>
                <!-- Columna central (ramificaciones destacadas) -->
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <div style="background:#dce9f9; border:1px solid #c4dbf5; border-left:6px solid #1e3a8a; border-radius:8px; padding:10px 12px; font-size:.8rem; font-weight:600; color:#1e3a8a;">PACIENTES LEY / SUBSIDIOS<br><span style="font-weight:400; color:#334e7d;">Certificados • Consulta de pago • Documentos licencia • Subsidios</span><span style="margin-top:4px; display:block; font-weight:400; color:#122c63;">Empresa y trabajador: consultar pago / doc. licencia / certificado licencia</span></div>
                    <div style="background:#dce9f9; border:1px solid #c4dbf5; border-left:6px solid #1e3a8a; border-radius:8px; padding:10px 12px; font-size:.8rem; font-weight:600; color:#1e3a8a;">INFORMACIONES<br><span style="font-weight:400; color:#334e7d;">Accidentes · Informaciones · Apelaciones · Otras consultas · Reclamos</span></div>
                </div>
                <!-- Columna derecha (Notas de derivación y criterios) -->
                <div style="display:flex; flex-direction:column; gap:12px; font-size:.72rem; color:#1f2937;">
                    <div style="background:#f1f5f9; border:1px solid #e2e8f0; border-left:5px solid #003366; border-radius:8px; padding:10px 12px; font-weight:600; color:#003366;">CUÁNDO DERIVAR
                        <ul style="margin:6px 0 0 14px; padding:0; list-style:disc; font-weight:400;">
                            <li>Solicitud formal evaluaciones laborales</li>
                            <li>Falta de confirmación retiro transporte</li>
                            <li>Reclamo por retraso o no pasó móvil</li>
                        </ul>
                    </div>
                    <div style="background:#fff8e1; border:1px solid #ffecb3; border-left:5px solid #f59e0b; border-radius:8px; padding:10px 12px; font-weight:600; color:#7a5200;">TEMAS DE TRANSPORTE PACIENTES LEY
                        <ul style="margin:6px 0 0 14px; padding:0; list-style:disc; font-weight:400;">
                            <li>Retraso</li>
                            <li>No lo pasaron a buscar</li>
                            <li>Reclamo puntual</li>
                        </ul>
                    </div>
                    <div style="background:#e9f7ef; border:1px solid #cde9db; border-left:5px solid #2e7d32; border-radius:8px; padding:10px 12px; font-weight:600; color:#0f4d17;">AFILIACIÓN / INCORPORACIÓN
                        <span style="display:block; margin-top:4px; font-weight:400;">Personas naturales y/o empresas que requieren afiliarse a ACHS.</span>
                    </div>
                </div>
            </div>
            <div style="margin-top:16px; display:flex; justify-content:space-between; gap:14px; flex-wrap:wrap; font-size:.68rem; color:#475569; background:#f8fafc; padding:10px 14px; border-radius:10px;">
                <span>Diagrama simplificado para orientación rápida en llamadas.</span>
                <span><b>Revisión:</b> 02-06-2025 • <span style="color:#1e3a8a; font-weight:600;">Lista para impresión / copia</span></span>
            </div>
        </div>
    </div>

    <!-- Modal de Correos -->
    <div id="modalCorreos" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:800px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,33,71,0.2); position:relative;">
            
            <!-- Header del modal -->
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #002147; padding-bottom:15px; margin-bottom:20px;">
                <h2 style="color:#002147; margin:0; font-size:1.8em;">✉️ Directorio de Correos ACHS</h2>
                <button onclick="cerrarModalCorreos()" style="background:#dc3545; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease;">&times;</button>
            </div>
            
            <!-- Tabla de correos -->
            <div style="overflow-x:auto;">
                <table style="width:100%; border-collapse:collapse; font-size:0.95em; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background:linear-gradient(145deg, #002147, #003366); color:white;">
                            <th style="border:1px solid #002147; padding:15px 12px; text-align:left; font-weight:bold;">📋 Área / Servicio</th>
                            <th style="border:1px solid #002147; padding:15px 12px; text-align:left; font-weight:bold;">📧 Correo Electrónico</th>
                            <th style="border:1px solid #002147; padding:15px 12px; text-align:center; font-weight:bold;">🔗 Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:12px; font-weight:bold; color:#002147;">
                                🏥 Médico General/Traumatología
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; font-family:monospace; color:#007bff;">
                                traumatologiasi@achs.cl
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; text-align:center;">
                                <button onclick="copiarCorreo('traumatologiasi@achs.cl')" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; transition:all 0.3s ease;">
                                    📋 Copiar
                                </button>
                            </td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:12px; font-weight:bold; color:#002147;">
                                🏥 Médico General/Dermatología
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; font-family:monospace; color:#007bff;">
                                dermatologiasnl@achs.cl
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; text-align:center;">
                                <button onclick="copiarCorreo('dermatologiasnl@achs.cl')" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; transition:all 0.3s ease;">
                                    📋 Copiar
                                </button>
                            </td>
                        </tr>
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:12px; font-weight:bold; color:#002147;">
                                📄 Solicitudes SNL
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; font-family:monospace; color:#007bff;">
                                solicitudessnl@achs.cl
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; text-align:center;">
                                <button onclick="copiarCorreo('solicitudessnl@achs.cl')" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; transition:all 0.3s ease;">
                                    📋 Copiar
                                </button>
                            </td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:12px; font-weight:bold; color:#002147;">
                                🧪 Pruebas
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; font-family:monospace; color:#007bff;">
                                mediosdeprueba@achs.cl
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; text-align:center;">
                                <button onclick="copiarCorreo('mediosdeprueba@achs.cl')" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; transition:all 0.3s ease;">
                                    📋 Copiar
                                </button>
                            </td>
                        </tr>
                        <tr style="background:#f8f9fa;">
                            <td style="border:1px solid #ddd; padding:12px; font-weight:bold; color:#002147;">
                                📋 Licencias Rechazadas
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; font-family:monospace; color:#007bff;">
                                sdtelemedicina@achs.cl
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; text-align:center;">
                                <button onclick="copiarCorreo('sdtelemedicina@achs.cl')" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; transition:all 0.3s ease;">
                                    📋 Copiar
                                </button>
                            </td>
                        </tr>
                        <tr style="background:#ffffff;">
                            <td style="border:1px solid #ddd; padding:12px; font-weight:bold; color:#002147;">
                                📢 Reclamos
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; font-family:monospace; color:#007bff;">
                                achs@achs.cl
                            </td>
                            <td style="border:1px solid #ddd; padding:12px; text-align:center;">
                                <button onclick="copiarCorreo('achs@achs.cl')" style="background:#28a745; color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8em; transition:all 0.3s ease;">
                                    📋 Copiar
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Footer con información adicional -->
            <div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:8px; border-left:4px solid #002147;">
                <p style="margin:0; font-size:0.9em; color:#666; text-align:center;">
                    <strong style="color:#002147;">✉️ Directorio de Correos ACHS</strong><br>
                    Haz clic en "Copiar" para copiar el correo al portapapeles • Actualizado al 6 de julio de 2025
                </p>
            </div>
        </div>
    </div>

    <!-- Modal de Atención -->
    <div id="modalAtencion" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:900px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,33,71,0.2); position:relative;">
            
            <!-- Header del modal -->
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #dc3545; padding-bottom:15px; margin-bottom:20px;">
                <h2 style="color:#dc3545; margin:0; font-size:1.8em;">⚠️ Registro de Atención - Incidencias y Cambios</h2>
                <button onclick="cerrarModalAtencion()" style="background:#dc3545; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease;">&times;</button>
            </div>
            
            <!-- Formulario de registro -->
            <div style="background:#fff3cd; border-radius:8px; padding:20px; margin-bottom:20px; border-left:4px solid #ffc107;">
                <h3 style="color:#856404; margin-top:0; margin-bottom:15px;">📝 Nuevo Registro de Atención</h3>
                
                <div style="display:grid; gap:15px;">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">📅 Fecha:</label>
                            <input type="datetime-local" id="fechaAtencion" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; background:#fff;" readonly>
                        </div>
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">👤 Registrado por:</label>
                            <input type="text" id="usuarioAtencion" placeholder="Nombre del usuario" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                        </div>
                    </div>
                    
                    <div>
                        <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">🏷️ Tipo de Registro:</label>
                        <select id="tipoAtencion" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                            <option value="">Seleccionar tipo...</option>
                            <option value="Incidencia">🚨 Incidencia</option>
                            <option value="Cambio de Procedimiento">🔄 Cambio de Procedimiento</option>
                            <option value="Mejora">💡 Mejora</option>
                            <option value="Observación">👁️ Observación</option>
                            <option value="Capacitación">📚 Capacitación</option>
                            <option value="Otro">📌 Otro</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">📋 Título:</label>
                        <input type="text" id="tituloAtencion" placeholder="Título breve del registro" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                    </div>
                    
                    <div>
                        <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">📝 Descripción:</label>
                        <textarea id="descripcionAtencion" rows="4" placeholder="Descripción detallada del registro..." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; resize:vertical;"></textarea>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">⚡ Prioridad:</label>
                            <select id="prioridadAtencion" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="Baja">🟢 Baja</option>
                                <option value="Media" selected>🟡 Media</option>
                                <option value="Alta">🟠 Alta</option>
                                <option value="Crítica">🔴 Crítica</option>
                            </select>
                        </div>
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">📊 Estado:</label>
                            <select id="estadoAtencion" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="Pendiente" selected>⏳ Pendiente</option>
                                <option value="En Proceso">🔄 En Proceso</option>
                                <option value="Resuelto">✅ Resuelto</option>
                                <option value="Cancelado">❌ Cancelado</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align:center; margin-top:10px;">
                        <button onclick="guardarRegistroAtencion()" style="background:#28a745; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-weight:bold; margin-right:10px;">
                            ✅ Guardar Registro
                        </button>
                        <button onclick="limpiarFormularioAtencion()" style="background:#6c757d; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-weight:bold;">
                            🗑️ Limpiar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lista de registros -->
            <div style="background:#f8f9fa; border-radius:8px; padding:20px; border-left:4px solid #dc3545;">
                <h3 style="color:#dc3545; margin-top:0; margin-bottom:15px;">📋 Historial de Registros de Atención</h3>
                
                <div style="margin-bottom:15px; text-align:right;">
                    <button onclick="exportarRegistrosAtencion()" style="background:#17a2b8; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9em;">
                        📥 Exportar a Excel
                    </button>
                </div>
                
                <div style="overflow-x:auto; max-height:400px; overflow-y:auto; border:1px solid #ddd; border-radius:6px; background:white;">
                    <table id="tablaAtencion" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                        <thead style="background:#dc3545; color:black; position:sticky; top:0;">
                            <tr>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:left;">📅 Fecha</th>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:left;">👤 Usuario</th>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:left;">🏷️ Tipo</th>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:left;">📋 Título</th>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:center;">⚡ Prioridad</th>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:center;">📊 Estado</th>
                                <th style="border:1px solid #dc3545; padding:8px; text-align:center;">🗑️ Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los registros se agregarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Alertas -->
    <div id="modalAlerta" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:12px; padding:25px; max-width:900px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(255,193,7,0.3); position:relative; border:3px solid #ffc107;">
            
            <!-- Header del modal -->
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid #ffc107; padding-bottom:15px; margin-bottom:20px;">
                <h2 style="color:#856404; margin:0; font-size:1.8em;">🚨 Sistema de Alertas y Recordatorios</h2>
                <button onclick="cerrarModalAlerta()" style="background:#ffc107; color:#856404; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease; font-weight:bold;">&times;</button>
            </div>
            
            <!-- Formulario de nueva alerta -->
            <div style="background:#fff3cd; border-radius:8px; padding:20px; margin-bottom:20px; border-left:4px solid #ffc107;">
                <h3 style="color:#856404; margin-top:0; margin-bottom:15px;">📝 Agendar Nueva Tarea/Recordatorio</h3>
                
                <div style="display:grid; gap:15px;">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">📅 Fecha y Hora de Recordatorio:</label>
                            <input type="datetime-local" id="fechaAlerta" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                        </div>
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">⚡ Prioridad:</label>
                            <select id="prioridadAlerta" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="Baja">🟢 Baja</option>
                                <option value="Media" selected>🟡 Media</option>
                                <option value="Alta">🟠 Alta</option>
                                <option value="Crítica">🔴 Crítica</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">🏷️ Título de la Tarea:</label>
                        <input type="text" id="tituloAlerta" placeholder="Ej: Revisar informes pendientes" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                    </div>
                    
                    <div>
                        <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">📝 Descripción:</label>
                        <textarea id="descripcionAlerta" rows="3" placeholder="Descripción detallada de la tarea..." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; resize:vertical;"></textarea>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">🔔 Tipo de Recordatorio:</label>
                            <select id="tipoAlerta" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="Tarea">📋 Tarea Pendiente</option>
                                <option value="Reunión">👥 Reunión</option>
                                <option value="Llamada">📞 Llamada</option>
                                <option value="Revisión">🔍 Revisión</option>
                                <option value="Entrega">📤 Entrega</option>
                                <option value="Otro">📌 Otro</option>
                            </select>
                        </div>
                        <div>
                            <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">🔁 Repetir:</label>
                            <select id="repetirAlerta" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                                <option value="No">❌ No repetir</option>
                                <option value="Diario">📅 Diario</option>
                                <option value="Semanal">📆 Semanal</option>
                                <option value="Mensual">🗓️ Mensual</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="text-align:center; margin-top:10px;">
                        <button onclick="guardarAlerta()" style="background:#ffc107; color:#856404; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-weight:bold; margin-right:10px;">
                            ⏰ Programar Alerta
                        </button>
                        <button onclick="limpiarFormularioAlerta()" style="background:#6c757d; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-weight:bold;">
                            🗑️ Limpiar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Lista de alertas programadas -->
            <div style="background:#f8f9fa; border-radius:8px; padding:20px; border-left:4px solid #ffc107;">
                <h3 style="color:#856404; margin-top:0; margin-bottom:15px;">⏰ Alertas Programadas</h3>
                
                <div style="margin-bottom:15px; display:flex; justify-content:space-between; align-items:center;">
                    <button onclick="verificarAlertas()" style="background:#28a745; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9em;">
                        🔄 Verificar Alertas Pendientes
                    </button>
                    <button onclick="exportarAlertas()" style="background:#17a2b8; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9em;">
                        📥 Exportar Alertas
                    </button>
                </div>
                
                <div style="overflow-x:auto; max-height:400px; overflow-y:auto; border:1px solid #ddd; border-radius:6px; background:white;">
                    <table id="tablaAlertas" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                        <thead style="background:#ffc107; color:#856404; position:sticky; top:0;">
                            <tr>
                                <th style="border:1px solid #ffc107; padding:8px; text-align:left;">📅 Fecha/Hora</th>
                                <th style="border:1px solid #ffc107; padding:8px; text-align:left;">🏷️ Título</th>
                                <th style="border:1px solid #ffc107; padding:8px; text-align:left;">🔔 Tipo</th>
                                <th style="border:1px solid #ffc107; padding:8px; text-align:center;">⚡ Prioridad</th>
                                <th style="border:1px solid #ffc107; padding:8px; text-align:center;">📊 Estado</th>
                                <th style="border:1px solid #ffc107; padding:8px; text-align:center;">🗑️ Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las alertas se agregarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Pendientes -->
    <div id="modalPendiente" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:15px; padding:30px; max-width:800px; width:90%; max-height:90vh; overflow-y:auto; box-shadow:0 20px 40px rgba(0,0,0,0.3); border:3px solid #007bff;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; border-bottom:2px solid #007bff; padding-bottom:15px;">
                <h2 style="color:#0056b3; margin:0; font-size:1.8em;">📝 Gestión de Tareas Pendientes</h2>
                <button onclick="cerrarModalPendiente()" style="background:#007bff; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease; font-weight:bold;">&times;</button>
            </div>
            
            <!-- Formulario de nueva tarea pendiente -->
            <div style="background:#f8f9fa; padding:25px; border-radius:12px; margin-bottom:25px; border:2px solid #007bff;">
                <h3 style="color:#0056b3; margin-top:0; margin-bottom:20px; font-size:1.4em;">📋 Registrar Nueva Tarea Pendiente</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
                    <div>
                        <label style="display:block; font-weight:bold; color:#495057; margin-bottom:5px;">📅 Fecha de Registro:</label>
                        <input type="date" id="fechaRegistroPendiente" readonly style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; background:#e9ecef;">
                    </div>
                    <div>
                        <label style="display:block; font-weight:bold; color:#495057; margin-bottom:5px;">⏰ Fecha/Hora de Recordatorio:</label>
                        <input type="datetime-local" id="fechaRecordatorioPendiente" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                    </div>
                </div>
                <div style="margin-bottom:20px;">
                    <label style="display:block; font-weight:bold; color:#495057; margin-bottom:5px;">🏷️ Título de la Tarea:</label>
                    <input type="text" id="tituloPendiente" placeholder="Ej: Revisar documentos de cliente X" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                </div>
                <div style="margin-bottom:20px;">
                    <label style="display:block; font-weight:bold; color:#495057; margin-bottom:5px;">📝 Observaciones:</label>
                    <textarea id="observacionesPendiente" rows="4" placeholder="Describe los detalles de la tarea pendiente..." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; resize:vertical;"></textarea>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
                    <div>
                        <label style="display:block; font-weight:bold; color:#495057; margin-bottom:5px;">⚡ Prioridad:</label>
                        <select id="prioridadPendiente" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                            <option value="Baja">🟢 Baja</option>
                            <option value="Media" selected>🟡 Media</option>
                            <option value="Alta">🔴 Alta</option>
                            <option value="Crítica">🚨 Crítica</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block; font-weight:bold; color:#495057; margin-bottom:5px;">📋 Categoría:</label>
                        <select id="categoriaPendiente" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                            <option value="Administración">📊 Administración</option>
                            <option value="Cliente">👥 Cliente</option>
                            <option value="Documentos">📄 Documentos</option>
                            <option value="Seguimiento">🔍 Seguimiento</option>
                            <option value="Urgente">⚡ Urgente</option>
                            <option value="Otro">📌 Otro</option>
                        </select>
                    </div>
                </div>
                <div style="text-align:center;">
                    <button onclick="guardarPendiente()" style="background:#007bff; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-weight:bold; margin-right:10px; font-size:1.1em;">
                        💾 Guardar y Programar Recordatorio
                    </button>
                    <button onclick="limpiarFormularioPendiente()" style="background:#6c757d; color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1.1em;">
                        🧹 Limpiar Formulario
                    </button>
                </div>
            </div>
            
            <!-- Lista de tareas pendientes -->
            <div style="background:white; padding:20px; border-radius:12px; border:2px solid #007bff;">
                <h3 style="color:#0056b3; margin-top:0; margin-bottom:15px;">📋 Tareas Pendientes Registradas</h3>
                <div style="margin-bottom:15px; display:flex; gap:10px; flex-wrap:wrap;">
                    <button onclick="verificarRecordatoriosPendientes()" style="background:#28a745; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9em;">
                        🔄 Verificar Recordatorios
                    </button>
                    <button onclick="exportarPendientes()" style="background:#17a2b8; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9em;">
                        📥 Exportar Pendientes
                    </button>
                </div>
                
                <div style="overflow-x:auto; max-height:400px; overflow-y:auto; border:1px solid #ddd; border-radius:6px; background:white;">
                    <table id="tablaPendientes" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                        <thead style="background:#007bff; color:black; position:sticky; top:0;">
                            <tr>
                                <th style="border:1px solid #007bff; padding:8px; text-align:left; font-weight:bold;">📅 Registro</th>
                                <th style="border:1px solid #007bff; padding:8px; text-align:left; font-weight:bold;">⏰ Recordatorio</th>
                                <th style="border:1px solid #007bff; padding:8px; text-align:left; font-weight:bold;">🏷️ Título</th>
                                <th style="border:1px solid #007bff; padding:8px; text-align:left; font-weight:bold;">📋 Categoría</th>
                                <th style="border:1px solid #007bff; padding:8px; text-align:center; font-weight:bold;">⚡ Prioridad</th>
                                <th style="border:1px solid #007bff; padding:8px; text-align:center; font-weight:bold;">📊 Estado</th>
                                <th style="border:1px solid #007bff; padding:8px; text-align:center; font-weight:bold;">🗑️ Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Las tareas pendientes se agregarán aquí dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Bandeja de Entrada de Emails -->
    <div id="modalEmails" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:white; border-radius:15px; padding:30px; max-width:1200px; width:95%; max-height:95vh; overflow-y:auto; box-shadow:0 20px 40px rgba(0,0,0,0.3); border:3px solid #28a745;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; border-bottom:2px solid #28a745; padding-bottom:15px;">
                <h2 style="color:#155724; margin:0; font-size:1.8em;">📧 Bandeja de Entrada Integrada</h2>
                <button onclick="cerrarModalEmails()" style="background:#28a745; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease; font-weight:bold;">&times;</button>
            </div>
            
          
                
                <!-- Filtros y búsqueda -->
                <div style="display:grid; grid-template-columns:1fr 200px 200px; gap:15px; align-items:center;">
                    <input type="text" id="buscarEmail" placeholder="🔍 Buscar por remitente, asunto o contenido..." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                    <select id="filtroEstado" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                        <option value="todos">📧 Todos los emails</option>
                        <option value="no-leidos">📩 No leídos</option>
                        <option value="leidos">📖 Leídos</option>
                        <option value="importantes">⭐ Importantes</option>
                        <option value="archivados">📁 Archivados</option>
                    </select>
                    <select id="filtroFecha" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px;">
                        <option value="todos">📅 Todas las fechas</option>
                        <option value="hoy">📅 Hoy</option>
                        <option value="ayer">📅 Ayer</option>
                        <option value="semana">📅 Esta semana</option>
                        <option value="mes">📅 Este mes</option>
                    </select>
                </div>
            </div>
            
            <!-- Lista de emails -->
            <div style="background:white; border-radius:12px; border:2px solid #28a745;">
                <div style="background:#28a745; color:white; padding:15px; border-radius:10px 10px 0 0; display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0; font-size:1.3em;">📬 Lista de Emails</h3>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <span id="contadorEmails" style="background:rgba(255,255,255,0.2); padding:5px 12px; border-radius:20px; font-size:0.9em;">
                            📊 0 emails
                        </span>
                        <span id="contadorNoLeidos" style="background:#dc3545; padding:5px 12px; border-radius:20px; font-size:0.9em;">
                            📩 0 no leídos
                        </span>
                    </div>
                </div>
                
                <div style="overflow-x:auto; max-height:500px; overflow-y:auto; border:1px solid #ddd; border-radius:0 0 10px 10px;">
                    <table id="tablaEmails" style="width:100%; border-collapse:collapse; font-size:0.9em;">
                        <thead style="background:#e8f5e8; position:sticky; top:0;">
                            <tr>
                                <th style="border:1px solid #28a745; padding:10px; text-align:center; font-weight:bold; width:40px;">📌</th>
                                <th style="border:1px solid #28a745; padding:10px; text-align:left; font-weight:bold; width:200px;">📤 Remitente</th>
                                <th style="border:1px solid #28a745; padding:10px; text-align:left; font-weight:bold;">📝 Asunto</th>
                                <th style="border:1px solid #28a745; padding:10px; text-align:center; font-weight:bold; width:150px;">📅 Fecha</th>
                                <th style="border:1px solid #28a745; padding:10px; text-align:center; font-weight:bold; width:100px;">📊 Estado</th>
                                <th style="border:1px solid #28a745; padding:10px; text-align:center; font-weight:bold; width:120px;">🔧 Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaEmails">
                            <tr>
                                <td colspan="6" style="text-align:center; padding:30px; color:#666; border:1px solid #ddd;">
                                    📭 No hay emails para mostrar. Haga clic en "Actualizar Bandeja" para cargar emails.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Redacción de Email eliminado - No se utilizaba (14/11/2025) -->

    <!-- Modal de Planilla de Respuestas -->
    <div id="modalPlanillaRespuestas" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div id="contenidoPlanilla" style="background:white; border-radius:15px; padding:30px; max-width:1200px; width:95%; max-height:95vh; overflow-y:auto; box-shadow:0 20px 40px rgba(0,0,0,0.3); border:3px solid #6f42c1; transform:scale(1); transition:transform 0.2s ease;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; border-bottom:2px solid #6f42c1; padding-bottom:15px;">
                <h2 style="color:#5a2d91; margin:0; font-size:1.8em;">📋 Planilla de Respuestas Predefinidas</h2>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button onclick="ajustarZoomModal('contenidoPlanilla', -0.1)" style="background:#e9ecef; color:#6f42c1; border:none; border-radius:4px; width:32px; height:32px; cursor:pointer; font-size:1.2rem; font-weight:bold;" title="Reducir zoom">−</button>
                    <button onclick="ajustarZoomModal('contenidoPlanilla', 0)" style="background:#e9ecef; color:#6f42c1; border:none; border-radius:4px; padding:6px 10px; cursor:pointer; font-size:0.8rem; font-weight:bold;" title="Restablecer zoom">100%</button>
                    <button onclick="ajustarZoomModal('contenidoPlanilla', 0.1)" style="background:#e9ecef; color:#6f42c1; border:none; border-radius:4px; width:32px; height:32px; cursor:pointer; font-size:1.2rem; font-weight:bold;" title="Aumentar zoom">+</button>
                    <button onclick="cerrarModalPlanillaRespuestas()" style="background:#6f42c1; color:white; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:1.3em; transition:all 0.3s ease; font-weight:bold;">&times;</button>
                </div>
            </div>
            
            <!-- Barra de búsqueda y herramientas -->
            <div style="background:#f8f9fa; padding:20px; border-radius:12px; margin-bottom:25px; border:2px solid #6f42c1;">
                <div style="display:flex; gap:15px; align-items:center; flex-wrap:wrap; margin-bottom:15px;">
                    <input type="text" id="buscarRespuesta" placeholder="🔍 Buscar respuesta..." style="flex:1; min-width:300px; padding:10px; border:1px solid #ddd; border-radius:6px;">
                    <select id="filtroCategoria" style="padding:10px; border:1px solid #ddd; border-radius:6px;">
                        <option value="todas">📂 Todas las categorías</option>
                        <option value="acuso-recibo">✅ Acuso de recibo</option>
                        <option value="bloqueos">🔒 Bloqueos</option>
                        <option value="cambios-cita">📅 Cambios de cita</option>
                        <option value="opciones-completas">💬 Opciones completas</option>
                        <option value="finalizacion">✅ Finalización</option>
                        <option value="contacto-paciente">📞 Contacto con paciente</option>
                        <option value="agenda-ingreso-ep">🗓️ Agenda Ingreso EP</option>
                    </select>
                    <button onclick="limpiarBusqueda()" style="background:#6c757d; color:white; border:none; padding:10px 15px; border-radius:6px; cursor:pointer;">
                        🧹 Limpiar
                    </button>
                </div>
                <p style="margin:0; color:#666; font-size:0.9em;">💡 Haz clic en cualquier respuesta para copiarla al portapapeles</p>
            </div>
            
            <!-- Contenedor de respuestas -->
            <div id="contenedorRespuestas">
                
                <!-- Categoria: Acuso de Recibo -->
                <div class="categoria-respuestas" data-categoria="acuso-recibo" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #28a745;">
                    <div style="background:#28a745; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('acuso-recibo')">
                        <h3 style="margin:0; font-size:1.3em;">✅ FORMAS DE ACUSAR RECIBO Y DECIR QUE SE ESTÁ GESTIONANDO</h3>
                        <span id="toggle-acuso-recibo" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-acuso-recibo" style="padding:20px;">
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e8f5e8'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Acusamos recibo de su correo y ya estamos gestionando lo solicitado.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e8f5e8'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Gracias por la información, procederemos con las gestiones correspondientes.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e8f5e8'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Hemos recibido su mensaje y estamos trabajando en ello.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e8f5e8'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Recibido. Nos encontramos coordinando las acciones necesarias.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e8f5e8'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Confirmamos recepción y comenzamos la gestión de inmediato.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Categoria: Bloqueos -->
                <div class="categoria-respuestas" data-categoria="bloqueos" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #dc3545;">
                    <div style="background:#dc3545; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('bloqueos')">
                        <h3 style="margin:0; font-size:1.3em;">🔒 FORMAS DE DECIR QUE SE REALIZARÁN LOS BLOQUEOS</h3>
                        <span id="toggle-bloqueos" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-bloqueos" style="padding:20px;">
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fde2e2'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Se procederá con el bloqueo de las citas a la brevedad.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fde2e2'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Estamos programando los bloqueos según lo indicado.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fde2e2'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Los bloqueos serán ejecutados durante la jornada.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fde2e2'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">En cuanto el sistema lo permita, se realizarán los bloqueos correspondientes.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fde2e2'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Estamos a la espera del sistema para efectuar los bloqueos solicitados.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Categoria: Cambios de Cita -->
                <div class="categoria-respuestas" data-categoria="cambios-cita" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #fd7e14;">
                    <div style="background:#fd7e14; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('cambios-cita')">
                        <h3 style="margin:0; font-size:1.3em;">📅 FORMAS DE INDICAR QUE SE INFORMARÁN LOS CAMBIOS DE CITA</h3>
                        <span id="toggle-cambios-cita" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-cambios-cita" style="padding:20px;">
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fef0e6'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Una vez realizadas las modificaciones, informaremos los cambios de cita.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fef0e6'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Les enviaremos la confirmación de los cambios una vez finalizados.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fef0e6'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Apenas tengamos el nuevo calendario, se lo haremos llegar.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fef0e6'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Informaremos oportunamente a los pacientes sobre las nuevas fechas.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#fef0e6'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Confirmaremos los nuevos horarios tan pronto estén disponibles.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Categoria: Opciones Completas -->
                <div class="categoria-respuestas" data-categoria="opciones-completas" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #6f42c1;">
                    <div style="background:#6f42c1; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('opciones-completas')">
                        <h3 style="margin:0; font-size:1.3em;">💬 OPCIONES COMPLETAS (respuesta directa)</h3>
                        <span id="toggle-opciones-completas" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-opciones-completas" style="padding:20px;">
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#f3e8ff'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Gracias por su mensaje. Ya estamos gestionando lo solicitado y procederemos con los bloqueos. Informaremos los cambios de cita a la brevedad.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#f3e8ff'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Recibido. Estamos coordinando los bloqueos según lo indicado. En cuanto estén realizados, les enviaremos la confirmación con los nuevos horarios.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#f3e8ff'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Acusamos recibo del correo. En cuanto el sistema lo permita, haremos los bloqueos y notificaremos los ajustes en la agenda.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#f3e8ff'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Gracias por la información. Estamos gestionando internamente, realizaremos los bloqueos y luego comunicaremos los cambios de cita correspondientes.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#f3e8ff'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Confirmamos recepción. La gestión está en curso; los bloqueos se harán hoy y se informarán los cambios de cita a los pacientes afectados.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Categoria: Finalización -->
                <div class="categoria-respuestas" data-categoria="finalizacion" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #20c997;">
                    <div style="background:#20c997; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('finalizacion')">
                        <h3 style="margin:0; font-size:1.3em;">✅ RESPUESTAS DE FINALIZACIÓN (por tono)</h3>
                        <span id="toggle-finalizacion" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-finalizacion" style="padding:20px;">
                        <h4 style="color:#20c997; margin-top:0;">🧾 Formal / Profesional</h4>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Se efectuaron los bloqueos correspondientes, se estableció contacto con el paciente y se reprogramó la atención.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Los procedimientos fueron reagendados tras confirmar con el paciente, quien fue debidamente informado.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Bloqueos realizados y reagendamiento coordinado exitosamente con el paciente.</span>
                        </div>
                        
                        <h4 style="color:#20c997; margin-top:20px;">💬 Neutro / Claro y directo</h4>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Los bloques ya están realizados, se contactó al paciente y quedó reagendado.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Se bloqueó la agenda, se habló con el paciente y se reagendó sin inconvenientes.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Todo listo: bloqueos hechos, paciente informado, cita reagendada.</span>
                        </div>
                        
                        <h4 style="color:#20c997; margin-top:20px;">🙂 Cercano / Agradable</h4>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Ya se hizo el bloqueo, hablamos con el paciente y reagendamos con su confirmación.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Agenda actualizada: se bloqueó la hora, se contactó al paciente y ya quedó reprogramado.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e6fffe'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Reagendado con éxito 😊 Bloqueos realizados y paciente notificado.</span>
                        </div>
                    </div>
                </div>
                
                <!-- Categoria: Contacto con Paciente -->
                <div class="categoria-respuestas" data-categoria="contacto-paciente" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #17a2b8;">
                    <div style="background:#17a2b8; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('contacto-paciente')">
                        <h3 style="margin:0; font-size:1.3em;">📞 RESPUESTAS SOBRE CONTACTO CON PACIENTES</h3>
                        <span id="toggle-contacto-paciente" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-contacto-paciente" style="padding:20px;">
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e1f7fa'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Nos encontramos en proceso de contactar a los pacientes para coordinar nuevas fechas.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e1f7fa'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Ya hemos comenzado a comunicarnos con los pacientes para reprogramar sus citas.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e1f7fa'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Estamos gestionando el contacto con los pacientes para agendar nuevamente sus horas.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e1f7fa'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Ya iniciamos el proceso de reagendamiento, contactando directamente a los pacientes.</span>
                        </div>
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:6px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#e1f7fa'" onmouseout="this.style.backgroundColor='white'">
                            <span class="texto-respuesta">Se está realizando el contacto con los pacientes con el fin de reprogramar sus citas.</span>
                        </div>
                    </div>
                </div>

                <!-- Categoria: Agenda Ingreso Enfermedad Profesional ACHS -->
                <div class="categoria-respuestas" data-categoria="agenda-ingreso-ep" style="background:white; border-radius:12px; margin-bottom:20px; border:2px solid #1976d2;">
                    <div style="background:#1976d2; color:white; padding:15px; border-radius:10px 10px 0 0; cursor:pointer;" onclick="toggleCategoria('agenda-ingreso-ep')">
                        <h3 style="margin:0; font-size:1.3em;">🗓️ Agenda Ingreso Enfermedad Profesional ACHS</h3>
                        <span id="toggle-agenda-ingreso-ep" style="float:right; font-size:1.2em;">▼</span>
                    </div>
                    <div id="content-agenda-ingreso-ep" style="padding:20px;">
                        <div class="respuesta-item" onclick="copiarRespuesta(this)" style="padding:18px; margin:8px 0; border:1px solid #1976d2; border-radius:8px; background:#e3f2fd; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.backgroundColor='#bbdefb'" onmouseout="this.style.backgroundColor='#e3f2fd'">
                            <span class="texto-respuesta">
                                <strong>Asunto:</strong> Agenda Ingreso Enfermedad Profesional ACHS<br><br>
                                Estimado/a [Nombre del paciente]:<br><br>
                                Junto con saludar, hago envío de su cita de ingreso por posible enfermedad profesional / Musculoesquelético / Notificación.<br><br>
                                La cita está agendada para el día [XX de XXXX de 2025] a las [HH:MM horas].<br>
                                Debe presentarse en ejemplo: Vicuña Mackenna 200, cuarto piso.<br>
                                Recuerde llegar 15 minutos antes (CEEP) o 30 minutos antes (Regiones), con su cédula de identidad.<br><br>
                                Ante cualquier duda, puede contactarnos al 600 600 2247, opción 3, subopción 3.<br><br>
                                Se despide cordialmente,<br><br>
                                Ejecutiva de Atención ACHS
                            </span>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- Estadísticas -->
            <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-top:20px; text-align:center; border:1px solid #ddd;">
                <span id="estadisticasRespuestas" style="color:#666; font-size:0.9em;">
                    📊 Total de respuestas: <strong>31</strong> | 📂 Categorías: <strong>7</strong>
                </span>
            </div>
        </div>
    </div>

    <!-- Modal Script EP (Enfermedades Profesionales) -->
    <div id="modalScriptEP" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:2500; justify-content:center; align-items:center;">
        <div id="contenidoScriptEP" style="background:linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border-radius:20px; padding:30px; max-width:1000px; width:95%; max-height:95vh; overflow-y:auto; box-shadow:0 25px 50px rgba(220,53,69,0.4); border:4px solid #dc3545; position:relative; transform:scale(1); transition:transform 0.2s ease;">
            
            <!-- Header destacado -->
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; background:linear-gradient(135deg, #dc3545, #c82333); color:white; padding:20px; border-radius:15px; margin:-30px -30px 25px -30px;">
                <div>
                    <h2 style="margin:0; font-size:2.2em; text-shadow:2px 2px 4px rgba(0,0,0,0.3);">🏥 SCRIPT EP</h2>
                    <p style="margin:5px 0 0 0; font-size:1.1em; opacity:0.9;">Protocolo de Atención para Enfermedades Profesionales</p>
                </div>
                <div style="display:flex; gap:6px; align-items:center;">
                    <button onclick="ajustarZoomModal('contenidoScriptEP', -0.1)" style="background:rgba(255,255,255,0.2); color:white; border:2px solid white; border-radius:6px; width:36px; height:36px; cursor:pointer; font-size:1.2rem; font-weight:bold;" title="Reducir zoom">−</button>
                    <button onclick="ajustarZoomModal('contenidoScriptEP', 0)" style="background:rgba(255,255,255,0.2); color:white; border:2px solid white; border-radius:6px; padding:6px 10px; cursor:pointer; font-size:0.75rem; font-weight:bold;" title="Restablecer zoom">100%</button>
                    <button onclick="ajustarZoomModal('contenidoScriptEP', 0.1)" style="background:rgba(255,255,255,0.2); color:white; border:2px solid white; border-radius:6px; width:36px; height:36px; cursor:pointer; font-size:1.2rem; font-weight:bold;" title="Aumentar zoom">+</button>
                    <button onclick="cerrarModalScriptEP()" style="background:rgba(255,255,255,0.2); color:white; border:2px solid white; border-radius:50%; width:45px; height:45px; cursor:pointer; font-size:1.5em; font-weight:bold; transition:all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">&times;</button>
                </div>
            </div>
            
            <!-- Contenido del script -->
            <div style="line-height:1.7; font-size:1.1em;">
                
                <!-- Sección 1: Clasificación de la enfermedad -->
                <div style="background:#e8f4fd; border-left:6px solid #007bff; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#007bff; margin:0 0 15px 0; font-size:1.4em;">🏥 CLASIFICACIÓN DE LA ENFERMEDAD</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #007bff;">
                        <p style="margin:0 0 15px 0; font-weight:600; background:#ffeb3b; padding:8px; border-radius:4px; color:#000;">"¿Me podría indicar por favor si su posible enfermedad profesional corresponde a la categoría de Salud Mental o es Musculo esquelético (como por ejemplo dolor de hombro, codo, muñeca)?"</p>
                        <p style="margin:15px 0 0 0; font-weight:600;">"¿Había asistido anteriormente a alguna agencia de ACHS por esta misma enfermedad?"</p>
                        <p style="margin:15px 0 0 0; font-weight:600;">"¿En qué región se encuentra ubicado usted?"</p>
                    </div>
                </div>
                
                <!-- Sección 2: Validación de datos -->
                <div style="background:#f0f8e7; border-left:6px solid #28a745; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#28a745; margin:0 0 15px 0; font-size:1.4em;">✅ VALIDACIÓN DE DATOS PERSONALES</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #28a745;">
                        <p style="margin:0 0 10px 0; font-weight:600;">"Perfecto. A continuación, pasaré a validar sus datos personales:"</p>
                        <p style="margin:10px 0; font-weight:600; background:#ffeb3b; padding:8px; border-radius:4px; color:#000;">"¿Su número de teléfono es &lt;XXXXXXXXX&gt;?"</p>
                        <p style="margin:10px 0; font-weight:600; background:#ffeb3b; padding:8px; border-radius:4px; color:#000;">"correo: xxxxx"</p>
                    </div>
                </div>
                
                <!-- Sección 3: Explicación del proceso -->
                <div style="background:#fff3e0; border-left:6px solid #ff9800; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#ff9800; margin:0 0 15px 0; font-size:1.4em;">📋 PROCESO DE ENFERMEDADES PROFESIONALES</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #ff9800;">
                        <p style="margin:0 0 15px 0; font-weight:600;">"Quiero comentarle acerca del proceso de enfermedades profesionales."</p>
                        
                        <p style="margin:10px 0; line-height:1.8;">Primero, será atendido por un <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">médico general</span> y recibirá las indicaciones para su tratamiento. En paralelo, un <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">comité iniciará un estudio</span> por su patología que tomará alrededor de <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">30 días aproximadamente</span>.</p>
                        
                        <p style="margin:10px 0; line-height:1.8;">Esta investigación se realizará para identificar si su patología es de <span style="background:#c8e6c9; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">origen laboral</span>, es decir, ocasionada por el trabajo o de <span style="background:#ffcdd2; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">origen común</span>, enfermedad producto de situaciones externas a lo laboral.</p>
                        
                        <div style="background:#e3f2fd; padding:12px; border-radius:6px; margin:15px 0; border:1px solid #2196f3;">
                            <p style="margin:0; font-weight:600; color:#1976d2;">"¿Se entiende?"</p>
                        </div>
                    </div>
                </div>
                
                <!-- Sección 4: Cobertura según origen -->
                <div style="background:#e8f5e8; border-left:6px solid #4caf50; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#4caf50; margin:0 0 15px 0; font-size:1.4em;">💰 COBERTURA SEGÚN ORIGEN</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #4caf50;">
                        <div style="background:#c8e6c9; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #4caf50;">
                            <p style="margin:0; font-weight:600; color:#2e7d32;">✅ Si su enfermedad es de <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000;">ORIGEN LABORAL</span>, sus atenciones y tratamiento estarán cubiertas por el seguro de la ley.</p>
                        </div>
                        
                        <div style="background:#ffcdd2; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #f44336;">
                            <p style="margin:0; font-weight:600; color:#c62828;">❌ Si su patología es definida de <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000;">ORIGEN COMÚN</span>, los gastos asociados a su atención y tratamiento serán derivados a su previsión de salud (ISAPRE o FONASA).</p>
                        </div>
                        
                        <div style="background:#fff3cd; border:1px solid #ffc107; padding:12px; border-radius:6px;">
                            <p style="margin:0; color:#856404; font-weight:600;">"¿Desea tomar la cita?"</p>
                        </div>
                    </div>
                </div>
                
                <!-- Sección 5: Modalidad de atención -->
                <div style="background:#fce4ec; border-left:6px solid #e91e63; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#e91e63; margin:0 0 15px 0; font-size:1.4em;">� MODALIDAD DE ATENCIÓN</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #e91e63;">
                        <p style="margin:0 0 15px 0; font-weight:600;">"Para su tipo de atención, la modalidad es a través de <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000;">telemedicina</span>."</p>
                        <p style="margin:0; font-weight:600;">"¿Conoce esta modalidad? ¿Se ha atendido previamente por telemedicina?"</p>
                    </div>
                </div>
                
                <!-- Sección 6: Instrucciones importantes -->
                <div style="background:#ffebee; border-left:6px solid #f44336; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#f44336; margin:0 0 15px 0; font-size:1.4em;">⚠️ INSTRUCCIONES IMPORTANTES</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #f44336;">
                        <div style="background:#fff3cd; border:2px solid #ffc107; padding:15px; border-radius:8px; margin-bottom:15px;">
                            <p style="margin:0 0 10px 0; font-weight:bold; color:#856404;">📞 LLAMADA TELEFÓNICA OBLIGATORIA:</p>
                            <p style="margin:0; line-height:1.8;">Ese día también lo llamarán a su celular para hacer su admisión de manera telefónica <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">20 min antes aproximadamente</span>. Por favor esté atento a su teléfono el día de su ingreso y tenga su <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">cédula de identidad a mano</span>.</p>
                        </div>
                        
                        <div style="background:#ffcdd2; border:2px solid #f44336; padding:15px; border-radius:8px; margin-bottom:15px;">
                            <p style="margin:0; font-weight:bold; color:#c62828; text-align:center;">🚨 ESTA LLAMADA ES OBLIGATORIA 🚨</p>
                            <p style="margin:10px 0 0 0; color:#c62828; text-align:center; font-weight:600;">Si no contestan el llamado y se conectan NO SERÁN ATENDIDOS</p>
                        </div>
                        
                        <p style="margin:15px 0; line-height:1.8;">En su atención con el médico, deberá indicar <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">dos testigos de la empresa</span> para su caso, nombre y número de teléfono. A ellos se les realizarán entrevistas de carácter confidencial. Si los testigos no están ese día o no quisieran declarar, se deberá tomar el testimonio a otros testigos que estén presentes ese día.</p>
                        
                        <p style="margin:15px 0 0 0; background:#e3f2fd; padding:10px; border-radius:6px; border:1px solid #2196f3;">📱 Le informo que recibirá un <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">mensaje vía WhatsApp</span> con un video explicativo del proceso de evaluación.</p>
                    </div>
                </div>
                
                <!-- Sección 7: Agendamiento -->
                <div style="background:#e8f5e8; border-left:6px solid #4caf50; padding:20px; margin-bottom:20px; border-radius:10px;">
                    <h3 style="color:#4caf50; margin:0 0 15px 0; font-size:1.4em;">� AGENDAMIENTO</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #4caf50;">
                        <p style="margin:0 0 15px 0; line-height:1.8;">Quiero comentarle que su agendamiento para ingreso de enfermedad profesional de <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">salud mental</span>, tanto para la <span style="background:#c8e6c9; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">consulta médica</span> como para la <span style="background:#c8e6c9; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">cita con el psicólogo</span>, será gestionado y le llegará la información con detalles del día y hora de atención dentro de las próximas <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">24 horas hábiles</span> a su correo electrónico &lt;xxxx@xxx.xx&gt;.</p>
                        
                        <div style="background:#fff3cd; border:1px solid #ffc107; padding:12px; border-radius:6px; margin:15px 0;">
                            <p style="margin:0; color:#856404; font-weight:600;">"¿Tiene alguna preferencia AM (8 AM – 13 PM) o PM (13 PM – 18 PM) de su citación?"</p>
                            <p style="margin:10px 0 0 0; color:#856404;">Intentaremos agendarlo en el bloque que nos indique según disponibilidad.</p>
                            <p style="margin:10px 0 0 0; font-style:italic; color:#666;">Paciente: AM/PM/No tiene preferencia</p>
                        </div>
                        
                        <div style="background:#e3f2fd; border:1px solid #2196f3; padding:12px; border-radius:6px;">
                            <p style="margin:0; color:#1976d2; line-height:1.8;">Le recomiendo que revise su <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">bandeja de entrada</span> de su correo electrónico en 24 horas hábiles, y también la carpeta de <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">"Spam" o "Correo no deseado"</span>, ya que los correos automáticos pueden llegar allí. Este correo debería llegar en la mañana del siguiente día hábil.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Sección 8: Licencias y documentación -->
                <div style="background:#f3e5f5; border-left:6px solid #9c27b0; padding:20px; border-radius:10px;">
                    <h3 style="color:#9c27b0; margin:0 0 15px 0; font-size:1.4em;">📄 LICENCIAS Y DOCUMENTACIÓN</h3>
                    <div style="background:white; padding:15px; border-radius:8px; border:1px solid #9c27b0;">
                        <p style="margin:0 0 15px 0; font-weight:600; background:#ffeb3b; padding:8px; border-radius:4px; color:#000;">"¿Cuenta con licencias rechazadas o algún antecedente de su patología?"</p>
                        
                        <div style="background:#fff3cd; border:1px solid #ffc107; padding:15px; border-radius:8px; margin:15px 0;">
                            <h4 style="color:#856404; margin:0 0 10px 0;">📧 Envío de licencias rechazadas:</h4>
                            <p style="margin:0; color:#856404; line-height:1.8;">Deberá enviar la licencia médica rechazada y la resolución del motivo de rechazo a la casilla <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000; font-weight:bold;">SDTELEMEDICINA@ACHS.CL</span>. Con su nombre y apellido en el asunto del correo.</p>
                        </div>
                        
                        <div style="background:#e3f2fd; border:1px solid #2196f3; padding:15px; border-radius:8px; margin:15px 0;">
                            <h4 style="color:#1976d2; margin:0 0 10px 0;">📎 Medios de prueba:</h4>
                            <p style="margin:0; color:#1976d2; font-weight:600;"><span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000;">MEDIOSDEPRUEBA@ACHS.CL</span></p>
                        </div>
                        
                        <div style="background:#ffebee; border:1px solid #f44336; padding:15px; border-radius:8px;">
                            <p style="margin:0; color:#c62828; font-weight:600;">⚠️ Debe llevar el día de su atención <span style="background:#ffeb3b; padding:2px 6px; border-radius:4px; color:#000;">cualquier antecedente que aporte a su patología</span>.</p>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- Botones de acción -->
            <div style="display:flex; gap:15px; margin-top:25px; justify-content:center; flex-wrap:wrap;">
                <button onclick="imprimirScript()" style="background:linear-gradient(145deg, #007bff, #0056b3); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,123,255,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,123,255,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.3)'">
                    🖨️ Imprimir Script
                </button>
                <button onclick="copiarScript()" style="background:linear-gradient(145deg, #28a745, #1e7e34); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(40,167,69,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40,167,69,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40,167,69,0.3)'">
                    📋 Copiar Script
                </button>
                <button onclick="cerrarModalScriptEP()" style="background:linear-gradient(145deg, #6c757d, #545b62); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(108,117,125,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(108,117,125,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(108,117,125,0.3)'">
                    ❌ Cerrar
                </button>
            </div>
            
        </div>
    </div>


           <!-- Modal de Comunicación (WhatsApp/Teams) -->
    <div id="modalComunicacion" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:3100; justify-content:center; align-items:center;" class="entrada-escena">
        <div style="background:linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius:20px; padding:30px; max-width:900px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 25px 50px rgba(0,0,0,0.3); border:4px solid #25D366; position:relative;" class="desvanecer-elegante escalar-suave">
            
            <!-- Botón de cerrar -->
            <div style="position:absolute; top:15px; right:15px;">
                <button onclick="cerrarModalComunicacion()" style="background:rgba(255,255,255,0.2); color:#25D366; border:2px solid #25D366; border-radius:50%; width:45px; height:45px; cursor:pointer; font-size:1.5em; font-weight:bold; transition:all 0.3s ease;" onmouseover="this.style.background='rgba(37,211,102,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'" class="escalar-suave flotante">&times;</button>
            </div>
            
            <!-- Header del modal -->
            <div style="text-align:center; margin-bottom:30px; padding:20px 0; border-bottom:3px solid #25D366;">
                <h1 style="color:#25D366; font-size:2.2em; font-weight:bold; margin:0; text-shadow:2px 2px 4px rgba(37,211,102,0.2);">
                    📱 ENVIAR REPORTE
                </h1>
                <p style="color:#20BA5A; font-size:1.3em; margin:10px 0 0 0; font-weight:600;">
                    WhatsApp • Microsoft Teams • Email
                </p>
                <div style="background:linear-gradient(90deg, #25D366, #20BA5A); height:4px; width:250px; margin:15px auto; border-radius:2px; box-shadow:0 2px 10px rgba(37,211,102,0.3);"></div>
            </div>
            
            <!-- Contenido principal en dos columnas -->
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-bottom:30px;">
                
                <!-- Columna izquierda: Resúmenes -->
                <div>
                    <h3 style="color:#495057; margin-bottom:15px; display:flex; align-items:center; gap:10px;">
                        <span style="background:#25D366; color:white; padding:5px 10px; border-radius:15px; font-size:0.8em;">VISTA PREVIA</span>
                        📋 Resúmenes Generados
                    </h3>
                    
                    <!-- Resumen corto -->
                    <div style="margin-bottom:20px;">
                        <label style="display:block; font-weight:bold; color:#495057; margin-bottom:8px;">📱 Resumen Corto (WhatsApp):</label>
                        <textarea id="resumenCorto" readonly style="width:100%; height:150px; padding:12px; border:2px solid #25D366; border-radius:8px; font-family:monospace; font-size:0.9em; line-height:1.4; background:#f8f9fa; resize:vertical;"></textarea>
                        <button onclick="copiarReporte('corto')" style="background:#ffc107; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; font-size:0.8em; margin-top:5px;">
                            📋 Copiar
                        </button>
                    </div>
                    
                    <!-- Resumen completo -->
                    <div>
                        <label style="display:block; font-weight:bold; color:#495057; margin-bottom:8px;">📄 Resumen Completo (Teams/Email):</label>
                        <textarea id="resumenCompleto" style="width:100%; height:200px; padding:12px; border:2px solid #6264A7; border-radius:8px; font-family:monospace; font-size:0.9em; line-height:1.4; resize:vertical;"></textarea>
                        <button onclick="copiarReporte('completo')" style="background:#ffc107; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer; font-size:0.8em; margin-top:5px;">
                            📋 Copiar
                        </button>
                    </div>
                </div>
                
                <!-- Columna derecha: Opciones de envío -->
                <div>
                    <h3 style="color:#495057; margin-bottom:15px; display:flex; align-items:center; gap:10px;">
                        <span style="background:#6264A7; color:white; padding:5px 10px; border-radius:15px; font-size:0.8em;">ENVIAR</span>
                        🚀 Opciones de Comunicación
                    </h3>
                    
                    <!-- WhatsApp -->
                    <div style="background:#f8f9fa; border:2px solid #25D366; border-radius:12px; padding:20px; margin-bottom:20px;">
                        <h4 style="color:#25D366; margin:0 0 15px 0; display:flex; align-items:center; gap:8px;">
                            📱 WhatsApp
                        </h4>
                        
                        <div style="margin-bottom:15px;">
                            <button onclick="enviarPorWhatsApp('corto')" style="background:linear-gradient(145deg, #25D366, #20BA5A); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(37,211,102,0.3); width:100%; margin-bottom:10px;">
                                💬 Enviar Resumen Corto
                            </button>
                            <button onclick="enviarPorWhatsApp('completo')" style="background:linear-gradient(145deg, #128C7E, #25D366); color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(18,140,126,0.3); width:100%;">
                                📄 Enviar Resumen Completo
                            </button>
                        </div>
                        
                        <div style="border-top:1px solid #ddd; padding-top:15px;">
                            <label style="display:block; font-weight:bold; color:#495057; margin-bottom:8px; font-size:0.9em;">
                                📞 Enviar a número específico:
                            </label>
                            <div style="display:flex; gap:10px;">
                                <input type="tel" id="numeroWhatsApp" placeholder="+56 9 1234 5678" style="flex:1; padding:8px 12px; border:1px solid #ddd; border-radius:6px; font-size:0.9em;">
                                <button onclick="enviarWhatsAppANumero()" style="background:#25D366; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9em; font-weight:600;">
                                    Enviar
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Microsoft Teams -->
                    <div style="background:#f8f9fa; border:2px solid #6264A7; border-radius:12px; padding:20px; margin-bottom:20px;">
                        <h4 style="color:#6264A7; margin:0 0 15px 0; display:flex; align-items:center; gap:8px;">
                            💼 Microsoft Teams
                        </h4>
                        <button onclick="enviarPorTeams()" style="background:linear-gradient(145deg, #6264A7, #464775); color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(98,100,167,0.3); width:100%;">
                            🚀 Abrir en Teams
                        </button>
                        <p style="color:#666; font-size:0.8em; margin:10px 0 0 0; text-align:center;">
                            Se abrirá Teams con el mensaje preparado
                        </p>
                    </div>
                    
                    <!-- Email -->
                    <div style="background:#f8f9fa; border:2px solid #0078D4; border-radius:12px; padding:20px;">
                        <h4 style="color:#0078D4; margin:0 0 15px 0; display:flex; align-items:center; gap:8px;">
                            📧 Email
                        </h4>
                        <button onclick="enviarPorEmail()" style="background:linear-gradient(145deg, #0078D4, #106EBE); color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,120,212,0.3); width:100%;">
                            ✉️ Abrir Cliente Email
                        </button>
                        <p style="color:#666; font-size:0.8em; margin:10px 0 0 0; text-align:center;">
                            Se abrirá tu cliente de email predeterminado
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Botones finales -->
            <div style="text-align:center; padding:20px 0; border-top:2px solid #25D366; margin-top:20px;">
                <button onclick="generarResumenParaEnvio()" style="background:linear-gradient(145deg, #17a2b8, #138496); color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(23,162,184,0.3); margin-right:15px;">
                    🔄 Actualizar Resúmenes
                </button>
                <button onclick="cerrarModalComunicacion()" style="background:linear-gradient(145deg, #6c757d, #545b62); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(108,117,125,0.3);">
                    ❌ Cerrar
                </button>
            </div>
            
        </div>
        </div>
    
        <!-- Modal Base de Conocimientos (Wiki Interna) -->
        <div id="modalBaseConocimientos" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:3200; justify-content:center; align-items:center;" class="entrada-escena">
            <div style="background:white; border-radius:20px; width:95%; max-width:1200px; height:90%; box-shadow:0 25px 50px rgba(0,0,0,0.3); overflow:hidden; display:flex; flex-direction:column; animation:slideInFromTop 0.5s ease-out;">
                
                <!-- Header del Modal -->
                <div style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding:20px; color:white; position:relative;">
                    <button onclick="cerrarModalBaseConocimientos()" style="position:absolute; top:15px; right:20px; background:rgba(255,255,255,0.2); border:none; color:white; font-size:24px; cursor:pointer; border-radius:50%; width:40px; height:40px; display:flex; align-items:center; justify-content:center; transition:all 0.3s ease;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        ×
                    </button>
                    <h2 style="margin:0; font-size:1.8rem; display:flex; align-items:center; gap:12px;">
                        📚 Base de Conocimientos ACHS
                    </h2>
                    <p style="margin:8px 0 0 0; opacity:0.9; font-size:1rem;">
                        Wiki Interna Colaborativa - Gestión del Conocimiento
                    </p>
                </div>
    
                <!-- Barra de Navegación -->
                <div style="background:#f8f9fa; border-bottom:2px solid #dee2e6; padding:15px 20px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                    <button id="btnNuevoArticulo" onclick="crearNuevoArticulo()" style="background:linear-gradient(145deg, #28a745, #20c997); color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; display:flex; align-items:center; gap:6px;">
                        ✏️ Nuevo Artículo
                    </button>
                    <button onclick="exportarWiki()" style="background:linear-gradient(145deg, #17a2b8, #20c997); color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; display:flex; align-items:center; gap:6px;">
                        📤 Exportar
                    </button>
                    <button onclick="importarWiki()" style="background:linear-gradient(145deg, #ffc107, #fd7e14); color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; display:flex; align-items:center; gap:6px;">
                        📥 Importar
                    </button>
                    <button onclick="abrirConvertidorPDF()" style="background:linear-gradient(145deg, #6f42c1, #5a32a3); color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; display:flex; align-items:center; gap:6px;">
                        📄 PDF a JSON
                    </button>
                    <input type="file" id="inputImportarWiki" accept=".json" style="display:none;" onchange="procesarImportacion(this)">
                    
                    <!-- Buscador -->
                    <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
                        <input type="text" id="buscadorWiki" placeholder="🔍 Buscar artículos..." style="padding:8px 12px; border:2px solid #dee2e6; border-radius:6px; font-size:0.9rem; width:200px;" oninput="buscarArticulos()">
                        <select id="filtroCategoria" onchange="filtrarPorCategoria()" style="padding:8px; border:2px solid #dee2e6; border-radius:6px; font-size:0.9rem;">
                            <option value="">Todas las categorías</option>
                            <option value="general">📋 General</option>
                            <option value="procedimientos">⚙️ Procedimientos</option>
                            <option value="politicas">📜 Políticas</option>
                            <option value="herramientas">🛠️ Herramientas</option>
                            <option value="faq">❓ FAQ</option>
                        </select>
                        <select id="filtroTipoDocumento" onchange="filtrarPorTipoDocumento()" style="padding:8px; border:2px solid #dee2e6; border-radius:6px; font-size:0.9rem;">
                            <option value="">Todos los tipos</option>
                            <option value="JSON">📄 JSON</option>
                            <option value="WORD">📝 WORD</option>
                            <option value="PDF">📋 PDF</option>
                            <option value="MANUAL">✏️ Manual</option>
                        </select>
                    </div>
                </div>
    
                <!-- Contenido Principal -->
                <div style="flex:1; display:flex; overflow:hidden;">
                    
                    <!-- Panel Izquierdo - Lista de Artículos -->
                    <div style="width:350px; background:#f8f9fa; border-right:2px solid #dee2e6; display:flex; flex-direction:column;">
                        
                        <!-- Estadísticas -->
                        <div id="estadisticasWiki" style="padding:15px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white;">
                            <h4 style="margin:0 0 8px 0; font-size:1rem;">📊 Estadísticas</h4>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:0.85rem;">
                                <div>📄 <span id="totalArticulos">0</span> artículos</div>
                                <div>👀 <span id="totalVistas">0</span> vistas</div>
                                <div>💬 <span id="totalComentarios">0</span> comentarios</div>
                                <div>📅 <span id="ultimaActualizacion">-</span></div>
                            </div>
                        </div>
                        
                        <!-- Lista de Artículos -->
                        <div style="flex:1; overflow-y:auto; padding:10px;">
                            <div id="listaArticulos" style="display:flex; flex-direction:column; gap:8px;">
                                <!-- Los artículos se cargarán aquí dinámicamente -->
                            </div>
                        </div>
                    </div>
    
                    <!-- Panel Central - Contenido del Artículo -->
                    <div style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
                        
                        <!-- Vista de Artículo -->
                        <div id="vistaArticulo" style="flex:1; overflow-y:auto; padding:0;">
                            <div style="padding:30px; text-align:center; color:#6c757d; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                                <div style="font-size:4rem; margin-bottom:20px;">📚</div>
                                <h3 style="color:#495057; margin-bottom:15px;">Base de Conocimientos ACHS</h3>
                                <p style="font-size:1.1rem; line-height:1.6; max-width:500px;">
                                    Selecciona un artículo de la lista para verlo, o crea uno nuevo para comenzar a construir nuestra base de conocimientos colaborativa.
                                </p>
                                <button onclick="crearNuevoArticulo()" style="background:linear-gradient(145deg, #667eea, #764ba2); color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:600; margin-top:20px; transition:all 0.3s ease;">
                                    ✏️ Crear Primer Artículo
                                </button>
                            </div>
                        </div>
    
                        <!-- Editor de Artículo -->
                        <div id="editorArticulo" style="display:none; flex:1; flex-direction:column; overflow:hidden;">
                            <div style="padding:20px; border-bottom:2px solid #dee2e6; background:#f8f9fa;">
                                <div style="display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap;">
                                    <input type="text" id="tituloEditor" placeholder="Título del artículo..." style="flex:1; padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1.1rem; font-weight:600; min-width:300px;">
                                    <select id="categoriaEditor" style="padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                                        <option value="general">📋 General</option>
                                        <option value="procedimientos">⚙️ Procedimientos</option>
                                        <option value="politicas">📜 Políticas</option>
                                        <option value="herramientas">🛠️ Herramientas</option>
                                        <option value="faq">❓ FAQ</option>
                                    </select>
                                    <select id="tipoDocumentoEditor" style="padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                                        <option value="JSON">📄 JSON</option>
                                        <option value="WORD">📝 WORD</option>
                                        <option value="PDF">📋 PDF</option>
                                        <option value="MANUAL">✏️ Manual</option>
                                    </select>
                                </div>
                                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                    <button onclick="guardarArticulo()" style="background:linear-gradient(145deg, #28a745, #20c997); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600; transition:all 0.3s ease;">
                                        💾 Guardar
                                    </button>
                                    <button onclick="cancelarEdicion()" style="background:linear-gradient(145deg, #6c757d, #5a6268); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600; transition:all 0.3s ease;">
                                        ❌ Cancelar
                                    </button>
                                    <button onclick="previsualizarArticulo()" style="background:linear-gradient(145deg, #17a2b8, #138496); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600; transition:all 0.3s ease;">
                                        👁️ Preview
                                    </button>
                                </div>
                            </div>
                            <textarea id="contenidoEditor" placeholder="Escribe el contenido del artículo aquí...
    
    Tips:
    - Usa **texto** para negritas
    - Usa *texto* para cursivas  
    - Usa # Título para encabezados
    - Usa - Item para listas
    - Usa [enlace](url) para enlaces" style="flex:1; padding:20px; border:none; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size:1rem; line-height:1.6; resize:none; outline:none;"></textarea>
                        </div>
                    </div>
    
                    <!-- Panel Derecho - Información del Artículo -->
                    <div id="panelInfo" style="width:300px; background:#f8f9fa; border-left:2px solid #dee2e6; display:none; flex-direction:column; overflow-y:auto;">
                        
                        <!-- Información del Artículo -->
                        <div style="padding:20px; border-bottom:1px solid #dee2e6;">
                            <h4 style="margin:0 0 15px 0; color:#495057; display:flex; align-items:center; gap:8px;">
                                ℹ️ Información
                            </h4>
                            <div id="infoArticulo" style="font-size:0.9rem; color:#6c757d; line-height:1.5;">
                                <!-- Información se cargará aquí -->
                            </div>
                        </div>
    
                        <!-- Acciones -->
                        <div style="padding:20px; border-bottom:1px solid #dee2e6;">
                            <h4 style="margin:0 0 15px 0; color:#495057; display:flex; align-items:center; gap:8px;">
                                ⚡ Acciones
                            </h4>
                            <div style="display:flex; flex-direction:column; gap:8px;">
                                <button onclick="editarArticulo()" style="background:linear-gradient(145deg, #ffc107, #e0a800); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease;">
                                    ✏️ Editar
                                </button>
                                <button onclick="duplicarArticulo()" style="background:linear-gradient(145deg, #6f42c1, #5a32a3); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease;">
                                    📋 Duplicar
                                </button>
                                <button onclick="compartirArticulo()" style="background:linear-gradient(145deg, #17a2b8, #138496); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease;">
                                    📤 Compartir
                                </button>
                                <button onclick="imprimirArticulo()" style="background:linear-gradient(145deg, #6c757d, #5a6268); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease;">
                                    🖨️ Imprimir
                                </button>
                                <button onclick="eliminarArticulo()" style="background:linear-gradient(145deg, #dc3545, #c82333); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease;">
                                    🗑️ Eliminar
                                </button>
                            </div>
                        </div>
    
                        <!-- Comentarios -->
                        <div style="flex:1; padding:20px;">
                            <h4 style="margin:0 0 15px 0; color:#495057; display:flex; align-items:center; gap:8px;">
                                💬 Comentarios
                            </h4>
                            
                            <!-- Nuevo Comentario -->
                            <div style="margin-bottom:15px;">
                                <textarea id="nuevoComentario" placeholder="Escribe un comentario..." style="width:100%; padding:8px; border:2px solid #dee2e6; border-radius:6px; font-size:0.9rem; resize:vertical; min-height:60px; font-family:inherit;"></textarea>
                                <button onclick="agregarComentario()" style="background:linear-gradient(145deg, #28a745, #20c997); color:white; border:none; padding:6px 12px; border-radius:4px; cursor:pointer; font-size:0.8rem; font-weight:600; margin-top:8px; width:100%; transition:all 0.3s ease;">
                                    💬 Agregar Comentario
                                </button>
                            </div>
    
                            <!-- Lista de Comentarios -->
                            <div id="listaComentarios" style="display:flex; flex-direction:column; gap:10px;">
                                <!-- Los comentarios se cargarán aquí -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Modal Convertidor PDF a JSON -->
        <div id="modalConvertidorPDF" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:3300; justify-content:center; align-items:center;" class="entrada-escena">
            <div style="background:white; border-radius:20px; width:90%; max-width:800px; max-height:90vh; box-shadow:0 25px 50px rgba(0,0,0,0.3); overflow:hidden; display:flex; flex-direction:column;">
                
                <!-- Header del Modal -->
                <div style="background:linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); padding:20px; color:white; position:relative;">
                    <button onclick="cerrarModalConvertidor()" style="position:absolute; top:15px; right:20px; background:rgba(255,255,255,0.2); border:none; color:white; font-size:24px; cursor:pointer; border-radius:50%; width:40px; height:40px; display:flex; align-items:center; justify-content:center; transition:all 0.3s ease;">
                        ×
                    </button>
                    <h2 style="margin:0; font-size:1.8rem; display:flex; align-items:center; gap:12px;">
                        📄 Convertidor PDF a JSON
                    </h2>
                    <p style="margin:8px 0 0 0; opacity:0.9; font-size:1rem;">
                        Convierte documentos PDF en artículos para la Base de Conocimientos
                    </p>
                </div>
    
                <!-- Contenido del Modal -->
                <div style="flex:1; padding:30px; overflow-y:auto;">
                    
                    <!-- Paso 1: Seleccionar archivo -->
                    <div class="paso-convertidor" id="paso1" style="margin-bottom:30px;">
                        <h3 style="color:#6f42c1; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                            📁 Paso 1: Selecciona tu archivo PDF
                        </h3>
                        <div style="border:2px dashed #6f42c1; border-radius:12px; padding:40px; text-align:center; background:#f8f9ff;">
                            <div style="font-size:3rem; margin-bottom:15px;">📄</div>
                            <input type="file" id="inputPDF" accept=".pdf" style="display:none;" onchange="procesarPDF(this)">
                            <button onclick="document.getElementById('inputPDF').click()" style="background:linear-gradient(145deg, #6f42c1, #5a32a3); color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:600; margin-bottom:10px;">
                                📁 Seleccionar PDF
                            </button>
                            <p style="color:#6c757d; margin:10px 0 0 0; font-size:0.9rem;">
                                O arrastra y suelta tu archivo PDF aquí
                            </p>
                        </div>
                    </div>
    
                    <!-- Paso 2: Información del artículo -->
                    <div class="paso-convertidor" id="paso2" style="display:none; margin-bottom:30px;">
                        <h3 style="color:#6f42c1; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                            ✏️ Paso 2: Completa la información del artículo
                        </h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
                            <div>
                                <label style="display:block; font-weight:600; margin-bottom:8px; color:#495057;">Título del artículo:</label>
                                <input type="text" id="tituloConvertidor" placeholder="Ej: Manual de Procedimientos SNL" style="width:100%; padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                            </div>
                            <div>
                                <label style="display:block; font-weight:600; margin-bottom:8px; color:#495057;">Categoría:</label>
                                <select id="categoriaConvertidor" style="width:100%; padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                                    <option value="general">📋 General</option>
                                    <option value="procedimientos">⚙️ Procedimientos</option>
                                    <option value="politicas">📜 Políticas</option>
                                    <option value="herramientas">🛠️ Herramientas</option>
                                    <option value="faq">❓ FAQ</option>
                                </select>
                            </div>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px; margin-bottom:20px;">
                            <div>
                                <label style="display:block; font-weight:600; margin-bottom:8px; color:#495057;">Tipo de Documento:</label>
                                <select id="tipoDocumentoConvertidor" style="width:100%; padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                                    <option value="PDF">📋 PDF</option>
                                    <option value="WORD">📝 WORD</option>
                                    <option value="JSON">📄 JSON</option>
                                    <option value="MANUAL">✏️ Manual</option>
                                </select>
                            </div>
                            <div>
                                <label style="display:block; font-weight:600; margin-bottom:8px; color:#495057;">Prioridad:</label>
                                <select id="prioridadConvertidor" style="width:100%; padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                                    <option value="normal">📄 Normal</option>
                                    <option value="importante">⭐ Importante</option>
                                    <option value="urgente">🔥 Urgente</option>
                                </select>
                            </div>
                            <div>
                                <label style="display:block; font-weight:600; margin-bottom:8px; color:#495057;">Tags (separados por comas):</label>
                                <input type="text" id="tagsConvertidor" placeholder="Ej: SNL, manual, procedimiento" style="width:100%; padding:12px; border:2px solid #dee2e6; border-radius:6px; font-size:1rem;">
                            </div>
                        </div>
                    </div>
    
                    <!-- Paso 3: Vista previa del contenido -->
                    <div class="paso-convertidor" id="paso3" style="display:none; margin-bottom:30px;">
                        <h3 style="color:#6f42c1; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                            👁️ Paso 3: Vista previa del contenido extraído
                        </h3>
                        <div style="background:#f8f9fa; border:2px solid #dee2e6; border-radius:8px; padding:20px; max-height:300px; overflow-y:auto;">
                            <div id="contenidoExtraido" style="white-space:pre-wrap; font-family:monospace; font-size:0.9rem; line-height:1.5;">
                                <!-- El contenido extraído aparecerá aquí -->
                            </div>
                        </div>
                        <p style="color:#6c757d; font-size:0.9rem; margin-top:10px;">
                            💡 Puedes editar este contenido antes de generar el JSON
                        </p>
                    </div>
    
                    <!-- Botones de acción -->
                    <div style="display:flex; gap:12px; justify-content:flex-end; align-items:center; padding-top:20px; border-top:1px solid #dee2e6;">
                        <span id="estadoConversion" style="color:#6c757d; font-size:0.9rem; flex:1;"></span>
                        <button onclick="cerrarModalConvertidor()" style="background:#6c757d; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600;">
                            ❌ Cancelar
                        </button>
                        <button id="btnGenerarJSON" onclick="generarJSONDesdeTexto()" style="display:none; background:linear-gradient(145deg, #28a745, #20c997); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600;">
                            🔄 Generar JSON
                        </button>
                        <button id="btnDescargarJSON" onclick="descargarJSON()" style="display:none; background:linear-gradient(145deg, #17a2b8, #138496); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; font-weight:600;">
                            💾 Descargar JSON
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Reclamos y Quejas -->
        <div id="modalReclamo" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); z-index:3400; justify-content:center; align-items:center;" class="entrada-escena">
            <div style="background:linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius:20px; padding:30px; max-width:1000px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 25px 50px rgba(0,0,0,0.3); border:4px solid #dc3545; position:relative;" class="desvanecer-elegante escalar-suave">
                
                <!-- Botón de cerrar -->
                <div style="position:absolute; top:15px; right:15px; z-index:3500;">
                    <button onclick="console.log('🔄 Botón X clickeado'); cerrarModalReclamo();" style="background:rgba(255,255,255,0.9); color:#dc3545; border:2px solid #dc3545; border-radius:50%; width:45px; height:45px; cursor:pointer; font-size:1.5em; font-weight:bold; transition:all 0.3s ease; z-index:3501;" onmouseover="this.style.background='rgba(220,53,69,0.1)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='rgba(255,255,255,0.9)'; this.style.transform='scale(1)'" class="escalar-suave flotante">&times;</button>
                </div>
                
                <!-- Header del modal -->
                <div style="text-align:center; margin-bottom:30px; padding:20px 0; border-bottom:3px solid #dc3545;">
                    <h1 style="color:#dc3545; font-size:2.2em; font-weight:bold; margin:0; text-shadow:2px 2px 4px rgba(220,53,69,0.2);">
                        📢 Sistema de Reclamos y Quejas
                    </h1>
                    <p style="color:#6c757d; margin:10px 0 0 0; font-size:1.1em; opacity:0.9;">
                        Complete el formulario para registrar y enviar su reclamo o queja
                    </p>
                </div>
                
                <!-- Formulario de Reclamo -->
                <div style="padding:0 20px;">
                    
                    <!-- Información del Cliente -->
                    <div style="background:#fff3cd; border-radius:12px; padding:25px; margin-bottom:25px; border-left:5px solid #ffc107;">
                        <h3 style="color:#856404; margin:0 0 20px 0; font-size:1.3em; display:flex; align-items:center; gap:10px;">
                            👤 Información del Cliente
                        </h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:15px;">
                            <div>
                                <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">Nombre Completo:</label>
                                <input type="text" id="nombreCliente" placeholder="Ingrese nombre completo del cliente" style="width:100%; padding:12px; border:2px solid #ffc107; border-radius:8px; font-size:1rem;">
                            </div>
                            <div>
                                <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">RUT:</label>
                                <input type="text" id="rutCliente" placeholder="12.345.678-9" style="width:100%; padding:12px; border:2px solid #ffc107; border-radius:8px; font-size:1rem;">
                            </div>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                            <div>
                                <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">Teléfono:</label>
                                <input type="tel" id="telefonoCliente" placeholder="+56 9 1234 5678" style="width:100%; padding:12px; border:2px solid #ffc107; border-radius:8px; font-size:1rem;">
                            </div>
                            <div>
                                <label style="color:#856404; font-weight:bold; display:block; margin-bottom:5px;">Email:</label>
                                <input type="email" id="emailCliente" placeholder="cliente@correo.com" style="width:100%; padding:12px; border:2px solid #ffc107; border-radius:8px; font-size:1rem;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles del Reclamo -->
                    <div style="background:#f8d7da; border-radius:12px; padding:25px; margin-bottom:25px; border-left:5px solid #dc3545;">
                        <h3 style="color:#721c24; margin:0 0 20px 0; font-size:1.3em; display:flex; align-items:center; gap:10px;">
                            📝 Detalles del Reclamo/Queja
                        </h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
                            <div>
                                <label style="color:#721c24; font-weight:bold; display:block; margin-bottom:5px;">Tipo de Reclamo:</label>
                                <select id="tipoReclamo" style="width:100%; padding:12px; border:2px solid #dc3545; border-radius:8px; font-size:1rem;">
                                    <option value="">Seleccione tipo de reclamo</option>
                                    <option value="atencion_deficiente">Atención Deficiente</option>
                                    <option value="demora_atencion">Demora en Atención</option>
                                    <option value="error_administrativo">Error Administrativo</option>
                                    <option value="problema_medico">Problema Médico</option>
                                    <option value="facturacion">Problema de Facturación</option>
                                    <option value="sistema_tecnologico">Sistema Tecnológico</option>
                                    <option value="instalaciones">Instalaciones</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                            <div>
                                <label style="color:#721c24; font-weight:bold; display:block; margin-bottom:5px;">Prioridad:</label>
                                <select id="prioridadReclamo" style="width:100%; padding:12px; border:2px solid #dc3545; border-radius:8px; font-size:1rem;">
                                    <option value="baja">🟢 Baja</option>
                                    <option value="media" selected>🟡 Media</option>
                                    <option value="alta">🟠 Alta</option>
                                    <option value="urgente">🔴 Urgente</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-bottom:20px;">
                            <label style="color:#721c24; font-weight:bold; display:block; margin-bottom:5px;">Descripción del Reclamo:</label>
                            <textarea id="descripcionReclamo" rows="4" placeholder="Describa detalladamente su reclamo o queja..." style="width:100%; padding:12px; border:2px solid #dc3545; border-radius:8px; font-size:1rem; resize:vertical;"></textarea>
                        </div>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
                            <div>
                                <label style="color:#721c24; font-weight:bold; display:block; margin-bottom:5px;">Fecha del Incidente:</label>
                                <input type="date" id="fechaIncidente" style="width:100%; padding:12px; border:2px solid #dc3545; border-radius:8px; font-size:1rem;">
                            </div>
                            <div>
                                <label style="color:#721c24; font-weight:bold; display:block; margin-bottom:5px;">Área/Departamento:</label>
                                <select id="areaDepartamento" style="width:100%; padding:12px; border:2px solid #dc3545; border-radius:8px; font-size:1rem;">
                                    <option value="">Seleccione área</option>
                                    <option value="contact_center">Contact Center</option>
                                    <option value="atencion_medica">Atención Médica</option>
                                    <option value="administracion">Administración</option>
                                    <option value="farmacia">Farmacia</option>
                                    <option value="examenes">Exámenes</option>
                                    <option value="urgencias">Urgencias</option>
                                    <option value="hospitalizacion">Hospitalización</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Información Interna -->
                    <div style="background:#d1ecf1; border-radius:12px; padding:25px; margin-bottom:25px; border-left:5px solid #17a2b8;">
                        <h3 style="color:#0c5460; margin:0 0 20px 0; font-size:1.3em; display:flex; align-items:center; gap:10px;">
                            🏢 Información Interna (ACHS)
                        </h3>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:15px;">
                            <div>
                                <label style="color:#0c5460; font-weight:bold; display:block; margin-bottom:5px;">Ejecutivo que Recibe:</label>
                                <input type="text" id="ejecutivoRecibe" placeholder="Nombre del ejecutivo" style="width:100%; padding:12px; border:2px solid #17a2b8; border-radius:8px; font-size:1rem;">
                            </div>
                            <div>
                                <label style="color:#0c5460; font-weight:bold; display:block; margin-bottom:5px;">Número de Caso:</label>
                                <input type="text" id="numeroCaso" placeholder="CASO-2024-XXXX" style="width:100%; padding:12px; border:2px solid #17a2b8; border-radius:8px; font-size:1rem;">
                            </div>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="color:#0c5460; font-weight:bold; display:block; margin-bottom:5px;">Observaciones Internas:</label>
                            <textarea id="observacionesInternas" rows="3" placeholder="Observaciones adicionales para uso interno..." style="width:100%; padding:12px; border:2px solid #17a2b8; border-radius:8px; font-size:1rem; resize:vertical;"></textarea>
                        </div>
                        <div>
                            <label style="color:#0c5460; font-weight:bold; display:block; margin-bottom:5px;">Estado del Reclamo:</label>
                            <select id="estadoReclamo" style="width:100%; padding:12px; border:2px solid #17a2b8; border-radius:8px; font-size:1rem;">
                                <option value="recibido" selected>📥 Recibido</option>
                                <option value="en_proceso">⏳ En Proceso</option>
                                <option value="escalado">⬆️ Escalado</option>
                                <option value="resuelto">✅ Resuelto</option>
                                <option value="cerrado">🔒 Cerrado</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Botones de Acción -->
                    <div style="display:flex; gap:15px; justify-content:center; margin-top:30px; padding-top:20px; border-top:2px solid #dee2e6;">
                        <button onclick="limpiarFormularioReclamo()" style="background:linear-gradient(145deg, #6c757d, #545b62); color:white; border:none; padding:15px 30px; border-radius:10px; cursor:pointer; font-size:1.1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(108,117,125,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(108,117,125,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(108,117,125,0.3)'">
                            🧹 Limpiar Formulario
                        </button>
                        <button onclick="guardarReclamo()" style="background:linear-gradient(145deg, #ffc107, #e0a800); color:#856404; border:none; padding:15px 30px; border-radius:10px; cursor:pointer; font-size:1.1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(255,193,7,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,193,7,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,193,7,0.3)'">
                            💾 Guardar Reclamo
                        </button>
                        <button onclick="enviarReclamoTeams()" style="background:linear-gradient(145deg, #6264A7, #464775); color:white; border:none; padding:15px 30px; border-radius:10px; cursor:pointer; font-size:1.1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(98,100,167,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(98,100,167,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(98,100,167,0.3)'">
                            📤 Enviar por Teams
                        </button>
                        <button onclick="enviarReclamoEmail()" style="background:linear-gradient(145deg, #dc3545, #c82333); color:white; border:none; padding:15px 30px; border-radius:10px; cursor:pointer; font-size:1.1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(220,53,69,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220,53,69,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(220,53,69,0.3)'">
                            📧 Enviar por Email
                        </button>
                    </div>
                </div>
            </div>
        </div>

    <!-- Modal Sistema de Respaldos -->
    <div id="modalRespaldo" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.6); z-index:2500; justify-content:center; align-items:center;">
        <div style="background:linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius:20px; padding:30px; max-width:900px; width:95%; max-height:90vh; overflow-y:auto; box-shadow:0 25px 50px rgba(111,66,193,0.4); border:4px solid #6f42c1; position:relative;">
            
            <!-- Botón de cerrar -->
            <div style="position:absolute; top:15px; right:15px;">
                <button onclick="cerrarModalRespaldo()" style="background:rgba(255,255,255,0.2); color:#6f42c1; border:2px solid #6f42c1; border-radius:50%; width:45px; height:45px; cursor:pointer; font-size:1.5em; font-weight:bold; transition:all 0.3s ease;" onmouseover="this.style.background='rgba(111,66,193,0.1)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">&times;</button>
            </div>
            
            <!-- Header del modal -->
            <div style="text-align:center; margin-bottom:30px; padding:20px 0; border-bottom:3px solid #6f42c1;">
                <h1 style="color:#6f42c1; margin:0; font-size:2.2em; font-weight:bold; text-shadow:2px 2px 4px rgba(111,66,193,0.2);">
                    💾 SISTEMA DE RESPALDOS ACHS
                </h1>
                <p style="color:#6c757d; margin:10px 0 0; font-size:1.1em; font-weight:500;">
                    Gestión avanzada de backup y recuperación de datos
                </p>
            </div>
            
            <!-- Estadísticas del sistema -->
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-bottom:30px;">
                <div style="background:linear-gradient(145deg, #e3f2fd, #bbdefb); padding:20px; border-radius:12px; text-align:center; border:2px solid #2196f3;">
                    <div style="font-size:2em; color:#1976d2; margin-bottom:8px;">📊</div>
                    <div style="font-size:1.8em; font-weight:bold; color:#1976d2;" id="totalRegistros">0</div>
                    <div style="color:#555; font-weight:500;">Registros Totales</div>
                </div>
                <div style="background:linear-gradient(145deg, #e8f5e8, #c8e6c9); padding:20px; border-radius:12px; text-align:center; border:2px solid #4caf50;">
                    <div style="font-size:2em; color:#388e3c; margin-bottom:8px;">💾</div>
                    <div style="font-size:1.8em; font-weight:bold; color:#388e3c;" id="ultimoRespaldo">Nunca</div>
                    <div style="color:#555; font-weight:500;">Último Respaldo</div>
                </div>
                <div style="background:linear-gradient(145deg, #fff3e0, #ffe0b2); padding:20px; border-radius:12px; text-align:center; border:2px solid #ff9800;">
                    <div style="font-size:2em; color:#f57c00; margin-bottom:8px;">📁</div>
                    <div style="font-size:1.8em; font-weight:bold; color:#f57c00;" id="tamanoData">0 KB</div>
                    <div style="color:#555; font-weight:500;">Tamaño de Datos</div>
                </div>
            </div>
            
            <!-- Controles de respaldo -->
            <div style="background:#f8f9fa; border-radius:15px; padding:25px; margin-bottom:25px; border-left:6px solid #6f42c1;">
                <h3 style="color:#6f42c1; margin:0 0 20px; font-size:1.3em; font-weight:600;">🔧 Controles de Respaldo</h3>
                
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:15px; margin-bottom:20px;">
                    <button onclick="crearRespaldoCompleto()" style="background:linear-gradient(145deg, #28a745, #20c997); color:white; border:none; padding:15px 20px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(40,167,69,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40,167,69,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40,167,69,0.3)'">
                        📦 Respaldo Completo
                    </button>
                    
                    <button onclick="crearRespaldoRapido()" style="background:linear-gradient(145deg, #007bff, #0056b3); color:white; border:none; padding:15px 20px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,123,255,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,123,255,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,123,255,0.3)'">
                        ⚡ Respaldo Rápido
                    </button>
                    
                    <button onclick="programarRespaldoAutomatico()" style="background:linear-gradient(145deg, #ffc107, #e0a800); color:#212529; border:none; padding:15px 20px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(255,193,7,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,193,7,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,193,7,0.3)'">
                        ⏰ Programar Auto
                    </button>
                    
                    <button onclick="restaurarRespaldo()" style="background:linear-gradient(145deg, #dc3545, #c82333); color:white; border:none; padding:15px 20px; border-radius:10px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(220,53,69,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220,53,69,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(220,53,69,0.3)'">
                        🔄 Restaurar
                    </button>
                </div>
            </div>
            
            <!-- Configuración de respaldo automático -->
            <div style="background:#e3f2fd; border-radius:15px; padding:25px; margin-bottom:25px; border-left:6px solid #2196f3;">
                <h3 style="color:#1976d2; margin:0 0 20px; font-size:1.3em; font-weight:600;">⚙️ Configuración Automática</h3>
                
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px;">
                    <div>
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#1976d2;">📅 Frecuencia:</label>
                        <select id="frecuenciaRespaldo" style="width:100%; padding:10px; border:2px solid #2196f3; border-radius:8px; font-size:1em;">
                            <option value="diario">Diario</option>
                            <option value="semanal" selected>Semanal</option>
                            <option value="mensual">Mensual</option>
                            <option value="manual">Solo Manual</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="display:block; margin-bottom:8px; font-weight:600; color:#1976d2;">⏰ Hora:</label>
                        <input type="time" id="horaRespaldo" value="02:00" style="width:100%; padding:10px; border:2px solid #2196f3; border-radius:8px; font-size:1em;">
                    </div>
                </div>
                
                <div style="margin-bottom:15px;">
                    <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                        <input type="checkbox" id="notificarRespaldo" checked style="transform:scale(1.2);">
                        <span style="font-weight:500; color:#1976d2;">📧 Notificar cuando se complete el respaldo</span>
                    </label>
                </div>
                
                <div>
                    <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                        <input type="checkbox" id="comprimirRespaldo" checked style="transform:scale(1.2);">
                        <span style="font-weight:500; color:#1976d2;">🗜️ Comprimir respaldos para ahorrar espacio</span>
                    </label>
                </div>
            </div>
            
            <!-- Historial de respaldos -->
            <div style="background:#fff; border-radius:15px; padding:25px; border:2px solid #dee2e6;">
                <h3 style="color:#6f42c1; margin:0 0 20px; font-size:1.3em; font-weight:600;">📋 Historial de Respaldos</h3>
                
                <div style="overflow-x:auto; max-height:300px; overflow-y:auto;">
                    <table style="width:100%; border-collapse:collapse; font-size:0.9em;" id="tablaHistorialRespaldos">
                        <thead>
                            <tr style="background:#6f42c1; color:white;">
                                <th style="border:1px solid #6f42c1; padding:12px; text-align:left;">📅 Fecha</th>
                                <th style="border:1px solid #6f42c1; padding:12px; text-align:left;">🏷️ Tipo</th>
                                <th style="border:1px solid #6f42c1; padding:12px; text-align:center;">📊 Registros</th>
                                <th style="border:1px solid #6f42c1; padding:12px; text-align:center;">📁 Tamaño</th>
                                <th style="border:1px solid #6f42c1; padding:12px; text-align:center;">🎯 Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="historialRespaldosBody">
                            <tr>
                                <td colspan="5" style="text-align:center; padding:20px; color:#6c757d; font-style:italic;">
                                    No hay respaldos registrados
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Botones de acción -->
            <div style="display:flex; gap:15px; justify-content:center; margin-top:30px; flex-wrap:wrap;">
                <button onclick="exportarConfiguracion()" style="background:linear-gradient(145deg, #17a2b8, #138496); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(23,162,184,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(23,162,184,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(23,162,184,0.3)'">
                    📤 Exportar Config
                </button>
                
                <button onclick="importarConfiguracion()" style="background:linear-gradient(145deg, #28a745, #1e7e34); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(40,167,69,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40,167,69,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40,167,69,0.3)'">
                    📥 Importar Config
                </button>
                
                <button onclick="limpiarHistorialRespaldos()" style="background:linear-gradient(145deg, #dc3545, #c82333); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(220,53,69,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(220,53,69,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(220,53,69,0.3)'">
                    🗑️ Limpiar Historial
                </button>
                
                <button onclick="cerrarModalRespaldo()" style="background:linear-gradient(145deg, #6c757d, #545b62); color:white; border:none; padding:12px 25px; border-radius:8px; cursor:pointer; font-size:1em; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(108,117,125,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(108,117,125,0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(108,117,125,0.3)'">
                    ❌ Cerrar
                </button>
            </div>
            
        </div>
    </div>

    <script>
    // ================ SISTEMA DE NOTIFICACIONES PUSH EN TIEMPO REAL ================
    
    // Variables globales del sistema de notificaciones
    let notificationsEnabled = true;
    let notificationSounds = false; // DESACTIVADO
    let notificationDuration = 5000; // 5 segundos
    let maxNotifications = 5;
    let notificationCount = 0;
    let notificationHistory = [];
    let notificationId = 0;
    let isNotificationsPanelOpen = false;
    
    // Configuración de sonidos (DESACTIVADO)
    const notificationAudio = null; // document.getElementById('notificationSound');
    
    // Función para inicializar el sistema de notificaciones
    function initNotificationSystem() {
        console.log('🔔 Inicializando sistema de notificaciones push');
        
        // (Desactivado) Solicitar permisos de notificación del navegador
        // No se solicita permiso para evitar el popup
        
        // Cargar configuración guardada
        loadNotificationSettings();
        
        // Configurar event listeners
        setupNotificationListeners();
        
        // Iniciar notificaciones de prueba para tareas importantes (DESACTIVADO)
        // startImportantTaskMonitoring();
        
        console.log('✅ Sistema de notificaciones inicializado (notificaciones automáticas desactivadas)');
    }
    
    // Función para cargar configuración
    function loadNotificationSettings() {
        const settings = localStorage.getItem('notificationSettings');
        if (settings) {
            const config = JSON.parse(settings);
            notificationsEnabled = config.enabled !== false;
            notificationSounds = config.sounds !== false;
            notificationDuration = config.duration || 5000;
            maxNotifications = config.maxNotifications || 5;
            
            // Actualizar UI
            document.getElementById('enableNotifications').checked = notificationsEnabled;
            document.getElementById('enableSounds').checked = notificationSounds;
            document.getElementById('notificationDuration').value = notificationDuration / 1000;
            document.getElementById('maxNotifications').value = maxNotifications;
        }
    }
    
    // Función para guardar configuración
    function saveNotificationSettings() {
        const settings = {
            enabled: document.getElementById('enableNotifications').checked,
            sounds: document.getElementById('enableSounds').checked,
            duration: parseInt(document.getElementById('notificationDuration').value) * 1000,
            maxNotifications: parseInt(document.getElementById('maxNotifications').value)
        };
        
        notificationsEnabled = settings.enabled;
        notificationSounds = settings.sounds;
        notificationDuration = settings.duration;
        maxNotifications = settings.maxNotifications;
        
        localStorage.setItem('notificationSettings', JSON.stringify(settings));
        
        showNotification('✅ Configuración guardada', 'La configuración de notificaciones ha sido actualizada.', 'success');
        closeNotificationSettings();
        
        console.log('💾 Configuración de notificaciones guardada:', settings);
    }
    
    // Función principal para mostrar notificaciones
    function showNotification(title, message, type = 'info', isUrgent = false, actions = null) {
        if (!notificationsEnabled) return;
        
        const id = ++notificationId;
        const timestamp = new Date();
        
        const notification = {
            id: id,
            title: title,
            message: message,
            type: type,
            isUrgent: isUrgent,
            timestamp: timestamp,
            actions: actions,
            read: false
        };
        
        // Agregar a historial
        notificationHistory.unshift(notification);
        if (notificationHistory.length > 100) {
            notificationHistory = notificationHistory.slice(0, 100);
        }
        
        // Crear toast notification
        createToastNotification(notification);
        
        // Reproducir sonido si está habilitado
        if (notificationSounds) {
            playNotificationSound();
        }
        
        // Mostrar notificación del navegador si es urgente
        if (isUrgent && 'Notification' in window && Notification.permission === 'granted') {
            new Notification(title, {
                body: message,
                icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDMTMuMSAyIDE0IDIuOSAxNCA0VjVDMTcuMyA2LjcgMTkuOCAxMC4xIDE5LjggMTRWMjBMMjIgMjJIMlYyMEw0LjIgMTRDNC4yIDEwLjEgNi43IDYuNyAxMCA1VjRDMTAgMi45IDEwLjkgMiAxMiAyWiIgZmlsbD0iIzAwN2JmZiIvPgo8L3N2Zz4K',
                badge: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDMTMuMSAyIDE0IDIuOSAxNCA0VjVDMTcuMyA2LjcgMTkuOCAxMC4xIDE5LjggMTRWMjBMMjIgMjJIMlYyMEw0LjIgMTRDNC4yIDEwLjEgNi43IDYuNyAxMCA1VjRDMTAgMi45IDEwLjkgMiAxMiAyWiIgZmlsbD0iI2ZmNmI2YiIvPgo8L3N2Zz4K'
            });
        }
        
        // Actualizar contador
        updateNotificationCount();
        
        // Actualizar panel
        updateNotificationsPanel();
        
        console.log(`🔔 Notificación mostrada: ${title} (${type})`);
        
        return id;
    }
    
    // Función para crear toast notification
    function createToastNotification(notification) {
        const container = document.getElementById('notificationsContainer');
        
        // Limitar número de notificaciones
        const existing = container.querySelectorAll('.notification-toast:not(.hide)');
        if (existing.length >= maxNotifications) {
            removeToastNotification(existing[0]);
        }
        
        const toast = document.createElement('div');
        toast.className = `notification-toast ${notification.type}${notification.isUrgent ? ' urgent' : ''}`;
        toast.setAttribute('data-notification-id', notification.id);
        
        const progressDuration = notification.isUrgent ? notificationDuration * 2 : notificationDuration;
        
        toast.innerHTML = `
            <div class="notification-header">
                <h4 class="notification-title">${notification.title}</h4>
                <button class="notification-close" onclick="removeToastNotification(this.closest('.notification-toast'))">&times;</button>
            </div>
            <div class="notification-body">${notification.message}</div>
            <div class="notification-footer">
                <span class="notification-time">${formatTime(notification.timestamp)}</span>
                ${notification.actions ? `
                    <div class="notification-actions">
                        ${notification.actions.map(action => 
                            `<button class="notification-action ${action.type || ''}" onclick="${action.onclick || ''}">${action.text}</button>`
                        ).join('')}
                    </div>
                ` : ''}
            </div>
            <div class="notification-progress">
                <div style="animation-duration: ${progressDuration}ms;"></div>
            </div>
        `;
        
        container.appendChild(toast);
        
        // Animación de entrada
        setTimeout(() => toast.classList.add('show'), 10);
        
        // Auto-dismiss después del tiempo configurado
        if (!notification.isUrgent) {
            setTimeout(() => removeToastNotification(toast), progressDuration);
        }
    }
    
    // Función para remover toast notification
    function removeToastNotification(toastElement) {
        if (!toastElement) return;
        
        toastElement.classList.add('hide');
        setTimeout(() => {
            if (toastElement.parentNode) {
                toastElement.parentNode.removeChild(toastElement);
            }
        }, 500);
    }
    
    // Función para reproducir sonido (DESACTIVADO)
    function playNotificationSound() {
        // Sonidos completamente desactivados
        return;
    }
    
    // Función para actualizar contador
    function updateNotificationCount() {
        const unreadCount = notificationHistory.filter(n => !n.read).length;
        notificationCount = unreadCount;
        
        const badge = document.getElementById('notificationBadge');
        if (unreadCount > 0) {
            badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
            badge.style.display = 'flex';
        } else {
            badge.style.display = 'none';
        }
    }
    
    // Función para toggle del panel de notificaciones
    function toggleNotificationsPanel() {
        const panel = document.getElementById('notificationsPanel');
        isNotificationsPanelOpen = !isNotificationsPanelOpen;
        
        if (isNotificationsPanelOpen) {
            panel.classList.add('open');
            // Marcar notificaciones como leídas
            notificationHistory.forEach(n => n.read = true);
            updateNotificationCount();
            updateNotificationsPanel();
        } else {
            panel.classList.remove('open');
        }
    }
    
    // Función para actualizar panel de notificaciones
    function updateNotificationsPanel() {
        const list = document.getElementById('notificationsList');
        if (!list) return;

        if (notificationHistory.length === 0) {
            list.innerHTML = `
                <div style="text-align: center; color: #6c757d; padding: 40px 20px;">
                    <div style="font-size: 48px; margin-bottom: 16px;">🔕</div>
                    <p>No hay notificaciones</p>
                    <p style="font-size: 12px;">Las notificaciones aparecerán aquí</p>
                </div>
            `;
            return;
        }
        
        list.innerHTML = notificationHistory.map(notification => `
            <div class="notification-item ${!notification.read ? 'unread' : ''}" onclick="markAsRead(${notification.id})">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                    <h5 style="margin: 0; font-size: 14px; color: #2c3e50;">${getTypeIcon(notification.type)} ${notification.title}</h5>
                    <small style="color: #6c757d; font-size: 11px;">${formatTime(notification.timestamp)}</small>
                </div>
                <p style="margin: 0; font-size: 13px; color: #495057; line-height: 1.4;">${notification.message}</p>
                ${notification.isUrgent ? '<div style="margin-top: 8px;"><span style="background: #fd7e14; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">🚨 URGENTE</span></div>' : ''}
            </div>
        `).join('');
    }
    
    // Función para obtener icono por tipo
    function getTypeIcon(type) {
        const icons = {
            success: '✅',
            warning: '⚠️',
            error: '❌',
            info: 'ℹ️',
            urgent: '🚨'
        };
        return icons[type] || 'ℹ️';
    }
    
    // Función para formatear tiempo
    function formatTime(date) {
        const now = new Date();
        const diff = now - date;
        
        if (diff < 60000) return 'Ahora';
        if (diff < 3600000) return `${Math.floor(diff / 60000)}m`;
        if (diff < 86400000) return `${Math.floor(diff / 3600000)}h`;
        return date.toLocaleDateString();
    }
    
    // Función para marcar como leída
    function markAsRead(id) {
        const notification = notificationHistory.find(n => n.id === id);
        if (notification) {
            notification.read = true;
            updateNotificationCount();
            updateNotificationsPanel();
        }
    }
    
    // Función para limpiar todas las notificaciones
    function clearAllNotifications() {
        if (confirm('¿Estás seguro de que quieres limpiar todas las notificaciones?')) {
            notificationHistory = [];
            updateNotificationCount();
            updateNotificationsPanel();
            
            // Limpiar toasts
            const container = document.getElementById('notificationsContainer');
            const toasts = container.querySelectorAll('.notification-toast');
            toasts.forEach(toast => removeToastNotification(toast));
            
            showNotification('🧹 Notificaciones limpiadas', 'Se han eliminado todas las notificaciones.', 'info');
        }
    }
    
    // Función para abrir configuración
    function openNotificationSettings() {
        const settings = document.getElementById('notificationSettings');
        const overlay = document.getElementById('notificationOverlay');
        
        settings.classList.add('show');
        overlay.style.display = 'block';
        
        // Actualizar valores en la UI
        document.getElementById('durationValue').textContent = document.getElementById('notificationDuration').value + 's';
        
        // Event listeners para el slider
        document.getElementById('notificationDuration').addEventListener('input', function() {
            document.getElementById('durationValue').textContent = this.value + 's';
        });
    }
    
    // Función para cerrar configuración
    function closeNotificationSettings() {
        const settings = document.getElementById('notificationSettings');
        const overlay = document.getElementById('notificationOverlay');
        
        settings.classList.remove('show');
        overlay.style.display = 'none';
    }
    
    // Función para restablecer configuración
    function resetNotificationSettings() {
        document.getElementById('enableNotifications').checked = true;
        document.getElementById('enableSounds').checked = true;
        document.getElementById('notificationDuration').value = 5;
        document.getElementById('maxNotifications').value = 5;
        document.getElementById('durationValue').textContent = '5s';
    }
    
    // Función para probar sonido
    function testNotificationSound() {
        playNotificationSound();
        showNotification('🔊 Prueba de sonido', 'Este es el sonido que escucharás con las notificaciones.', 'info');
    }
    
    // Función para configurar event listeners
    function setupNotificationListeners() {
        // Cerrar panel al hacer clic fuera
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notificationsPanel');
            const icon = document.getElementById('notificationIcon');
            
            if (isNotificationsPanelOpen && !panel.contains(e.target) && !icon.contains(e.target)) {
                toggleNotificationsPanel();
            }
        });
        
        // Teclas de acceso rápido
        document.addEventListener('keydown', function(e) {
            // Ctrl + Shift + N para toggle de notificaciones
            if (e.ctrlKey && e.shiftKey && e.key === 'N') {
                e.preventDefault();
                toggleNotificationsPanel();
            }
        });
    }
    
    // Función para monitorear tareas importantes
    function startImportantTaskMonitoring() {
        // Ejemplos de notificaciones para tareas importantes del sistema ACHS
        
        // Notificación de bienvenida
        setTimeout(() => {
            showNotification(
                '🎉 Sistema ACHS Iniciado',
                'Bienvenido al Panel de Gestión Ejecutivo. Sistema de notificaciones activado.',
                'success',
                false,
                [{text: '👍 Entendido', onclick: 'markAsRead(' + (notificationId + 1) + ')'}]
            );
        }, 2000);
        
        // Recordatorio de tareas pendientes cada 30 minutos
        setInterval(() => {
            const pendientes = document.querySelectorAll('[data-pendiente="true"]').length;
            if (pendientes > 0) {
                showNotification(
                    '📋 Tareas Pendientes',
                    `Tienes ${pendientes} tarea(s) pendiente(s) por revisar.`,
                    'warning',
                    false,
                    [
                        {text: '📝 Ver', onclick: 'mostrarPendientes()', type: 'primary'},
                        {text: '⏰ Recordar más tarde', onclick: 'snoozeReminder()', type: 'secondary'}
                    ]
                );
            }
        }, 1800000); // 30 minutos
        
        // Monitorear formularios sin guardar
        let formChanged = false;
        const formInputs = document.querySelectorAll('input, select, textarea');
        formInputs.forEach(input => {
            input.addEventListener('change', () => {
                formChanged = true;
                // Advertir si hay cambios sin guardar después de 5 minutos
                setTimeout(() => {
                    if (formChanged) {
                        showNotification(
                            '⚠️ Cambios sin Guardar',
                            'Tienes cambios en el formulario que no has guardado.',
                            'warning',
                            false,
                            [
                                {text: '💾 Guardar', onclick: 'grabar()', type: 'primary'},
                                {text: '❌ Descartar', onclick: 'resetForm()', type: 'secondary'}
                            ]
                        );
                    }
                }, 300000); // 5 minutos
            });
        });
        
        // Notificaciones sobre RUTs inválidos
        const rutInput = document.getElementById('rut');
        if (rutInput) {
            rutInput.addEventListener('blur', function() {
                const rut = this.value.trim();
                if (rut && !validarRut(rut)) {
                    showNotification(
                        '❌ RUT Inválido',
                        'El RUT ingresado no tiene un formato válido. Por favor verifica.',
                        'error',
                        true
                    );
                }
            });
        }
        
        // Notificaciones de recordatorio para citas importantes
        setInterval(() => {
            const ahora = new Date();
            const horaActual = ahora.getHours();
            
            // Recordatorio de almuerzo
            if (horaActual === 12 && ahora.getMinutes() === 0) {
                showNotification(
                    '🍽️ Hora de Almuerzo',
                    'Es hora de tu descanso. Recuerda mantener un horario saludable.',
                    'info'
                );
            }
            
            // Recordatorio de fin de jornada
            if (horaActual === 17 && ahora.getMinutes() === 30) {
                showNotification(
                    '🕐 Fin de Jornada',
                    'Tu jornada laboral está terminando. Revisa tus tareas pendientes.',
                    'info',
                    false,
                    [{text: '📊 Ver Resumen', onclick: 'showDailySummary()'}]
                );
            }
        }, 60000); // Cada minuto
        
        console.log('📊 Monitoreo de tareas importantes iniciado');
    }
    
    // Deshabilitar inicio automático de notificaciones
    // startImportantTaskMonitoring();
    
    // Funciones auxiliares para las notificaciones
    function snoozeReminder() {
        showNotification('⏰ Recordatorio Pospuesto', 'Te recordaremos nuevamente en 15 minutos.', 'info');
        setTimeout(() => {
            showNotification('🔔 Recordatorio', 'Aún tienes tareas pendientes por revisar.', 'warning');
        }, 900000); // 15 minutos
    }
    
    function showDailySummary() {
        const totalRegistros = document.querySelectorAll('#historial tbody tr').length;
        const pendientes = document.querySelectorAll('[data-pendiente="true"]').length;
        
        showNotification(
            '📈 Resumen del Día',
            `Registros procesados: ${totalRegistros} | Pendientes: ${pendientes}`,
            'info',
            false,
            [{text: '📊 Ver Detalles', onclick: 'openDetailedReport()'}]
        );
    }
    
    function resetForm() {
        if (confirm('¿Estás seguro de que quieres descartar los cambios?')) {
            document.querySelector('form').reset();
            formChanged = false;
            showNotification('🔄 Formulario Reiniciado', 'Los cambios han sido descartados.', 'info');
        }
    }
    
    // Función para validar RUT (simple)
    function validarRut(rut) {
        // Eliminar puntos y guión
        rut = rut.replace(/\./g, '').replace(/-/g, '');
        
        // Verificar formato básico
        if (rut.length < 8 || rut.length > 9) return false;
        
        // Extraer dígito verificador
        const dv = rut.slice(-1).toLowerCase();
        const numero = rut.slice(0, -1);
        
        // Calcular dígito verificador
        let suma = 0;
        let multiplicador = 2;
        
        for (let i = numero.length - 1; i >= 0; i--) {
            suma += parseInt(numero[i]) * multiplicador;
            multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
        }
        
        const resto = suma % 11;
        const dvCalculado = resto === 0 ? '0' : resto === 1 ? 'k' : (11 - resto).toString();
        
        return dv === dvCalculado;
    }
    
    // FUNCIÓN PARA BOTÓN CARPETA - DEFINIDA INMEDIATAMENTE
    function abrirModalCarpeta() {
        console.log('🔄 Función abrirModalCarpeta ejecutada');
        
        const modal = document.getElementById('modalPdf');
        if (modal) {
            modal.style.display = 'flex';
            console.log('✅ Modal PDF abierto correctamente');
            
            // Cargar documentos si existen
            cargarDocumentosGuardados();
            actualizarListaDocumentos();
        } else {
            console.error('❌ Modal modalPdf no encontrado');
            alert('❌ Error: Modal no encontrado');
        }
    }

    // FUNCIÓN DE PRUEBA GLOBAL
    function testGlobal() {
        alert('✅ JavaScript funcionando correctamente');
        console.log('✅ Test ejecutado correctamente');
    }

    // FUNCIÓN PARA BOTÓN OUTBOUND
    function abrirOutbound() {

    }

    // FUNCIÓN PARA BOTÓN TERAPIA FÍSICA
    function abrirTerapiaFisica() {
        console.log('🔄 Abriendo enlace TERAPIA FÍSICA');
        const url = 'https://docs.google.com/spreadsheets/d/17QUP9LFgIzqDBuc1j6oYi-kh8hyECIos/edit?usp=drive_link&ouid=109971191188208299343&rtpof=true&sd=true';
        window.open(url, '_blank');
        console.log('✅ Enlace TERAPIA FÍSICA abierto en nueva pestaña');
    }

    // FUNCIÓN PARA BOTÓN DIRECCIÓN
    function abrirDireccion() {
        console.log('🔄 Abriendo enlace DIRECCIÓN');
        const url = 'https://www.achs.cl/nosotros/ubicacion';
        window.open(url, '_blank');
        console.log('✅ Enlace DIRECCIÓN abierto en nueva pestaña');
    }

    // FUNCIÓN PARA BOTÓN ATENCIÓN
    function abrirModalAtencion() {
        console.log('🔄 Abriendo modal de ATENCIÓN');
        const modal = document.getElementById('modalAtencion');
        if (modal) {
            modal.style.display = 'flex';
            // Establecer fecha y hora actual
            const ahora = new Date();
            const fechaLocal = new Date(ahora.getTime() - (ahora.getTimezoneOffset() * 60000));
            document.getElementById('fechaAtencion').value = fechaLocal.toISOString().slice(0, 16);
            cargarRegistrosAtencion();
            console.log('✅ Modal de ATENCIÓN abierto');
        } else {
            console.error('❌ Modal de ATENCIÓN no encontrado');
        }
    }

    function cerrarModalAtencion() {
        console.log('🔄 Cerrando modal de ATENCIÓN');
        const modal = document.getElementById('modalAtencion');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de ATENCIÓN cerrado');
        }
    }

    // Variables globales
    let documentosGuardados = [];
    let historialRegistros = [];
    let registrosAtencion = [];
    let alertasProgramadas = [];
    let intervalosAlerta = [];
    let tareasPendientes = [];
    let intervalosRecordatorio = [];
    let bandejaEmails = [];
    let emailsBorradores = [];
    let configuracionEmail = {
        servidor: 'outlook.office365.com',
        puerto: 993,
        usuario: '',
        activo: false
    };

    // Variables del calendario
    let fechaActualCalendario = new Date();
    let tooltipFeriado = null;

    // Feriados chilenos 2025
    const feriadosChilenos = {
        '2025-01-01': 'Año Nuevo',
        '2025-04-18': 'Viernes Santo',
        '2025-04-19': 'Sábado Santo',
        '2025-05-01': 'Día del Trabajador',
        '2025-05-21': 'Día de las Glorias Navales',
        '2025-06-26': 'San Pedro y San Pablo',
        '2025-07-16': 'Día de la Virgen del Carmen',
        '2025-08-15': 'Asunción de la Virgen',
        '2025-09-18': 'Independencia Nacional',
        '2025-09-19': 'Día de las Glorias del Ejército',
        '2025-10-12': 'Encuentro de Dos Mundos',
        '2025-10-31': 'Día de las Iglesias Evangélicas',
        '2025-11-01': 'Día de Todos los Santos',
        '2025-12-08': 'Inmaculada Concepción',
        '2025-12-25': 'Navidad'
    };

    // ============ FUNCIONES DEL RELOJ Y CALENDARIO ============
    
    // Función para actualizar el reloj
    function actualizarReloj() {
        const ahora = new Date();
        
        // Actualizar reloj digital
        const horas = ahora.getHours().toString().padStart(2, '0');
        const minutos = ahora.getMinutes().toString().padStart(2, '0');
        const segundos = ahora.getSeconds().toString().padStart(2, '0');
        
        const relojElement = document.getElementById('relojDigital');
        if (relojElement) {
            relojElement.textContent = `${horas}:${minutos}:${segundos}`;
        }
        
        // Actualizar reloj compacto
        const relojCompacto = document.getElementById('reloj-compacto');
        if (relojCompacto) {
            relojCompacto.textContent = `${horas}:${minutos}:${segundos}`;
        }
        
        // Actualizar fecha
        const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
        const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        
        const diaSemana = diasSemana[ahora.getDay()];
        const dia = ahora.getDate();
        const mes = meses[ahora.getMonth()];
        const ano = ahora.getFullYear();
        
        const fechaElement = document.getElementById('fechaActual');
        if (fechaElement) {
            fechaElement.textContent = `${diaSemana}, ${dia} de ${mes} de ${ano}`;
        }
        
        // Actualizar fecha compacta
        const fechaCompacta = document.getElementById('fecha-compacta');
        if (fechaCompacta) {
            fechaCompacta.textContent = `${diaSemana}, ${dia} de ${mes} de ${ano}`;
        }
    }
    
    // Función para generar el calendario
    function generarCalendario(fecha = new Date()) {
        const cuerpoCalendario = document.getElementById('cuerpoCalendario');
        const mesAnoElement = document.getElementById('mesAnoActual');
        
        if (!cuerpoCalendario || !mesAnoElement) return;
        
        const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        
        const ano = fecha.getFullYear();
        const mes = fecha.getMonth();
        
        // Actualizar título del mes
        mesAnoElement.textContent = `${meses[mes]} ${ano}`;
        
        // Limpiar calendario
        cuerpoCalendario.innerHTML = '';
        
        // Primer día del mes y último día del mes anterior
        const primerDia = new Date(ano, mes, 1);
        const ultimoDia = new Date(ano, mes + 1, 0);
        const diasEnMes = ultimoDia.getDate();
        const diaSemanaInicio = primerDia.getDay();
        
        // Días del mes anterior para completar la primera semana
        const ultimoDiaMesAnterior = new Date(ano, mes, 0).getDate();
        
        let diaActual = 1;
        let diaSiguienteMes = 1;
        
        // Generar 6 semanas (42 días)
        for (let semana = 0; semana < 6; semana++) {
            const fila = cuerpoCalendario.insertRow();
            
            for (let diaSemana = 0; diaSemana < 7; diaSemana++) {
                const celda = fila.insertCell();
                celda.className = 'calendario-dia';
                
                let diaTexto = '';
                let fechaCompleta = '';
                let esOtroMes = false;
                
                if (semana === 0 && diaSemana < diaSemanaInicio) {
                    // Días del mes anterior
                    diaTexto = ultimoDiaMesAnterior - (diaSemanaInicio - diaSemana - 1);
                    fechaCompleta = `${ano}-${(mes).toString().padStart(2, '0')}-${diaTexto.toString().padStart(2, '0')}`;
                    esOtroMes = true;
                } else if (diaActual <= diasEnMes) {
                    // Días del mes actual
                    diaTexto = diaActual;
                    fechaCompleta = `${ano}-${(mes + 1).toString().padStart(2, '0')}-${diaActual.toString().padStart(2, '0')}`;
                    diaActual++;
                } else {
                    // Días del mes siguiente
                    diaTexto = diaSiguienteMes;
                    fechaCompleta = `${ano}-${(mes + 2).toString().padStart(2, '0')}-${diaSiguienteMes.toString().padStart(2, '0')}`;
                    diaSiguienteMes++;
                    esOtroMes = true;
                }
                
                celda.textContent = diaTexto;
                
                // Aplicar clases CSS
                if (esOtroMes) {
                    celda.classList.add('dia-otro-mes');
                }
                
                // Marcar día actual
                const hoy = new Date();
                if (!esOtroMes && 
                    diaTexto == hoy.getDate() && 
                    mes == hoy.getMonth() && 
                    ano == hoy.getFullYear()) {
                    celda.classList.add('dia-actual');
                }
                
                // Marcar fines de semana
                if (diaSemana === 0 || diaSemana === 6) {
                    celda.classList.add('dia-fin-semana');
                }
                
                // Marcar feriados
                if (feriadosChilenos[fechaCompleta]) {
                    celda.classList.add('dia-feriado');
                    celda.dataset.feriado = feriadosChilenos[fechaCompleta];
                    
                    // Agregar eventos de tooltip
                    celda.addEventListener('mouseenter', mostrarTooltipFeriado);
                    celda.addEventListener('mouseleave', ocultarTooltipFeriado);
                }
                
                // Evento click
                celda.addEventListener('click', function() {
                    if (!esOtroMes) {
                        seleccionarDia(this, fechaCompleta);
                    }
                });
            }
        }
        
        // Actualizar próximos feriados
        actualizarProximosFeriados();
    }
    
    // Función para mostrar tooltip de feriado
    function mostrarTooltipFeriado(event) {
        if (tooltipFeriado) {
            document.body.removeChild(tooltipFeriado);
        }
        
        tooltipFeriado = document.createElement('div');
        tooltipFeriado.className = 'tooltip-feriado';
        tooltipFeriado.textContent = event.target.dataset.feriado;
        tooltipFeriado.style.opacity = '1';
        
        document.body.appendChild(tooltipFeriado);
        
        const rect = event.target.getBoundingClientRect();
        tooltipFeriado.style.left = (rect.left + rect.width / 2 - tooltipFeriado.offsetWidth / 2) + 'px';
        tooltipFeriado.style.top = (rect.top - tooltipFeriado.offsetHeight - 10) + 'px';
    }
    
    // Función para ocultar tooltip de feriado
    function ocultarTooltipFeriado() {
        if (tooltipFeriado) {
            tooltipFeriado.style.opacity = '0';
            setTimeout(() => {
                if (tooltipFeriado && tooltipFeriado.parentNode) {
                    document.body.removeChild(tooltipFeriado);
                    tooltipFeriado = null;
                }
            }, 300);
        }
    }
    
    // Función para seleccionar un día
    function seleccionarDia(celda, fecha) {
        // Remover selección anterior
        const seleccionAnterior = document.querySelector('.calendario-dia.seleccionado');
        if (seleccionAnterior) {
            seleccionAnterior.classList.remove('seleccionado');
        }
        
        // Agregar nueva selección
        celda.classList.add('seleccionado');
        
        // Mostrar información del día
        const esFeriado = feriadosChilenos[fecha];
        if (esFeriado) {
            mostrarMensajeTemp(`🎊 ${esFeriado}`, '#e91e63');
        } else {
            const fechaObj = new Date(fecha);
            const opciones = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const fechaTexto = fechaObj.toLocaleDateString('es-CL', opciones);
            mostrarMensajeTemp(`📅 ${fechaTexto}`, '#007bff');
        }
    }
    
    // Función para actualizar próximos feriados
    function actualizarProximosFeriados() {
        const proximosElement = document.getElementById('proximosFeriados');
        if (!proximosElement) return;
        
        const hoy = new Date();
        const proximosFeriados = [];
        
        for (const [fecha, nombre] of Object.entries(feriadosChilenos)) {
            const fechaFeriado = new Date(fecha);
            if (fechaFeriado >= hoy) {
                proximosFeriados.push({ fecha: fechaFeriado, nombre });
            }
        }
        
        proximosFeriados.sort((a, b) => a.fecha - b.fecha);
        
        proximosElement.innerHTML = '';
        
        const primerosTres = proximosFeriados.slice(0, 3);
        primerosTres.forEach(feriado => {
            const div = document.createElement('div');
            div.style.cssText = 'margin-bottom: 5px; padding: 3px 0; border-bottom: 1px solid #eee;';
            
            const diasRestantes = Math.ceil((feriado.fecha - hoy) / (1000 * 60 * 60 * 24));
            const fechaTexto = feriado.fecha.toLocaleDateString('es-CL', { day: 'numeric', month: 'short' });
            
            div.innerHTML = `
                <div style="font-weight: bold; color: #e91e63;">${feriado.nombre}</div>
                <div style="color: #666; font-size: 0.7em;">${fechaTexto} (${diasRestantes} días)</div>
            `;
            
            proximosElement.appendChild(div);
        });
    }
    
    // Función para navegar meses
    function cambiarMes(direccion) {
        fechaActualCalendario.setMonth(fechaActualCalendario.getMonth() + direccion);
        generarCalendario(fechaActualCalendario);
    }
    
    // Función para ir al día de hoy
    function irAHoy() {
        fechaActualCalendario = new Date();
        generarCalendario(fechaActualCalendario);
    }
    
    // Función para configurar eventos del calendario
    function configurarEventosCalendario() {
        const mesAnterior = document.getElementById('mesAnterior');
        const mesSiguiente = document.getElementById('mesSiguiente');
        const hoyBtn = document.getElementById('hoyBtn');
        
        if (mesAnterior) {
            mesAnterior.addEventListener('click', () => cambiarMes(-1));
        }
        
        if (mesSiguiente) {
            mesSiguiente.addEventListener('click', () => cambiarMes(1));
        }
        
        if (hoyBtn) {
            hoyBtn.addEventListener('click', irAHoy);
        }
        
        // Generar calendario inicial
        generarCalendario();
        
        console.log('✅ Eventos del calendario configurados');
    }

    // ============ FUNCIONES DEL HISTORIAL DE REGISTROS ============
    
    // Función para cargar historial desde localStorage
    function cargarHistorialGuardado() {
        try {
            console.log('🔄 Cargando historial desde localStorage...');
            const datos = localStorage.getItem('historialRegistrosAchs');
            if (datos && datos !== 'null' && datos !== 'undefined') {
                historialRegistros = JSON.parse(datos);
                console.log('✅ Historial cargado desde localStorage. Total:', historialRegistros.length);
                actualizarTablaHistorial();
                return true;
            }
            console.log('ℹ️ No hay registros de historial guardados');
            historialRegistros = [];
            return false;
        } catch (e) {
            console.error('❌ Error al cargar historial:', e);
            historialRegistros = [];
            return false;
        }
    }

    // Función para guardar historial en localStorage
    function guardarHistorialEnStorage() {
        try {
            localStorage.setItem('historialRegistrosAchs', JSON.stringify(historialRegistros));
            console.log('✅ Historial guardado en localStorage. Total:', historialRegistros.length);
        } catch (e) {
            console.error('❌ Error al guardar historial:', e);
            alert('Error al guardar los registros. El almacenamiento puede estar lleno.');
        }
    }

    // Función para actualizar la tabla del historial
    function actualizarTablaHistorial() {
        const tabla = document.getElementById('historial');
        if (!tabla) {
            console.warn('⚠️ Tabla historial no encontrada');
            return;
        }
        
        const tbody = tabla.getElementsByTagName('tbody')[0];
        if (!tbody) {
            console.warn('⚠️ tbody de tabla historial no encontrado');
            return;
        }
        
        tbody.innerHTML = ''; // Limpiar tabla
        
        if (historialRegistros.length === 0) {
            console.log('ℹ️ No hay registros para mostrar');
            return;
        }
        
        // Mostrar registros ordenados por fecha de creación (más recientes primero)
        const registrosOrdenados = [...historialRegistros].sort((a, b) => {
            const fechaA = new Date(a.fechaCreacion || a.fecha);
            const fechaB = new Date(b.fechaCreacion || b.fecha);
            return fechaB - fechaA; // Más recientes primero
        });
        
        console.log(`📋 Mostrando ${registrosOrdenados.length} registros en la tabla`);
        
        registrosOrdenados.forEach((registro, index) => {
            const fila = tbody.insertRow();
            
            // Agregar efecto hover
            fila.style.transition = 'all 0.3s ease';
            fila.onmouseover = function() {
                this.style.background = '#f8f9fa';
                this.style.transform = 'translateX(5px)';
            };
            fila.onmouseout = function() {
                this.style.background = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
                this.style.transform = 'translateX(0)';
            };
            
            // Color alternado para filas
            fila.style.background = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
            
            // Celdas con datos
            fila.insertCell(0).innerText = registro.fecha;
            fila.insertCell(1).innerText = registro.rut;
            fila.insertCell(2).innerText = registro.nombre;
            fila.insertCell(3).innerText = registro.motivo;
            fila.insertCell(4).innerText = registro.submotivo;
            fila.insertCell(5).innerText = registro.observacion;
            
            // Celda de eliminar
            const celdaEliminar = fila.insertCell(6);
            celdaEliminar.style.textAlign = 'center';
            
            const btnEliminar = document.createElement('button');
            btnEliminar.innerText = "🗑️";
            btnEliminar.title = "Eliminar este registro";
            btnEliminar.style.cssText = `
                background: #dc3545;
                color: white;
                border: none;
                padding: 5px 8px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 0.9em;
                transition: all 0.3s ease;
            `;
            
            btnEliminar.onmouseover = function() {
                this.style.background = '#c82333';
                this.style.transform = 'scale(1.1)';
            };
            
            btnEliminar.onmouseout = function() {
                this.style.background = '#dc3545';
                this.style.transform = 'scale(1)';
            };
            
            btnEliminar.onclick = function() {
                if (confirm('¿Estás seguro de que quieres eliminar este registro?')) {
                    eliminarRegistro(registro.id);
                }
            };
            
            celdaEliminar.appendChild(btnEliminar);
        });
    }

    // Función para eliminar un registro específico
    function eliminarRegistro(id) {
        const registrosAnteriores = historialRegistros.length;
        historialRegistros = historialRegistros.filter(registro => registro.id !== id);
        guardarHistorialEnStorage();
        actualizarTablaHistorial();
        
        const registrosActuales = historialRegistros.length;
        console.log(`Registro eliminado. Anterior: ${registrosAnteriores}, Actual: ${registrosActuales}`);
        
        // Mensaje de confirmación
        mostrarMensajeTemp('🗑️ Registro eliminado exitosamente', '#dc3545');
    }

    // Función para mostrar mensajes temporales
    function mostrarMensajeTemp(texto, color = '#28a745') {
        const mensaje = document.createElement('div');
        mensaje.innerHTML = texto;
        mensaje.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${color};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 9999;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            font-size: 0.9em;
        `;
        document.body.appendChild(mensaje);
        
        // Animación de entrada
        setTimeout(() => {
            mensaje.style.transform = 'translateX(-10px)';
        }, 100);
        
        // Remover después de 3 segundos
        setTimeout(() => {
            if (mensaje.parentNode) {
                mensaje.style.opacity = '0';
                mensaje.style.transform = 'translateX(100px)';
                setTimeout(() => {
                    if (mensaje.parentNode) {
                        mensaje.parentNode.removeChild(mensaje);
                    }
                }, 300);
            }
        }, 3000);
    }

    // ============ EVENTOS DE BOTONES ============

    // Función para el botón GRABAR
    function configurarBotonGrabar() {
        const btnGrabar = document.getElementById('grabar');
        if (btnGrabar) {
            btnGrabar.onclick = function() {
                console.log('🔄 Botón GRABAR presionado');
                
                // Verificar que todos los elementos existan
                const elementos = {
                    fecha: document.getElementById('fecha'),
                    rut: document.getElementById('rut'),
                    nombre: document.getElementById('nombre'),
                    motivo: document.getElementById('motivo'),
                    submotivo: document.getElementById('submotivo'),
                    observacion: document.getElementById('observacion')
                };
                
                console.log('🔍 Verificando elementos del formulario:', elementos);
                
                const fecha = elementos.fecha ? elementos.fecha.value : '';
                const rut = elementos.rut ? elementos.rut.value.trim() : '';
                const nombre = elementos.nombre ? elementos.nombre.value.trim() : '';
                const motivo = elementos.motivo ? elementos.motivo.value : '';
                const submotivo = elementos.submotivo ? elementos.submotivo.value : '';
                const observacion = elementos.observacion ? elementos.observacion.value.trim() : '';

                console.log('📝 Valores del formulario:', { fecha, rut, nombre, motivo, submotivo, observacion });

                // Validaciones
                if (!fecha) {
                    alert("❌ Por favor verifique que la fecha esté establecida.");
                    return;
                }
                
                if (!rut) {
                    alert("❌ Por favor ingrese el RUT.");
                    if (elementos.rut) elementos.rut.focus();
                    return;
                }
                
                if (!nombre) {
                    alert("❌ Por favor ingrese el nombre.");
                    if (elementos.nombre) elementos.nombre.focus();
                    return;
                }
                
                if (!motivo || motivo === "ELIGE UNA OPCIÓN") {
                    alert("❌ Por favor seleccione un motivo.");
                    if (elementos.motivo) elementos.motivo.focus();
                    return;
                }
                
                if (!submotivo || submotivo === "ELIGE UNA OPCIÓN") {
                    alert("❌ Por favor seleccione un sub-motivo.");
                    if (elementos.submotivo) elementos.submotivo.focus();
                    return;
                }

                // Crear objeto registro con ID único y timestamp
                const nuevoRegistro = {
                    id: Date.now() + Math.random(), // ID único
                    fecha: fecha,
                    rut: rut,
                    nombre: nombre,
                    motivo: motivo,
                    submotivo: submotivo,
                    observacion: observacion,
                    fechaCreacion: new Date().toISOString() // Para ordenamiento
                };

                // Agregar al inicio del array para que aparezca en primera fila
                historialRegistros.unshift(nuevoRegistro);
                guardarHistorialEnStorage();
                actualizarTablaHistorial();

                // Limpiar campos del formulario
                if (elementos.rut) elementos.rut.value = "";
                if (elementos.nombre) elementos.nombre.value = "";
                if (elementos.motivo) elementos.motivo.selectedIndex = 0;
                if (elementos.submotivo) elementos.submotivo.selectedIndex = 0;
                if (elementos.observacion) elementos.observacion.value = "";

                // Mensaje de éxito
                mostrarMensajeTemp('✅ Registro guardado exitosamente', '#28a745');
                
                // Notificación push del sistema
                if (typeof showNotification === 'function') {
                    showNotification(
                        '💾 Registro Guardado',
                        `Nuevo registro para ${elementos.nombre?.value || 'N/A'} guardado exitosamente.`,
                        'success',
                        false,
                        [{text: '📊 Ver Historial', onclick: 'scrollToHistorial()'}]
                    );
                }
                
                console.log('✅ Nuevo registro agregado. Total:', historialRegistros.length);
                console.log('📋 Registro:', nuevoRegistro);
            };
            console.log('✅ Evento del botón GRABAR configurado');
        } else {
            console.error('❌ Botón GRABAR no encontrado');
        }
    }

    // Función para el botón EXPORTAR
    function configurarBotonExportar() {
        const btnExportar = document.getElementById('exportar');
        if (btnExportar) {
            btnExportar.onclick = function() {
                console.log('🔄 Botón EXPORTAR presionado');
                
                if (historialRegistros.length === 0) {
                    alert('❌ No hay registros para exportar');
                    return;
                }
                
                let csv = [];
                
                // Encabezados
                csv.push(['Fecha', 'RUT', 'Nombre', 'Motivo', 'Sub-Motivo', 'Observación'].join(','));
                
                // Datos - ordenados por fecha de creación (más recientes primero)
                const registrosOrdenados = [...historialRegistros].sort((a, b) => {
                    const fechaA = new Date(a.fechaCreacion || a.fecha);
                    const fechaB = new Date(b.fechaCreacion || b.fecha);
                    return fechaB - fechaA;
                });
                
                registrosOrdenados.forEach(registro => {
                    const fila = [
                        `"${registro.fecha}"`,
                        `"${registro.rut}"`,
                        `"${registro.nombre}"`,
                        `"${registro.motivo}"`,
                        `"${registro.submotivo}"`,
                        `"${registro.observacion.replace(/"/g, '""')}"` // Escapar comillas
                    ];
                    csv.push(fila.join(','));
                });
                
                const csvString = csv.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `historial_registros_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                mostrarMensajeTemp('📥 Historial exportado exitosamente', '#17a2b8');
                console.log('✅ Historial exportado exitosamente');
                
                // Notificación push del sistema
                if (typeof showNotification === 'function') {
                    showNotification(
                        '📥 Exportación Completa',
                        `Historial con ${historialRegistros.length} registros exportado exitosamente.`,
                        'success',
                        false,
                        [{text: '📂 Abrir Carpeta', onclick: 'abrirCarpetaDescargas()'}]
                    );
                }
            };
            console.log('✅ Evento del botón EXPORTAR configurado');
        } else {
            console.error('❌ Botón EXPORTAR no encontrado');
        }
    }

    // Función para el botón BORRAR TODO
    // ...existing code...

    // Cerrar modal PDF
    function cerrarModalPdf() {
        document.getElementById('modalPdf').style.display = 'none';
        if (typeof ocultarFormularioEnlace === 'function') {
            ocultarFormularioEnlace();
        }
    }

    // ============ FUNCIONES DEL MODAL DE ANEXO ============
    
    // Función para abrir modal de anexo
    function abrirModalAnexo() {
        console.log('🔄 Abriendo modal de anexo');
        const modal = document.getElementById('modalAnexo');
        if (modal) {
            modal.style.display = 'flex';
            console.log('✅ Modal de anexo abierto');
        } else {
            console.error('❌ Modal de anexo no encontrado');
            alert('❌ Error: Modal de anexo no encontrado');
        }
    }
    
    // Función para cerrar modal de anexo
    function cerrarModalAnexo() {
        console.log('🔄 Cerrando modal de anexo');
        const modal = document.getElementById('modalAnexo');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de anexo cerrado');
        }
    }
    
    // Configurar botón de anexo
    function configurarBotonAnexo() {
        const btnAnexo = document.getElementById('btnAnexo');
        if (btnAnexo) {
            console.log('✅ Botón ANEXO listo para desplegar submenú');
        } else {
            console.error('❌ Botón ANEXO no encontrado');
        }
    }

    // Submenú ANEXO: toggle mostrar/ocultar
    function toggleSubmenuAnexo(e) {
        e.stopPropagation();
        const submenu = document.getElementById('submenuAnexo');
        const btn = document.getElementById('btnAnexo');
        if (!submenu) return;
        const visible = submenu.style.display === 'block';
        submenu.style.display = visible ? 'none' : 'block';
        if (btn) btn.setAttribute('aria-expanded', visible ? 'false' : 'true');
    }

    // Cerrar submenú anexo al hacer clic fuera
    document.addEventListener('click', function(ev){
        const submenu = document.getElementById('submenuAnexo');
        const btn = document.getElementById('btnAnexo');
        if (submenu && btn && submenu.style.display === 'block') {
            if (!submenu.contains(ev.target) && !btn.contains(ev.target)) {
                submenu.style.display = 'none';
                btn.setAttribute('aria-expanded','false');
            }
        }
    });

    // ===== Modal IVR =====
    function abrirModalIVR() {
        const m = document.getElementById('modalIVR');
        if (m) {
            m.style.display = 'flex';
            // Oculta submenú al abrir
            const submenu = document.getElementById('submenuAnexo');
            if (submenu) submenu.style.display = 'none';
        } else {
            console.error('❌ Modal IVR no encontrado');
        }
    }
    function cerrarModalIVR() {
        const m = document.getElementById('modalIVR');
        if (m) m.style.display = 'none';
    }
    // Copiar contenido textual del diagrama IVR
    function copiarIVR(){
        const modal = document.getElementById('modalIVR');
        if(!modal) return;
        const texto = Array.from(modal.querySelectorAll('div, span'))
            .map(n=>n.innerText.trim())
            .filter(t=>t.length>0)
            .join('\n');
        if(navigator.clipboard){
            navigator.clipboard.writeText(texto).then(()=>{
                mostrarToastIVR('✅ Diagrama IVR copiado');
            }).catch(()=>{alert('Error al copiar');});
        } else {
            const ta=document.createElement('textarea');
            ta.value=texto;document.body.appendChild(ta);ta.select();
            try{document.execCommand('copy');mostrarToastIVR('✅ Diagrama IVR copiado');}catch(e){alert('Error al copiar');}
            document.body.removeChild(ta);
        }
    }
    // Imprimir sólo contenido diagrama
    function imprimirIVR(){
        const modal = document.getElementById('modalIVR');
        if(!modal) return;
        const contenido = modal.querySelector('div[style*="DIAGRAMA DE IVR"]').parentElement.innerHTML;
        const w = window.open('', '_blank');
        w.document.write('<html><head><title>Diagrama IVR</title><style>body{font-family:Arial, sans-serif; margin:20px;} .col-print div{page-break-inside:avoid;} </style></head><body>'+contenido+'</body></html>');
        w.document.close();
        w.focus();
        w.print();
    }
    // Toast temporal
    function mostrarToastIVR(msg){
        let t = document.getElementById('toastIVR');
        if(!t){
            t=document.createElement('div');
            t.id='toastIVR';
            t.style.position='fixed';
            t.style.bottom='20px';
            t.style.left='50%';
            t.style.transform='translateX(-50%)';
            t.style.background='rgba(30,58,138,0.95)';
            t.style.color='#fff';
            t.style.padding='10px 18px';
            t.style.borderRadius='10px';
            t.style.fontSize='.8rem';
            t.style.fontWeight='600';
            t.style.boxShadow='0 6px 18px rgba(30,58,138,0.35)';
            document.body.appendChild(t);
        }
        t.textContent=msg;
        t.style.opacity='1';
        setTimeout(()=>{t.style.transition='opacity .6s'; t.style.opacity='0';},1800);
    }

    // ============ FUNCIONES DEL MODAL DE PRECIOS ============
    
    // Función para abrir modal de precios
    function abrirModalPrecios() {
        console.log('🔄 Abriendo modal de precios');
        const modal = document.getElementById('modalPrecios');
        if (modal) {
            modal.style.display = 'flex';
            // Restablecer zoom del contenido de precios al abrir
            const cont = document.getElementById('contenidoPrecios');
            if (cont) {
                cont.style.transform = 'scale(1)';
            }
            console.log('✅ Modal de precios abierto');
        } else {
            console.error('❌ Modal de precios no encontrado');
            alert('❌ Error: Modal de precios no encontrado');
        }
    }
    
    // Función para cerrar modal de precios
    function cerrarModalPrecios() {
        console.log('🔄 Cerrando modal de precios');
        const modal = document.getElementById('modalPrecios');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de precios cerrado');
        }
    }
    
    // Configurar botón de precios
    function configurarBotonPrecios() {
        const btnPrecios = document.getElementById('btnPrecios');
        if (btnPrecios) {
            btnPrecios.onclick = function() {
                console.log('🔄 Botón PRECIOS presionado');
                abrirModalPrecios();
            };
            console.log('✅ Evento del botón PRECIOS configurado');
        } else {
            console.error('❌ Botón PRECIOS no encontrado');
        }
    }
    
    // ============ FUNCIONES DEL MODAL DE CORREOS ============
    
    // Función para abrir modal de correos
    function abrirModalCorreos() {
        console.log('🔄 Abriendo modal de correos');
        const modal = document.getElementById('modalCorreos');
        if (modal) {
            modal.style.display = 'flex';
            console.log('✅ Modal de correos abierto');
        } else {
            console.error('❌ Modal de correos no encontrado');
            alert('❌ Error: Modal de correos no encontrado');
        }
    }
    
    // Función para cerrar modal de correos
    function cerrarModalCorreos() {
        console.log('🔄 Cerrando modal de correos');
        const modal = document.getElementById('modalCorreos');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de correos cerrado');
        }
    }
    
    // Función para copiar correo al portapapeles
    function copiarCorreo(correo) {
        if (navigator.clipboard && window.isSecureContext) {
            // Método moderno para navegadores seguros
            navigator.clipboard.writeText(correo).then(function() {
                console.log('✅ Correo copiado al portapapeles:', correo);
                mostrarMensajeTemp(`📧 Correo copiado: ${correo}`, '#28a745');
            }).catch(function(err) {
                console.error('❌ Error al copiar:', err);
                copiarCorreoFallback(correo);
            });
        } else {
            // Método de respaldo para navegadores más antiguos
            copiarCorreoFallback(correo);
        }
    }
    
    // Función de respaldo para copiar al portapapeles
    function copiarCorreoFallback(correo) {
        const textArea = document.createElement('textarea');
        textArea.value = correo;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            console.log('✅ Correo copiado al portapapeles (método de respaldo):', correo);
            mostrarMensajeTemp(`📧 Correo copiado: ${correo}`, '#28a745');
        } catch (err) {
            console.error('❌ Error al copiar con método de respaldo:', err);
            // Como último recurso, mostrar el correo en un prompt para que el usuario lo copie manualmente
            prompt('Copia este correo manualmente:', correo);
        } finally {
            document.body.removeChild(textArea);
        }
    }
    
    // Configurar botón de correos
    function configurarBotonCorreos() {
        const btnCorreos = document.getElementById('btnCorreos');
        if (btnCorreos) {
            btnCorreos.onclick = function() {
                console.log('🔄 Botón CORREOS presionado');
                abrirModalCorreos();
            };
            console.log('✅ Evento del botón CORREOS configurado');
        } else {
            console.error('❌ Botón CORREOS no encontrado');
        }
    }
    
    // ============ FUNCIONES DEL MODAL DE ATENCIÓN ============
    
    // Función para configurar botón de atención
    function configurarBotonAtencion() {
        const btnAtencion = document.getElementById('btnAtencion');
        if (btnAtencion) {
            btnAtencion.onclick = function() {
                console.log('🔄 Botón ATENCIÓN presionado');
                abrirModalAtencion();
            };
            console.log('✅ Evento del botón ATENCIÓN configurado');
        } else {
            console.error('❌ Botón ATENCIÓN no encontrado');
        }
    }
    
    // Función para guardar registro de atención
    function guardarRegistroAtencion() {
        const fecha = document.getElementById('fechaAtencion').value;
        const usuario = document.getElementById('usuarioAtencion').value.trim();
        const tipo = document.getElementById('tipoAtencion').value;
        const titulo = document.getElementById('tituloAtencion').value.trim();
        const descripcion = document.getElementById('descripcionAtencion').value.trim();
        const prioridad = document.getElementById('prioridadAtencion').value;
        const estado = document.getElementById('estadoAtencion').value;
        
        // Validaciones
        if (!fecha) {
            alert('❌ La fecha es requerida');
            return;
        }
        if (!usuario) {
            alert('❌ El nombre del usuario es requerido');
            document.getElementById('usuarioAtencion').focus();
            return;
        }
        if (!tipo) {
            alert('❌ Debe seleccionar un tipo de registro');
            document.getElementById('tipoAtencion').focus();
            return;
        }
        if (!titulo) {
            alert('❌ El título es requerido');
            document.getElementById('tituloAtencion').focus();
            return;
        }
        if (!descripcion) {
            alert('❌ La descripción es requerida');
            document.getElementById('descripcionAtencion').focus();
            return;
        }
        
        // Crear nuevo registro
        const nuevoRegistro = {
            id: Date.now() + Math.random(),
            fecha: fecha,
            usuario: usuario,
            tipo: tipo,
            titulo: titulo,
            descripcion: descripcion,
            prioridad: prioridad,
            estado: estado,
            fechaCreacion: new Date().toISOString()
        };
        
        // Agregar al array
        registrosAtencion.unshift(nuevoRegistro);
        guardarRegistrosAtencion();
        actualizarTablaAtencion();
        limpiarFormularioAtencion();
        
        // Reproducir sonido de notificación
        reproducirSonidoAtencion();
        
        // Mostrar pop-up prominente
        mostrarPopUpAtencion(nuevoRegistro);
        
        // Mensaje temporal adicional
        mostrarMensajeTemp('✅ Registro de atención guardado exitosamente', '#28a745');
        console.log('✅ Nuevo registro de atención guardado:', nuevoRegistro);
    }
    
    // Función para limpiar formulario
    function limpiarFormularioAtencion() {
        document.getElementById('usuarioAtencion').value = '';
        document.getElementById('tipoAtencion').selectedIndex = 0;
        document.getElementById('tituloAtencion').value = '';
        document.getElementById('descripcionAtencion').value = '';
        document.getElementById('prioridadAtencion').selectedIndex = 1; // Media
        document.getElementById('estadoAtencion').selectedIndex = 0; // Pendiente
        
        // Actualizar fecha
        const ahora = new Date();
        const fechaLocal = new Date(ahora.getTime() - (ahora.getTimezoneOffset() * 60000));
        document.getElementById('fechaAtencion').value = fechaLocal.toISOString().slice(0, 16);
    }
    
    // Función para reproducir sonido de atención
    function reproducirSonidoAtencion() {
        try {
            // Crear un contexto de audio
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Crear una secuencia de tonos para la alerta
            const playTone = (frequency, duration, delay = 0) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }, delay);
            };
            
            // Secuencia de tonos de alerta: dos tonos altos
            playTone(800, 0.2, 0);      // Primer tono
            playTone(1000, 0.2, 300);   // Segundo tono
            playTone(800, 0.3, 600);    // Tercer tono
            
            console.log('🔊 Sonido de atención reproducido');
        } catch (error) {
            console.log('⚠️ No se pudo reproducir el sonido:', error);
            // Fallback: usar beep del sistema si está disponible
            if (typeof window !== 'undefined' && window.speechSynthesis) {
                window.speechSynthesis.speak(new SpeechSynthesisUtterance(''));
            }
        }
    }
    
    // Función para mostrar pop-up prominente de atención
    function mostrarPopUpAtencion(registro) {
        // Crear overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(220, 53, 69, 0.9);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-in;
        `;
        
        // Crear modal del pop-up
        const popup = document.createElement('div');
        popup.style.cssText = `
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            text-align: center;
            border: 3px solid #dc3545;
            animation: scaleIn 0.3s ease-out;
        `;
        
        // Icono y colores según prioridad
        const iconosPrioridad = {
            'Crítica': '🚨',
            'Alta': '🔴',
            'Media': '🟡',
            'Baja': '🟢'
        };
        
        const coloresPrioridad = {
            'Crítica': '#dc3545',
            'Alta': '#fd7e14', 
            'Media': '#ffc107',
            'Baja': '#28a745'
        };
        
        const icono = iconosPrioridad[registro.prioridad] || '⚠️';
        const color = coloresPrioridad[registro.prioridad] || '#dc3545';
        
        popup.innerHTML = `
            <div style="font-size: 4em; margin-bottom: 20px; animation: pulse 1s infinite;">${icono}</div>
            <h2 style="color: ${color}; margin-bottom: 20px; font-size: 1.8em;">¡REGISTRO DE ATENCIÓN GUARDADO!</h2>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: left;">
                <p style="margin: 5px 0;"><strong>📋 Tipo:</strong> ${registro.tipo}</p>
                <p style="margin: 5px 0;"><strong>🏷️ Título:</strong> ${registro.titulo}</p>
                <p style="margin: 5px 0;"><strong>👤 Usuario:</strong> ${registro.usuario}</p>
                <p style="margin: 5px 0;"><strong>⚡ Prioridad:</strong> <span style="color: ${color}; font-weight: bold;">${registro.prioridad}</span></p>
                <p style="margin: 5px 0;"><strong>📅 Fecha:</strong> ${new Date(registro.fecha).toLocaleString('es-CL')}</p>
            </div>
            <button id="cerrarPopupAtencion" style="
                background: ${color};
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 8px;
                font-size: 1.1em;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s ease;
            ">✅ ENTENDIDO</button>
        `;
        
        overlay.appendChild(popup);
        document.body.appendChild(overlay);
        
        // Agregar estilos de animación
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes scaleIn {
                from { transform: scale(0.5); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
        `;
        document.head.appendChild(style);
        
        // Evento para cerrar
        const btnCerrar = document.getElementById('cerrarPopupAtencion');
        const cerrarPopup = () => {
            overlay.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                document.body.removeChild(overlay);
                document.head.removeChild(style);
            }, 300);
        };
        
        btnCerrar.onclick = cerrarPopup;
        
        // Cerrar con Escape
        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                cerrarPopup();
                document.removeEventListener('keydown', handleEscape);
            }
        };
        document.addEventListener('keydown', handleEscape);
        
        // Auto-cerrar después de 10 segundos si es prioridad baja
        if (registro.prioridad === 'Baja') {
            setTimeout(cerrarPopup, 10000);
        }
        
        console.log('🚨 Pop-up de atención mostrado para:', registro.titulo);
    }
    
    // Función para cargar registros desde localStorage
    function cargarRegistrosAtencion() {
        try {
            const datos = localStorage.getItem('registrosAtencionAchs');
            if (datos && datos !== 'null' && datos !== 'undefined') {
                registrosAtencion = JSON.parse(datos);
                console.log('✅ Registros de atención cargados:', registrosAtencion.length);
                actualizarTablaAtencion();
                return true;
            }
            registrosAtencion = [];
            return false;
        } catch (e) {
            console.error('❌ Error al cargar registros de atención:', e);
            registrosAtencion = [];
            return false;
        }
    }
    
    // Función para guardar registros en localStorage
    function guardarRegistrosAtencion() {
        try {
            localStorage.setItem('registrosAtencionAchs', JSON.stringify(registrosAtencion));
            console.log('✅ Registros de atención guardados:', registrosAtencion.length);
        } catch (e) {
            console.error('❌ Error al guardar registros de atención:', e);
            alert('Error al guardar los registros. El almacenamiento puede estar lleno.');
        }
    }
    
    // Función para actualizar tabla de atención
    function actualizarTablaAtencion() {
        const tabla = document.getElementById('tablaAtencion');
        if (!tabla) return;
        
        const tbody = tabla.getElementsByTagName('tbody')[0];
        if (!tbody) return;
        
        tbody.innerHTML = '';
        
        if (registrosAtencion.length === 0) {
            const fila = tbody.insertRow();
            const celda = fila.insertCell(0);
            celda.colSpan = 7;
            celda.style.textAlign = 'center';
            celda.style.color = '#888';
            celda.style.padding = '20px';
            celda.innerHTML = 'No hay registros de atención';
            return;
        }
        
        // Ordenar por fecha de creación (más recientes primero)
        const registrosOrdenados = [...registrosAtencion].sort((a, b) => 
            new Date(b.fechaCreacion) - new Date(a.fechaCreacion)
        );
        
        registrosOrdenados.forEach((registro, index) => {
            const fila = tbody.insertRow();
            fila.style.background = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
            
            // Fecha
            const fechaFormateada = new Date(registro.fecha).toLocaleString('es-CL');
            fila.insertCell(0).innerHTML = fechaFormateada;
            
            // Usuario
            fila.insertCell(1).innerHTML = registro.usuario;
            
            // Tipo
            const tipoIconos = {
                'Incidencia': '🚨',
                'Cambio de Procedimiento': '🔄',
                'Mejora': '💡',
                'Observación': '👁️',
                'Capacitación': '📚',
                'Otro': '📌'
            };
            fila.insertCell(2).innerHTML = (tipoIconos[registro.tipo] || '📌') + ' ' + registro.tipo;
            
            // Título (con tooltip para descripción)
            const celdaTitulo = fila.insertCell(3);
            celdaTitulo.innerHTML = registro.titulo;
            celdaTitulo.title = registro.descripcion;
            celdaTitulo.style.cursor = 'help';
            
            // Prioridad
            const prioridadColores = {
                'Baja': '#28a745',
                'Media': '#ffc107',
                'Alta': '#fd7e14',
                'Crítica': '#dc3545'
            };
            const celdaPrioridad = fila.insertCell(4);
            celdaPrioridad.innerHTML = registro.prioridad;
            celdaPrioridad.style.color = prioridadColores[registro.prioridad] || '#666';
            celdaPrioridad.style.fontWeight = 'bold';
            celdaPrioridad.style.textAlign = 'center';
            
            // Estado
            const estadoColores = {
                'Pendiente': '#ffc107',
                'En Proceso': '#17a2b8',
                'Resuelto': '#28a745',
                'Cancelado': '#dc3545'
            };
            const celdaEstado = fila.insertCell(5);
            celdaEstado.innerHTML = registro.estado;
            celdaEstado.style.color = estadoColores[registro.estado] || '#666';
            celdaEstado.style.fontWeight = 'bold';
            celdaEstado.style.textAlign = 'center';
            
            // Botón eliminar
            const celdaEliminar = fila.insertCell(6);
            celdaEliminar.style.textAlign = 'center';
            const btnEliminar = document.createElement('button');
            btnEliminar.innerHTML = '🗑️';
            btnEliminar.style.cssText = 'background:#dc3545; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:0.8em;';
            btnEliminar.onclick = function() {
                if (confirm('¿Estás seguro de eliminar este registro?')) {
                    eliminarRegistroAtencion(registro.id);
                }
            };
            celdaEliminar.appendChild(btnEliminar);
        });
    }
    
    // Función para eliminar registro de atención
    function eliminarRegistroAtencion(id) {
        registrosAtencion = registrosAtencion.filter(r => r.id !== id);
        guardarRegistrosAtencion();
        actualizarTablaAtencion();
        mostrarMensajeTemp('🗑️ Registro eliminado exitosamente', '#dc3545');
    }
    
    // Función para exportar registros de atención
    function exportarRegistrosAtencion() {
        if (registrosAtencion.length === 0) {
            alert('❌ No hay registros para exportar');
            return;
        }
        
        let csv = [];
        csv.push(['Fecha', 'Usuario', 'Tipo', 'Título', 'Descripción', 'Prioridad', 'Estado'].join(','));
        
        const registrosOrdenados = [...registrosAtencion].sort((a, b) => 
            new Date(b.fechaCreacion) - new Date(a.fechaCreacion)
        );
        
        registrosOrdenados.forEach(registro => {
            const fila = [
                `"${new Date(registro.fecha).toLocaleString('es-CL')}"`,
                `"${registro.usuario}"`,
                `"${registro.tipo}"`,
                `"${registro.titulo}"`,
                `"${registro.descripcion.replace(/"/g, '""')}"`,
                `"${registro.prioridad}"`,
                `"${registro.estado}"`
            ];
            csv.push(fila.join(','));
        });
        
        const csvString = csv.join('\n');
        const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `registros_atencion_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        mostrarMensajeTemp('📥 Registros de atención exportados exitosamente', '#17a2b8');
        
        // Notificación push del sistema
        if (typeof showNotification === 'function') {
            showNotification(
                '📊 Datos de Atención Exportados',
                `${registrosAtencion.length} registros de atención exportados exitosamente.`,
                'success'
            );
        }
    }
    
    // ============ FUNCIONES DEL SISTEMA DE ALERTAS ============
    
    // Función para abrir modal de alertas
    function abrirModalAlerta() {
        console.log('🔄 Abriendo modal de alertas');
        const modal = document.getElementById('modalAlerta');
        if (modal) {
            modal.style.display = 'flex';
            // Establecer fecha mínima como ahora
            const ahora = new Date();
            const fechaLocal = new Date(ahora.getTime() - (ahora.getTimezoneOffset() * 60000));
            document.getElementById('fechaAlerta').min = fechaLocal.toISOString().slice(0, 16);
            cargarAlertas();
            console.log('✅ Modal de alertas abierto');
        } else {
            console.error('❌ Modal de alertas no encontrado');
        }
    }
    
    function cerrarModalAlerta() {
        console.log('🔄 Cerrando modal de alertas');
        const modal = document.getElementById('modalAlerta');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de alertas cerrado');
        }
    }
    
    // Función para configurar botón de alertas
    function configurarBotonAlerta() {
        const btnAlerta = document.getElementById('btnAlerta');
        if (btnAlerta) {
            btnAlerta.onclick = function() {
                console.log('🔄 Botón ALERTA presionado');
                abrirModalAlerta();
            };
            console.log('✅ Evento del botón ALERTA configurado');
        } else {
            console.error('❌ Botón ALERTA no encontrado');
        }
    }
    
    // Función para guardar nueva alerta
    function guardarAlerta() {
        const fecha = document.getElementById('fechaAlerta').value;
        const titulo = document.getElementById('tituloAlerta').value.trim();
        const descripcion = document.getElementById('descripcionAlerta').value.trim();
        const prioridad = document.getElementById('prioridadAlerta').value;
        const tipo = document.getElementById('tipoAlerta').value;
        const repetir = document.getElementById('repetirAlerta').value;
        
        // Validaciones
        if (!fecha) {
            alert('❌ Debe seleccionar fecha y hora para la alerta');
            document.getElementById('fechaAlerta').focus();
            return;
        }
        
        const fechaAlerta = new Date(fecha);
        const ahora = new Date();
        
        if (fechaAlerta <= ahora) {
            alert('❌ La fecha debe ser futura');
            document.getElementById('fechaAlerta').focus();
            return;
        }
        
        if (!titulo) {
            alert('❌ El título es requerido');
            document.getElementById('tituloAlerta').focus();
            return;
        }
        
        if (!descripcion) {
            alert('❌ La descripción es requerida');
            document.getElementById('descripcionAlerta').focus();
            return;
        }
        
        // Crear nueva alerta
        const nuevaAlerta = {
            id: Date.now() + Math.random(),
            fecha: fecha,
            titulo: titulo,
            descripcion: descripcion,
            prioridad: prioridad,
            tipo: tipo,
            repetir: repetir,
            activa: true,
            fechaCreacion: new Date().toISOString()
        };
        
        // Agregar al array
        alertasProgramadas.push(nuevaAlerta);
        guardarAlertas();
        actualizarTablaAlertas();
        programarAlerta(nuevaAlerta);
        limpiarFormularioAlerta();
        
        // Reproducir sonido de confirmación
        reproducirSonidoConfirmacion();
        
        mostrarMensajeTemp('⏰ Alerta programada exitosamente', '#ffc107');
        console.log('✅ Nueva alerta programada:', nuevaAlerta);
    }
    
    // Función para limpiar formulario de alerta
    function limpiarFormularioAlerta() {
        document.getElementById('fechaAlerta').value = '';
        document.getElementById('tituloAlerta').value = '';
        document.getElementById('descripcionAlerta').value = '';
        document.getElementById('prioridadAlerta').selectedIndex = 1; // Media
        document.getElementById('tipoAlerta').selectedIndex = 0; // Tarea
        document.getElementById('repetirAlerta').selectedIndex = 0; // No repetir
    }
    
    // Función para programar alerta en el navegador
    function programarAlerta(alerta) {
        const fechaAlerta = new Date(alerta.fecha);
        const ahora = new Date();
        const tiempoEspera = fechaAlerta.getTime() - ahora.getTime();
        
        if (tiempoEspera > 0) {
            const timeoutId = setTimeout(() => {
                mostrarAlertaEmergente(alerta);
            }, tiempoEspera);
            
            // Guardar el ID del timeout para poder cancelarlo
            intervalosAlerta.push({
                id: alerta.id,
                timeoutId: timeoutId
            });
            
            console.log(`⏰ Alerta programada para: ${fechaAlerta.toLocaleString()}`);
        }
    }
    
    // Función para mostrar alerta emergente con sonido
    function mostrarAlertaEmergente(alerta) {
        // Reproducir sonido de alerta
        reproducirSonidoAlertaUrgente();
        
        // Crear overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(255, 193, 7, 0.95);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: alertaBlink 1s infinite;
        `;
        
        // Crear modal de alerta
        const popup = document.createElement('div');
        popup.style.cssText = `
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            text-align: center;
            border: 4px solid #ffc107;
            animation: alertaShake 0.5s ease-in-out infinite;
        `;
        
        // Icono y colores según prioridad
        const iconosPrioridad = {
            'Crítica': '🚨',
            'Alta': '🔴',
            'Media': '🟡',
            'Baja': '🟢'
        };
        
        const coloresPrioridad = {
            'Crítica': '#dc3545',
            'Alta': '#fd7e14', 
            'Media': '#ffc107',
            'Baja': '#28a745'
        };
        
        const icono = iconosPrioridad[alerta.prioridad] || '⏰';
        const color = coloresPrioridad[alerta.prioridad] || '#ffc107';
        
        const tipoIconos = {
            'Tarea': '📋',
            'Reunión': '👥',
            'Llamada': '📞',
            'Revisión': '🔍',
            'Entrega': '📤',
            'Otro': '📌'
        };
        
        popup.innerHTML = `
            <div style="font-size: 5em; margin-bottom: 20px; animation: pulse 1s infinite;">${icono}</div>
            <h1 style="color: ${color}; margin-bottom: 20px; font-size: 2.2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">¡RECORDATORIO PROGRAMADO!</h1>
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px; text-align: left; border: 2px solid ${color};">
                <p style="margin: 8px 0; font-size: 1.1em;"><strong>${tipoIconos[alerta.tipo] || '📌'} Tipo:</strong> ${alerta.tipo}</p>
                <p style="margin: 8px 0; font-size: 1.3em; color: ${color}; font-weight: bold;"><strong>🏷️ Tarea:</strong> ${alerta.titulo}</p>
                <p style="margin: 8px 0; font-size: 1.1em;"><strong>📝 Descripción:</strong> ${alerta.descripcion}</p>
                <p style="margin: 8px 0; font-size: 1.1em;"><strong>⚡ Prioridad:</strong> <span style="color: ${color}; font-weight: bold;">${alerta.prioridad}</span></p>
                <p style="margin: 8px 0; font-size: 1em;"><strong>📅 Programado para:</strong> ${new Date(alerta.fecha).toLocaleString('es-CL')}</p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="completarAlerta" style="
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1.1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">✅ COMPLETADO</button>
                <button id="posponerAlerta" style="
                    background: #17a2b8;
                    color: white;
                    border: none;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1.1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">⏰ POSPONER 10 MIN</button>
                <button id="cerrarAlertaEmergente" style="
                    background: ${color};
                    color: white;
                    border: none;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1.1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">👁️ ENTENDIDO</button>
            </div>
        `;
        
        overlay.appendChild(popup);
        document.body.appendChild(overlay);
        
        // Agregar estilos de animación
        const style = document.createElement('style');
        style.textContent = `
            @keyframes alertaBlink {
                0%, 50% { background: rgba(255, 193, 7, 0.95); }
                51%, 100% { background: rgba(255, 193, 7, 0.7); }
            }
            @keyframes alertaShake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // Eventos de botones
        const cerrarAlerta = () => {
            overlay.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                document.body.removeChild(overlay);
                document.head.removeChild(style);
            }, 300);
        };
        
        document.getElementById('completarAlerta').onclick = () => {
            marcarAlertaCompletada(alerta.id);
            cerrarAlerta();
        };
        
        document.getElementById('posponerAlerta').onclick = () => {
            posponerAlerta(alerta, 10);
            cerrarAlerta();
        };
        
        document.getElementById('cerrarAlertaEmergente').onclick = cerrarAlerta;
        
        // Cerrar con Escape
        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                cerrarAlerta();
                document.removeEventListener('keydown', handleEscape);
            }
        };
        document.addEventListener('keydown', handleEscape);
        
        console.log('🚨 Alerta emergente mostrada:', alerta.titulo);
    }
    
    // Función para reproducir sonido de alerta urgente
    function reproducirSonidoAlertaUrgente() {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            const playTone = (frequency, duration, delay = 0) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = 'square';
                    
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }, delay);
            };
            
            // Secuencia de sonidos urgentes: sirena
            for (let i = 0; i < 6; i++) {
                playTone(800, 0.3, i * 350);
                playTone(1200, 0.3, i * 350 + 150);
            }
            
            console.log('🔊 Sonido de alerta urgente reproducido');
        } catch (error) {
            console.log('⚠️ No se pudo reproducir el sonido de alerta:', error);
        }
    }
    
    // Función para reproducir sonido de confirmación
    function reproducirSonidoConfirmacion() {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            const playTone = (frequency, duration, delay = 0) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + duration);
                }, delay);
            };
            
            // Sonido de confirmación: tonos ascendentes
            playTone(523, 0.2, 0);    // Do
            playTone(659, 0.2, 200);  // Mi
            playTone(784, 0.3, 400);  // Sol
            
        } catch (error) {
            console.log('⚠️ No se pudo reproducir el sonido de confirmación:', error);
        }
    }
    
    // Funciones para gestión de enlaces PDF
    function mostrarFormularioEnlace() {
        document.getElementById('formularioEnlace').style.display = 'block';
        document.getElementById('nombreEnlace').focus();
    }

    function ocultarFormularioEnlace() {
        document.getElementById('formularioEnlace').style.display = 'none';
        document.getElementById('nombreEnlace').value = '';
        document.getElementById('urlEnlace').value = '';
    }

    function agregarEnlace() {
        const nombre = document.getElementById('nombreEnlace').value.trim();
        const url = document.getElementById('urlEnlace').value.trim();
        
        if (!nombre) {
            alert('❌ Por favor ingrese un nombre para el enlace');
            return;
        }
        
        if (!url) {
            alert('❌ Por favor ingrese la URL del PDF');
            return;
        }
        
        // Validar que sea una URL válida
        try {
            new URL(url);
        } catch (e) {
            alert('❌ Por favor ingrese una URL válida');
            return;
        }
        
        // Crear objeto enlace
        const enlace = {
            id: Date.now() + Math.random(),
            nombre: nombre,
            url: url,
            tipo: 'enlace',
            fechaCreacion: new Date().toLocaleDateString()
        };
        
        // Agregar a la lista
        documentosGuardados.push(enlace);
        guardarEnLocalStorage();
        actualizarListaDocumentos();
        
        // Limpiar formulario y ocultarlo
        ocultarFormularioEnlace();
        
        alert(`✅ Enlace "${nombre}" agregado exitosamente`);
        console.log('Enlace agregado:', enlace);
    }

    function actualizarListaDocumentos() {
        console.log('🔄 Ejecutando actualizarListaDocumentos...');
        const lista = document.getElementById('listaDocumentos');
        if (!lista) {
            console.warn('⚠️ Elemento listaDocumentos no encontrado');
            return;
        }
        
        lista.innerHTML = '';
        
        if (documentosGuardados.length === 0) {
            lista.innerHTML = '<p style="color:#888; font-size:0.9em; margin:10px 0;">No hay documentos guardados</p>';
            return;
        }
        
        console.log(`📋 Mostrando ${documentosGuardados.length} documentos`);
        
        documentosGuardados.forEach((doc, index) => {
            const item = document.createElement('div');
            const esEnlace = doc.tipo === 'enlace';
            
            item.style.cssText = 'border:1px solid #ddd; border-radius:4px; padding:8px; margin-bottom:8px; background:#f9f9f9; transition: all 0.3s ease; position:relative;';
            
            const icono = esEnlace ? '🔗' : '📄';
            const tipo = esEnlace ? 'Enlace' : 'Archivo';
            
            item.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div style="flex:1; cursor:pointer;" onclick="${esEnlace ? `abrirEnlace('${doc.url}')` : `mostrarDocumento(documentosGuardados[${index}])`}">
                        <div style="font-weight:bold; color:#002147; margin-bottom:3px;">${icono} ${doc.nombre}</div>
                        <div style="font-size:0.8em; color:#666;">${tipo} • ${doc.fechaCreacion}</div>
                    </div>
                    <button onclick="eliminarDocumento(${index})" style="background:#dc3545; color:white; border:none; border-radius:50%; width:24px; height:24px; cursor:pointer; font-size:0.8em; font-weight:bold; transition:all 0.3s ease; margin-left:8px; display:flex; align-items:center; justify-content:center;" 
                            onmouseover="this.style.background='#c82333'; this.style.transform='scale(1.1)'" 
                            onmouseout="this.style.background='#dc3545'; this.style.transform='scale(1)'"
                            title="Eliminar documento">
                        ×
                    </button>
                </div>
            `;
            
            // Efecto hover para el contenedor completo
            item.onmouseover = function() {
                this.style.background = '#e3f2fd';
                this.style.transform = 'translateX(3px)';
                this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
            };
            
            item.onmouseout = function() {
                this.style.background = '#f9f9f9';
                this.style.transform = 'translateX(0)';
                this.style.boxShadow = 'none';
            };
            
            lista.appendChild(item);
        });
    }

    function eliminarDocumento(index) {
        if (index < 0 || index >= documentosGuardados.length) {
            console.error('❌ Índice inválido para eliminar documento:', index);
            return;
        }
        
        const documento = documentosGuardados[index];
        
        // Confirmación antes de eliminar
        if (confirm(`¿Está seguro de que desea eliminar el documento "${documento.nombre}"?`)) {
            console.log(`🗑️ Eliminando documento: ${documento.nombre}`);
            
            // Eliminar del array
            documentosGuardados.splice(index, 1);
            
            // Actualizar localStorage
            guardarEnLocalStorage();
            
            // Actualizar la visualización
            actualizarListaDocumentos();
            
            // Mostrar mensaje de confirmación
            alert('✅ Documento eliminado exitosamente');
        }
    }

    function abrirEnlace(url) {
        window.open(url, '_blank');
    }

    function guardarEnLocalStorage() {
        try {
            const datos = JSON.stringify(documentosGuardados);
            localStorage.setItem('documentosAchs', datos);
            console.log('✅ Guardado en localStorage exitoso. Total:', documentosGuardados.length);
        } catch (e) {
            console.error('❌ Error al guardar en localStorage:', e);
            alert('Error al guardar los documentos. El almacenamiento puede estar lleno.');
        }
    }

    // ===== FUNCIONES FALTANTES SISTEMA DE ALERTAS =====
    
    // Función para cargar alertas desde localStorage
    function cargarAlertas() {
        try {
            console.log('🔄 Cargando alertas desde localStorage...');
            const datos = localStorage.getItem('alertasProgramadasAchs');
            
            if (datos && datos !== 'null' && datos !== 'undefined') {
                alertasProgramadas = JSON.parse(datos);
                actualizarTablaAlertas();
                
                // Reprogramar alertas pendientes
                alertasProgramadas.forEach(alerta => {
                    if (alerta.activa) {
                        const fechaAlerta = new Date(alerta.fecha);
                        const ahora = new Date();
                        if (fechaAlerta > ahora) {
                            programarAlerta(alerta);
                        }
                    }
                });
                
                console.log(`✅ Cargadas ${alertasProgramadas.length} alertas programadas`);
            } else {
                console.log('📝 No hay alertas guardadas');
                alertasProgramadas = [];
                actualizarTablaAlertas();
            }
        } catch (error) {
            console.error('❌ Error al cargar alertas:', error);
            alertasProgramadas = [];
            actualizarTablaAlertas();
        }
    }
    
    // Función para guardar alertas en localStorage
    function guardarAlertas() {
        try {
            localStorage.setItem('alertasProgramadasAchs', JSON.stringify(alertasProgramadas));
            console.log(`💾 Alertas guardadas: ${alertasProgramadas.length} elementos`);
        } catch (error) {
            console.error('❌ Error al guardar alertas:', error);
            alert('Error al guardar las alertas. El almacenamiento puede estar lleno.');
        }
    }
    
    // Función para actualizar tabla de alertas
    function actualizarTablaAlertas() {
        const tabla = document.getElementById('tablaAlertas');
        if (!tabla) {
            console.warn('⚠️ Tabla de alertas no encontrada');
            return;
        }
        
        const tbody = tabla.querySelector('tbody') || tabla;
        tbody.innerHTML = '';
        
        if (alertasProgramadas.length === 0) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td colspan="6" style="text-align:center; color:#6c757d; padding:20px; font-style:italic;">
                    📅 No hay alertas programadas
                </td>
            `;
            tbody.appendChild(tr);
            return;
        }
        
        // Ordenar alertas por fecha
        const alertasOrdenadas = [...alertasProgramadas].sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
        
        alertasOrdenadas.forEach((alerta, index) => {
            const tr = document.createElement('tr');
            const fecha = new Date(alerta.fecha);
            const fechaFormateada = fecha.toLocaleDateString('es-ES') + ' ' + fecha.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
            
            // Determinar estado y color
            const ahora = new Date();
            let estado, colorEstado;
            if (!alerta.activa) {
                estado = 'Completada';
                colorEstado = '#28a745';
            } else if (fecha < ahora) {
                estado = 'Vencida';
                colorEstado = '#dc3545';
            } else {
                estado = 'Pendiente';
                colorEstado = '#007bff';
            }
            
            // Iconos por prioridad
            const iconosPrioridad = {
                'Crítica': '🚨',
                'Alta': '🔴',
                'Media': '🟡',
                'Baja': '🟢'
            };
            
            tr.innerHTML = `
                <td style="padding:8px; border-bottom:1px solid #ddd;">
                    ${iconosPrioridad[alerta.prioridad] || '⚪'} ${alerta.prioridad}
                </td>
                <td style="padding:8px; border-bottom:1px solid #ddd;">
                    <strong>${alerta.titulo}</strong><br>
                    <small style="color:#666;">${alerta.descripcion}</small>
                </td>
                <td style="padding:8px; border-bottom:1px solid #ddd; font-size:0.9em;">
                    ${fechaFormateada}
                </td>
                <td style="padding:8px; border-bottom:1px solid #ddd;">
                    <span style="background:${colorEstado}; color:white; padding:2px 6px; border-radius:3px; font-size:0.8em;">
                        ${estado}
                    </span>
                </td>
                <td style="padding:8px; border-bottom:1px solid #ddd; font-size:0.8em;">
                    ${alerta.tipo}
                </td>
                <td style="padding:8px; border-bottom:1px solid #ddd; text-align:center;">
                    <button onclick="marcarAlertaCompletada('${alerta.id}')" 
                            style="background:#28a745; color:white; border:none; padding:4px 8px; border-radius:3px; cursor:pointer; font-size:0.8em; margin-right:4px;"
                            title="Marcar como completada">
                        ✓
                    </button>
                    <button onclick="eliminarAlerta('${alerta.id}')" 
                            style="background:#dc3545; color:white; border:none; padding:4px 8px; border-radius:3px; cursor:pointer; font-size:0.8em;"
                            title="Eliminar alerta">
                        ✗
                    </button>
                </td>
            `;
            
            tbody.appendChild(tr);
        });
        
        console.log(`📊 Tabla de alertas actualizada con ${alertasProgramadas.length} elementos`);
    }
    
    // Función para marcar alerta como completada
    function marcarAlertaCompletada(id) {
        const alerta = alertasProgramadas.find(a => a.id == id);
        if (alerta) {
            alerta.activa = false;
            guardarAlertas();
            actualizarTablaAlertas();
            mostrarMensajeTemp('✅ Alerta marcada como completada', '#28a745');
            console.log('✅ Alerta completada:', alerta.titulo);
        }
    }
    
    // Función para eliminar alerta
    function eliminarAlerta(id) {
        const alerta = alertasProgramadas.find(a => a.id == id);
        if (alerta && confirm(`¿Eliminar la alerta "${alerta.titulo}"?`)) {
            alertasProgramadas = alertasProgramadas.filter(a => a.id != id);
            guardarAlertas();
            actualizarTablaAlertas();
            mostrarMensajeTemp('🗑️ Alerta eliminada', '#dc3545');
            console.log('🗑️ Alerta eliminada:', alerta.titulo);
        }
    }
    
    // Función para verificar alertas vencidas
    function verificarAlertas() {
        const ahora = new Date();
        const alertasVencidas = alertasProgramadas.filter(a => a.activa && new Date(a.fecha) < ahora);
        
        if (alertasVencidas.length === 0) {
            mostrarMensajeTemp('✅ No hay alertas vencidas', '#28a745');
        } else {
            mostrarMensajeTemp(`⚠️ ${alertasVencidas.length} alerta(s) vencida(s)`, '#ffc107');
            alertasVencidas.forEach(alerta => {
                console.warn(`⚠️ Alerta vencida: ${alerta.titulo} (${alerta.fecha})`);
            });
        }
        
        actualizarTablaAlertas();
    }
    
    // Función para exportar alertas
    function exportarAlertas() {
        if (alertasProgramadas.length === 0) {
            mostrarMensajeTemp('❌ No hay alertas para exportar', '#dc3545');
            return;
        }
        
        let contenido = `REPORTE DE ALERTAS PROGRAMADAS - ACHS
=====================================
Fecha de exportación: ${new Date().toLocaleString()}
Total de alertas: ${alertasProgramadas.length}

`;
        
        alertasProgramadas.forEach((alerta, index) => {
            const fecha = new Date(alerta.fecha);
            const estado = alerta.activa ? (fecha < new Date() ? 'VENCIDA' : 'PENDIENTE') : 'COMPLETADA';
            
            contenido += `${index + 1}. ${alerta.titulo}
   Fecha: ${fecha.toLocaleString()}
   Prioridad: ${alerta.prioridad}
   Tipo: ${alerta.tipo}
   Estado: ${estado}
   Descripción: ${alerta.descripcion}
   
`;
        });
        
        const blob = new Blob([contenido], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `alertas_achs_${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        mostrarMensajeTemp('📄 Alertas exportadas correctamente', '#28a745');
        console.log('📄 Alertas exportadas exitosamente');
    }
    
    // ===== FIN FUNCIONES FALTANTES SISTEMA DE ALERTAS =====

    function cargarDocumentosGuardados() {
        try {
            console.log('🔄 Cargando documentos desde localStorage...');
            const datos = localStorage.getItem('documentosAchs');
            
            if (datos && datos !== 'null' && datos !== 'undefined') {
                documentosGuardados = JSON.parse(datos);
                console.log('✅ Documentos cargados desde localStorage. Total:', documentosGuardados.length);
                return true;
            }
            
            console.log('ℹ️ No hay documentos guardados o datos inválidos');
            documentosGuardados = [];
            
            // Agregar enlace de ejemplo si no hay documentos
            if (documentosGuardados.length === 0) {
                const enlaceEjemplo = {
                    id: Date.now(),
                    nombre: 'Ejemplo - Google Drive',
                    url: 'https://drive.google.com/file/d/ejemplo',
                    tipo: 'enlace',
                    fechaCreacion: new Date().toLocaleDateString()
                };
                documentosGuardados.push(enlaceEjemplo);
                guardarEnLocalStorage();
            }
            
            return false;
            
        } catch (e) {
            console.error('❌ Error al cargar desde localStorage:', e);
            documentosGuardados = [];
            return false;
        }
    }

    // Inicialización al cargar la página
    window.addEventListener('DOMContentLoaded', function() {
        console.log('🔄 Página cargada, inicializando...');
        
        // Establecer fecha actual
        const fechaElement = document.getElementById('fecha');
        if (fechaElement) {
            fechaElement.valueAsDate = new Date();
            console.log('✅ Fecha establecida');
        }
        
        // Configurar cierre de modales al hacer clic fuera de ellos
        window.onclick = function(event) {
            const modalPdf = document.getElementById('modalPdf');
            const modalPrecios = document.getElementById('modalPrecios');
            const modalAnexo = document.getElementById('modalAnexo');
            const modalCorreos = document.getElementById('modalCorreos');
            const modalAtencion = document.getElementById('modalAtencion');
            const modalReclamo = document.getElementById('modalReclamo');
            
            // Cerrar modal PDF si se hace clic fuera
            if (modalPdf && event.target === modalPdf) {
                cerrarModalPdf();
            }
            
            // Cerrar modal de precios si se hace clic fuera
            if (modalPrecios && event.target === modalPrecios) {
                cerrarModalPrecios();
            }
            
            // Cerrar modal de anexo si se hace clic fuera
            if (modalAnexo && event.target === modalAnexo) {
                cerrarModalAnexo();
            }
            
            // Cerrar modal de correos si se hace clic fuera
            if (modalCorreos && event.target === modalCorreos) {
                cerrarModalCorreos();
            }
            
            // Cerrar modal de atención si se hace clic fuera
            if (modalAtencion && event.target === modalAtencion) {
                cerrarModalAtencion();
            }
            
            // Cerrar modal de reclamos si se hace clic fuera
            if (modalReclamo && event.target === modalReclamo) {
                cerrarModalReclamo();
            }
        };
        console.log('✅ Configurado cierre de modales al hacer clic fuera');
        
        // Cargar datos guardados
        cargarDocumentosGuardados();
        cargarHistorialGuardado(); // CARGAR HISTORIAL
        cargarRegistrosAtencion(); // CARGAR REGISTROS DE ATENCIÓN
        cargarReclamosGuardados(); // CARGAR RECLAMOS GUARDADOS
        cargarAlertas(); // CARGAR ALERTAS
        cargarTareasPendientes(); // CARGAR TAREAS PENDIENTES
        cargarEmailsGuardados(); // CARGAR EMAILS
        
        // Configurar eventos de botones
        configurarBotonGrabar();
        configurarBotonExportar();
    // ...existing code...
        configurarBotonAnexo(); // CONFIGURAR BOTÓN ANEXO
        configurarBotonPrecios(); // CONFIGURAR BOTÓN PRECIOS
        configurarBotonCorreos(); // CONFIGURAR BOTÓN CORREOS
        configurarBotonReclamo(); // CONFIGURAR BOTÓN RECLAMO
        inicializarFormularioReclamo(); // INICIALIZAR SISTEMA DE RECLAMOS
        configurarBotonAtencion(); // CONFIGURAR BOTÓN ATENCIÓN
        configurarBotonPendiente(); // CONFIGURAR BOTÓN PENDIENTE
        configurarBotonPlanillaRespuestas(); // CONFIGURAR BOTÓN PLANILLA DE RESPUESTAS
        if (typeof configurarMotivoSubmotivo === 'function') configurarMotivoSubmotivo();
        
        console.log('✅ Inicialización completa');
    });

    // Mostrar/ocultar menú de acceso directo
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar sistema de notificaciones push
        initNotificationSystem();
        
        const btnAccesoDirecto = document.getElementById('btnAccesoDirecto');
        const accesoLinks = document.getElementById('accesoLinks');
        
        if (btnAccesoDirecto && accesoLinks) {
            btnAccesoDirecto.onclick = function(e) {
                e.stopPropagation();
                const isVisible = accesoLinks.style.display === "block";
                accesoLinks.style.display = isVisible ? "none" : "block";
            };
            
            // Ocultar menú al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (accesoLinks.style.display === "block") {
                    accesoLinks.style.display = "none";
                }
            });
            
            // Evitar que el menú se cierre al hacer clic en él
            accesoLinks.onclick = function(e) {
                e.stopPropagation();
            };
        }
        
        // Inicializar calendario y reloj
        console.log('🔄 Inicializando calendario y reloj...');
        configurarEventosCalendario();
        actualizarReloj();
        
        // Actualizar reloj cada segundo
        setInterval(actualizarReloj, 1000);
        console.log('✅ Reloj iniciado - actualizándose cada segundo');
        
        // Configurar fecha actual en el formulario
        const fechaInput = document.getElementById('fecha');
        if (fechaInput) {
            const hoy = new Date();
            const fechaFormateada = hoy.toISOString().split('T')[0];
            fechaInput.value = fechaFormateada;
            console.log('✅ Fecha del formulario configurada:', fechaFormateada);
        }
    });

    console.log('✅ Script cargado completamente');

    // Respaldo de inicialización con window.onload
    window.addEventListener('load', function() {
        console.log('🔄 window.onload ejecutado - verificando inicialización...');
        
        // Verificar si los botones están configurados
        const btnGrabar = document.getElementById('grabar');
        const btnExportar = document.getElementById('exportar');
        const btnPrecios = document.getElementById('btnPrecios');
        const btnAnexo = document.getElementById('btnAnexo');
        const btnCorreos = document.getElementById('btnCorreos');
        
        if (btnGrabar && !btnGrabar.onclick) {
            console.log('⚠️ Configurando botón GRABAR desde window.onload');
            configurarBotonGrabar();
        }
        
        if (btnExportar && !btnExportar.onclick) {
            console.log('⚠️ Configurando botón EXPORTAR desde window.onload');
            configurarBotonExportar();
        }
        
        const btnBorrarTodo = document.getElementById('borrarTodo');
        // ...existing code...
        
        if (btnPrecios && !btnPrecios.onclick) {
            console.log('⚠️ Configurando botón PRECIOS desde window.onload');
            configurarBotonPrecios();
        }
        
        if (btnAnexo && !btnAnexo.onclick) {
            console.log('⚠️ Configurando botón ANEXO desde window.onload');
            configurarBotonAnexo();
        }
        
        if (btnCorreos && !btnCorreos.onclick) {
            console.log('⚠️ Configurando botón CORREOS desde window.onload');
            configurarBotonCorreos();
        }
        
        const btnAtencion = document.getElementById('btnAtencion');
        if (btnAtencion && !btnAtencion.onclick) {
            console.log('⚠️ Configurando botón ATENCIÓN desde window.onload');
            configurarBotonAtencion();
        }
        
        const btnPendiente = document.getElementById('btnPendiente');
        if (btnPendiente && !btnPendiente.onclick) {
            console.log('⚠️ Configurando botón PENDIENTE desde window.onload');
            configurarBotonPendiente();
        }
        
        const btnReclamo = document.getElementById('btnReclamo');
        if (btnReclamo && !btnReclamo.onclick) {
            console.log('⚠️ Configurando botón RECLAMO desde window.onload');
            configurarBotonReclamo();
        }
        
        if (btnCorreos && !btnCorreos.onclick) {
            console.log('⚠️ Configurando botón CORREOS desde window.onload');
            configurarBotonCorreos();
        }
        
        const btnPlanillaRespuestas = document.getElementById('btnPlanillaRespuestas');
        if (btnPlanillaRespuestas && !btnPlanillaRespuestas.onclick) {
            console.log('⚠️ Configurando botón PLANILLA DE RESPUESTAS desde window.onload');
            configurarBotonPlanillaRespuestas();
        }
        
        // Cargar historial si no se ha cargado
        if (historialRegistros.length === 0) {
            console.log('⚠️ Cargando historial desde window.onload');
            cargarHistorialGuardado();
        }
    });

    // ============ FUNCIONES DEL SISTEMA DE PENDIENTES ============
    
    // Función para configurar botón de pendientes
    function configurarBotonPendiente() {
        const btnPendiente = document.getElementById('btnPendiente');
        if (btnPendiente) {
            btnPendiente.onclick = function() {
                console.log('🔄 Botón PENDIENTE presionado');
                abrirModalPendiente();
            };
            console.log('✅ Evento del botón PENDIENTE configurado');
        } else {
            console.error('❌ Botón PENDIENTE no encontrado');
        }
    }
    
    // Función para abrir modal de pendientes
    function abrirModalPendiente() {
        console.log('🔄 Abriendo modal de pendientes');
        const modal = document.getElementById('modalPendiente');
        if (modal) {
            modal.style.display = 'flex';
            // Establecer fecha de registro automática (hoy)
            const hoy = new Date();
            const fechaLocal = hoy.toISOString().split('T')[0];
            document.getElementById('fechaRegistroPendiente').value = fechaLocal;
            
            // Establecer fecha mínima para recordatorio (ahora)
            const ahora = new Date();
            const fechaHoraLocal = new Date(ahora.getTime() - (ahora.getTimezoneOffset() * 60000));
            document.getElementById('fechaRecordatorioPendiente').min = fechaHoraLocal.toISOString().slice(0, 16);
            
            cargarTareasPendientes();
            console.log('✅ Modal de pendientes abierto');
        } else {
            console.error('❌ Modal de pendientes no encontrado');
        }
    }
    
    function cerrarModalPendiente() {
        console.log('🔄 Cerrando modal de pendientes');
        const modal = document.getElementById('modalPendiente');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de pendientes cerrado');
        }
    }
    
    // Función para guardar nueva tarea pendiente
    function guardarPendiente() {
        const fechaRegistro = document.getElementById('fechaRegistroPendiente').value;
        const fechaRecordatorio = document.getElementById('fechaRecordatorioPendiente').value;
        const titulo = document.getElementById('tituloPendiente').value.trim();
        const observaciones = document.getElementById('observacionesPendiente').value.trim();
        const prioridad = document.getElementById('prioridadPendiente').value;
        const categoria = document.getElementById('categoriaPendiente').value;
        
        // Validaciones
        if (!fechaRecordatorio) {
            alert('❌ Debe seleccionar fecha y hora para el recordatorio');
            document.getElementById('fechaRecordatorioPendiente').focus();
            return;
        }
        
        const fechaRecordatorioDate = new Date(fechaRecordatorio);
        const ahora = new Date();
        
        if (fechaRecordatorioDate <= ahora) {
            alert('❌ La fecha de recordatorio debe ser futura');
            document.getElementById('fechaRecordatorioPendiente').focus();
            return;
        }
        
        if (!titulo) {
            alert('❌ El título es requerido');
            document.getElementById('tituloPendiente').focus();
            return;
        }
        
        if (!observaciones) {
            alert('❌ Las observaciones son requeridas');
            document.getElementById('observacionesPendiente').focus();
            return;
        }
        
        // Crear nueva tarea pendiente
        const nuevaPendiente = {
            id: Date.now().toString() + Math.floor(Math.random() * 1000).toString(), // ID único como string
            fechaRegistro: fechaRegistro,
            fechaRecordatorio: fechaRecordatorio,
            titulo: titulo,
            observaciones: observaciones,
            prioridad: prioridad,
            categoria: categoria,
            estado: 'Pendiente',
            fechaCreacion: new Date().toISOString()
        };
        
        // Agregar al array
        tareasPendientes.push(nuevaPendiente);
        guardarTareasPendientes();
        actualizarTablaPendientes();
        programarRecordatorio(nuevaPendiente);
        limpiarFormularioPendiente();
        
        // Reproducir sonido de confirmación
        reproducirSonidoConfirmacion();
        
        mostrarMensajeTemp('📝 Tarea pendiente registrada y recordatorio programado', '#007bff');
        console.log('✅ Nueva tarea pendiente registrada:', nuevaPendiente);
    }
    
    // Función para limpiar formulario de pendientes
    function limpiarFormularioPendiente() {
        document.getElementById('tituloPendiente').value = '';
        document.getElementById('observacionesPendiente').value = '';
        document.getElementById('fechaRecordatorioPendiente').value = '';
        document.getElementById('prioridadPendiente').selectedIndex = 1; // Media
        document.getElementById('categoriaPendiente').selectedIndex = 0; // Administración
        
        // Establecer fecha de registro automática (hoy)
        const hoy = new Date();
        const fechaLocal = hoy.toISOString().split('T')[0];
        document.getElementById('fechaRegistroPendiente').value = fechaLocal;
    }
    
    // Función para programar recordatorio
    function programarRecordatorio(tarea) {
        const fechaRecordatorio = new Date(tarea.fechaRecordatorio);
        const ahora = new Date();
        const tiempoEspera = fechaRecordatorio.getTime() - ahora.getTime();
        
        if (tiempoEspera > 0) {
            const timeoutId = setTimeout(() => {
                mostrarRecordatorioEmergente(tarea);
            }, tiempoEspera);
            
            // Guardar el ID del timeout para poder cancelarlo
            intervalosRecordatorio.push({
                id: tarea.id,
                timeoutId: timeoutId
            });
            
            console.log(`⏰ Recordatorio programado para: ${fechaRecordatorio.toLocaleString()}`);
        }
    }
    
    // Función para mostrar recordatorio emergente con sonido
    function mostrarRecordatorioEmergente(tarea) {
        // Reproducir sonido de alerta
        reproducirSonidoAlertaUrgente();
        
        // Crear overlay
        const overlay = document.createElement('div');
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 123, 255, 0.95);
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: recordatorioBlink 1s infinite;
        `;
        
        // Crear modal de recordatorio
        const popup = document.createElement('div');
        popup.style.cssText = `
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            text-align: center;
            border: 4px solid #007bff;
            animation: recordatorioShake 0.5s ease-in-out infinite;
        `;
        
        // Icono y colores según prioridad
        const iconosPrioridad = {
            'Crítica': '🚨',
            'Alta': '🔴',
            'Media': '🟡',
            'Baja': '🟢'
        };
        
        const coloresPrioridad = {
            'Crítica': '#dc3545',
            'Alta': '#fd7e14', 
            'Media': '#ffc107',
            'Baja': '#28a745'
        };
        
        const icono = iconosPrioridad[tarea.prioridad] || '📝';
        const color = coloresPrioridad[tarea.prioridad] || '#007bff';
        
        const categoriaIconos = {
            'Administración': '📊',
            'Cliente': '👥',
            'Documentos': '📄',
            'Seguimiento': '🔍',
            'Urgente': '⚡',
            'Otro': '📌'
        };
        
        popup.innerHTML = `
            <div style="font-size: 5em; margin-bottom: 20px; animation: pulse 1s infinite;">📝</div>
            <h1 style="color: #007bff; margin-bottom: 20px; font-size: 2.2em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">¡RECORDATORIO DE TAREA PENDIENTE!</h1>
            <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px; text-align: left; border: 2px solid ${color};">
                <p style="margin: 8px 0; font-size: 1.1em;"><strong>${categoriaIconos[tarea.categoria] || '📌'} Categoría:</strong> ${tarea.categoria}</p>
                <p style="margin: 8px 0; font-size: 1.3em; color: ${color}; font-weight: bold;"><strong>🏷️ Tarea:</strong> ${tarea.titulo}</p>
                <p style="margin: 8px 0; font-size: 1.1em;"><strong>📝 Observaciones:</strong> ${tarea.observaciones}</p>
                <p style="margin: 8px 0; font-size: 1.1em;"><strong>⚡ Prioridad:</strong> <span style="color: ${color}; font-weight: bold;">${icono} ${tarea.prioridad}</span></p>
                <p style="margin: 8px 0; font-size: 1em;"><strong>📅 Registrado:</strong> ${new Date(tarea.fechaRegistro).toLocaleDateString('es-CL')}</p>
                <p style="margin: 8px 0; font-size: 1em;"><strong>⏰ Recordatorio para:</strong> ${new Date(tarea.fechaRecordatorio).toLocaleString('es-CL')}</p>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button id="completarTarea" style="
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1.1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">✅ COMPLETADA</button>
                <button id="posponerTarea" style="
                    background: #17a2b8;
                    color: white;
                    border: none;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1.1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">⏰ POSPONER 30 MIN</button>
                <button id="cerrarRecordatorio" style="
                    background: #007bff;
                    color: white;
                    border: none;
                    padding: 15px 25px;
                    border-radius: 8px;
                    font-size: 1.1em;
                    font-weight: bold;
                    cursor: pointer;
                    transition: all 0.3s ease;
                ">👁️ ENTENDIDO</button>
            </div>
        `;
        
        overlay.appendChild(popup);
        document.body.appendChild(overlay);
        
        // Agregar estilos de animación
        const style = document.createElement('style');
        style.textContent = `
            @keyframes recordatorioBlink {
                0%, 50% { background: rgba(0, 123, 255, 0.95); }
                51%, 100% { background: rgba(0, 123, 255, 0.7); }
            }
            @keyframes recordatorioShake {
                0%, 100% { transform: translateX(0px); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // Configurar botones del pop-up
        document.getElementById('completarTarea').onclick = function() {
            marcarTareaCompletada(tarea.id);
            document.body.removeChild(overlay);
            document.head.removeChild(style);
            mostrarMensajeTemp('✅ Tarea marcada como completada', '#28a745');
        };
        
        document.getElementById('posponerTarea').onclick = function() {
            posponerTarea(tarea, 30); // 30 minutos
            document.body.removeChild(overlay);
            document.head.removeChild(style);
            mostrarMensajeTemp('⏰ Tarea pospuesta 30 minutos', '#17a2b8');
        };
        
        document.getElementById('cerrarRecordatorio').onclick = function() {
            document.body.removeChild(overlay);
            document.head.removeChild(style);
        };
        
        console.log('🔔 Recordatorio de tarea mostrado:', tarea);
    }
    
    // Función para marcar tarea como completada
    function marcarTareaCompletada(tareaId) {
        const tarea = tareasPendientes.find(t => t.id === tareaId);
        if (tarea) {
            tarea.estado = 'Completada';
            tarea.fechaCompletada = new Date().toISOString();
            guardarTareasPendientes();
            actualizarTablaPendientes();
            console.log('✅ Tarea marcada como completada:', tarea);
        }
    }
    
    // Función para posponer tarea
    function posponerTarea(tarea, minutos) {
        const nuevaFecha = new Date(tarea.fechaRecordatorio);
        nuevaFecha.setMinutes(nuevaFecha.getMinutes() + minutos);
        
        tarea.fechaRecordatorio = nuevaFecha.toISOString().slice(0, 16);
        guardarTareasPendientes();
        actualizarTablaPendientes();
        
        // Reprogramar recordatorio
        programarRecordatorio(tarea);
        
        console.log(`⏰ Tarea pospuesta ${minutos} minutos. Nueva fecha:`, nuevaFecha.toLocaleString());
    }
    
    // Función para cargar tareas desde localStorage
    function cargarTareasPendientes() {
        try {
            const datos = localStorage.getItem('tareasPendientesAchs');
            if (datos && datos !== 'null') {
                tareasPendientes = JSON.parse(datos);
                actualizarTablaPendientes();
                // Reprogramar recordatorios para tareas pendientes
                tareasPendientes.forEach(tarea => {
                    if (tarea.estado === 'Pendiente') {
                        programarRecordatorio(tarea);
                    }
                });
                console.log('✅ Tareas pendientes cargadas:', tareasPendientes.length);
            }
        } catch (error) {
            console.error('❌ Error al cargar tareas pendientes:', error);
            tareasPendientes = [];
        }
    }
    
    // Función para guardar tareas en localStorage
    function guardarTareasPendientes() {
        try {
            localStorage.setItem('tareasPendientesAchs', JSON.stringify(tareasPendientes));
            console.log('💾 Tareas pendientes guardadas en localStorage');
        } catch (error) {
            console.error('❌ Error al guardar tareas pendientes:', error);
        }
    }
    
    // Función para actualizar tabla de pendientes
    function actualizarTablaPendientes() {
        console.log('🔄 Actualizando tabla de pendientes...');
        const tbody = document.querySelector('#tablaPendientes tbody');
        
        if (!tbody) {
            console.error('❌ No se encontró el tbody de la tabla pendientes');
            return;
        }
        
        console.log('📋 Número de tareas pendientes:', tareasPendientes.length);
        
        tbody.innerHTML = '';
        
        if (tareasPendientes.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:#666;">No hay tareas pendientes registradas</td></tr>';
            console.log('📝 Tabla vacía - no hay tareas pendientes');
            return;
        }
        
        tareasPendientes.forEach((tarea, index) => {
            console.log(`🔄 Procesando tarea ${index + 1}:`, tarea.titulo, 'ID:', tarea.id);
            
            const coloresPrioridad = {
                'Crítica': '#dc3545',
                'Alta': '#fd7e14',
                'Media': '#ffc107',
                'Baja': '#28a745'
            };
            
            const colorEstado = tarea.estado === 'Completada' ? '#28a745' : '#007bff';
            
            const row = tbody.insertRow();
            
            // Crear celdas individualmente para mejor control
            const cellFechaRegistro = row.insertCell(0);
            cellFechaRegistro.style.cssText = 'border:1px solid #ddd; padding:8px;';
            cellFechaRegistro.textContent = new Date(tarea.fechaRegistro).toLocaleDateString('es-CL');
            
            const cellFechaRecordatorio = row.insertCell(1);
            cellFechaRecordatorio.style.cssText = 'border:1px solid #ddd; padding:8px;';
            cellFechaRecordatorio.textContent = new Date(tarea.fechaRecordatorio).toLocaleString('es-CL');
            
            const cellTitulo = row.insertCell(2);
            cellTitulo.style.cssText = 'border:1px solid #ddd; padding:8px; font-weight:bold;';
            cellTitulo.textContent = tarea.titulo;
            
            const cellCategoria = row.insertCell(3);
            cellCategoria.style.cssText = 'border:1px solid #ddd; padding:8px;';
            cellCategoria.textContent = tarea.categoria;
            
            const cellPrioridad = row.insertCell(4);
            cellPrioridad.style.cssText = `border:1px solid #ddd; padding:8px; text-align:center; color:${coloresPrioridad[tarea.prioridad]}; font-weight:bold;`;
            cellPrioridad.textContent = tarea.prioridad;
            
            const cellEstado = row.insertCell(5);
            cellEstado.style.cssText = `border:1px solid #ddd; padding:8px; text-align:center; color:${colorEstado}; font-weight:bold;`;
            cellEstado.textContent = tarea.estado;
            
            const cellAcciones = row.insertCell(6);
            cellAcciones.style.cssText = 'border:1px solid #ddd; padding:8px; text-align:center;';
            
            const btnEliminar = document.createElement('button');
            btnEliminar.style.cssText = 'background:#dc3545; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;';
            btnEliminar.title = 'Eliminar tarea';
            btnEliminar.textContent = '🗑️';
            btnEliminar.onclick = function() {
                eliminarTareaPendiente(tarea.id);
            };
            
            cellAcciones.appendChild(btnEliminar);
            
            console.log(`✅ Tarea agregada a tabla - ID: ${tarea.id}, Título: ${tarea.titulo}`);
        });
        
        console.log('✅ Tabla de pendientes actualizada con', tareasPendientes.length, 'tareas');
    }
    
    // Función para eliminar tarea pendiente
    function eliminarTareaPendiente(tareaId) {
        console.log('🗑️ Intentando eliminar tarea pendiente:', tareaId);
        console.log('📋 Tareas pendientes antes de eliminar:', tareasPendientes.length);
        console.log('📋 Lista completa de IDs:', tareasPendientes.map(t => t.id));
        
        // Verificar que el tareaId no sea undefined o null
        if (!tareaId) {
            console.error('❌ ID de tarea no válido:', tareaId);
            mostrarMensajeTemp('❌ Error: ID de tarea no válido', '#dc3545');
            return;
        }
        
        // Convertir a string para comparación consistente
        const tareaIdStr = String(tareaId);
        
        if (confirm('¿Está seguro de que desea eliminar esta tarea pendiente?')) {
            // Buscar la tarea antes de eliminar
            const tareaAEliminar = tareasPendientes.find(t => String(t.id) === tareaIdStr);
            console.log('🔍 Tarea encontrada:', tareaAEliminar);
            
            if (!tareaAEliminar) {
                console.error('❌ No se encontró la tarea con ID:', tareaIdStr);
                console.log('🔍 IDs disponibles:', tareasPendientes.map(t => String(t.id)));
                mostrarMensajeTemp('❌ Error: Tarea no encontrada', '#dc3545');
                return;
            }
            
            // Cancelar recordatorio si existe
            const intervalo = intervalosRecordatorio.find(i => String(i.id) === tareaIdStr);
            if (intervalo) {
                clearTimeout(intervalo.timeoutId);
                intervalosRecordatorio = intervalosRecordatorio.filter(i => String(i.id) !== tareaIdStr);
                console.log('⏰ Recordatorio cancelado para tarea:', tareaIdStr);
            }
            
            // Eliminar la tarea del array
            const lengthAntes = tareasPendientes.length;
            tareasPendientes = tareasPendientes.filter(t => String(t.id) !== tareaIdStr);
            const lengthDespues = tareasPendientes.length;
            
            console.log(`📊 Tareas antes: ${lengthAntes}, después: ${lengthDespues}`);
            
            if (lengthAntes === lengthDespues) {
                console.error('❌ No se eliminó ninguna tarea');
                console.log('🔍 ID buscado:', tareaIdStr);
                console.log('🔍 IDs en array:', tareasPendientes.map(t => String(t.id)));
                mostrarMensajeTemp('❌ Error al eliminar la tarea', '#dc3545');
                return;
            }
            
            // Guardar en localStorage
            try {
                guardarTareasPendientes();
                console.log('💾 Tareas guardadas en localStorage');
            } catch (error) {
                console.error('❌ Error al guardar:', error);
            }
            
            // Actualizar la tabla
            try {
                actualizarTablaPendientes();
                console.log('🔄 Tabla actualizada');
            } catch (error) {
                console.error('❌ Error al actualizar tabla:', error);
            }
            
            // Mostrar mensaje de éxito
            mostrarMensajeTemp('🗑️ Tarea pendiente eliminada', '#dc3545');
            
            // Notificación push si está disponible
            if (typeof showNotification === 'function') {
                showNotification('🗑️ Tarea Eliminada', `La tarea "${tareaAEliminar.titulo}" ha sido eliminada.`, 'info');
            }
            
            console.log('✅ Tarea pendiente eliminada exitosamente:', tareaIdStr);
        } else {
            console.log('🚫 Eliminación cancelada por el usuario');
        }
    }
    
    // Función para verificar recordatorios pendientes
    function verificarRecordatoriosPendientes() {
        const ahora = new Date();
        const recordatoriosPendientes = tareasPendientes.filter(tarea => {
            const fechaRecordatorio = new Date(tarea.fechaRecordatorio);
            return tarea.estado === 'Pendiente' && fechaRecordatorio > ahora;
        });
        
        let mensaje = `📊 Recordatorios pendientes: ${recordatoriosPendientes.length}\n\n`;
        
        if (recordatoriosPendientes.length > 0) {
            recordatoriosPendientes.slice(0, 5).forEach((tarea, index) => {
                const fechaRecordatorio = new Date(tarea.fechaRecordatorio);
                const tiempoRestante = fechaRecordatorio.getTime() - ahora.getTime();
                const horasRestantes = Math.floor(tiempoRestante / (1000 * 60 * 60));
                const minutosRestantes = Math.floor((tiempoRestante % (1000 * 60 * 60)) / (1000 * 60));
                
                mensaje += `${index + 1}. ${tarea.titulo}\n`;
                mensaje += `   📅 ${fechaRecordatorio.toLocaleString('es-CL')}\n`;
                mensaje += `   ⏰ Faltan: ${horasRestantes}h ${minutosRestantes}m\n\n`;
            });
            
            if (recordatoriosPendientes.length > 5) {
                mensaje += `... y ${recordatoriosPendientes.length - 5} más`;
            }
        } else {
            mensaje += 'No hay recordatorios pendientes programados.';
        }
        
        alert(mensaje);
    }
    
    // Función para exportar pendientes a Excel
    function exportarPendientes() {
        if (tareasPendientes.length === 0) {
            alert('❌ No hay tareas pendientes para exportar');
            return;
        }
        
        try {
            // Crear datos para exportar
            const datosExportar = tareasPendientes.map(tarea => ({
                'Fecha Registro': new Date(tarea.fechaRegistro).toLocaleDateString('es-CL'),
                'Fecha Recordatorio': new Date(tarea.fechaRecordatorio).toLocaleString('es-CL'),
                'Título': tarea.titulo,
                'Observaciones': tarea.observaciones,
                'Categoría': tarea.categoria,
                'Prioridad': tarea.prioridad,
                'Estado': tarea.estado,
                'Fecha Completada': tarea.fechaCompletada ? new Date(tarea.fechaCompletada).toLocaleString('es-CL') : 'N/A'
            }));
            
            // Convertir a CSV
            const headers = Object.keys(datosExportar[0]);
            const csvContent = [
                headers.join(','),
                ...datosExportar.map(row => headers.map(header => `"${row[header]}"`).join(','))
            ].join('\n');
            
            // Crear y descargar archivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `tareas_pendientes_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            mostrarMensajeTemp('📥 Tareas pendientes exportadas exitosamente', '#28a745');
            console.log('📥 Tareas pendientes exportadas:', tareasPendientes.length);
        } catch (error) {
            console.error('❌ Error al exportar tareas pendientes:', error);
            alert('❌ Error al exportar las tareas pendientes');
        }
    }

    // ============ FUNCIONES DEL SISTEMA DE PLANILLA DE RESPUESTAS ============
    
    // Función para configurar botón de planilla de respuestas
    function configurarBotonPlanillaRespuestas() {
        const btnPlanillaRespuestas = document.getElementById('btnPlanillaRespuestas');
        if (btnPlanillaRespuestas) {
            btnPlanillaRespuestas.onclick = function() {
                console.log('🔄 Botón PLANILLA DE RESPUESTAS presionado');
                abrirModalPlanillaRespuestas();
            };
            console.log('✅ Evento del botón PLANILLA DE RESPUESTAS configurado');
        } else {
            console.error('❌ Botón PLANILLA DE RESPUESTAS no encontrado');
        }
    }
    
    // Función para abrir modal de planilla de respuestas
    function abrirModalPlanillaRespuestas() {
        console.log('🔄 Abriendo modal de planilla de respuestas');
        const modal = document.getElementById('modalPlanillaRespuestas');
        if (modal) {
            modal.style.display = 'flex';
            inicializarBusquedaRespuestas();
            console.log('✅ Modal de planilla de respuestas abierto');
        } else {
            console.error('❌ Modal de planilla de respuestas no encontrado');
        }
    }
    
    function cerrarModalPlanillaRespuestas() {
        console.log('🔄 Cerrando modal de planilla de respuestas');
        const modal = document.getElementById('modalPlanillaRespuestas');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de planilla de respuestas cerrado');
        }
    }

    // ===== FUNCIÓN DE ZOOM PARA MODALES =====
    const zoomLevels = {}; // Almacenar nivel de zoom por modal
    
    function ajustarZoomModal(modalContenidoId, cambio) {
        const contenido = document.getElementById(modalContenidoId);
        if (!contenido) return;
        
        // Inicializar nivel de zoom si no existe
        if (!zoomLevels[modalContenidoId]) {
            zoomLevels[modalContenidoId] = 1.0;
        }
        
        // Si cambio es 0, restablecer a 100%
        if (cambio === 0) {
            zoomLevels[modalContenidoId] = 1.0;
        } else {
            // Ajustar zoom (límites: 0.5x a 2.0x)
            zoomLevels[modalContenidoId] = Math.max(0.5, Math.min(2.0, zoomLevels[modalContenidoId] + cambio));
        }
        
        // Aplicar transform scale
        contenido.style.transform = `scale(${zoomLevels[modalContenidoId]})`;
        
        // Feedback visual temporal
        const nivel = Math.round(zoomLevels[modalContenidoId] * 100);
        console.log(`🔍 Zoom ${modalContenidoId}: ${nivel}%`);
    }
    
    // Función para copiar respuesta al portapapeles
    function copiarRespuesta(elemento) {
        const textoRespuesta = elemento.querySelector('.texto-respuesta').textContent;
        
        // Copiar al portapapeles
        navigator.clipboard.writeText(textoRespuesta).then(function() {
            // Mostrar feedback visual
            elemento.style.backgroundColor = '#d4edda';
            elemento.style.border = '2px solid #28a745';
            
            // Agregar icono de copiado temporalmente
            const iconoOriginal = elemento.innerHTML;
            elemento.innerHTML = `✅ COPIADO: ${textoRespuesta}`;
            
            // Restaurar después de 2 segundos
            setTimeout(() => {
                elemento.innerHTML = iconoOriginal;
                elemento.style.backgroundColor = 'white';
                elemento.style.border = '1px solid #ddd';
            }, 2000);
            
            // Reproducir sonido de confirmación
            reproducirSonidoConfirmacion();
            
            mostrarMensajeTemp('📋 Respuesta copiada al portapapeles', '#28a745');
            console.log('✅ Respuesta copiada:', textoRespuesta);
        }).catch(function(err) {
            console.error('❌ Error al copiar al portapapeles:', err);
            
            // Fallback: seleccionar texto
            const range = document.createRange();
            range.selectNode(elemento.querySelector('.texto-respuesta'));
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            
            mostrarMensajeTemp('📋 Texto seleccionado. Use Ctrl+C para copiar', '#ffc107');
        });
    }
    
    // Función para alternar categorías (expandir/colapsar)
    function toggleCategoria(categoria) {
        const content = document.getElementById(`content-${categoria}`);
        const toggle = document.getElementById(`toggle-${categoria}`);
        
        if (content && toggle) {
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '▼';
            } else {
                content.style.display = 'none';
                toggle.textContent = '▶';
            }
        }
    }
    
    // Función para inicializar búsqueda de respuestas
    function inicializarBusquedaRespuestas() {
        const buscarInput = document.getElementById('buscarRespuesta');
        const filtroCategoria = document.getElementById('filtroCategoria');
        
        if (buscarInput) {
            buscarInput.addEventListener('input', filtrarRespuestas);
        }
        
        if (filtroCategoria) {
            filtroCategoria.addEventListener('change', filtrarRespuestas);
        }
        
        // Cerrar todas las categorías por defecto (requerimiento: iniciar sub-menús cerrados)
        const categorias = ['acuso-recibo', 'bloqueos', 'cambios-cita', 'opciones-completas', 'finalizacion', 'contacto-paciente', 'agenda-ingreso-ep'];
        categorias.forEach(categoria => {
            const content = document.getElementById(`content-${categoria}`);
            const toggle = document.getElementById(`toggle-${categoria}`);
            if (content && toggle) {
                content.style.display = 'none';
                toggle.textContent = '▶';
            }
        });
    }
    
    // Función para filtrar respuestas
    function filtrarRespuestas() {
        const busqueda = document.getElementById('buscarRespuesta').value.toLowerCase();
        const categoriaSeleccionada = document.getElementById('filtroCategoria').value;
        
        const todasLasCategorias = document.querySelectorAll('.categoria-respuestas');
        let respuestasVisibles = 0;
        let categoriasVisibles = 0;
        
        todasLasCategorias.forEach(categoria => {
            const categoriaNombre = categoria.getAttribute('data-categoria');
            let mostrarCategoria = false;
            
            // Filtrar por categoría
            if (categoriaSeleccionada === 'todas' || categoriaSeleccionada === categoriaNombre) {
                const respuestas = categoria.querySelectorAll('.respuesta-item');
                
                respuestas.forEach(respuesta => {
                    const textoRespuesta = respuesta.querySelector('.texto-respuesta').textContent.toLowerCase();
                    
                    if (!busqueda || textoRespuesta.includes(busqueda)) {
                        respuesta.style.display = 'block';
                        mostrarCategoria = true;
                        respuestasVisibles++;
                    } else {
                        respuesta.style.display = 'none';
                    }
                });
                
                if (mostrarCategoria) {
                    categoria.style.display = 'block';
                    categoriasVisibles++;
                } else {
                    categoria.style.display = 'none';
                }
            } else {
                categoria.style.display = 'none';
            }
        });
        
        // Actualizar estadísticas
        const estadisticas = document.getElementById('estadisticasRespuestas');
        if (estadisticas) {
            estadisticas.innerHTML = `📊 Respuestas encontradas: <strong>${respuestasVisibles}</strong> | 📂 Categorías visibles: <strong>${categoriasVisibles}</strong>`;
        }
        
        // Mostrar mensaje si no hay resultados
        if (respuestasVisibles === 0) {
            mostrarMensajeNoResultados();
        } else {
            ocultarMensajeNoResultados();
        }
    }
    
    // Función para mostrar mensaje de no resultados
    function mostrarMensajeNoResultados() {
        let mensajeExistente = document.getElementById('mensajeNoResultados');
        if (!mensajeExistente) {
            const contenedor = document.getElementById('contenedorRespuestas');
            const mensaje = document.createElement('div');
            mensaje.id = 'mensajeNoResultados';
            mensaje.style.cssText = `
                text-align: center;
                padding: 40px;
                color: #666;
                font-size: 1.1em;
                background: #f8f9fa;
                border-radius: 12px;
                border: 2px dashed #ddd;
                margin: 20px 0;
            `;
            mensaje.innerHTML = `
                <div style="font-size: 3em; margin-bottom: 15px;">🔍</div>
                <h3 style="color: #666; margin-bottom: 10px;">No se encontraron resultados</h3>
                <p style="margin: 0;">Intenta con otros términos de búsqueda o selecciona una categoría diferente.</p>
            `;
            contenedor.appendChild(mensaje);
        }
    }
    
    // Función para ocultar mensaje de no resultados
    function ocultarMensajeNoResultados() {
        const mensaje = document.getElementById('mensajeNoResultados');
        if (mensaje) {
            mensaje.remove();
        }
    }
    
    // Función para limpiar búsqueda
    function limpiarBusqueda() {
        const buscarInput = document.getElementById('buscarRespuesta');
        const filtroCategoria = document.getElementById('filtroCategoria');
        
        if (buscarInput) {
            buscarInput.value = '';
        }
        
        if (filtroCategoria) {
            filtroCategoria.selectedIndex = 0;
        }
        
        // Mostrar todas las respuestas
        const todasLasRespuestas = document.querySelectorAll('.respuesta-item');
        const todasLasCategorias = document.querySelectorAll('.categoria-respuestas');
        
        todasLasRespuestas.forEach(respuesta => {
            respuesta.style.display = 'block';
        });
        
        todasLasCategorias.forEach(categoria => {
            categoria.style.display = 'block';
        });
        
        // Restaurar estadísticas
        const estadisticas = document.getElementById('estadisticasRespuestas');
        if (estadisticas) {
            estadisticas.innerHTML = '📊 Total de respuestas: <strong>30</strong> | 📂 Categorías: <strong>6</strong>';
        }
        
        // Ocultar mensaje de no resultados si existe
        ocultarMensajeNoResultados();
        
        mostrarMensajeTemp('🧹 Filtros limpiados', '#6c757d');
    }
    
    // Función para integrar con el sistema de emails (si está abierto)
    // NOTA: Modal de Redacción eliminado (14/11/2025) - Función deshabilitada
    function integrarConEmails(texto) {
        // Funcionalidad deshabilitada - Modal de Redacción de Email fue eliminado
        console.log('Modal de Redacción de Email no disponible');
    }
    
    // ========== FUNCIONES PARA SCRIPT EP (ENFERMEDADES PROFESIONALES) ==========
    
    function abrirModalScriptEP() {
        console.log('🔄 Abriendo modal Script EP');
        const modal = document.getElementById('modalScriptEP');
        if (modal) {
            modal.style.display = 'flex';
            console.log('✅ Modal Script EP abierto correctamente');
            
            // Reproducir sonido de alerta para llamar la atención
            reproducirSonidoConfirmacion();
            
            // Mostrar mensaje temporal
            mostrarMensajeTemp('🏥 Script EP cargado - Protocolo de Enfermedades Profesionales', '#dc3545');
        } else {
            console.error('❌ Modal Script EP no encontrado');
            alert('❌ Error: Modal Script EP no encontrado');
        }
    }
    
    function cerrarModalScriptEP() {
        console.log('🔄 Cerrando modal Script EP');
        const modal = document.getElementById('modalScriptEP');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal Script EP cerrado');
        }
    }
    
    function copiarScript() {
        // Obtener todo el contenido del script actualizado
        const contenidoScript = `
SCRIPT EP - PROTOCOLO DE ATENCIÓN PARA ENFERMEDADES PROFESIONALES

🏥 CLASIFICACIÓN DE LA ENFERMEDAD
"¿Me podría indicar por favor si su posible enfermedad profesional corresponde a la categoría de Salud Mental o es Musculo esquelético (como por ejemplo dolor de hombro, codo, muñeca)?"

"¿Había asistido anteriormente a alguna agencia de ACHS por esta misma enfermedad?"

"¿En qué región se encuentra ubicado usted?"

✅ VALIDACIÓN DE DATOS PERSONALES
"Perfecto. A continuación, pasaré a validar sus datos personales:"
"¿Su número de teléfono es <XXXXXXXXX>?"
"correo: xxxxx"

📋 PROCESO DE ENFERMEDADES PROFESIONALES
"Quiero comentarle acerca del proceso de enfermedades profesionales."

Primero, será atendido por un MÉDICO GENERAL y recibirá las indicaciones para su tratamiento. En paralelo, un COMITÉ INICIARÁ UN ESTUDIO por su patología que tomará alrededor de 30 DÍAS APROXIMADAMENTE.

Esta investigación se realizará para identificar si su patología es de ORIGEN LABORAL, es decir, ocasionada por el trabajo o de ORIGEN COMÚN, enfermedad producto de situaciones externas a lo laboral.

"¿Se entiende?"

💰 COBERTURA SEGÚN ORIGEN
✅ Si su enfermedad es de ORIGEN LABORAL, sus atenciones y tratamiento estarán cubiertas por el seguro de la ley.

❌ Si su patología es definida de ORIGEN COMÚN, los gastos asociados a su atención y tratamiento serán derivados a su previsión de salud (ISAPRE o FONASA).

"¿Desea tomar la cita?"

� MODALIDAD DE ATENCIÓN
"Para su tipo de atención, la modalidad es a través de TELEMEDICINA."
"¿Conoce esta modalidad? ¿Se ha atendido previamente por telemedicina?"

⚠️ INSTRUCCIONES IMPORTANTES
📞 LLAMADA TELEFÓNICA OBLIGATORIA:
Ese día también lo llamarán a su celular para hacer su admisión de manera telefónica 20 MIN ANTES APROXIMADAMENTE. Por favor esté atento a su teléfono el día de su ingreso y tenga su CÉDULA DE IDENTIDAD A MANO.

🚨 ESTA LLAMADA ES OBLIGATORIA 🚨
Si no contestan el llamado y se conectan NO SERÁN ATENDIDOS

En su atención con el médico, deberá indicar DOS TESTIGOS DE LA EMPRESA para su caso, nombre y número de teléfono. A ellos se les realizarán entrevistas de carácter confidencial. Si los testigos no están ese día o no quisieran declarar, se deberá tomar el testimonio a otros testigos que estén presentes ese día.

📱 Le informo que recibirá un MENSAJE VÍA WHATSAPP con un video explicativo del proceso de evaluación.

� AGENDAMIENTO
Quiero comentarle que su agendamiento para ingreso de enfermedad profesional de SALUD MENTAL, tanto para la CONSULTA MÉDICA como para la CITA CON EL PSICÓLOGO, será gestionado y le llegará la información con detalles del día y hora de atención dentro de las próximas 24 HORAS HÁBILES a su correo electrónico <xxxx@xxx.xx>.

"¿Tiene alguna preferencia AM (8 AM – 13 PM) o PM (13 PM – 18 PM) de su citación?"
Intentaremos agendarlo en el bloque que nos indique según disponibilidad.
Paciente: AM/PM/No tiene preferencia

Le recomiendo que revise su BANDEJA DE ENTRADA de su correo electrónico en 24 horas hábiles, y también la carpeta de "SPAM" O "CORREO NO DESEADO", ya que los correos automáticos pueden llegar allí. Este correo debería llegar en la mañana del siguiente día hábil.

📄 LICENCIAS Y DOCUMENTACIÓN
"¿Cuenta con licencias rechazadas o algún antecedente de su patología?"

📧 Envío de licencias rechazadas:
Deberá enviar la licencia médica rechazada y la resolución del motivo de rechazo a la casilla SDTELEMEDICINA@ACHS.CL. Con su nombre y apellido en el asunto del correo.

📎 Medios de prueba:
MEDIOSDEPRUEBA@ACHS.CL

⚠️ Debe llevar el día de su atención CUALQUIER ANTECEDENTE QUE APORTE A SU PATOLOGÍA.
        `;
        
        // Copiar al portapapeles
        navigator.clipboard.writeText(contenidoScript.trim()).then(function() {
            mostrarMensajeTemp('📋 Script EP actualizado copiado al portapapeles', '#28a745');
            console.log('✅ Script EP actualizado copiado al portapapeles');
            
            // Reproducir sonido de confirmación
            reproducirSonidoConfirmacion();
        }).catch(function(err) {
            console.error('❌ Error al copiar script EP:', err);
            mostrarMensajeTemp('❌ Error al copiar. Use Ctrl+A y Ctrl+C manualmente', '#dc3545');
        });
    }
    
    function imprimirScript() {
        // Crear ventana de impresión con el script formateado actualizado
        const ventanaImpresion = window.open('', '_blank', 'width=800,height=600');
        
        const contenidoImpresion = `
<!DOCTYPE html>
<html>
<head>
    <title>Script EP - Enfermedades Profesionales</title>
    <style>
        :root { --font-sans: 'Helvetica Rounded', 'Arial Rounded MT Bold', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif; }
        body { 
            font-family: var(--font-sans); 
            margin: 24px; 
            line-height: 1.55; 
            font-size: 0.95rem;
        }
        .header {
            background: #dc3545;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .seccion {
            margin-bottom: 25px;
            padding: 15px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        /* Estilos migrados a assets/css/styles.css (bloque SCRIPT EP) - 2025-11-10 */
    </style>
</head>
<body>
    <div class="header">
        <h1>🏥 SCRIPT EP</h1>
        <p>Protocolo de Atención para Enfermedades Profesionales - ACTUALIZADO</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">🏥 CLASIFICACIÓN DE LA ENFERMEDAD</div>
        <p class="pregunta">"¿Me podría indicar por favor si su posible enfermedad profesional corresponde a la categoría de Salud Mental o es Musculo esquelético (como por ejemplo dolor de hombro, codo, muñeca)?"</p>
        <p class="pregunta">"¿Había asistido anteriormente a alguna agencia de ACHS por esta misma enfermedad?"</p>
        <p class="pregunta">"¿En qué región se encuentra ubicado usted?"</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">✅ VALIDACIÓN DE DATOS PERSONALES</div>
        <p><strong>"Perfecto. A continuación, pasaré a validar sus datos personales:"</strong></p>
        <p class="pregunta">"¿Su número de teléfono es <span class="destacado">&lt;XXXXXXXXX&gt;</span>?"</p>
        <p class="pregunta">"correo: <span class="destacado">xxxxx</span>"</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">📋 PROCESO DE ENFERMEDADES PROFESIONALES</div>
        <p><strong>"Quiero comentarle acerca del proceso de enfermedades profesionales."</strong></p>
        <p>Primero, será atendido por un <span class="destacado">médico general</span> y recibirá las indicaciones para su tratamiento. En paralelo, un <span class="destacado">comité iniciará un estudio</span> por su patología que tomará alrededor de <span class="destacado">30 días aproximadamente</span>.</p>
        <p>Esta investigación se realizará para identificar si su patología es de <span class="destacado">origen laboral</span>, es decir, ocasionada por el trabajo o de <span class="destacado">origen común</span>, enfermedad producto de situaciones externas a lo laboral.</p>
        <p class="pregunta">"¿Se entiende?"</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">💰 COBERTURA SEGÚN ORIGEN</div>
        <div style="background:#c8e6c9; border:1px solid #4caf50; padding:10px; border-radius:5px; color:#2e7d32; margin:10px 0;">
            <strong>✅ Si su enfermedad es de <span class="destacado">ORIGEN LABORAL</span>, sus atenciones y tratamiento estarán cubiertas por el seguro de la ley.</strong>
        </div>
        <div style="background:#ffcdd2; border:1px solid #f44336; padding:10px; border-radius:5px; color:#c62828; margin:10px 0;">
            <strong>❌ Si su patología es definida de <span class="destacado">ORIGEN COMÚN</span>, los gastos asociados a su atención y tratamiento serán derivados a su previsión de salud (ISAPRE o FONASA).</strong>
        </div>
        <p class="pregunta">"¿Desea tomar la cita?"</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">� MODALIDAD DE ATENCIÓN</div>
        <p><strong>"Para su tipo de atención, la modalidad es a través de <span class="destacado">telemedicina</span>."</strong></p>
        <p class="pregunta">"¿Conoce esta modalidad? ¿Se ha atendido previamente por telemedicina?"</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">⚠️ INSTRUCCIONES IMPORTANTES</div>
        <div class="importante">
            <strong>� LLAMADA TELEFÓNICA OBLIGATORIA:</strong><br>
            Ese día también lo llamarán a su celular para hacer su admisión de manera telefónica <span class="destacado">20 min antes aproximadamente</span>. Por favor esté atento a su teléfono el día de su ingreso y tenga su <span class="destacado">cédula de identidad a mano</span>.
        </div>
        
        <div class="alerta-critica">
            🚨 ESTA LLAMADA ES OBLIGATORIA 🚨<br>
            Si no contestan el llamado y se conectan NO SERÁN ATENDIDOS
        </div>
        
        <p>En su atención con el médico, deberá indicar <span class="destacado">dos testigos de la empresa</span> para su caso, nombre y número de teléfono. A ellos se les realizarán entrevistas de carácter confidencial. Si los testigos no están ese día o no quisieran declarar, se deberá tomar el testimonio a otros testigos que estén presentes ese día.</p>
        
        <p>📱 Le informo que recibirá un <span class="destacado">mensaje vía WhatsApp</span> con un video explicativo del proceso de evaluación.</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">� AGENDAMIENTO</div>
        <p>Quiero comentarle que su agendamiento para ingreso de enfermedad profesional de <span class="destacado">salud mental</span>, tanto para la <span class="destacado">consulta médica</span> como para la <span class="destacado">cita con el psicólogo</span>, será gestionado y le llegará la información con detalles del día y hora de atención dentro de las próximas <span class="destacado">24 horas hábiles</span> a su correo electrónico &lt;xxxx@xxx.xx&gt;.</p>
        
        <p class="pregunta">"¿Tiene alguna preferencia AM (8 AM – 13 PM) o PM (13 PM – 18 PM) de su citación?"</p>
        <p>Intentaremos agendarlo en el bloque que nos indique según disponibilidad.</p>
        <p><em>Paciente: AM/PM/No tiene preferencia</em></p>
        
        <p>Le recomiendo que revise su <span class="destacado">bandeja de entrada</span> de su correo electrónico en 24 horas hábiles, y también la carpeta de <span class="destacado">"Spam" o "Correo no deseado"</span>, ya que los correos automáticos pueden llegar allí. Este correo debería llegar en la mañana del siguiente día hábil.</p>
    </div>
    
    <div class="seccion">
        <div class="titulo-seccion">📄 LICENCIAS Y DOCUMENTACIÓN</div>
        <p class="pregunta">"¿Cuenta con licencias rechazadas o algún antecedente de su patología?"</p>
        
        <div class="importante">
            <strong>📧 Envío de licencias rechazadas:</strong><br>
            Deberá enviar la licencia médica rechazada y la resolución del motivo de rechazo a la casilla <span class="destacado">SDTELEMEDICINA@ACHS.CL</span>. Con su nombre y apellido en el asunto del correo.
        </div>
        
        <div class="contacto">
            <strong>📎 Medios de prueba:</strong><br>
            <span class="destacado">MEDIOSDEPRUEBA@ACHS.CL</span>
        </div>
        
        <div class="importante" style="margin-top:15px;">
            <strong>⚠️ Debe llevar el día de su atención <span class="destacado">cualquier antecedente que aporte a su patología</span>.</strong>
        </div>
    </div>
    
    <div style="text-align:center; margin-top:30px; color:#666; font-size:0.9em;">
        <p>Documento generado desde ACHS Ejecutivo Centralizado</p>
        <p>Fecha: ${new Date().toLocaleDateString('es-CL')}</p>
    </div>
</body>
</html>
        `;
        
        ventanaImpresion.document.write(contenidoImpresion);
        ventanaImpresion.document.close();
        
        // Esperar a que se cargue y luego imprimir
        ventanaImpresion.onload = function() {
            ventanaImpresion.print();
        };
        
        mostrarMensajeTemp('🖨️ Abriendo ventana de impresión actualizada...', '#007bff');
        console.log('✅ Ventana de impresión actualizada abierta para Script EP');
    }

    // ========== FUNCIONES PARA SCRIPT SNL 2.0 (Contact Center ACHS Salud) ==========
    
    // Función para mostrar/ocultar el submenú SNL 2.0
    function toggleSubmenuSNL2() {
            const submenu = document.getElementById('submenuSNL2');
            const overlay = document.getElementById('overlaySubmenuSNL2');
            if (submenu && overlay) {
                const isVisible = submenu.style.display === 'block';
                if (isVisible) {
                    submenu.style.display = 'none';
                    submenu.classList.remove('show');
                    overlay.style.display = 'none';
                } else {
                    submenu.style.display = 'block';
                    submenu.classList.add('show');
                    overlay.style.display = 'block';
                }
            }
        }

        // Función para cerrar el submenú SNL 2.0
        function cerrarSubmenuSNL2() {
            const submenu = document.getElementById('submenuSNL2');
            const overlay = document.getElementById('overlaySubmenuSNL2');
            if (submenu) {
                submenu.style.display = 'none';
                submenu.classList.remove('show');
            }
            if (overlay) {
                overlay.style.display = 'none';
            }
        }

        // Cerrar el submenú al hacer clic fuera
        document.addEventListener('click', function(e) {
            const btnSNL2 = document.getElementById('btnFloranteSNL2');
            const submenu = document.getElementById('submenuSNL2');
            if (btnSNL2 && submenu && !btnSNL2.contains(e.target) && !submenu.contains(e.target)) {
                cerrarSubmenuSNL2();
            }
        });
        
        function abrirModalScriptSNL2(tipo) {
            console.log('🔄 Abriendo modal Script SNL 2.0 -', tipo);
            
            // Cerrar el submenú y el overlay
            cerrarSubmenuSNL2();
            
            const modal = document.getElementById('modalScriptSNL2');
            if (modal) {
                // Actualizar el contenido del modal según el tipo seleccionado
                actualizarContenidoSNL2(tipo);
                
                modal.style.display = 'flex';
                console.log('✅ Modal Script SNL 2.0 abierto correctamente');
                
                // Reproducir sonido de confirmación
                reproducirSonidoConfirmacion();
                
                // Mostrar mensaje temporal
                mostrarMensajeTemp('📞 Script SNL 2.0 cargado - ' + obtenerTituloSNL2(tipo), '#00d2ff');
            } else {
                console.error('❌ Modal Script SNL 2.0 no encontrado');
                alert('❌ Error: No se pudo abrir el modal Script SNL 2.0');
            }
        }
        
        function cerrarModalScriptSNL2() {
            console.log('🔄 Cerrando modal Script SNL 2.0');
            const modal = document.getElementById('modalScriptSNL2');
            if (modal) {
                modal.style.display = 'none';
                console.log('✅ Modal Script SNL 2.0 cerrado correctamente');
            } else {
                console.error('❌ Modal Script SNL 2.0 no encontrado');
            }
        }
        
        function obtenerTituloSNL2(tipo) {
            switch(tipo) {
                case 'intro':
                    return 'Intro Contact Center ACHS Salud';
                case 'menu':
                    return 'Menú Principal y Submenús';
                case 'procedimiento':
                    return 'Procedimiento de Agendamiento';
                case 'saludmental':
                    return 'Agendamiento Salud Mental';
                case 'traumatologia':
                    return 'Agendamiento Traumatología';
                case 'kinesiologia':
                    return 'Agendamiento Kinesiología';
                case 'medicinageneral':
                    return 'Agendamiento Medicina General';
                case 'medicinacuidado':
                    return 'Agendamiento Medicina del Cuidado';
                case 'dermatologia':
                    return 'Agendamiento Dermatología';
                case 'despedida':
                    return 'Despedida';
                default:
                    return 'Contact Center ACHS Salud';
            }
        }
        
        function actualizarContenidoSNL2(tipo) {
            const modalContent = document.getElementById('modalScriptSNL2Content');
            if (!modalContent) {
                console.error('❌ No se encontró el contenedor del modal SNL 2.0');
                return;
            }
            
            let contenidoHTML = '';
            
            switch(tipo) {
                case 'intro':
                    contenidoHTML = generarContenidoIntro();
                    break;
                case 'menu':
                    contenidoHTML = generarContenidoMenu();
                    break;
                case 'procedimiento':
                    contenidoHTML = generarContenidoProcedimiento();
                    break;
                case 'saludmental':
                    contenidoHTML = generarContenidoSaludMentalSNL2();
                    break;
                case 'traumatologia':
                    contenidoHTML = generarContenidoTraumatologiaSNL2();
                    break;
                case 'kinesiologia':
                    contenidoHTML = generarContenidoKinesiologiaSNL2();
                    break;
                case 'medicinageneral':
                    contenidoHTML = generarContenidoMedicinaGeneralSNL2();
                    break;
                case 'medicinacuidado':
                    contenidoHTML = generarContenidoMedicinaCuidado();
                    break;
                case 'dermatologia':
                    contenidoHTML = generarContenidoDermatologiaSNL2();
                    break;
                case 'despedida':
                    contenidoHTML = generarContenidoDespedida();
                    break;
                default:
                    contenidoHTML = generarContenidoIntro();
            }
            
            modalContent.innerHTML = contenidoHTML;
            console.log('✅ Contenido SNL 2.0 actualizado para:', tipo);
        }

        // Funciones para generar contenido específico
        function generarContenidoIntro() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff; margin-bottom:20px;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">🎤 Intro Contact Center ACHS Salud</h2>
                    <div style="background:white; padding:18px; border-radius:10px; margin-bottom:16px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">Primer mensaje:</h3>
                        <p style="font-size:1.1em; line-height:1.8; color:#222;">
                            <strong>Hola te damos la bienvenida a ACHS Salud</strong><br>
                            Reserva tu hora en <strong style="color:#00d2ff;">achssalud.cl</strong>
                        </p>
                    </div>
                </div>
            `;
        }

        function generarContenidoMenu() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff; margin-bottom:20px;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">📋 Menú Principal y Submenús</h2>
                    
                    <div style="background:white; padding:18px; border-radius:10px; margin-bottom:16px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">Menú Principal:</h3>
                        <ul style="list-style:none; padding:0; font-size:1.05em; line-height:2;">
                            <li>✅ Para <strong>Reserva de hora</strong>, marca <strong style="color:#00d2ff;">1</strong></li>
                            <li>❌ Para <strong>Anular una hora</strong>, marca <strong style="color:#00d2ff;">2</strong></li>
                            <li>💬 Para <strong>otras consultas</strong>, marca <strong style="color:#00d2ff;">3</strong></li>
                        </ul>
                    </div>

                    <div style="background:#fff5e6; padding:18px; border-radius:10px; border:2px solid #ffd166;">
                        <h3 style="color:#e67e22; margin-bottom:12px;">Sub menú 1 (Reserva de hora):</h3>
                        <ul style="list-style:none; padding:0; font-size:1.05em; line-height:2;">
                            <li>🦴 Para consulta de <strong>Traumatología</strong> con un médico general, marca <strong style="color:#e67e22;">1</strong></li>
                            <li>🧴 Para consulta de <strong>Dermatología</strong> con un médico general, marca <strong style="color:#e67e22;">2</strong></li>
                            <li>🩺 Para consulta de <strong>Medicina General</strong>, marca <strong style="color:#e67e22;">3</strong></li>
                            <li>🏃 Para consulta de <strong>Kinesiología</strong>, marca <strong style="color:#e67e22;">4</strong></li>
                            <li>🧠 Para servicio de <strong>Salud Mental</strong> con un psicólogo, marca <strong style="color:#e67e22;">5</strong></li>
                            <li>📸 En caso de necesitar servicio de <strong>Rayos</strong>, te informamos que la atención se realiza por orden de llegada, sin agendamiento previo. Si quieres saber en qué centros se ofrece este servicio, Marca <strong style="color:#e67e22;">6</strong>.</li>
                            <li>🔄 Para volver al menú principal, marca <strong style="color:#e67e22;">9</strong></li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generarContenidoProcedimiento() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">📝 Procedimiento agendamiento de atenciones de Salud No Laboral</h2>
                    
                    <div style="background:#fffbe6; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #ffd166;">
                        <p style="font-size:1.05em; color:#333; line-height:1.7;">
                            El siguiente script corresponde a la realización del <strong style="color:#e67e22;">agendamiento de pacientes</strong> de los servicios de <strong>Salud Mental</strong>, <strong>Traumatología</strong>, <strong>Medicina General</strong>, <strong>Dermatología</strong> y <strong>Kinesiología</strong> (primera atención), medicina del cuidado ACHS con la siguiente estructura de llamado: <strong>datos e información del paciente</strong>, <strong>agendamiento</strong> (presencial o telemedicina) y <strong>cierre final</strong> al paciente.
                        </p>
                        <p style="color:#e74c3c; font-weight:bold; margin-top:10px;">
                            ⚠️ El procedimiento es para realizar agendamientos de atenciones de Salud Común. No aplica para agendar Rayos X.
                        </p>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px; margin-bottom:16px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">👤 Datos e información del paciente</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> Achs Salud, buenos &lt;días/tardes&gt;, mi nombre es &lt;nombre y apellido agente&gt; ¿Con quién tengo el gusto?</p>
                            <p><strong>Paciente:</strong> Hablas con &lt;nombre y apellido paciente&gt;</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; ¿En qué le puedo ayudar?</p>
                            <p><strong>Paciente:</strong> Necesito una cita para el Servicio de Salud Mental/Traumatología/Kinesiología/Medicina General/Dermatología de Salud Común.</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; Entiendo. ¿Se ha atendido previamente por este servicio?</p>
                            <p><strong>Paciente:</strong> Si/No <span style="color:#e67e22;">[Tener consideración para el agendamiento]</span></p>
                            <p><strong>Ejecutivo:</strong> <span style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</span><br>
                            ¿Cumple con los requisitos para agendar?</p>
                            <p><strong>Paciente:</strong> Si/No <span style="color:#e74c3c;">[En caso de no cumplir los requisitos, no agendar]</span></p>
                            <p><strong>Ejecutivo:</strong> Entiendo. ¿Podría indicarme su RUT?</p>
                            <p><strong>Paciente:</strong> &lt;XX.XXX.XXX-X&gt;</p>
                            <p><strong>Ejecutivo:</strong> Gracias.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarContenidoSaludMentalSNL2() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">🧠 Agendamiento Salud Mental con Psicólogo</h2>
                    
                    <div style="background:#f0e6ff; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #9b59b6;">
                        <h3 style="color:#8e44ad;">Si el paciente es nuevo y no conoce la modalidad:</h3>
                        <p style="line-height:1.8; color:#333;">
                            <strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; recuerde que este servicio <strong style="color:#e74c3c;">no es para patologías relacionadas al trabajo</strong> y es de <strong>modalidad online</strong>. El psicólogo evaluará el caso del paciente y determinará en la primera cita si nuestro modelo de atención se adecúa a sus necesidades.
                        </p>
                        <p style="line-height:1.8; color:#333;">
                            Puede realizar el agendamiento a través de la página web <strong style="color:#00d2ff;">www.achssalud.cl/saludmental</strong>, para hacer la reserva online de su cita. Una vez realizada la reserva, deberá pagar su cita dentro de los próximos <strong style="color:#e67e22;">15 minutos</strong> o su cita será anulada automáticamente por no pago.
                        </p>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px; margin-bottom:16px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">En caso de que el paciente quiera ser agendado por el ejecutivo:</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> <span style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</span><br>
                            ¿Cumple con los requisitos para agendar?</p>
                            <p><strong>Paciente:</strong> Si/No <span style="color:#e74c3c;">[En caso de no cumplir los requisitos, no agendar]</span></p>
                            <p><strong>Ejecutivo:</strong> Hay disponibilidad en los siguientes horarios &lt;indicar horarios disponibles&gt;</p>
                            <p><strong>Paciente:</strong> &lt;Agéndeme a las XX:XX horas por favor&gt;</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; su cita quedó agendada para el día <strong>&lt;XX-XX-XXXX&gt;</strong> a las <strong>&lt;XX:XX horas&gt;</strong> con el/la psicólogo/a <strong>&lt;nombre y apellido de profesional&gt;</strong>. Le debería haber llegado un correo con el link para realizar el pago de la cita. Recuerde que para que su cita sea confirmada debe realizar el pago dentro de los próximos <strong style="color:#e67e22;">15 minutos</strong>. Una vez realizado el pago y confirmada su cita recibirá en su correo el link de conexión. Le recuerdo que debe ingresar al menos <strong>5 minutos antes</strong> de su cita para verificar que todo funcione correctamente.</p>
                            <p style="background:#fffbe6; padding:10px; border-radius:6px; margin-top:10px;">
                                📝 <strong>Importante:</strong> Como es paciente nuevo, en el correo "confirmación de cita" le será enviado un cuestionario para que lo responda antes de su primera sesión.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Continuará en el siguiente bloque...
    
        function generarContenidoTraumatologiaSNL2() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">🦴 Agendamiento Traumatología con Médico General</h2>
                    
                    <div style="background:#fffbe6; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #e67e22;">
                        <h3 style="color:#e67e22;">Si es paciente nuevo:</h3>
                        <p style="line-height:1.8; color:#333;">
                            <strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; recuerde que:
                        </p>
                        <ul style="line-height:1.9; color:#333;">
                            <li>Este servicio <strong style="color:#e74c3c;">no es para patologías relacionadas al trabajo</strong></li>
                            <li>La primera atención es <strong>presencial con médico general</strong>, el cual puede solicitar exámenes y/o apoyo de un traumatólogo central.</li>
                            <li><strong style="color:#e74c3c;">No realizamos cirugías ni procedimientos como curaciones en el centro.</strong></li>
                            <li>El servicio tiene foco en identificar el diagnóstico, entregar recetas para medicamentos y otras indicaciones médicas como terapia física, según corresponda</li>
                            <li>Puede realizar el agendamiento a través de la página web <strong style="color:#00d2ff;">www.achssalud.cl/traumatologia</strong> para hacer la reserva online de su cita</li>
                        </ul>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">En caso de que el paciente quiera ser agendado por el ejecutivo:</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> <span style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</span><br>
                            ¿Cumple con los requisitos para agendar?</p>
                            <p><strong>Paciente:</strong> Si/No <span style="color:#e74c3c;">[En caso de no cumplir los requisitos, no agendar]</span></p>
                            <p><strong>Ejecutivo:</strong> ¿En qué centro desea agendar o de qué comuna es para buscarle la más cercana?</p>
                            <p><strong>Paciente:</strong> &lt;XXXXX región/comuna&gt;</p>
                            <p><strong>Ejecutivo:</strong> Hay disponibilidad en los siguientes horarios &lt;indicar horarios disponibles según centro Achs más cercano&gt;</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; su cita de Traumatología con médico general quedó agendada para el día <strong>&lt;XX-XX-XXXX&gt;</strong> a las <strong>&lt;XX:XX horas&gt;</strong>, en el Centro de Salud Achs <strong>&lt;XXXXXX, ubicada en la calle XXXXXX&gt;</strong>. Debe presentarse <strong>20 minutos antes</strong> con su carnet de identidad o pasaporte para realizar el pago y la admisión de la cita.</p>
                            <p style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</p>
                            <div style="background:#e6f7ff; padding:12px; border-radius:8px; margin-top:12px;">
                                <p><strong style="color:#0077be;">Agregar información según previsión:</strong></p>
                                <p><strong>• Fonasa:</strong> Para la atención existen dos formas de pago: llegar con el bono que puede comprar en la página web de Fonasa <strong>www.fonasa.cl</strong> o comprar bono directo en el centro que se va a atender.</p>
                                <p><strong>• Isapre:</strong> Tenemos convenio con Banmédica, Vida Tres y Colmena, en caso de que tu Isapre no esté en convenio deberás cancelar el valor particular y con la boleta reembolsar en su Isapre.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarContenidoKinesiologiaSNL2() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">🏃 Agendamiento Kinesiología</h2>
                    
                    <div style="background:#fffbe6; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #e67e22;">
                        <h3 style="color:#e67e22;">Si es paciente nuevo:</h3>
                        <p style="line-height:1.8; color:#333;">
                            <strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; recuerde que:
                        </p>
                        <ul style="line-height:1.9; color:#333;">
                            <li>Este servicio <strong style="color:#e74c3c;">no es para patologías relacionadas al trabajo</strong></li>
                            <li>La primera atención es una <strong>evaluación kinesiológica</strong>, donde se le informará cuántas sesiones tendrá a la semana. En el centro se le agendará las sesiones faltantes para completar su tratamiento.</li>
                            <li><strong style="color:#e74c3c;">Solo se puede agendar con Orden Médica</strong>, recuerde llevarla el día de su atención.</li>
                            <li>Paciente debe ser <strong>autovalente</strong>.</li>
                            <li>Disponible para <strong>mayores de 18 años</strong></li>
                            <li>Se ven <strong>lesiones músculo-esqueléticas de origen común</strong>.</li>
                        </ul>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">En caso de que el paciente quiera ser agendado por el ejecutivo y cuente con Orden Médica:</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> <span style="color:#e74c3c; font-weight:bold;">Te informamos que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</span><br>
                            ¿Cumple con los requisitos para agendar?</p>
                            <p><strong>Paciente:</strong> Si/No <span style="color:#e74c3c;">[En caso de no cumplir los requisitos, no agendar]</span></p>
                            <p><strong>Ejecutivo:</strong> ¿Su dolencia está relacionada con qué parte del cuerpo?, ¿cuál es su diagnóstico?</p>
                            <p><strong>Paciente:</strong> &lt;Indica lugar del cuerpo y diagnóstico&gt;</p>
                            <p style="background:#fff3cd; padding:10px; border-radius:6px; border:1px solid #ffc107;">
                            <p><strong>Paciente:</strong> En caso de que el paciente indique dos extremidades se debe agendar dos citas de ingreso y comunicarle lo siguiente </p> 
                            <p><strong> En caso de que el paciente indique dos extremidades se debe agendar dos citas de ingreso y comunicarle lo siguiente</p>
                            <p><strong>Ejecutivo:<strong> Como requieres tratamiento para dos zonas, debes agendar 2 sesiones de evaluación diferentes (1 por cada lesión) para así poder tratar de manera completa ambas zonas. 
                            <p><strong>Ejemplo 1: si tienes lesión de muñeca y lesión de rodilla, debemos evaluar cada una por separado y así personalizar tu tratamiento.
                            <p><strong>Ejemplo 2: Si tienes lesión de muñeca y hombro, debemos evaluar cada una por separado y así personalizar tu tratamiento.
 
                            <p>📝<strong>Nota:</strong> Revisar listado. Si se encuentra, proceder a agendar cita. En caso contrario, anotar diagnóstico y no agendar.</p>
                            <p><strong>Ejecutivo:</strong> ¿En qué centro desea agendar o de qué comuna es para buscarle la más cercana?</p>
                            <p><strong>Paciente:</strong> &lt;XXXXX centro/comuna&gt;</p>
                            <p style="background:#e3f2fd; padding:10px; border-radius:6px; border:1px solid #2196f3;">
                                💻 <strong>Sistema SAP:</strong> Ingresar a SAP a la transacción NWP1, Activar Variante de la sede, y buscar disponibilidad en los cupos de Salud Integral
                            </p>
                            <p><strong>Ejecutivo:</strong> Hay disponibilidad en los siguientes horarios &lt;indicar horarios disponibles según centro Achs más cercano. Se debe entregar hora cerrada HH:00&gt;</p>
                            <p><strong>Paciente:</strong> &lt;Agéndeme a las HH:00 horas por favor&gt;</p>
                            <p style="background:#fff3cd; padding:10px; border-radius:6px; border:1px solid #ffc107; margin-top:10px;">
                                📋 <strong>Proceso en SAP:</strong><br>
                                1. Colocarse sobre el cupo y hacer doble click<br>
                                2. Ingresar Rut del paciente anteponiendo RU<br>
                                3. Tipo de episodio: VSC salud común<br>
                                4. Clase de consulta: Apoyo tratamiento<br>
                                5. Pinchar Binoculares, seleccionar al paciente<br>
                                6. Guardar en el disquet<br>
                                <em>Si tiene dudas del proceso, puede consultarlo con Nataly Ramírez: nvramirezj@achs.cl</em>
                            </p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; su cita de Kinesiología quedó agendada para el día <strong>&lt;XX-XX-XXXX&gt;</strong> a las <strong>&lt;HH:00 horas&gt;</strong>, en el Centro de Salud Achs <strong>&lt;XXXXXX, ubicada en la calle XXXXXX&gt;</strong>. Debe presentarse <strong>30 minutos antes</strong> con su <strong style="color:#e74c3c;">Orden Médica</strong> y su carnet de identidad o pasaporte para realizar el pago y la admisión de la cita.</p>
                            <p style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</p>
                            <div style="background:#e6f7ff; padding:12px; border-radius:8px; margin-top:12px;">
                                <p><strong style="color:#0077be;">Agregar información según previsión:</strong></p>
                                <p><strong>• Fonasa:</strong> Para la atención existen dos formas de pago: Comprar bono directo en el centro que se va a atender o puede llegar con el bono comprado en la página web de Fonasa <strong>www.fonasa.cl</strong>. Para una atención más rápida le recomendamos asistir con el bono comprado.</p>
                                <p><strong>• Isapre:</strong> Tenemos convenio con Banmédica, Vida Tres y Colmena, en caso de que tu Isapre no esté en convenio deberás cancelar el valor particular y con la boleta reembolsar en su Isapre.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarContenidoMedicinaGeneralSNL2() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">🩺 Agendamiento Medicina General</h2>
                    
                    <div style="background:#fffbe6; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #e67e22;">
                        <h3 style="color:#e67e22;">Si es paciente nuevo:</h3>
                        <p style="line-height:1.8; color:#333;">
                            <strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; recuerde que:
                        </p>
                        <ul style="line-height:1.9; color:#333;">
                            <li>Este servicio <strong style="color:#e74c3c;">no es para patologías relacionadas al trabajo</strong></li>
                            <li>La atención es <strong>presencial con médico general</strong>, el cual puede solicitar exámenes y/o derivarlo a especialista para su tratamiento</li>
                            <li>Puede realizar el agendamiento a través de la página web <strong style="color:#00d2ff;">www.achssalud.cl/medicinageneral</strong> para hacer la reserva online de su cita</li>
                        </ul>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">En caso de que el paciente quiera ser agendado por el ejecutivo:</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> ¿En qué centro desea agendar o de qué comuna es para buscarle la más cercana?</p>
                            <p><strong>Paciente:</strong> &lt;XXXXX región/comuna&gt;</p>
                            <p><strong>Ejecutivo:</strong> Hay disponibilidad en los siguientes horarios &lt;indicar horarios disponibles según centro Achs más cercano&gt;</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; su cita de Medicina General quedó agendada para el día <strong>&lt;XX-XX-XXXX&gt;</strong> a las <strong>&lt;XX:XX horas&gt;</strong>, en el Centro de Salud Achs <strong>&lt;XXXXXX, ubicada en la calle XXXXXX&gt;</strong>. Debe presentarse <strong>20 minutos antes</strong> con su carnet de identidad o pasaporte para realizar el pago y la admisión de la cita.</p>
                            <div style="background:#e6f7ff; padding:12px; border-radius:8px; margin-top:12px;">
                                <p><strong style="color:#0077be;">Agregar información según previsión:</strong></p>
                                <p><strong>• Fonasa:</strong> Para la atención existen dos formas de pago: Comprar bono directo en el centro que se va a atender o puede llegar con el bono comprado en la página web de Fonasa <strong>www.fonasa.cl</strong>.</p>
                                <p><strong>• Isapre:</strong> Tenemos convenio con Banmédica, Vida Tres y Colmena, en caso de que tu Isapre no esté en convenio deberás cancelar el valor particular y con la boleta reembolsar en su Isapre.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarContenidoMedicinaCuidado() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">💚 Agendamiento Medicina General del Cuidado</h2>
                    
                    <div style="background:#fffbe6; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #e67e22;">
                        <h3 style="color:#e67e22;">Si es paciente nuevo:</h3>
                        <p style="line-height:1.8; color:#333;">
                            <strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; recuerde que:
                        </p>
                        <ul style="line-height:1.9; color:#333;">
                            <li>Este servicio <strong style="color:#e74c3c;">no es para patologías relacionadas al trabajo</strong></li>
                            <li>La atención es <strong>presencial con médico general</strong>, el cual puede revisar exámenes y/o derivarlo a especialista para su tratamiento.</li>
                            <li>Puede realizar el agendamiento a través de la página web <strong style="color:#00d2ff;">www.achssalud.cl/medicinadelcuidado</strong> para hacer la obtención de la orden médica y la reserva online de su cita.</li>
                            <li style="background:#fff3cd; padding:8px; border-radius:6px; margin-top:8px;">En caso de que el paciente haya adquirido la orden de exámenes con nosotros (<strong>$2.490</strong>), se le aplicará un <strong>pre-abono</strong> al pago de la atención médica, descontando hasta <strong style="color:#27ae60;">$2.000</strong> del monto total a pagar de la consulta.</li>
                            <li>El prepago se considerará de manera automática, sólo para pacientes Fonasa e Isapre convenidas (en caso contrario el paciente deberá pagar el valor completo de la consulta, aunque haya comprado órdenes de exámenes con nosotros).</li>
                            <li>Prepago se aplica con IMED de forma automática al momento de colocar la huella digital del paciente.</li>
                            <li>Se les solicita a los pacientes que lleven los <strong>resultados de los exámenes impresos</strong></li>
                            <li style="background:#ffe4e4; padding:8px; border-radius:6px; margin-top:8px;">⏰ El prepago de la consulta tiene una vigencia de <strong style="color:#e74c3c;">6 meses</strong> a partir de la emisión de la orden médica.</li>
                        </ul>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">En caso de que el paciente quiera ser agendado por el ejecutivo la lectura de los exámenes preventivos:</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> ¿En qué centro desea agendar o de qué comuna es para buscarle la más cercana?</p>
                            <p><strong>Paciente:</strong> &lt;XXXXX región/comuna&gt;</p>
                            <p><strong>Ejecutivo:</strong> Hay disponibilidad en los siguientes horarios &lt;indicar horarios disponibles según centro Achs más cercano&gt;</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; su cita de Medicina General del cuidado quedó agendada para el día <strong>&lt;XX-XX-XXXX&gt;</strong> a las <strong>&lt;XX:XX horas&gt;</strong>, en el Centro de Salud Achs <strong>&lt;XXXXXX, ubicada en la calle XXXXXX&gt;</strong>. Debe presentarse <strong>20 minutos antes</strong> con su carnet de identidad o pasaporte para realizar el pago y la admisión de la cita.</p>
                            <div style="background:#e6f7ff; padding:12px; border-radius:8px; margin-top:12px;">
                                <p><strong style="color:#0077be;">Agregar información según previsión:</strong></p>
                                <p><strong>• FONASA – ISAPRE:</strong> En caso de que el paciente haya adquirido la orden de exámenes con nosotros Achs salud ($2.490), se le aplicará un pre-abono al pago de la atención médica, descontando hasta <strong style="color:#27ae60;">$2.000</strong> del monto total a pagar de la consulta. El prepago se considerará de manera automática, sólo para pacientes Fonasa e Isapre convenidas (en caso contrario el paciente deberá pagar el valor completo de la consulta, aunque haya comprado órdenes de exámenes con nosotros).</p>
                                <p><strong>• Prepago:</strong> Se aplica con IMED de forma automática al momento de colocar la huella digital del paciente.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarContenidoDermatologiaSNL2() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">🧴 Agendamiento Dermatología con Médico General</h2>
                    
                    <div style="background:#fffbe6; padding:16px; border-radius:10px; margin-bottom:16px; border:1px solid #e67e22;">
                        <h3 style="color:#e67e22;">Si es paciente nuevo:</h3>
                        <p style="line-height:1.8; color:#333;">
                            <strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; recuerde que:
                        </p>
                        <ul style="line-height:1.9; color:#333;">
                            <li>Este servicio <strong style="color:#e74c3c;">no es para patologías relacionadas al trabajo</strong></li>
                            <li>La primera atención es <strong>presencial con médico general</strong>, el cual puede solicitar exámenes y/o apoyo de un dermatólogo.</li>
                            <li><strong style="color:#e74c3c;">No realizamos cirugías ni procedimientos como curaciones en el centro.</strong></li>
                            <li>El servicio tiene foco en identificar el diagnóstico y entregar recetas para medicamentos/cremas</li>
                            <li>Puede realizar el agendamiento a través de la página web <strong style="color:#00d2ff;">www.achssalud.cl/dermatologia</strong> para hacer la reserva online de su cita</li>
                        </ul>
                    </div>

                    <div style="background:white; padding:18px; border-radius:10px;">
                        <h3 style="color:#3a7bd5; margin-bottom:12px;">En caso de que el paciente quiera ser agendado por el ejecutivo:</h3>
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:1.9; color:#333;">
                            <p><strong>Ejecutivo:</strong> <span style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</span><br>
                            ¿Cumple con los requisitos para agendar?</p>
                            <p><strong>Paciente:</strong> Si/No <span style="color:#e74c3c;">[En caso de no cumplir los requisitos, no agendar]</span></p>
                            <p><strong>Ejecutivo:</strong> ¿En qué centro desea agendar o de qué comuna es para buscarle la más cercana?</p>
                            <p><strong>Paciente:</strong> &lt;XXXXX región/comuna&gt;</p>
                            <p><strong>Ejecutivo:</strong> Hay disponibilidad en los siguientes horarios &lt;indicar horarios disponibles según centro Achs más cercano&gt;</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; su cita de Dermatología con médico general quedó agendada para el día <strong>&lt;XX-XX-XXXX&gt;</strong> a las <strong>&lt;XX:XX horas&gt;</strong>, en el Centro de Salud Achs <strong>&lt;XXXXXX, ubicada en la calle XXXXXX&gt;</strong>. Debe presentarse <strong>20 minutos antes</strong> con su carnet de identidad o pasaporte para realizar el pago y la admisión de la cita.</p>
                            <p style="color:#e74c3c; font-weight:bold;">Recuerde que, por normativa de la Superintendencia de Seguridad Social, no podemos atender patologías que ya fueron consultadas por motivos laborales.</p>
                            <div style="background:#e6f7ff; padding:12px; border-radius:8px; margin-top:12px;">
                                <p><strong style="color:#0077be;">Agregar información según previsión:</strong></p>
                                <p><strong>• Fonasa:</strong> Para la atención existen dos formas de pago: llegar con el bono que puede comprar en la página web de Fonasa <strong>www.fonasa.cl</strong> o comprar bono directo en el centro que se va a atender.</p>
                                <p><strong>• Isapre:</strong> Tenemos convenio con Banmédica, Vida Tres y Colmena, en caso de que tu Isapre no esté en convenio deberás cancelar el valor particular y con la boleta reembolsar en su Isapre.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generarContenidoDespedida() {
            return `
                <div style="background:#e0f7ff; padding:24px; border-radius:14px; border-left:5px solid #00d2ff;">
                    <h2 style="color:#006494; font-size:1.6em; margin-bottom:16px;">👋 Despedida</h2>
                    
                    <div style="background:white; padding:18px; border-radius:10px;">
                        <div style="background:#f8f9fa; padding:14px; border-radius:8px; line-height:2; color:#333; font-size:1.1em;">
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt;, ¿algo más en lo que lo pueda ayudar?</p>
                            <p><strong>Paciente:</strong> No, gracias.</p>
                            <p><strong>Ejecutivo:</strong> &lt;nombre y apellido paciente&gt; Gracias por llamar a ACHS Salud. Por favor manténgase en línea para evaluar mi atención, muchas gracias.</p>
                        </div>
                        <div style="background:#d4edda; padding:12px; border-radius:8px; margin-top:16px; border:1px solid #28a745;">
                            <p style="color:#155724; margin:0; font-weight:600;">
                                ✅ Es importante mantener siempre un tono amable, profesional y empático durante toda la llamada.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function copiarScriptSNL2() {
            const modal = document.getElementById('modalScriptSNL2Content');
            if (!modal) return;
            
            const textoParaCopiar = modal.innerText || modal.textContent;
            
            navigator.clipboard.writeText(textoParaCopiar).then(() => {
                mostrarMensajeTemp('📋 Contenido copiado al portapapeles', '#27ae60');
            }).catch(err => {
                console.error('Error al copiar:', err);
                mostrarMensajeTemp('❌ Error al copiar el contenido', '#e74c3c');
            });
        }

        function imprimirScriptSNL2() {
            const contenidoModal = document.getElementById('modalScriptSNL2Content');
            if (!contenidoModal) {
                alert('No hay contenido para imprimir');
                return;
            }

            const ventanaImpresion = window.open('', '_blank');
            const contenidoImpresion = `
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SCRIPT SNL 2.0 - Contact Center ACHS Salud</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 40px;
            color: #2c3e50;
            background: #f8f9fa;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
            color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3);
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #00d2ff;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 { font-size: 2.2em; margin: 0; }
        h2 { color: #006494; font-size: 1.5em; margin-bottom: 10px; }
        h3 { color: #3a7bd5; font-size: 1.2em; margin: 12px 0 8px 0; }
        p { margin: 8px 0; }
        strong { color: #006494; }
        ul { margin: 10px 0 10px 20px; }
        li { margin: 6px 0; }
        .important { background: #fff3cd; padding: 10px; border-radius: 5px; border: 1px solid #ffc107; margin: 10px 0; }
        .note { background: #d1ecf1; padding: 10px; border-radius: 5px; border: 1px solid #17a2b8; margin: 10px 0; }
        .footer { text-align: center; margin-top: 40px; color: #6c757d; font-size: 0.9em; }
        @media print {
            body { margin: 20px; }
            .header { background: #00d2ff; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📞 SCRIPT SNL 2.0</h1>
        <p style="font-size: 1.2em; margin: 5px 0 0 0;">Contact Center ACHS Salud</p>
    </div>
    
    ${contenidoModal.innerHTML}
    
    <div class="footer">
        <p>Documento generado automáticamente - ACHS ${new Date().toLocaleDateString()}</p>
        <p>Contact Center ACHS Salud</p>
    </div>
</body>
</html>
            `;
            
            ventanaImpresion.document.write(contenidoImpresion);
            ventanaImpresion.document.close();
            
            ventanaImpresion.onload = function() {
                setTimeout(() => {
                    ventanaImpresion.print();
                }, 500);
            };
            
            mostrarMensajeTemp('🖨️ Abriendo ventana de impresión para Script SNL 2.0...', '#00d2ff');
            console.log('✅ Ventana de impresión abierta para Script SNL 2.0');
        }
    
        // ===== FUNCIONES PARA SCRIPT LE - LISTA DE ESPERA =====
        
        function abrirModalScriptLE() {
            console.log('🔄 Abriendo modal Script LE');
            const modal = document.getElementById('modalScriptLE');
            if (modal) {
                modal.style.display = 'flex';
                console.log('✅ Modal Script LE abierto correctamente');
                
                // Reproducir sonido de confirmación
                reproducirSonidoConfirmacion();
                
                // Mostrar mensaje temporal
                mostrarMensajeTemp('🏥 Script LE cargado - Protocolo Lista de Espera FONASA', '#9b59b6');
            } else {
                console.error('❌ Modal Script LE no encontrado');
                alert('❌ Error: No se pudo abrir el modal Script LE');
            }
        }
        
        function cerrarModalScriptLE() {
            console.log('🔄 Cerrando modal Script LE');
            const modal = document.getElementById('modalScriptLE');
            if (modal) {
                modal.style.display = 'none';
                console.log('✅ Modal Script LE cerrado correctamente');
            } else {
                console.error('❌ Modal Script LE no encontrado');
            }
        }
        
        function copiarScriptLE() {
            // Obtener todo el contenido del script LE
            const contenidoScript = `
    SCRIPT LE - PROTOCOLO LISTA DE ESPERA FONASA
    Hospital del Trabajador ACHS Salud
    
    🏥 SCRIPT LISTA DE ESPERA (LE)
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    📞 1. NOTIFICACIÓN:
    
    Hola, ¿hablo con [Nombre del Paciente]? Soy [Tu Nombre] y te llamo del Hospital del Trabajador Achs Salud. ¿Cómo estás hoy?
    
    Te llamo para informarte que Fonasa/Tu hospital nos derivó tu caso para resolver tu problema de salud [Problema de salud].
    
    ⚠️ IMPORTANTE: Hay que recalcar que Fonasa solo nos derivó el caso para la resolución de ese problema de salud
    
    📝 NOTA: Si no es el paciente, reforzar que se llama por una cirugía pendiente de LE y pedir números de paciente o que indiquen horario de llamado
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    🏥 2. PROCESO Y PARTICIPACIÓN:
    
    Todo el proceso se realiza en el Centro Médico del Hospital del Trabajador. Este incluye:
    • Exámenes de laboratorio
    • Imagen  
    • Consulta para confirmar tu diagnóstico
    • Posteriormente la cirugía en caso de que no existan contraindicaciones
    
    💰 Los exámenes, consultas y cirugía no tienen ningún costo para el paciente y solamente corren por su cuenta los costos de traslado (incluso si son de región)
    
    ¿Deseas atenderte con nosotros?
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    📋 3. INFORMACIÓN DE CONTACTO DEL PACIENTE (solo en caso de que paciente acepte operarse):
    
    Para poder seguir adelante, necesito reunir información relevante sobre ti, ¿te puedo hacer algunas preguntas?
    
    • ¿Podrías darme tu número de teléfono principal y un segundo número si tienes?
    • ¿Cuál es tu correo electrónico?
    • ¿Cuál es tu fecha de nacimiento?
    • ¿Cuál es tu dirección y comuna?
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    🩺 4. INFORMACIÓN MÉDICA (solo en caso de que paciente acepte operarse):
    
    Ahora te haré algunas preguntas sobre tu problema de salud:
    
    • ¿La condición afecta un lado en particular? Si es así, ¿cuál?
    • ¿Has tenido alguna operación previa por este diagnóstico?
    • ¿Hace cuánto tiempo estás esperando esta cirugía?
    • ¿Estás o crees estar embarazada? [Solo si aplica]
    • ¿Has tenido algún infarto?
    • ¿Estás dializado?
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    ❌ 5. INFORMACIÓN RECHAZO (solo en caso de que paciente rechace):
    
    Dependiendo del motivo de rechazo:
    
    • Si ya se operó: ¿Cuándo y dónde se operó? [No es necesaria fecha exacta]
    • Si paciente falleció: ¿Cuándo falleció?
    • Si no desea operarse con nosotros es por:
      ○ Lejanía (Distancia/Traslado)
      ○ Salud
      ○ No lo necesita (No quiere – No necesita)
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    👋 6. DESPEDIDA E INFORMACIÓN PARA EL PACIENTE:
    
    Te recuerdo que todas tus atenciones serán en el Centro Médico del Hospital del Trabajador ubicado en Vicuña Mackenna 210, Providencia (a pasos del metro Parque Bustamante). 
    
    Durante los próximos días te contactarán para agendar tu consulta médica y tus exámenes, por lo que te pido que estés muy atento a tu teléfono.
    
    Buenas tardes y muchas gracias por tu tiempo
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    ❓ PREGUNTAS FRECUENTES:
    
    💰 ¿Esto tiene algún costo para mí?
    Las consultas, exámenes, cirugía y recuperación no tienen costo para el paciente. Sin embargo, cualquier costo relacionado a transporte (traslados en taxi, locomoción pública, ambulancia, uber, bus, avión, etc) corre por cuenta del paciente.
    ⚠️ RECALCAR ESTA INFORMACIÓN PARA PACIENTES DE REGIÓN/ZONAS ALEJADAS DEL HT
    
    ⏰ ¿Qué sucede si no puedo tomar la decisión ahora?
    Fonasa nos entrega plazos muy acotados para resolver los casos que nos deriva, por lo cual solamente podemos darle 24 horas para que tome la decisión
    
    🏥 Ya estoy en un proceso para operarme en mi Hospital de Base, ¿puedo iniciar el proceso en el HT?
    Fonasa nos derivó su caso para ser operado por nosotros, sin importar lo que esté sucediendo en su Hospital de base. Usted puede mantenerse en ambos procesos, sin embargo, si durante el proceso decide mantenerse en su Hospital de base, debe comunicarnos su decisión para informar a Fonasa
    
    📋 ¿Todas mis atenciones pasan a ser en el Hospital del Trabajador?
    No, Fonasa solamente nos deriva su caso para la confirmación del diagnóstico y la resolución quirúrgica de su problema de salud, por lo que cualquier problema de salud no asociado al diagnóstico por el que fue derivado debe ser resuelto en su Hospital de base
    
    🩺 ¿Qué pasa con el resto de mis atenciones en mi Hospital de base?
    Usted mantendrá todo el resto de sus atenciones en su Hospital de base. Fonasa solamente nos entrega las facultades para atenderla por el problema de salud que Fonasa derivó
    
    🚀 ¿Cuándo iniciaría el proceso?
    El proceso comienza inmediatamente después de la creación de la ficha [Preguntas que se le harán a continuación]. Durante la misma semana lo contactarán desde el equipo de agendamiento para agendar sus exámenes y consulta de evaluación, por lo que debe estar muy atento al teléfono
    
    📅 ¿Cuándo tengo mi consulta?
    Durante la misma semana lo contactarán desde el equipo de agendamiento para confirmar sus exámenes y consulta de evaluación, por lo que debe estar muy atento al teléfono
    
    ⚕️ ¿Cuándo tengo mi cirugía?
    Para poder llegar a la cirugía se debe seguir todo el proceso, el cual contempla: exámenes de laboratorio, imágenes y consultas médicas, en los cuales se corroborará el diagnóstico. Posteriormente el equipo médico definirá la fecha de su cirugía, la cual debe tener lugar antes de un mes aproximadamente desde la derivación
    
    🧪 Yo ya tengo mis exámenes, ¿debo tomarme mis exámenes igual?
    Si cuenta con exámenes que fueron tomados en menos de 3 meses hacia el pasado, puede traerlos para complementar información en consulta, pero de todas formas tomaremos nuevamente todos los exámenes
    
    📋 Si ya tengo todos mis pases en mi Hospital de base, ¿puedo operarme al tiro?
    No, pese a que usted ya cuenta con pases de su Hospital de base, nuestros médicos deben corroborar su diagnóstico para poder operarse con nosotros. De todas formas, debe traer toda la documentación que le hayan entregado en su Hospital de base (exámenes, pases, etc)
    
    ⏱️ ¿Cuánto demora el proceso?
    El proceso depende de cada paciente y su condición de salud. En caso de que usted sea un paciente sano y se confirme su diagnóstico, entonces programaremos su cirugía cuanto antes. En caso de que su problema de salud sea más complejo, entonces los tiempos pueden aumentar.
    
    📅 ¿Las consultas y exámenes son el mismo día?
    No siempre es posible agendar todas las atenciones para el mismo día debido a que depende de la disponibilidad de horas de imagenología y de consultas. En caso de que tenga alguna limitación de horarios, puedo dejar una nota con su disponibilidad
    
    📍 ¿Dónde están ubicados?
    Nuestro centro médico está ubicado en Vicuña Mackenna 210, metro parque Bustamante.
    
    🏢 ¿Me puedo atender en una de las sedes?
    La licitación solo contempla atenciones en sede central ubicada en Vicuña Mackenna 210.
    
    🏃‍♂️ ¿Puedo hacer la kinesiología en otro lado?
    La licitación solo contempla atenciones ambulatorias en sede central ubicada en Vicuña Mackenna 210.
    
    🔍 ¿Por qué tienen que confirmar mi diagnóstico?
    La confirmación de diagnóstico es esencial para entregar un tratamiento acorde a cada paciente y tener certeza de la patología por la que fue derivado y explicar a paciente el procedimiento y plan de acción.
    
    📝 ¿Por qué necesitan mi información?
    Fonasa no nos entrega toda la información que necesitamos para crear su ficha y sin esta no podemos atenderlo, por lo que necesitamos que nos la entregue. Esta información solo será utilizada para crear la ficha y tener la mayor cantidad de opciones para contactarlo
    
    🏠 ¿Para qué necesitan mi dirección?
    Su dirección es parte de la información solicitada al momento de la creación de su ficha clínica
    
    🔒 ¿Dónde puedo revisar que esto no es una estafa?
    Puede revisar nuestra página Web (https://www.hospitaldeltrabajador.cl/ o https://www.hospitaldeltrabajador.cl/detalle-noticia/2024/hospital-del-trabajador-achs-salud-es-uno-de-los-prestadores-que-resolvera-parte-de-las-cirugias-de-lista-de-espera-fonasa-durante-los-proximos-3-anos), revisar en YouTube un reportaje realizado cuando iniciamos este proceso el año pasado con nuestra primera paciente e incluso preguntar a Fonasa o su hospital de base por la derivación.
    
    🩺 ¿Qué pasa si tengo muchos problemas de salud?
    Usted será evaluado por uno de nuestros médicos para determinar si estos problemas de salud serán un problema para realizar la cirugía
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    Documento generado automáticamente - ACHS ${new Date().toLocaleDateString()}
            `;
            
            // Copiar al portapapeles
            navigator.clipboard.writeText(contenidoScript.trim()).then(function() {
                mostrarMensajeTemp('📋 Script LE copiado al portapapeles', '#9b59b6');
                console.log('✅ Script LE copiado al portapapeles');
                
                // Reproducir sonido de confirmación
                reproducirSonidoConfirmacion();
            }).catch(function(err) {
                console.error('❌ Error al copiar script LE:', err);
                mostrarMensajeTemp('❌ Error al copiar. Use Ctrl+A y Ctrl+C manualmente', '#dc3545');
            });
        }
        
        function imprimirScriptLE() {
            // Crear ventana de impresión con el script LE formateado
            const ventanaImpresion = window.open('', '_blank', 'width=800,height=600');
            
            const contenidoImpresion = `
    <!DOCTYPE html>
    <html>
    <head>
        <title>Script LE - Lista de Espera FONASA</title>
        <style>
            body { 
                font-family: Arial, sans-serif; 
                line-height: 1.6; 
                margin: 40px; 
                color: #2c3e50; 
                background: #f8f9fa;
            }
            .header { 
                text-align: center; 
                margin-bottom: 30px; 
                padding: 20px; 
                background: linear-gradient(135deg, #9b59b6, #8e44ad); 
                color: white; 
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(155,89,182,0.3);
            }
            .seccion { 
                margin: 20px 0; 
                padding: 15px; 
                border-left: 4px solid #9b59b6; 
                background: #fff; 
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .titulo-seccion { 
                font-weight: bold; 
                font-size: 1.2em; 
                color: #8e44ad; 
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .destacado { 
                background: #fff3cd; 
                padding: 2px 6px; 
                border-radius: 4px; 
                font-weight: bold;
                color: #856404;
            }
            .importante { 
                background: #f8d7da; 
                border: 1px solid #f5c6cb; 
                padding: 15px; 
                border-radius: 8px; 
                margin: 10px 0;
                color: #721c24;
            }
            .nota { 
                background: #d1ecf1; 
                border: 1px solid #bee5eb; 
                padding: 15px; 
                border-radius: 8px; 
                margin: 10px 0;
                color: #0c5460;
            }
            .footer { 
                margin-top: 40px; 
                text-align: center;
                color: #6c757d;
                font-size: 0.9em;
            }
            ul { margin: 10px 0; padding-left: 20px; }
            li { margin: 5px 0; }
            .pregunta { font-weight: bold; color: #2980b9; margin: 8px 0; }
            .faq { background: #e8f5e8; padding: 10px; border-radius: 5px; margin: 8px 0; }
            .faq-titulo { font-weight: bold; color: #155724; }
            hr { border: none; height: 2px; background: linear-gradient(90deg, #9b59b6, #8e44ad); margin: 30px 0; }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>🏥 SCRIPT LE</h1>
            <p>Protocolo Lista de Espera FONASA - Hospital del Trabajador ACHS Salud</p>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">📞 1. NOTIFICACIÓN</div>
            <p class="pregunta">Hola, ¿hablo con <span class="destacado">[Nombre del Paciente]</span>? Soy <span class="destacado">[Tu Nombre]</span> y te llamo del Hospital del Trabajador Achs Salud. ¿Cómo estás hoy?</p>
            <p class="pregunta">Te llamo para informarte que Fonasa/Tu hospital nos derivó tu caso para resolver tu problema de salud <span class="destacado">[Problema de salud]</span>.</p>
            <div class="importante">
                <strong>⚠️ IMPORTANTE:</strong> Hay que recalcar que Fonasa solo nos derivó el caso para la resolución de ese problema de salud
            </div>
            <div class="nota">
                <strong>📝 NOTA:</strong> Si no es el paciente, reforzar que se llama por una cirugía pendiente de LE y pedir números de paciente o que indiquen horario de llamado
            </div>
        </div>
    
        <hr>
        
        <div class="seccion">
            <div class="titulo-seccion">🏥 2. PROCESO Y PARTICIPACIÓN</div>
            <p>Todo el proceso se realiza en el <strong>Centro Médico del Hospital del Trabajador</strong>. Este incluye:</p>
            <ul>
                <li>Exámenes de laboratorio</li>
                <li>Imagen</li>
                <li>Consulta para confirmar tu diagnóstico</li>
                <li>Posteriormente la cirugía en caso de que no existan contraindicaciones</li>
            </ul>
            <div class="nota">
                <strong>💰 SIN COSTO:</strong> Los exámenes, consultas y cirugía no tienen ningún costo para el paciente y solamente corren por su cuenta los costos de traslado (incluso si son de región)
            </div>
            <p class="pregunta">¿Deseas atenderte con nosotros?</p>
        </div>
    
        <hr>
        
        <div class="seccion">
            <div class="titulo-seccion">📋 3. INFORMACIÓN DE CONTACTO DEL PACIENTE</div>
            <em>(solo en caso de que paciente acepte operarse)</em>
            <p class="pregunta">Para poder seguir adelante, necesito reunir información relevante sobre ti, ¿te puedo hacer algunas preguntas?</p>
            <ul>
                <li>¿Podrías darme tu número de teléfono principal y un segundo número si tienes?</li>
                <li>¿Cuál es tu correo electrónico?</li>
                <li>¿Cuál es tu fecha de nacimiento?</li>
                <li>¿Cuál es tu dirección y comuna?</li>
            </ul>
        </div>
    
        <hr>
        
        <div class="seccion">
            <div class="titulo-seccion">🩺 4. INFORMACIÓN MÉDICA</div>
            <em>(solo en caso de que paciente acepte operarse)</em>
            <p class="pregunta">Ahora te haré algunas preguntas sobre tu problema de salud:</p>
            <ul>
                <li>¿La condición afecta un lado en particular? Si es así, ¿cuál?</li>
                <li>¿Has tenido alguna operación previa por este diagnóstico?</li>
                <li>¿Hace cuánto tiempo estás esperando esta cirugía?</li>
                <li>¿Estás o crees estar embarazada? <em>[Solo si aplica]</em></li>
                <li>¿Has tenido algún infarto?</li>
                <li>¿Estás dializado?</li>
            </ul>
        </div>
    
        <hr>
        
        <div class="seccion">
            <div class="titulo-seccion">❌ 5. INFORMACIÓN RECHAZO</div>
            <em>(solo en caso de que paciente rechace y dependiendo del motivo de rechazo)</em>
            <ul>
                <li><strong>Si ya se operó:</strong> ¿Cuándo y dónde se operó? <em>[No es necesaria fecha exacta]</em></li>
                <li><strong>Si paciente falleció:</strong> ¿Cuándo falleció?</li>
                <li><strong>Si no desea operarse con nosotros es por:</strong>
                    <ul>
                        <li>Lejanía (Distancia/Traslado)</li>
                        <li>Salud</li>
                        <li>No lo necesita (No quiere – No necesita)</li>
                    </ul>
                </li>
            </ul>
        </div>
    
        <hr>
        
        <div class="seccion">
            <div class="titulo-seccion">👋 6. DESPEDIDA E INFORMACIÓN</div>
            <p class="pregunta">Te recuerdo que todas tus atenciones serán en el Centro Médico del Hospital del Trabajador ubicado en <span class="destacado">Vicuña Mackenna 210, Providencia</span> (a pasos del metro Parque Bustamante).</p>
            <p class="pregunta">Durante los próximos días te contactarán para agendar tu consulta médica y tus exámenes, por lo que <span class="destacado">te pido que estés muy atento a tu teléfono</span>.</p>
            <p class="pregunta"><strong>Buenas tardes y muchas gracias por tu tiempo</strong></p>
        </div>
    
        <hr>
        
        <div class="seccion">
            <div class="titulo-seccion">❓ PREGUNTAS FRECUENTES</div>
            
            <div class="faq">
                <div class="faq-titulo">💰 ¿Esto tiene algún costo para mí?</div>
                <p>Las consultas, exámenes, cirugía y recuperación no tienen costo para el paciente. Sin embargo, cualquier costo relacionado a transporte (traslados en taxi, locomoción pública, ambulancia, uber, bus, avión, etc) corre por cuenta del paciente.</p>
                <div class="importante">⚠️ RECALCAR ESTA INFORMACIÓN PARA PACIENTES DE REGIÓN/ZONAS ALEJADAS DEL HT</div>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">⏰ ¿Qué sucede si no puedo tomar la decisión ahora?</div>
                <p>Fonasa nos entrega plazos muy acotados para resolver los casos que nos deriva, por lo cual solamente podemos darle 24 horas para que tome la decisión</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🏥 Ya estoy en proceso en mi Hospital de Base, ¿puedo iniciar en el HT?</div>
                <p>Fonasa nos derivó su caso para ser operado por nosotros, sin importar lo que esté sucediendo en su Hospital de base. Usted puede mantenerse en ambos procesos, sin embargo, si durante el proceso decide mantenerse en su Hospital de base, debe comunicarnos su decisión para informar a Fonasa</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">📋 ¿Todas mis atenciones pasan a ser en el Hospital del Trabajador?</div>
                <p>No, Fonasa solamente nos deriva su caso para la confirmación del diagnóstico y la resolución quirúrgica de su problema de salud, por lo que cualquier problema de salud no asociado al diagnóstico por el que fue derivado debe ser resuelto en su Hospital de base</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🩺 ¿Qué pasa con el resto de mis atenciones en mi Hospital de base?</div>
                <p>Usted mantendrá todo el resto de sus atenciones en su Hospital de base. Fonasa solamente nos entrega las facultades para atenderla por el problema de salud que Fonasa derivó</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🚀 ¿Cuándo iniciaría el proceso?</div>
                <p>El proceso comienza inmediatamente después de la creación de la ficha [Preguntas que se le harán a continuación]. Durante la misma semana lo contactarán desde el equipo de agendamiento para agendar sus exámenes y consulta de evaluación, por lo que debe estar muy atento al teléfono</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">📅 ¿Cuándo tengo mi consulta?</div>
                <p>Durante la misma semana lo contactarán desde el equipo de agendamiento para confirmar sus exámenes y consulta de evaluación, por lo que debe estar muy atento al teléfono</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">⚕️ ¿Cuándo tengo mi cirugía?</div>
                <p>Para poder llegar a la cirugía se debe seguir todo el proceso, el cual contempla: exámenes de laboratorio, imágenes y consultas médicas, en los cuales se corroborará el diagnóstico. Posteriormente el equipo médico definirá la fecha de su cirugía, la cual debe tener lugar antes de un mes aproximadamente desde la derivación</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🧪 Yo ya tengo mis exámenes, ¿debo tomarme mis exámenes igual?</div>
                <p>Si cuenta con exámenes que fueron tomados en menos de 3 meses hacia el pasado, puede traerlos para complementar información en consulta, pero de todas formas tomaremos nuevamente todos los exámenes</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">📋 Si ya tengo todos mis pases en mi Hospital de base, ¿puedo operarme al tiro?</div>
                <p>No, pese a que usted ya cuenta con pases de su Hospital de base, nuestros médicos deben corroborar su diagnóstico para poder operarse con nosotros. De todas formas, debe traer toda la documentación que le hayan entregado en su Hospital de base (exámenes, pases, etc)</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">⏱️ ¿Cuánto demora el proceso?</div>
                <p>El proceso depende de cada paciente y su condición de salud. En caso de que usted sea un paciente sano y se confirme su diagnóstico, entonces programaremos su cirugía cuanto antes. En caso de que su problema de salud sea más complejo, entonces los tiempos pueden aumentar.</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">📅 ¿Las consultas y exámenes son el mismo día?</div>
                <p>No siempre es posible agendar todas las atenciones para el mismo día debido a que depende de la disponibilidad de horas de imagenología y de consultas. En caso de que tenga alguna limitación de horarios, puedo dejar una nota con su disponibilidad</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">📍 ¿Dónde están ubicados?</div>
                <p>Nuestro centro médico está ubicado en Vicuña Mackenna 210, metro parque Bustamante.</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🏢 ¿Me puedo atender en una de las sedes?</div>
                <p>La licitación solo contempla atenciones en sede central ubicada en Vicuña Mackenna 210.</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🏃‍♂️ ¿Puedo hacer la kinesiología en otro lado?</div>
                <p>La licitación solo contempla atenciones ambulatorias en sede central ubicada en Vicuña Mackenna 210.</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🔍 ¿Por qué tienen que confirmar mi diagnóstico?</div>
                <p>La confirmación de diagnóstico es esencial para entregar un tratamiento acorde a cada paciente y tener certeza de la patología por la que fue derivado y explicar a paciente el procedimiento y plan de acción.</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">📝 ¿Por qué necesitan mi información?</div>
                <p>Fonasa no nos entrega toda la información que necesitamos para crear su ficha y sin esta no podemos atenderlo, por lo que necesitamos que nos la entregue. Esta información solo será utilizada para crear la ficha y tener la mayor cantidad de opciones para contactarlo</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🏠 ¿Para qué necesitan mi dirección?</div>
                <p>Su dirección es parte de la información solicitada al momento de la creación de su ficha clínica</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🔒 ¿Dónde puedo revisar que esto no es una estafa?</div>
                <p>Puede revisar nuestra página Web (hospitaldeltrabajador.cl), revisar en YouTube un reportaje realizado cuando iniciamos este proceso el año pasado con nuestra primera paciente e incluso preguntar a Fonasa o su hospital de base por la derivación.</p>
            </div>
            
            <div class="faq">
                <div class="faq-titulo">🩺 ¿Qué pasa si tengo muchos problemas de salud?</div>
                <p>Usted será evaluado por uno de nuestros médicos para determinar si estos problemas de salud serán un problema para realizar la cirugía</p>
            </div>
        </div>
        
        <div class="footer">
            <p>Documento generado automáticamente - ACHS ${new Date().toLocaleDateString()}</p>
        </div>
    </body>
    </html>
            `;
            
            ventanaImpresion.document.write(contenidoImpresion);
            ventanaImpresion.document.close();
            
            // Esperar a que se cargue y luego imprimir
            ventanaImpresion.onload = function() {
                setTimeout(() => {
                    ventanaImpresion.print();
                }, 500);
            };
            
            mostrarMensajeTemp('🖨️ Abriendo ventana de impresión para Script LE...', '#3498db');
            console.log('✅ Ventana de impresión abierta para Script LE');
        }
    
        // ===== FUNCIONES PARA SCRIPT CIRUGÍA =====
        
        function abrirModalScriptCirugia() {
            console.log('🏥 Abriendo modal Script Cirugía...');
            
            const modal = document.getElementById('modalScriptCirugia');
            if (modal) {
                modal.style.display = 'flex';
                
                // Animación de entrada
                setTimeout(() => {
                    modal.querySelector('div').style.transform = 'scale(1)';
                    modal.querySelector('div').style.opacity = '1';
                }, 10);
                
                mostrarMensajeTemp('📋 Script Cirugía abierto correctamente', '#28a745');
                console.log('✅ Modal Script Cirugía abierto exitosamente');
            } else {
                console.error('❌ Error: No se encontró el modal Script Cirugía');
                mostrarMensajeTemp('❌ Error al abrir Script Cirugía', '#dc3545');
            }
        }
        
        function cerrarModalScriptCirugia() {
            console.log('🔒 Cerrando modal Script Cirugía...');
            
            const modal = document.getElementById('modalScriptCirugia');
            if (modal) {
                // Animación de salida
                modal.querySelector('div').style.transform = 'scale(0.9)';
                modal.querySelector('div').style.opacity = '0';
                
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                
                console.log('✅ Modal Script Cirugía cerrado exitosamente');
            }
        }
        
        function copiarScriptCirugia() {
            console.log('📋 Copiando Script Cirugía al portapapeles...');
            
            // Contenido del script de cirugía para copiar
            const contenidoScript = `
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    🏥 SCRIPT CIRUGÍA - PROTOCOLO SEGUIMIENTO POST-PRESUPUESTO
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    👤 EJECUTIVO A: SALUDO INICIAL
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    Buenos días/Buenas tardes, mi nombre es <nombre y apellido agente> y lo llamo del Hospital del 
    trabajador Achs Salud ¿hablo con <nombre y apellido paciente>?
    
    📋 Paciente: Sí
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    📞 EJECUTIVO B: INFORMACIÓN PRINCIPAL
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    <nombre paciente> Le informo que, para efectos de auditoría y seguridad, esta llamada podría ser 
    grabada. El motivo de mi llamada es porque, según nuestros registros usted presupuestó una cirugía 
    de <Nombre cirugía> el día <Fecha de presupuesto>, pero finalmente no se realizó su cirugía con 
    nosotros. Desde el Hospital del Trabajador nos gustaría entender cual fue el motivo por el cual no 
    se operó con nosotros ¿tendrá 2 minutos para hacerle unas preguntas?
    
    📋 Respuestas del Paciente:
    • No → Proceder con despedida
    • Sí → Continuar con el Script
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    ❓ EJECUTIVO C: PRIMERA PREGUNTA
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    1. ¿La cirugía que presupuestó se la realizó finalmente en otra clínica/hospital?
    
    📋 Respuestas:
    • Sí → Proceder en Ejecutivo D
    • No → Proceder en Ejecutivo E
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    🏥 EJECUTIVO D: SI SE OPERÓ EN OTRO LUGAR
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    2. ¿En que clínica/hospital se realizó la cirugía?
    (Respuesta abierta)
    
    3. ¿La cirugía se la realizó con un médico distinto al que lo atendió en el Hospital del Trabajador?
    • Sí
    • No
    
    4. ¿Nos podría comentar por qué eligió otro prestador?
    • Decidí operarme en Hospital Público
    • Mi Isapre tenía mejor cobertura con otro prestador
    • Precios más económicos
    • No me gustó el médico que me atendió en el Hospital del Trabajador
    • Ubicación más conveniente
    • Tuve que esperar menos tiempo para conseguir fecha de cirugía
    • Tenían disponible Bono PAD
    
    ➡️ Seguir en Despedida
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    ❌ EJECUTIVO E: SI NO SE OPERÓ
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    2. ¿Por qué motivo decidió no avanzar con su cirugía?
    • Motivos económicos
    • Decidí posponerla porque no era urgente
    • Estoy haciendo kinesiología para poder agendar mi cirugía
    • Sí me voy a operar
    
    ➡️ Seguir en Despedida
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    
    👋 DESPEDIDA
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    
    Ejecutivo: <nombre paciente>, ¿tienes alguna duda o algo más en lo que te pueda ayudar?
    
    Paciente: No, gracias.
    
    Ejecutivo: <nombre paciente> Muchas gracias por atenderme. En caso de cualquier duda o consulta 
    nos puedes llamar al 22 515 7777. Que tengas Un buen día/Una buena tarde
    
    ═══════════════════════════════════════════════════════════════════════════════════════════════════════
    `;
            
            // Copiar al portapapeles
            navigator.clipboard.writeText(contenidoScript).then(() => {
                mostrarMensajeTemp('📋 Script Cirugía copiado al portapapeles exitosamente', '#28a745');
                console.log('✅ Script Cirugía copiado al portapapeles');
            }).catch(err => {
                console.error('❌ Error al copiar Script Cirugía:', err);
                mostrarMensajeTemp('❌ Error al copiar Script Cirugía', '#dc3545');
            });
        }
        
        function imprimirScriptCirugia() {
            // Crear ventana de impresión con el script de cirugía formateado
            const ventanaImpresion = window.open('', '_blank', 'width=800,height=600');
            
            const contenidoImpresion = `
    <!DOCTYPE html>
    <html>
    <head>
        <title>Script Cirugía - Protocolo Seguimiento Post-Presupuesto</title>
        <style>
            body { 
                font-family: Arial, sans-serif; 
                line-height: 1.6; 
                margin: 40px; 
                color: #2c3e50; 
                background: #f8f9fa;
            }
            .header { 
                text-align: center; 
                color: #e74c3c; 
                border-bottom: 3px solid #e74c3c; 
                padding-bottom: 20px; 
                margin-bottom: 30px;
            }
            .seccion { 
                background: white; 
                margin: 20px 0; 
                padding: 20px; 
                border-radius: 10px; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                border-left: 5px solid #e74c3c;
            }
            .titulo-seccion { 
                color: #e74c3c; 
                font-weight: bold; 
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .contenido { 
                background: #f8f9fa; 
                padding: 15px; 
                border-radius: 8px; 
                margin: 10px 0;
            }
            .opciones { 
                background: #fff3cd; 
                padding: 10px; 
                border-radius: 6px; 
                border-left: 3px solid #ffc107;
                margin: 10px 0;
            }
            .footer { 
                text-align: center; 
                margin-top: 40px; 
                color: #666; 
                font-size: 0.9em;
            }
            @page { margin: 2cm; }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>🏥 SCRIPT CIRUGÍA</h1>
            <h2>Protocolo Seguimiento Post-Presupuesto</h2>
            <p>Hospital del Trabajador ACHS Salud</p>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">👤 EJECUTIVO A: SALUDO INICIAL</div>
            <div class="contenido">
                <strong>Buenos días/Buenas tardes</strong>, mi nombre es <strong>&lt;nombre y apellido agente&gt;</strong> y lo llamo del Hospital del trabajador Achs Salud ¿hablo con <strong>&lt;nombre y apellido paciente&gt;</strong>?
            </div>
            <div class="opciones">
                <strong>📋 Paciente responde:</strong> Sí
            </div>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">📞 EJECUTIVO B: INFORMACIÓN PRINCIPAL</div>
            <div class="contenido">
                <strong>&lt;nombre paciente&gt;</strong> Le informo que, para efectos de auditoría y seguridad, esta llamada podría ser grabada. El motivo de mi llamada es porque, según nuestros registros usted presupuestó una cirugía de <strong>&lt;Nombre cirugía&gt;</strong> el día <strong>&lt;Fecha de presupuesto&gt;</strong>, pero finalmente no se realizó su cirugía con nosotros. Desde el Hospital del Trabajador nos gustaría entender cual fue el motivo por el cual no se operó con nosotros ¿tendrá 2 minutos para hacerle unas preguntas?
            </div>
            <div class="opciones">
                <strong>📋 Respuestas del Paciente:</strong><br>
                • <strong>No</strong> → Proceder con despedida<br>
                • <strong>Sí</strong> → Continuar con el Script
            </div>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">❓ EJECUTIVO C: PRIMERA PREGUNTA</div>
            <div class="contenido">
                <strong>1.</strong> ¿La cirugía que presupuestó se la realizó finalmente en otra clínica/hospital?
            </div>
            <div class="opciones">
                <strong>📋 Respuestas:</strong><br>
                • <strong>Sí</strong> → Proceder en Ejecutivo D<br>
                • <strong>No</strong> → Proceder en Ejecutivo E
            </div>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">🏥 EJECUTIVO D: SI SE OPERÓ EN OTRO LUGAR</div>
            <div class="contenido">
                <strong>2.</strong> ¿En que clínica/hospital se realizó la cirugía?<br>
                <em>(Respuesta abierta)</em>
            </div>
            <div class="contenido">
                <strong>3.</strong> ¿La cirugía se la realizó con un médico distinto al que lo atendió en el Hospital del Trabajador?<br>
                • Sí<br>
                • No
            </div>
            <div class="contenido">
                <strong>4.</strong> ¿Nos podría comentar por qué eligió otro prestador?<br>
                • Decidí operarme en Hospital Público<br>
                • Mi Isapre tenía mejor cobertura con otro prestador<br>
                • Precios más económicos<br>
                • No me gustó el médico que me atendió en el Hospital del Trabajador<br>
                • Ubicación más conveniente<br>
                • Tuve que esperar menos tiempo para conseguir fecha de cirugía<br>
                • Tenían disponible Bono PAD
            </div>
            <div class="opciones">
                <strong>➡️ Seguir en Despedida</strong>
            </div>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">❌ EJECUTIVO E: SI NO SE OPERÓ</div>
            <div class="contenido">
                <strong>2.</strong> ¿Por qué motivo decidió no avanzar con su cirugía?<br>
                • Motivos económicos<br>
                • Decidí posponerla porque no era urgente<br>
                • Estoy haciendo kinesiología para poder agendar mi cirugía<br>
                • Sí me voy a operar
            </div>
            <div class="opciones">
                <strong>➡️ Seguir en Despedida</strong>
            </div>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">👋 DESPEDIDA</div>
            <div class="contenido">
                <strong>Ejecutivo:</strong> <strong>&lt;nombre paciente&gt;</strong>, ¿tienes alguna duda o algo más en lo que te pueda ayudar?
            </div>
            <div class="opciones">
                <strong>Paciente:</strong> No, gracias.
            </div>
            <div class="contenido">
                <strong>Ejecutivo:</strong> <strong>&lt;nombre paciente&gt;</strong> Muchas gracias por atenderme. En caso de cualquier duda o consulta nos puedes llamar al <strong>22 515 7777</strong>. Que tengas <strong>Un buen día/Una buena tarde</strong>
            </div>
        </div>
        
        <div class="footer">
            <p>📄 Documento generado desde Sistema ACHS - Script Cirugía</p>
            <p>🕒 Fecha de impresión: ${new Date().toLocaleString('es-CL')}</p>
        </div>
    </body>
    </html>
            `;
            
            ventanaImpresion.document.write(contenidoImpresion);
            ventanaImpresion.document.close();
            
            // Esperar a que se cargue y luego imprimir
            ventanaImpresion.onload = function() {
                setTimeout(() => {
                    ventanaImpresion.print();
                }, 500);
            };
            
            mostrarMensajeTemp('🖨️ Abriendo ventana de impresión para Script Cirugía...', '#3498db');
            console.log('✅ Ventana de impresión abierta para Script Cirugía');
        }

    // Event listener para configuración
    document.addEventListener('DOMContentLoaded', function() {
        // Cargar último número de WhatsApp cuando se abra el modal de comunicación
        setTimeout(() => {
            cargarUltimoNumeroWhatsApp();
        }, 1000);
        
        // Configurar event listener para la Base de Conocimientos
        const btnBaseConocimientos = document.getElementById('btnBaseConocimientos');
        if (btnBaseConocimientos) {
            btnBaseConocimientos.addEventListener('click', abrirModalBaseConocimientos);
            console.log('✅ Event listener para Base de Conocimientos configurado');
        }
        
        // Inicializar la base de conocimientos
        inicializarBaseConocimientos();
    });

    // Cargar último número de WhatsApp usado
    function cargarUltimoNumeroWhatsApp() {
        const ultimoNumero = localStorage.getItem('ultimoNumeroWhatsApp');
        if (ultimoNumero) {
            const inputNumero = document.getElementById('numeroWhatsApp');
            if (inputNumero) {
                inputNumero.value = ultimoNumero;
            }
        }
    }

    // Función para abrir modal de comunicación
    function abrirModalComunicacion() {
        const modal = document.getElementById('modalComunicacion');
        if (modal) {
            modal.style.display = 'flex';
            console.log('✅ Modal de comunicación abierto');
        }
    }

    // Función para cerrar modal de comunicación
    function cerrarModalComunicacion() {
        const modal = document.getElementById('modalComunicacion');
        if (modal) {
            modal.style.display = 'none';
            console.log('✅ Modal de comunicación cerrado');
        }
    }

    // Función para enviar por WhatsApp
    function enviarPorWhatsApp(tipo = 'corto') {
        const contenido = tipo === 'corto' ? 
            document.getElementById('resumenCorto').value : 
            document.getElementById('resumenCompleto').value;
        
        if (!contenido.trim()) {
            mostrarMensajeTemp('⚠️ No hay contenido para enviar', '#ffc107');
            return;
        }

        // Codificar el mensaje para URL
        const mensajeCodificado = encodeURIComponent(contenido);
        
        // Abrir WhatsApp Web con el mensaje preformateado
        const urlWhatsApp = `https://web.whatsapp.com/send?text=${mensajeCodificado}`;
        
        window.open(urlWhatsApp, '_blank');
        
        mostrarMensajeTemp('📱 WhatsApp abierto con el reporte', '#25D366');
        console.log('✅ Reporte enviado a WhatsApp');
        
        // Opcional: cerrar modal después de enviar
        setTimeout(() => {
            cerrarModalComunicacion();
        }, 2000);
    }

    // Función para enviar por WhatsApp a número específico
    function enviarWhatsAppANumero() {
        const numero = document.getElementById('numeroWhatsApp').value.trim();
        const contenido = document.getElementById('resumenCompleto').value;
        
        if (!numero) {
            mostrarMensajeTemp('⚠️ Ingrese un número de WhatsApp', '#ffc107');
            document.getElementById('numeroWhatsApp').focus();
            return;
        }
        
        if (!contenido.trim()) {
            mostrarMensajeTemp('⚠️ No hay contenido para enviar', '#ffc107');
            return;
        }

        // Limpiar el número (quitar espacios, guiones, etc.)
        const numeroLimpio = numero.replace(/\D/g, '');
        
        if (numeroLimpio.length < 8) {
            mostrarMensajeTemp('⚠️ Número de WhatsApp inválido', '#dc3545');
            return;
        }

        // Agregar código de país si no lo tiene
        const numeroCompleto = numeroLimpio.startsWith('56') ? numeroLimpio : '56' + numeroLimpio;
        
        const mensajeCodificado = encodeURIComponent(contenido);
        const urlWhatsApp = `https://web.whatsapp.com/send?phone=${numeroCompleto}&text=${mensajeCodificado}`;
        
        window.open(urlWhatsApp, '_blank');
        
        mostrarMensajeTemp(`📱 WhatsApp abierto para enviar a +${numeroCompleto}`, '#25D366');
        console.log(`✅ Reporte enviado a WhatsApp: +${numeroCompleto}`);
        
        // Guardar número para uso futuro
        localStorage.setItem('ultimoNumeroWhatsApp', numero);
        
        setTimeout(() => {
            cerrarModalComunicacion();
        }, 2000);
    }

    // Función para enviar por Microsoft Teams
    function enviarPorTeams() {
        const contenido = document.getElementById('resumenCompleto').value;
        
        if (!contenido.trim()) {
            mostrarMensajeTemp('⚠️ No hay contenido para enviar', '#ffc107');
            return;
        }

        // Crear enlace de Teams con mensaje preformateado
        const mensajeCodificado = encodeURIComponent(contenido);
        
        // Intentar abrir Teams desktop app primero, luego web
        const urlTeamsDesktop = `msteams:/l/chat/0/0?message=${mensajeCodificado}`;
        const urlTeamsWeb = `https://teams.microsoft.com/l/chat/0/0?message=${mensajeCodificado}`;
        
        // Intentar abrir app de escritorio
        const ventanaTeams = window.open(urlTeamsDesktop, '_blank');
        
        // Si no se abre en 2 segundos, abrir versión web
        setTimeout(() => {
            if (!ventanaTeams || ventanaTeams.closed) {
                window.open(urlTeamsWeb, '_blank');
                mostrarMensajeTemp('💼 Teams Web abierto con el reporte', '#6264A7');
            } else {
                mostrarMensajeTemp('💼 Teams App abierto con el reporte', '#6264A7');
            }
        }, 2000);
        
        console.log('✅ Reporte enviado a Microsoft Teams');
        
        setTimeout(() => {
            cerrarModalComunicacion();
        }, 2000);
    }

    // Función para enviar por email
    function enviarPorEmail() {
        const contenido = document.getElementById('resumenCompleto').value;
        const asunto = `Reporte de Conversación ACHS - ${new Date().toLocaleDateString()}`;
        
        if (!contenido.trim()) {
            mostrarMensajeTemp('⚠️ No hay contenido para enviar', '#ffc107');
            return;
        }

        // Crear enlace mailto
        const asuntoCodificado = encodeURIComponent(asunto);
        const cuerpoConFormato = contenido.replace(/\n/g, '%0D%0A');
        const cuerpoCodificado = encodeURIComponent(cuerpoConFormato);
        
        const urlEmail = `mailto:?subject=${asuntoCodificado}&body=${cuerpoCodificado}`;
        
        window.location.href = urlEmail;
        
        mostrarMensajeTemp('📧 Cliente de email abierto con el reporte', '#0078D4');
        console.log('✅ Reporte enviado por email');
        
        setTimeout(() => {
            cerrarModalComunicacion();
        }, 2000);
    }

    // Función para copiar al portapapeles
    function copiarReporte(tipo = 'completo') {
        const contenido = tipo === 'corto' ? 
            document.getElementById('resumenCorto').value : 
            document.getElementById('resumenCompleto').value;
        
        if (!contenido.trim()) {
            mostrarMensajeTemp('⚠️ No hay contenido para copiar', '#ffc107');
            return;
        }

        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(contenido).then(() => {
                mostrarMensajeTemp('📋 Reporte copiado al portapapeles', '#28a745');
            }).catch(() => {
                copiarAlPortapapelesFallback(contenido);
            });
        } else {
            copiarAlPortapapelesFallback(contenido);
        }
    }

    // Función de respaldo para copiar al portapapeles
    function copiarAlPortapapelesFallback(texto) {
        const textArea = document.createElement('textarea');
        textArea.value = texto;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        textArea.style.top = '-999999px';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
            document.execCommand('copy');
            mostrarMensajeTemp('📋 Reporte copiado al portapapeles', '#28a745');
        } catch (err) {
            prompt('Copia este texto manualmente:', texto);
        } finally {
            document.body.removeChild(textArea);
        }
    }

    // ============ FUNCIONES DE BASE DE CONOCIMIENTOS ============

    // Variables globales para la base de conocimientos
    let articulosWiki = [];
    let articuloActual = null;
    let modoEdicion = false;

    // Función para inicializar la base de conocimientos
    function inicializarBaseConocimientos() {
        console.log('📚 Inicializando Base de Conocimientos');
        
        // Cargar artículos desde localStorage
        cargarArticulosWiki();
        
        // Mostrar lista de artículos
        mostrarListaArticulos();
        
        // Actualizar estadísticas
        actualizarEstadisticasWiki();
        
        console.log('✅ Base de Conocimientos inicializada');
    }

    // Función para inicializar la base de conocimientos
    function inicializarBaseConocimientos() {
        cargarArticulosWiki();
        configurarEventosWiki();
        console.log('✅ Base de Conocimientos inicializada');
    }

    // Cargar artículos desde localStorage
    function cargarArticulosWiki() {
        const articulosGuardados = localStorage.getItem('articulosWiki');
        if (articulosGuardados) {
            articulosWiki = JSON.parse(articulosGuardados);
            console.log(`📚 Cargados ${articulosWiki.length} artículos de la wiki`);
        } else {
            // Crear algunos artículos de ejemplo
            articulosWiki = [
                {
                    id: Date.now() + 1,
                    titulo: 'Proceso de Atención SNL',
                    categoria: 'SNL',
                    tipoDocumento: 'MANUAL',
                    contenido: `# Proceso de Atención SNL (Salud No Laboral)

## Pasos a seguir:

1. **Verificar datos del paciente**
   - RUT válido y activo
   - Nombre completo
   - Teléfono de contacto

2. **Consultar disponibilidad**
   - Revisar agenda médica
   - Verificar especialidades disponibles
   - Confirmar horarios

3. **Coordinar cita**
   - Agendar en sistema
   - Enviar confirmación
   - Registrar en historial

## Contactos importantes:
- **SNL:** 225157000
- **WhatsApp SNL:** 988514462`,
                    autor: 'Sistema',
                    fecha: new Date().toISOString(),
                    vistas: 15,
                    prioridad: 'importante',
                    tags: ['SNL', 'procedimiento', 'citas'],
                    comentarios: []
                },
                {
                    id: Date.now() + 2,
                    titulo: 'FAQ - Preguntas Frecuentes EP',
                    categoria: 'FAQ',
                    tipoDocumento: 'WORD',
                    contenido: `# Preguntas Frecuentes - Enfermedades Profesionales

## ¿Qué es una EP?
Una Enfermedad Profesional es aquella causada de manera directa por el ejercicio de la profesión o el trabajo que realice una persona.

## ¿Cómo se reporta una EP?
1. Llenar formulario EP-SM
2. Adjuntar documentación médica
3. Enviar a través del sistema

## Tiempos de respuesta:
- **Evaluación inicial:** 5 días hábiles
- **Resolución:** 15 días hábiles
- **Notificación:** 24 horas

## Contacto especializado:
- **Formulario EP:** [Enlace al formulario]
- **Consultas:** contacto.ep@achs.cl`,
                    autor: 'Sistema',
                    fecha: new Date(Date.now() - 86400000).toISOString(),
                    vistas: 32,
                    prioridad: 'normal',
                    tags: ['EP', 'FAQ', 'formulario'],
                    comentarios: []
                },
                {
                    id: Date.now() + 3,
                    titulo: 'Manual de Procedimientos PDF',
                    categoria: 'procedimientos',
                    tipoDocumento: 'PDF',
                    contenido: `# Manual de Procedimientos Administrativos

Este documento fue importado desde un archivo PDF oficial de ACHS.

## Contenido del Manual:

### 1. Procedimientos Generales
- Atención al cliente
- Gestión de documentos
- Reportes administrativos

### 2. Procesos Específicos
- Validación de datos
- Seguimiento de casos
- Archivo y almacenamiento

### 3. Contactos de Soporte
- Mesa de ayuda: ext. 1234
- Supervisor: ext. 5678

*Documento originalmente en formato PDF, convertido a la Base de Conocimientos para facilitar el acceso y búsqueda.*`,
                    autor: 'Importado desde PDF',
                    fecha: new Date(Date.now() - 172800000).toISOString(),
                    vistas: 8,
                    prioridad: 'normal',
                    tags: ['PDF', 'manual', 'procedimientos'],
                    comentarios: []
                }
            ];
            guardarArticulosWiki();
        }
    }

    // Guardar artículos en localStorage
    function guardarArticulosWiki() {
        localStorage.setItem('articulosWiki', JSON.stringify(articulosWiki));
        actualizarEstadisticasWiki();
    }

    // Configurar eventos de la wiki
    function configurarEventosWiki() {
        // Búsqueda en tiempo real
        const inputBusqueda = document.getElementById('buscarArticulo');
        if (inputBusqueda) {
            inputBusqueda.addEventListener('input', buscarArticulosWiki);
        }

        // Filtros
        const selectCategoria = document.getElementById('filtroCategoria');
        const selectOrden = document.getElementById('ordenarPor');
        
        if (selectCategoria) {
            selectCategoria.addEventListener('change', filtrarArticulosWiki);
        }
        
        if (selectOrden) {
            selectOrden.addEventListener('change', filtrarArticulosWiki);
        }
    }

    // Abrir modal de base de conocimientos
    function abrirModalBaseConocimientos() {
        const modal = document.getElementById('modalBaseConocimientos');
        if (modal) {
            modal.style.display = 'flex';
            mostrarListaArticulos();
            mostrarVistaPorDefecto();
            actualizarEstadisticasWiki();
            console.log('📚 Modal de Base de Conocimientos abierto');
        }
    }

    // Cerrar modal
    function cerrarModalBaseConocimientos() {
        const modal = document.getElementById('modalBaseConocimientos');
        if (modal) {
            modal.style.display = 'none';
            console.log('📚 Modal de Base de Conocimientos cerrado');
        }
    }

    // Mostrar lista de artículos
    function mostrarListaArticulos(articulos = null) {
        const listaContainer = document.getElementById('listaArticulos');
        if (!listaContainer) return;

        const articulosMostrar = articulos || articulosWiki;

        if (articulosMostrar.length === 0) {
            listaContainer.innerHTML = `
                <div style="text-align:center; color:#6c757d; padding:20px; font-style:italic;">
                    📝 No hay artículos que coincidan<br>
                    <small>Intenta cambiar los filtros de búsqueda</small>
                </div>
            `;
            return;
        }

        const articulosHTML = articulosMostrar.map(articulo => {
            const fechaFormateada = new Date(articulo.fecha).toLocaleDateString();
            const iconoCategoria = obtenerIconoCategoria(articulo.categoria);
            const iconoPrioridad = articulo.prioridad === 'urgente' ? '🔥' : 
                                 articulo.prioridad === 'importante' ? '⭐' : '📄';
            const tipoIcono = articulo.tipoDocumento === 'WORD' ? '📝' :
                             articulo.tipoDocumento === 'PDF' ? '📋' :
                             articulo.tipoDocumento === 'JSON' ? '📄' : '✏️';
            
            return `
                <div onclick="verArticulo('${articulo.id}')" style="background:white; border:1px solid #dee2e6; border-radius:8px; padding:12px; margin-bottom:10px; cursor:pointer; transition:all 0.3s ease;" 
                     onmouseover="this.style.borderColor='#17a2b8'; this.style.boxShadow='0 4px 8px rgba(23,162,184,0.2)'" 
                     onmouseout="this.style.borderColor='#dee2e6'; this.style.boxShadow='none'">
                    
                    <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:8px;">
                        <h6 style="margin:0; color:#17a2b8; font-size:0.9em; font-weight:bold; line-height:1.3;">
                            ${iconoPrioridad} ${articulo.titulo}
                        </h6>
                    </div>
                    
                    <div style="display:flex; justify-content:space-between; align-items:center; font-size:0.75em; color:#6c757d;">
                        <span style="background:#e7f3ff; color:#0056b3; padding:2px 6px; border-radius:10px;">
                            ${iconoCategoria} ${articulo.categoria}
                        </span>
                        <span style="background:#f8f9fa; color:#495057; padding:2px 6px; border-radius:10px;">
                            ${tipoIcono} ${articulo.tipoDocumento || 'MANUAL'}
                        </span>
                        <span>👀 ${articulo.vistas}</span>
                    </div>
                    
                    <div style="font-size:0.7em; color:#6c757d; margin-top:5px;">
                        📅 ${fechaFormateada}
                    </div>
                </div>
            `;
        }).join('');

        listaContainer.innerHTML = articulosHTML;
    }

    // Obtener icono por categoría
    function obtenerIconoCategoria(categoria) {
        const iconos = {
            'SNL': '🏥',
            'EP': '⚕️',
            'Procedimientos': '📋',
            'FAQ': '❓',
            'Contactos': '📞',
            'Sistemas': '💻',
            'Normativas': '📜'
        };
        return iconos[categoria] || '📄';
    }

    // Formatear contenido con markdown simple
    function formatearContenido(contenido) {
        let html = contenido;
        
        // Headers
        html = html.replace(/^### (.*$)/gim, '<h5 style="color:#17a2b8; margin-top:20px; margin-bottom:10px;">$1</h5>');
        html = html.replace(/^## (.*$)/gim, '<h4 style="color:#17a2b8; margin-top:25px; margin-bottom:12px;">$1</h4>');
        html = html.replace(/^# (.*$)/gim, '<h3 style="color:#17a2b8; margin-top:30px; margin-bottom:15px;">$1</h3>');
        
        // Bold e italic
        html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // Enlaces
        html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:#17a2b8; text-decoration:none;">$1 🔗</a>');
        
        // Listas
        html = html.replace(/^\d+\.\s(.*)$/gim, '<li style="margin-bottom:5px;">$1</li>');
        html = html.replace(/^-\s(.*)$/gim, '<li style="margin-bottom:5px; list-style-type:disc;">$1</li>');
        
        // Envolver listas en ul/ol
        html = html.replace(/(<li[^>]*>.*<\/li>)/gs, (match) => {
            if (match.includes('list-style-type:disc')) {
                return `<ul style="margin:10px 0; padding-left:20px;">${match}</ul>`;
            } else {
                return `<ol style="margin:10px 0; padding-left:20px;">${match}</ol>`;
            }
        });
        
        // Párrafos
        html = html.split('\n\n').map(p => p.trim() ? `<p style="margin-bottom:15px; line-height:1.6;">${p}</p>` : '').join('');
        
        return html;
    }

    // Crear nuevo artículo
    function crearNuevoArticulo() {
        articuloActual = null;
        modoEdicion = true;
        
        // Ocultar otros paneles
        document.getElementById('vistaPorDefecto').style.display = 'none';
        document.getElementById('visorArticulo').style.display = 'none';
        
        // Mostrar editor
        const editor = document.getElementById('editorArticulo');
        editor.style.display = 'flex';
        
        // Limpiar campos
        document.getElementById('tituloArticulo').value = '';
        document.getElementById('categoriaArticulo').value = '';
        document.getElementById('prioridadArticulo').value = 'normal';
        document.getElementById('tagsArticulo').value = '';
        document.getElementById('contenidoArticulo').value = '';
        
        // Ocultar botón eliminar
        document.getElementById('btnEliminarArticulo').style.display = 'none';
        
        console.log('📝 Creando nuevo artículo');
    }

    // Editar artículo actual
    function editarArticuloActual() {
        if (!articuloActual) return;
        
        modoEdicion = true;
        
        // Ocultar visor
        document.getElementById('visorArticulo').style.display = 'none';
        
        // Mostrar editor
        const editor = document.getElementById('editorArticulo');
        editor.style.display = 'flex';
        
        // Llenar campos
        document.getElementById('tituloArticulo').value = articuloActual.titulo;
        document.getElementById('categoriaArticulo').value = articuloActual.categoria;
        document.getElementById('prioridadArticulo').value = articuloActual.prioridad || 'normal';
        document.getElementById('tagsArticulo').value = articuloActual.tags ? articuloActual.tags.join(', ') : '';
        document.getElementById('contenidoArticulo').value = articuloActual.contenido;
        
        // Mostrar botón eliminar
        document.getElementById('btnEliminarArticulo').style.display = 'inline-block';
        
        console.log(`✏️ Editando artículo: ${articuloActual.titulo}`);
    }

    // Guardar artículo
    function guardarArticulo() {
        const titulo = document.getElementById('tituloArticulo').value.trim();
        const categoria = document.getElementById('categoriaArticulo').value;
        const prioridad = document.getElementById('prioridadArticulo').value;
        const tags = document.getElementById('tagsArticulo').value.split(',').map(t => t.trim()).filter(t => t);
        const contenido = document.getElementById('contenidoArticulo').value.trim();
        
        // Validaciones
        if (!titulo) {
            mostrarMensajeTemp('⚠️ El título es obligatorio', '#ffc107');
            return;
        }
        
        if (!categoria) {
            mostrarMensajeTemp('⚠️ Selecciona una categoría', '#ffc107');
            return;
        }
        
        if (!contenido) {
            mostrarMensajeTemp('⚠️ El contenido no puede estar vacío', '#ffc107');
            return;
        }
        
        // Crear o actualizar artículo
        if (articuloActual) {
            // Actualizar existente
            articuloActual.titulo = titulo;
            articuloActual.categoria = categoria;
            articuloActual.prioridad = prioridad;
            articuloActual.tags = tags;
            articuloActual.contenido = contenido;
            articuloActual.fechaModificacion = new Date().toISOString();
        } else {
            // Crear nuevo
            const nuevoArticulo = {
                id: Date.now(),
                titulo: titulo,
                categoria: categoria,
                prioridad: prioridad,
                tags: tags,
                contenido: contenido,
                autor: 'Usuario',
                fecha: new Date().toISOString(),
                vistas: 0,
                comentarios: []
            };
            
            articulosWiki.unshift(nuevoArticulo);
            articuloActual = nuevoArticulo;
        }
        
        guardarArticulosWiki();
        mostrarListaArticulos();
        mostrarVisorArticulo(articuloActual);
        mostrarMensajeTemp('✅ Artículo guardado exitosamente', '#28a745');
        
        console.log(`💾 Artículo guardado: ${titulo}`);
    }

    // Cancelar edición
    function cancelarEdicion() {
        if (articuloActual) {
            mostrarVisorArticulo(articuloActual);
        } else {
            mostrarVistaPorDefecto();
        }
        modoEdicion = false;
    }

    // Eliminar artículo
    function eliminarArticulo() {
        if (!articuloActual) return;
        
        if (confirm(`¿Estás seguro de que quieres eliminar el artículo "${articuloActual.titulo}"?`)) {
            const index = articulosWiki.findIndex(a => a.id === articuloActual.id);
            if (index !== -1) {
                articulosWiki.splice(index, 1);
                guardarArticulosWiki();
                mostrarListaArticulos();
                mostrarVistaPorDefecto();
                articuloActual = null;
                mostrarMensajeTemp('🗑️ Artículo eliminado', '#dc3545');
                console.log('🗑️ Artículo eliminado');
            }
        }
    }

    // Mostrar vista por defecto
    function mostrarVistaPorDefecto() {
        document.getElementById('visorArticulo').style.display = 'none';
        document.getElementById('editorArticulo').style.display = 'none';
        document.getElementById('vistaPorDefecto').style.display = 'block';
    }

    // Buscar artículos
    function buscarArticulosWiki() {
        const termino = document.getElementById('buscarArticulo').value.toLowerCase();
        const categoria = document.getElementById('filtroCategoria').value;
        
        let articulosFiltrados = articulosWiki.filter(articulo => {
            const coincideTexto = articulo.titulo.toLowerCase().includes(termino) ||
                                articulo.contenido.toLowerCase().includes(termino) ||
                                (articulo.tags && articulo.tags.some(tag => tag.toLowerCase().includes(termino)));
            
            const coincideCategoria = !categoria || articulo.categoria === categoria;
            
            return coincideTexto && coincideCategoria;
        });
        
        // Aplicar orden
        const orden = document.getElementById('ordenarPor').value;
        articulosFiltrados = ordenarArticulos(articulosFiltrados, orden);
        
        mostrarListaArticulos(articulosFiltrados);
    }

    // Filtrar artículos
    function filtrarArticulosWiki() {
        buscarArticulosWiki(); // Reutilizar la función de búsqueda
    }

    // Ordenar artículos
    function ordenarArticulos(articulos, criterio) {
        return articulos.sort((a, b) => {
            switch(criterio) {
                case 'fecha':
                    return new Date(b.fecha) - new Date(a.fecha);
                case 'titulo':
                    return a.titulo.localeCompare(b.titulo);
                case 'vistas':
                    return (b.vistas || 0) - (a.vistas || 0);
                case 'relevancia':
                    // Combinar vistas y prioridad
                    const scoreA = (a.vistas || 0) + (a.prioridad === 'urgente' ? 100 : a.prioridad === 'importante' ? 50 : 0);
                    const scoreB = (b.vistas || 0) + (b.prioridad === 'urgente' ? 100 : b.prioridad === 'importante' ? 50 : 0);
                    return scoreB - scoreA;
                default:
                    return 0;
            }
        });
    }

    // Actualizar estadísticas
    function actualizarEstadisticasWiki() {
        const hoy = new Date().toDateString();
        const semanaAtras = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
        
        const totalArticulos = articulosWiki.length;
        const articulosHoy = articulosWiki.filter(a => new Date(a.fecha).toDateString() === hoy).length;
        const articulosSemana = articulosWiki.filter(a => new Date(a.fecha) >= semanaAtras).length;
        const totalVistas = articulosWiki.reduce((sum, a) => sum + (a.vistas || 0), 0);
        
        // Actualizar elementos
        const elementos = {
            'totalArticulos': totalArticulos,
            'articulosHoy': articulosHoy,
            'totalArticulosPanel': totalArticulos,
            'articulosSemana': articulosSemana,
            'totalVistas': totalVistas
        };
        
        Object.entries(elementos).forEach(([id, valor]) => {
            const elemento = document.getElementById(id);
            if (elemento) {
                elemento.textContent = valor;
            }
        });
        
        // Actualizar artículos recientes y populares
        actualizarPanelesLaterales();
    }

    // Actualizar paneles laterales
    function actualizarPanelesLaterales() {
        // Artículos recientes
        const recientes = [...articulosWiki]
            .sort((a, b) => new Date(b.fecha) - new Date(a.fecha))
            .slice(0, 5);
        
        const recientesContainer = document.getElementById('articulosRecientes');
        if (recientesContainer) {
            if (recientes.length === 0) {
                recientesContainer.innerHTML = '<div style="color:#6c757d; font-style:italic; text-align:center; padding:10px;">No hay artículos recientes</div>';
            } else {
                recientesContainer.innerHTML = recientes.map(articulo => `
                    <div onclick="verArticulo('${articulo.id}')" style="background:white; border:1px solid #dee2e6; border-radius:6px; padding:8px; margin-bottom:8px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#dee2e6'">
                        <div style="font-weight:bold; font-size:0.8em; color:#17a2b8; margin-bottom:4px;">${articulo.titulo}</div>
                        <div style="font-size:0.7em; color:#6c757d;">${new Date(articulo.fecha).toLocaleDateString()}</div>
                    </div>
                `).join('');
            }
        }
        
        // Artículos populares
        const populares = [...articulosWiki]
            .sort((a, b) => (b.vistas || 0) - (a.vistas || 0))
            .slice(0, 5);
        
        const popularesContainer = document.getElementById('articulosPopulares');
        if (popularesContainer) {
            if (populares.length === 0 || populares.every(a => (a.vistas || 0) === 0)) {
                popularesContainer.innerHTML = '<div style="color:#6c757d; font-style:italic; text-align:center; padding:10px;">No hay datos aún</div>';
            } else {
                popularesContainer.innerHTML = populares.map(articulo => `
                    <div onclick="verArticulo('${articulo.id}')" style="background:white; border:1px solid #dee2e6; border-radius:6px; padding:8px; margin-bottom:8px; cursor:pointer; transition:all 0.3s ease;" onmouseover="this.style.borderColor='#17a2b8'" onmouseout="this.style.borderColor='#dee2e6'">
                        <div style="font-weight:bold; font-size:0.8em; color:#17a2b8; margin-bottom:4px;">${articulo.titulo}</div>
                        <div style="font-size:0.7em; color:#6c757d;">👀 ${articulo.vistas || 0} vistas</div>
                    </div>
                `).join('');
            }
        }
    }

    // Buscar en wiki por categoría
    function buscarEnWiki(categoria) {
        document.getElementById('filtroCategoria').value = categoria;
        document.getElementById('buscarArticulo').value = '';
        filtrarArticulosWiki();
    }

    // Mostrar comentarios
    function mostrarComentarios(articulo) {
        const container = document.getElementById('comentariosArticulo');
        if (!container) return;
        
        if (!articulo.comentarios || articulo.comentarios.length === 0) {
            container.innerHTML = '<div style="color:#6c757d; font-style:italic;">No hay comentarios aún</div>';
            return;
        }
        
        container.innerHTML = articulo.comentarios.map(comentario => `
            <div style="background:#f8f9fa; border-left:4px solid #17a2b8; padding:10px; margin-bottom:8px; border-radius:4px;">
                <div style="font-size:0.8em; color:#6c757d; margin-bottom:5px;">
                    ${comentario.autor} - ${new Date(comentario.fecha).toLocaleDateString()}
                </div>
                <div>${comentario.texto}</div>
            </div>
        `).join('');
    }

    // Agregar comentario
    function agregarComentario() {
        if (!articuloActual) return;
        
        const input = document.getElementById('nuevoComentario');
        const texto = input.value.trim();
        
        if (!texto) {
            mostrarMensajeTemp('⚠️ Escribe un comentario', '#ffc107');
            return;
        }
        
        if (!articuloActual.comentarios) {
            articuloActual.comentarios = [];
        }
        
        articuloActual.comentarios.push({
            texto: texto,
            autor: 'Usuario',
            fecha: new Date().toISOString()
        });
        
        guardarArticulosWiki();
        mostrarComentarios(articuloActual);
        input.value = '';
        
        mostrarMensajeTemp('💬 Comentario agregado', '#28a745');
    }

    // Funciones de herramientas adicionales
    function mostrarCategorias() {
        const categorias = [...new Set(articulosWiki.map(a => a.categoria))];
        const mensaje = categorias.length > 0 ? 
            `Categorías disponibles:\n${categorias.map(c => `• ${obtenerIconoCategoria(c)} ${c}`).join('\n')}` :
            'No hay categorías creadas aún';
        alert(mensaje);
    }

    function exportarBaseConocimientos() {
        const datos = {
            articulos: articulosWiki,
            fechaExportacion: new Date().toISOString(),
            version: '1.0'
        };
        
        const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `base-conocimientos-achs-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        mostrarMensajeTemp('📥 Base de conocimientos exportada', '#28a745');
    }

    function importarBaseConocimientos() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const datos = JSON.parse(e.target.result);
                    if (datos.articulos && Array.isArray(datos.articulos)) {
                        if (confirm('¿Quieres reemplazar todos los artículos actuales? (Se recomienda hacer un backup primero)')) {
                            articulosWiki = datos.articulos;
                            guardarArticulosWiki();
                            mostrarListaArticulos();
                            mostrarMensajeTemp('📤 Base de conocimientos importada', '#28a745');
                        }
                    } else {
                        throw new Error('Formato de archivo inválido');
                    }
                } catch (error) {
                    mostrarMensajeTemp('❌ Error al importar: formato inválido', '#dc3545');
                }
            };
            reader.readAsText(file);
        };
        input.click();
    }

    function estadisticasWiki() {
        const stats = {
            total: articulosWiki.length,
            categorias: [...new Set(articulosWiki.map(a => a.categoria))].length,
            vistasTotal: articulosWiki.reduce((sum, a) => sum + (a.vistas || 0), 0),
            comentariosTotal: articulosWiki.reduce((sum, a) => sum + (a.comentarios ? a.comentarios.length : 0), 0),
            articulo_mas_visto: articulosWiki.reduce((max, a) => (a.vistas || 0) > (max.vistas || 0) ? a : max, articulosWiki[0])
        };
        
        const mensaje = `📊 Estadísticas de la Base de Conocimientos:

• Total de artículos: ${stats.total}
• Categorías diferentes: ${stats.categorias}
• Vistas totales: ${stats.vistasTotal}
• Comentarios totales: ${stats.comentariosTotal}
${stats.articulo_mas_visto ? `• Artículo más visto: "${stats.articulo_mas_visto.titulo}" (${stats.articulo_mas_visto.vistas || 0} vistas)` : ''}`;
        
        alert(mensaje);
    }

    // Funciones de formato para el editor
    function formatearTexto(tipo) {
        const textarea = document.getElementById('contenidoArticulo');
        const inicio = textarea.selectionStart;
        const fin = textarea.selectionEnd;
        const textoSeleccionado = textarea.value.substring(inicio, fin);
        
        let textoFormateado = '';
        switch(tipo) {
            case 'bold':
                textoFormateado = `**${textoSeleccionado || 'texto en negrita'}**`;
                break;
            case 'italic':
                textoFormateado = `*${textoSeleccionado || 'texto en cursiva'}*`;
                break;
        }
        
        textarea.value = textarea.value.substring(0, inicio) + textoFormateado + textarea.value.substring(fin);
        textarea.focus();
    }

    function insertarLista() {
        const textarea = document.getElementById('contenidoArticulo');
        const posicion = textarea.selectionStart;
        const textoBefore = textarea.value.substring(0, posicion);
        const textoAfter = textarea.value.substring(posicion);
        
        const lista = '\n- Elemento 1\n- Elemento 2\n- Elemento 3\n';
        textarea.value = textoBefore + lista + textoAfter;
        textarea.focus();
    }

    function insertarEnlace() {
        const textarea = document.getElementById('contenidoArticulo');
        const inicio = textarea.selectionStart;
        const fin = textarea.selectionEnd;
        const textoSeleccionado = textarea.value.substring(inicio, fin);
        
        const enlace = `[${textoSeleccionado || 'texto del enlace'}](URL)`;
        textarea.value = textarea.value.substring(0, inicio) + enlace + textarea.value.substring(fin);
        textarea.focus();
    }

    function insertarTabla() {
        const textarea = document.getElementById('contenidoArticulo');
        const posicion = textarea.selectionStart;
        const textoBefore = textarea.value.substring(0, posicion);
        const textoAfter = textarea.value.substring(posicion);
        
        const tabla = '\n| Columna 1 | Columna 2 | Columna 3 |\n|-----------|-----------|-----------||\n| Dato 1    | Dato 2    | Dato 3    |\n| Dato 4    | Dato 5    | Dato 6    |\n';
        textarea.value = textoBefore + tabla + textoAfter;
        textarea.focus();
    }

    function previsualizarArticulo() {
        const titulo = document.getElementById('tituloArticulo').value.trim();
        const contenido = document.getElementById('contenidoArticulo').value.trim();
        
        if (!titulo || !contenido) {
            mostrarMensajeTemp('⚠️ Completa el título y contenido para previsualizar', '#ffc107');
            return;
        }
        
        // Crear ventana de previsualización
        const ventana = window.open('', '_blank', 'width=800,height=600');
        ventana.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Previsualización: ${titulo}</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                    h1, h2, h3, h4, h5 { color: #17a2b8; }
                    pre { background: #f8f9fa; padding: 10px; border-radius: 4px; }
                </style>
            </head>
            <body>
                <h1>${titulo}</h1>
                <hr>
                ${formatearContenido(contenido)}
            </body>
            </html>
        `);
        ventana.document.close();
    }

    function duplicarArticulo() {
        if (!articuloActual) return;
        
        const copia = {
            ...articuloActual,
            id: Date.now(),
            titulo: `Copia de ${articuloActual.titulo}`,
            fecha: new Date().toISOString(),
            vistas: 0,
            comentarios: []
        };
        
        articulosWiki.unshift(copia);
        guardarArticulosWiki();
        mostrarListaArticulos();
        verArticulo(copia.id);
        
        mostrarMensajeTemp('📋 Artículo duplicado', '#28a745');
    }

    function compartirArticulo() {
        if (!articuloActual) return;
        
        const texto = `📚 Base de Conocimientos ACHS
        
Título: ${articuloActual.titulo}
Categoría: ${articuloActual.categoria}

${articuloActual.contenido}

---
Compartido desde la Base de Conocimientos ACHS`;
        
        if (navigator.share) {
            navigator.share({
                title: articuloActual.titulo,
                text: texto
            });
        } else {
            // Fallback: copiar al portapapeles
            if (navigator.clipboard) {
                navigator.clipboard.writeText(texto).then(() => {
                    mostrarMensajeTemp('📋 Artículo copiado al portapapeles', '#28a745');
                });
            } else {
                prompt('Copia este texto:', texto);
            }
        }
    }

    // ============ FUNCIONES FALTANTES PARA LA BASE DE CONOCIMIENTOS ============
    
    // Función para crear nuevo artículo
    function crearNuevoArticulo() {
        console.log('📝 Creando nuevo artículo');
        
        articuloActual = null;
        modoEdicion = true;
        
        // Ocultar vista por defecto y visor
        const vistaPorDefecto = document.getElementById('vistaArticulo');
        if (vistaPorDefecto) {
            vistaPorDefecto.style.display = 'none';
        }
        
        // Mostrar editor
        const editor = document.getElementById('editorArticulo');
        if (editor) {
            editor.style.display = 'flex';
            editor.style.flexDirection = 'column';
        }
        
        // Mostrar panel de información
        const panelInfo = document.getElementById('panelInfo');
        if (panelInfo) {
            panelInfo.style.display = 'none'; // Ocultar mientras se edita
        }
        
        // Limpiar campos del editor
        const tituloEditor = document.getElementById('tituloEditor');
        const categoriaEditor = document.getElementById('categoriaEditor');
        const tipoDocumentoEditor = document.getElementById('tipoDocumentoEditor');
        const contenidoEditor = document.getElementById('contenidoEditor');
        
        if (tituloEditor) tituloEditor.value = '';
        if (categoriaEditor) categoriaEditor.value = 'general';
        if (tipoDocumentoEditor) tipoDocumentoEditor.value = 'MANUAL';
        if (contenidoEditor) contenidoEditor.value = '';
        
        // Enfocar en el título
        if (tituloEditor) {
            tituloEditor.focus();
        }
        
        mostrarMensajeTemp('✏️ Nuevo artículo iniciado', '#28a745');
        console.log('✅ Editor de nuevo artículo activado');
    }

    // Función para guardar artículo
    function guardarArticulo() {
        console.log('💾 Guardando artículo');
        
        const titulo = document.getElementById('tituloEditor')?.value.trim();
        const categoria = document.getElementById('categoriaEditor')?.value;
        const tipoDocumento = document.getElementById('tipoDocumentoEditor')?.value;
        const contenido = document.getElementById('contenidoEditor')?.value.trim();
        
        // Validaciones
        if (!titulo) {
            alert('⚠️ Por favor ingresa un título para el artículo');
            document.getElementById('tituloEditor')?.focus();
            return;
        }
        
        if (!contenido) {
            alert('⚠️ Por favor ingresa contenido para el artículo');
            document.getElementById('contenidoEditor')?.focus();
            return;
        }
        
        const ahora = new Date();
        
        if (articuloActual) {
            // Actualizar artículo existente
            articuloActual.titulo = titulo;
            articuloActual.categoria = categoria;
            articuloActual.tipoDocumento = tipoDocumento;
            articuloActual.contenido = contenido;
            articuloActual.fechaModificacion = ahora.toISOString();
            articuloActual.autor = 'Usuario ACHS'; // En un sistema real sería el usuario actual
            
            mostrarMensajeTemp('✅ Artículo actualizado', '#28a745');
        } else {
            // Crear nuevo artículo
            const nuevoArticulo = {
                id: Date.now(),
                titulo: titulo,
                categoria: categoria,
                tipoDocumento: tipoDocumento,
                contenido: contenido,
                autor: 'Usuario ACHS',
                fecha: ahora.toISOString(),
                fechaModificacion: ahora.toISOString(),
                vistas: 0,
                comentarios: []
            };
            
            articulosWiki.unshift(nuevoArticulo); // Agregar al inicio
            articuloActual = nuevoArticulo;
            
            mostrarMensajeTemp('✅ Artículo creado exitosamente', '#28a745');
        }
        
        // Guardar en localStorage
        guardarArticulosWiki();
        
        // Actualizar lista de artículos
        mostrarListaArticulos();
        
        // Mostrar el artículo guardado
        cancelarEdicion();
        verArticulo(articuloActual.id);
        
        console.log('✅ Artículo guardado:', titulo);
    }

    // Función para cancelar edición
    function cancelarEdicion() {
        console.log('❌ Cancelando edición');
        
        modoEdicion = false;
        
        // Ocultar editor
        const editor = document.getElementById('editorArticulo');
        if (editor) {
            editor.style.display = 'none';
        }
        
        if (articuloActual) {
            // Si hay un artículo actual, mostrarlo
            verArticulo(articuloActual.id);
        } else {
            // Si no hay artículo, mostrar vista por defecto
            const vistaArticulo = document.getElementById('vistaArticulo');
            if (vistaArticulo) {
                vistaArticulo.style.display = 'flex';
                vistaArticulo.style.flexDirection = 'column';
                vistaArticulo.style.justifyContent = 'center';
                vistaArticulo.style.alignItems = 'center';
            }
        }
        
        mostrarMensajeTemp('↩️ Edición cancelada', '#6c757d');
    }

    // Función para ver un artículo
    function verArticulo(id) {
        console.log('👁️ Viendo artículo ID:', id);
        
        const articulo = articulosWiki.find(a => a.id === id);
        if (!articulo) {
            console.error('❌ Artículo no encontrado:', id);
            return;
        }
        
        articuloActual = articulo;
        
        // Incrementar vistas
        articulo.vistas = (articulo.vistas || 0) + 1;
        guardarArticulosWiki();
        
        // Formatear fecha (definir al inicio para uso global en la función)
        const fechaFormateada = new Date(articulo.fecha).toLocaleDateString('es-ES', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        
        // Ocultar editor y vista por defecto
        const editor = document.getElementById('editorArticulo');
        if (editor) {
            editor.style.display = 'none';
        }
        
        // Mostrar contenido del artículo
        const vistaArticulo = document.getElementById('vistaArticulo');
        if (vistaArticulo) {
            vistaArticulo.style.display = 'block';
            vistaArticulo.style.padding = '30px';
            vistaArticulo.style.overflow = 'auto';
            
            const iconoCategoria = {
                'general': '📋',
                'procedimientos': '⚙️',
                'politicas': '📜',
                'herramientas': '🛠️',
                'faq': '❓'
            };
            
            vistaArticulo.innerHTML = `
                <div style="border-bottom: 2px solid #dee2e6; padding-bottom: 20px; margin-bottom: 30px;">
                    <h1 style="color: #495057; margin: 0 0 15px 0; font-size: 2rem; line-height: 1.2;">
                        ${articulo.titulo}
                    </h1>
                    <div style="display: flex; gap: 20px; align-items: center; color: #6c757d; font-size: 0.9rem;">
                        <span style="background: linear-gradient(145deg, #667eea, #764ba2); color: white; padding: 4px 12px; border-radius: 15px; font-weight: 600;">
                            ${iconoCategoria[articulo.categoria] || '📋'} ${articulo.categoria.charAt(0).toUpperCase() + articulo.categoria.slice(1)}
                        </span>
                        <span>👤 ${articulo.autor}</span>
                        <span>📅 ${fechaFormateada}</span>
                        <span>👀 ${articulo.vistas} vistas</span>
                        <span>💬 ${articulo.comentarios?.length || 0} comentarios</span>
                    </div>
                </div>
                <div style="font-size: 1.1rem; line-height: 1.8; color: #495057;">
                    ${formatearContenido(articulo.contenido)}
                </div>
            `;
        }
        
        // Mostrar panel de información
        const panelInfo = document.getElementById('panelInfo');
        if (panelInfo) {
            panelInfo.style.display = 'flex';
            panelInfo.style.flexDirection = 'column';
            
            // Actualizar información del artículo
            const infoArticulo = document.getElementById('infoArticulo');
            if (infoArticulo) {
                infoArticulo.innerHTML = `
                    <div style="margin-bottom: 8px;"><strong>📅 Creado:</strong> ${fechaFormateada}</div>
                    <div style="margin-bottom: 8px;"><strong>👤 Autor:</strong> ${articulo.autor}</div>
                    <div style="margin-bottom: 8px;"><strong>� Tipo:</strong> ${articulo.tipoDocumento || 'MANUAL'}</div>
                    <div style="margin-bottom: 8px;"><strong>�👀 Vistas:</strong> ${articulo.vistas}</div>
                    <div style="margin-bottom: 8px;"><strong>💬 Comentarios:</strong> ${articulo.comentarios?.length || 0}</div>
                    <div><strong>📊 Categoría:</strong> ${articulo.categoria}</div>
                `;
            }
            
            // Actualizar botones de acción
            const botonesAccion = panelInfo.querySelector('div[style*="flex-direction:column"]');
            if (botonesAccion) {
                botonesAccion.innerHTML = `
                    <button onclick="editarArticulo()" style="background:linear-gradient(145deg, #ffc107, #e0a800); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; margin-bottom: 8px;">
                        ✏️ Editar
                    </button>
                    <button onclick="duplicarArticulo()" style="background:linear-gradient(145deg, #6f42c1, #5a32a3); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; margin-bottom: 8px;">
                        📋 Duplicar
                    </button>
                    <button onclick="compartirArticulo()" style="background:linear-gradient(145deg, #17a2b8, #138496); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; margin-bottom: 8px;">
                        📤 Compartir
                    </button>
                    <button onclick="imprimirArticulo()" style="background:linear-gradient(145deg, #6c757d, #5a6268); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease; margin-bottom: 8px;">
                        🖨️ Imprimir
                    </button>
                    <button onclick="eliminarArticulo()" style="background:linear-gradient(145deg, #dc3545, #c82333); color:white; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:0.9rem; font-weight:600; transition:all 0.3s ease;">
                        🗑️ Eliminar
                    </button>
                `;
            }
            
            // Cargar comentarios
            cargarComentarios();
        }
        
        // Actualizar estadísticas
        actualizarEstadisticasWiki();
        
        console.log('✅ Artículo mostrado:', articulo.titulo);
    }

    // Función para exportar wiki
    function exportarWiki() {
        console.log('📤 Exportando base de conocimientos');
        
        if (articulosWiki.length === 0) {
            alert('⚠️ No hay artículos para exportar');
            return;
        }
        
        const datosExportacion = {
            version: '1.0',
            fechaExportacion: new Date().toISOString(),
            totalArticulos: articulosWiki.length,
            articulos: articulosWiki
        };
        
        const contenidoJson = JSON.stringify(datosExportacion, null, 2);
        const blob = new Blob([contenidoJson], { type: 'application/json' });
        
        const enlace = document.createElement('a');
        enlace.href = URL.createObjectURL(blob);
        enlace.download = `base_conocimientos_achs_${new Date().toISOString().split('T')[0]}.json`;
        
        document.body.appendChild(enlace);
        enlace.click();
        document.body.removeChild(enlace);
        
        URL.revokeObjectURL(enlace.href);
        
        mostrarMensajeTemp(`📤 ${articulosWiki.length} artículos exportados`, '#28a745');
        console.log('✅ Base de conocimientos exportada exitosamente');
    }

    // Función para importar wiki
    function importarWiki() {
        console.log('📥 Iniciando importación de base de conocimientos');
        
        const input = document.getElementById('inputImportarWiki');
        if (input) {
            input.click();
        } else {
            console.error('❌ Input de importación no encontrado');
        }
    }

    // Función para procesar importación
    function procesarImportacion(input) {
        console.log('🔄 Procesando archivo de importación');
        
        const archivo = input.files[0];
        if (!archivo) return;
        
        if (archivo.type !== 'application/json') {
            alert('⚠️ Por favor selecciona un archivo JSON válido');
            return;
        }
        
        const lector = new FileReader();
        lector.onload = function(e) {
            try {
                const datos = JSON.parse(e.target.result);
                
                // Validar estructura
                if (!datos.articulos || !Array.isArray(datos.articulos)) {
                    throw new Error('Estructura de archivo inválida');
                }
                
                // Confirmar importación
                const confirmar = confirm(`¿Deseas importar ${datos.articulos.length} artículos?\n\nEsto se agregará a los artículos existentes.`);
                
                if (confirmar) {
                    // Agregar artículos con nuevos IDs para evitar conflictos
                    const articulosImportados = datos.articulos.map(articulo => ({
                        ...articulo,
                        id: Date.now() + Math.random(), // Nuevo ID único
                        fechaImportacion: new Date().toISOString()
                    }));
                    
                    articulosWiki = [...articulosImportados, ...articulosWiki];
                    guardarArticulosWiki();
                    mostrarListaArticulos();
                    actualizarEstadisticasWiki();
                    
                    mostrarMensajeTemp(`📥 ${articulosImportados.length} artículos importados`, '#28a745');
                    console.log(`✅ ${articulosImportados.length} artículos importados exitosamente`);
                }
                
            } catch (error) {
                console.error('❌ Error al importar:', error);
                alert('❌ Error al procesar el archivo. Verifica que sea un archivo de exportación válido.');
            }
        };
        
        lector.readAsText(archivo);
        
        // Limpiar input
        input.value = '';
    }

    // Función para editar artículo
    function editarArticulo() {
        if (!articuloActual) return;
        
        console.log('✏️ Editando artículo:', articuloActual.titulo);
        
        modoEdicion = true;
        
        // Llenar campos del editor
        const tituloEditor = document.getElementById('tituloEditor');
        const categoriaEditor = document.getElementById('categoriaEditor');
        const tipoDocumentoEditor = document.getElementById('tipoDocumentoEditor');
        const contenidoEditor = document.getElementById('contenidoEditor');
        
        if (tituloEditor) tituloEditor.value = articuloActual.titulo;
        if (categoriaEditor) categoriaEditor.value = articuloActual.categoria;
        if (tipoDocumentoEditor) tipoDocumentoEditor.value = articuloActual.tipoDocumento || 'MANUAL';
        if (contenidoEditor) contenidoEditor.value = articuloActual.contenido;
        
        // Ocultar visor y panel de info
        const vistaArticulo = document.getElementById('vistaArticulo');
        const panelInfo = document.getElementById('panelInfo');
        
        if (vistaArticulo) vistaArticulo.style.display = 'none';
        if (panelInfo) panelInfo.style.display = 'none';
        
        // Mostrar editor
        const editor = document.getElementById('editorArticulo');
        if (editor) {
            editor.style.display = 'flex';
            editor.style.flexDirection = 'column';
        }
        
        // Enfocar en el título
        if (tituloEditor) {
            tituloEditor.focus();
        }
        
        mostrarMensajeTemp('✏️ Modo edición activado', '#ffc107');
    }

    // Función para eliminar artículo
    function eliminarArticulo() {
        if (!articuloActual) return;
        
        const confirmar = confirm(`¿Estás seguro de que deseas eliminar el artículo "${articuloActual.titulo}"?\n\nEsta acción no se puede deshacer.`);
        
        if (confirmar) {
            console.log('🗑️ Eliminando artículo:', articuloActual.titulo);
            
            // Eliminar de la lista
            articulosWiki = articulosWiki.filter(a => a.id !== articuloActual.id);
            guardarArticulosWiki();
            
            // Actualizar interfaz
            mostrarListaArticulos();
            actualizarEstadisticasWiki();
            
            // Volver a vista por defecto
            articuloActual = null;
            const vistaArticulo = document.getElementById('vistaArticulo');
            const panelInfo = document.getElementById('panelInfo');
            
            if (vistaArticulo) {
                vistaArticulo.innerHTML = `
                    <div style="padding:30px; text-align:center; color:#6c757d; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <div style="font-size:4rem; margin-bottom:20px;">📚</div>
                        <h3 style="color:#495057; margin-bottom:15px;">Base de Conocimientos ACHS</h3>
                        <p style="font-size:1.1rem; line-height:1.6; max-width:500px;">
                            Selecciona un artículo de la lista para verlo, o crea uno nuevo para comenzar a construir nuestra base de conocimientos colaborativa.
                        </p>
                        <button onclick="crearNuevoArticulo()" style="background:linear-gradient(145deg, #667eea, #764ba2); color:white; border:none; padding:12px 24px; border-radius:8px; cursor:pointer; font-size:1rem; font-weight:600; margin-top:20px; transition:all 0.3s ease;">
                            ✏️ Crear Primer Artículo
                        </button>
                    </div>
                `;
            }
            
            if (panelInfo) panelInfo.style.display = 'none';
            
            mostrarMensajeTemp('🗑️ Artículo eliminado', '#dc3545');
        }
    }

    // Función para cargar artículos desde localStorage
    function cargarArticulosWiki() {
        try {
            const datos = localStorage.getItem('articulosWikiACHS');
            if (datos) {
                articulosWiki = JSON.parse(datos);
                console.log(`📚 ${articulosWiki.length} artículos cargados desde localStorage`);
                return true;
            }
        } catch (error) {
            console.error('❌ Error al cargar artículos:', error);
        }
        
        articulosWiki = [];
        return false;
    }

    // Función para guardar artículos en localStorage
    function guardarArticulosWiki() {
        try {
            localStorage.setItem('articulosWikiACHS', JSON.stringify(articulosWiki));
            console.log(`💾 ${articulosWiki.length} artículos guardados en localStorage`);
        } catch (error) {
            console.error('❌ Error al guardar artículos:', error);
            alert('Error al guardar. El almacenamiento puede estar lleno.');
        }
    }

    // Función para mostrar lista de artículos
    function mostrarListaArticulos() {
        const lista = document.getElementById('listaArticulos');
        if (!lista) return;
        
        lista.innerHTML = '';
        
        if (articulosWiki.length === 0) {
            lista.innerHTML = `
                <div style="text-align: center; color: #6c757d; padding: 20px;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">📭</div>
                    <p>No hay artículos aún.</p>
                    <button onclick="crearNuevoArticulo()" style="background: linear-gradient(145deg, #667eea, #764ba2); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 600; margin-top: 10px;">
                        ✏️ Crear Primero
                    </button>
                </div>
            `;
            return;
        }
        
        const iconoCategoria = {
            'general': '📋',
            'procedimientos': '⚙️',
            'politicas': '📜',
            'herramientas': '🛠️',
            'faq': '❓'
        };
        
        articulosWiki.forEach(articulo => {
            const elemento = document.createElement('div');
            elemento.style.cssText = `
                background: white;
                border: 2px solid #dee2e6;
                border-radius: 8px;
                padding: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-bottom: 8px;
            `;
            
            elemento.onmouseover = function() {
                this.style.borderColor = '#667eea';
                this.style.boxShadow = '0 4px 12px rgba(102,126,234,0.2)';
                this.style.transform = 'translateY(-2px)';
            };
            
            elemento.onmouseout = function() {
                this.style.borderColor = '#dee2e6';
                this.style.boxShadow = 'none';
                this.style.transform = 'translateY(0)';
            };
            
            elemento.onclick = function() {
                verArticulo(articulo.id);
            };
            
            const fechaCorta = new Date(articulo.fecha).toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit'
            });
            
            elemento.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <span style="font-size: 1.2rem;">${iconoCategoria[articulo.categoria] || '📋'}</span>
                    <span style="background: #667eea; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 600;">
                        ${articulo.categoria.toUpperCase()}
                    </span>
                </div>
                <h4 style="margin: 0 0 8px 0; color: #495057; font-size: 0.95rem; line-height: 1.3;">
                    ${articulo.titulo}
                </h4>
                <div style="font-size: 0.75rem; color: #6c757d; display: flex; justify-content: space-between;">
                    <span>📅 ${fechaCorta}</span>
                    <span>👀 ${articulo.vistas || 0}</span>
                </div>
            `;
            
            lista.appendChild(elemento);
        });
        
        console.log(`📋 Lista de ${articulosWiki.length} artículos actualizada`);
    }

    // Función para actualizar estadísticas
    function actualizarEstadisticasWiki() {
        const totalArticulos = document.getElementById('totalArticulos');
        const totalVistas = document.getElementById('totalVistas');
        const totalComentarios = document.getElementById('totalComentarios');
        const ultimaActualizacion = document.getElementById('ultimaActualizacion');
        
        const vistas = articulosWiki.reduce((total, articulo) => total + (articulo.vistas || 0), 0);
        const comentarios = articulosWiki.reduce((total, articulo) => total + (articulo.comentarios?.length || 0), 0);
        
        let ultimaFecha = '-';
        if (articulosWiki.length > 0) {
            const fechas = articulosWiki.map(a => new Date(a.fechaModificacion || a.fecha));
            const masReciente = new Date(Math.max(...fechas));
            ultimaFecha = masReciente.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' });
        }
        
        if (totalArticulos) totalArticulos.textContent = articulosWiki.length;
        if (totalVistas) totalVistas.textContent = vistas;
        if (totalComentarios) totalComentarios.textContent = comentarios;
        if (ultimaActualizacion) ultimaActualizacion.textContent = ultimaFecha;
    }

    // Función para buscar artículos
    function buscarArticulos() {
        const termino = document.getElementById('buscadorWiki')?.value.toLowerCase() || '';
        const categoria = document.getElementById('filtroCategoria')?.value || '';
        const tipoDocumento = document.getElementById('filtroTipoDocumento')?.value || '';
        
        let articulosFiltrados = articulosWiki;
        
        // Filtrar por búsqueda
        if (termino) {
            articulosFiltrados = articulosFiltrados.filter(articulo =>
                articulo.titulo.toLowerCase().includes(termino) ||
                articulo.contenido.toLowerCase().includes(termino) ||
                articulo.autor.toLowerCase().includes(termino)
            );
        }
        
        // Filtrar por categoría
        if (categoria) {
            articulosFiltrados = articulosFiltrados.filter(articulo =>
                articulo.categoria === categoria
            );
        }
        
        // Filtrar por tipo de documento
        if (tipoDocumento) {
            articulosFiltrados = articulosFiltrados.filter(articulo =>
                (articulo.tipoDocumento || 'MANUAL') === tipoDocumento
            );
        }
        
        // Actualizar lista con resultados filtrados
        const articulosOriginales = [...articulosWiki];
        articulosWiki = articulosFiltrados;
        mostrarListaArticulos();
        articulosWiki = articulosOriginales;
        
        console.log(`🔍 Búsqueda: "${termino}" | Categoría: "${categoria}" | Tipo: "${tipoDocumento}" | Resultados: ${articulosFiltrados.length}`);
    }

    // Función para filtrar por categoría
    function filtrarPorCategoria() {
        buscarArticulos(); // Reutilizar la lógica de búsqueda
    }

    // Función para filtrar por tipo de documento
    function filtrarPorTipoDocumento() {
        buscarArticulos(); // Reutilizar la lógica de búsqueda
    }

    // Funciones adicionales para el panel de información
    function cargarComentarios() {
        const listaComentarios = document.getElementById('listaComentarios');
        if (!listaComentarios || !articuloActual) return;
        
        listaComentarios.innerHTML = '';
        
        const comentarios = articuloActual.comentarios || [];
        
        if (comentarios.length === 0) {
            listaComentarios.innerHTML = `
                <div style="text-align: center; color: #6c757d; padding: 20px; font-size: 0.85rem;">
                    💬 No hay comentarios aún.<br>¡Sé el primero en comentar!
                </div>
            `;
            return;
        }
        
        comentarios.forEach(comentario => {
            const div = document.createElement('div');
            div.style.cssText = `
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                padding: 10px;
                margin-bottom: 8px;
                font-size: 0.8rem;
            `;
            
            const fecha = new Date(comentario.fecha).toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            div.innerHTML = `
                <div style="font-weight: 600; color: #495057; margin-bottom: 5px;">
                    ${comentario.autor} <span style="font-weight: normal; color: #6c757d;">- ${fecha}</span>
                </div>
                <div style="color: #495057; line-height: 1.4;">
                    ${comentario.contenido}
                </div>
            `;
            
            listaComentarios.appendChild(div);
        });
    }

    function agregarComentario() {
        if (!articuloActual) return;
        
        const textarea = document.getElementById('nuevoComentario');
        const contenido = textarea?.value.trim();
        
        if (!contenido) {
            alert('⚠️ Por favor escribe un comentario');
            return;
        }
        
        const nuevoComentario = {
            id: Date.now(),
            autor: 'Usuario ACHS', // En un sistema real sería el usuario actual
            contenido: contenido,
            fecha: new Date().toISOString()
        };
        
        if (!articuloActual.comentarios) {
            articuloActual.comentarios = [];
        }
        
        articuloActual.comentarios.push(nuevoComentario);
        guardarArticulosWiki();
        
        // Limpiar textarea
        if (textarea) textarea.value = '';
        
        // Recargar comentarios
        cargarComentarios();
        
        // Actualizar estadísticas
        actualizarEstadisticasWiki();
        
        mostrarMensajeTemp('💬 Comentario agregado', '#28a745');
    }

    function imprimirArticulo() {
        if (!articuloActual) return;
        
        const contenidoImprimir = `
            <html>
            <head>
                <title>${articuloActual.titulo} - Base de Conocimientos ACHS</title>
                <style>
                    body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
                    h1 { color: #495057; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
                    .metadata { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; }
                    .content { margin-top: 30px; }
                    @media print { body { margin: 20px; } }
                </style>
            </head>
            <body>
                <h1>${articuloActual.titulo}</h1>
                <div class="metadata">
                    <strong>Categoría:</strong> ${articuloActual.categoria}<br>
                    <strong>Autor:</strong> ${articuloActual.autor}<br>
                    <strong>Fecha:</strong> ${new Date(articuloActual.fecha).toLocaleDateString('es-ES')}<br>
                    <strong>Vistas:</strong> ${articuloActual.vistas || 0}
                </div>
                <div class="content">
                    ${formatearContenido(articuloActual.contenido)}
                </div>
                <hr style="margin-top: 40px;">
                <small>Generado desde la Base de Conocimientos ACHS - ${new Date().toLocaleDateString('es-ES')}</small>
            </body>
            </html>
        `;
        
        const ventana = window.open('', '_blank');
        ventana.document.write(contenidoImprimir);
        ventana.document.close();
        ventana.print();
    }

    function previsualizarArticulo() {
        const titulo = document.getElementById('tituloEditor')?.value.trim();
        const contenido = document.getElementById('contenidoEditor')?.value.trim();
        
        if (!titulo || !contenido) {
            alert('⚠️ Ingresa título y contenido para previsualizar');
            return;
        }
        
        const ventana = window.open('', '_blank', 'width=800,height=600');
        const html = `
            <html>
            <head>
                <title>Vista Previa - ${titulo}</title>
                <style>
                    body { font-family: 'Segoe UI', sans-serif; margin: 40px; line-height: 1.6; }
                    h1 { color: #495057; margin-bottom: 20px; }
                    .preview-badge { background: #ffc107; color: #212529; padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
                </style>
            </head>
            <body>
                <div class="preview-badge">👁️ VISTA PREVIA</div>
                <h1>${titulo}</h1>
                <div>${formatearContenido(contenido)}</div>
            </body>
            </html>
        `;
        
        ventana.document.write(html);
        ventana.document.close();
    }

    // ============ FUNCIONES DEL CONVERTIDOR PDF A JSON ============
    
    let contenidoPDFExtraido = '';
    let archivoActual = null;
    
    // Abrir modal del convertidor
    function abrirConvertidorPDF() {
        const modal = document.getElementById('modalConvertidorPDF');
        if (modal) {
            modal.style.display = 'flex';
            resetearConvertidor();
            console.log('📄 Modal convertidor PDF abierto');
        }
    }
    
    // Cerrar modal del convertidor
    function cerrarModalConvertidor() {
        const modal = document.getElementById('modalConvertidorPDF');
        if (modal) {
            modal.style.display = 'none';
            resetearConvertidor();
            console.log('📄 Modal convertidor PDF cerrado');
        }
    }
    
    // Resetear el estado del convertidor
    function resetearConvertidor() {
        document.getElementById('paso1').style.display = 'block';
        document.getElementById('paso2').style.display = 'none';
        document.getElementById('paso3').style.display = 'none';
        document.getElementById('btnGenerarJSON').style.display = 'none';
        document.getElementById('btnDescargarJSON').style.display = 'none';
        
        // Limpiar campos
        document.getElementById('tituloConvertidor').value = '';
        document.getElementById('categoriaConvertidor').value = 'general';
        document.getElementById('prioridadConvertidor').value = 'normal';
        document.getElementById('tagsConvertidor').value = '';
        document.getElementById('contenidoExtraido').textContent = '';
        document.getElementById('estadoConversion').textContent = '';
        
        contenidoPDFExtraido = '';
        archivoActual = null;
    }
    
    // Procesar archivo PDF
    function procesarPDF(input) {
        const file = input.files[0];
        if (!file) return;
        
        if (file.type !== 'application/pdf') {
            mostrarMensajeTemp('❌ Por favor selecciona un archivo PDF válido', '#dc3545');
            return;
        }
        
        archivoActual = file;
        document.getElementById('estadoConversion').textContent = `📄 Archivo seleccionado: ${file.name}`;
        
        // Mostrar mensaje sobre limitaciones del navegador
        mostrarMensajeExplicativo();
        
        // Llenar nombre automáticamente
        const nombreSinExtension = file.name.replace('.pdf', '');
        document.getElementById('tituloConvertidor').value = nombreSinExtension;
        
        // Mostrar paso 2
        document.getElementById('paso2').style.display = 'block';
        document.getElementById('btnGenerarJSON').style.display = 'inline-block';
        
        console.log(`📄 PDF seleccionado: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
    }
    
    // Mostrar mensaje explicativo sobre las limitaciones
    function mostrarMensajeExplicativo() {
        const mensaje = `📄 IMPORTANTE: Conversión de PDF a JSON
        
🔍 MÉTODOS DISPONIBLES:

1️⃣ MÉTODO MANUAL (Recomendado):
• Abre tu PDF en otro programa
• Copia todo el texto (Ctrl+A, Ctrl+C)
• Pega el contenido en el Paso 3
• Continúa con la conversión

2️⃣ MÉTODO AUTOMÁTICO (Limitado):
• Solo funciona con PDFs de texto simple
• No funciona con PDFs escaneados o con imágenes
• Puede requerir permisos especiales del navegador

💡 CONSEJOS:
• Para PDFs complejos, usa herramientas online como:
  - SmallPDF.com (PDF to Text)
  - ILovePDF.com
  - Adobe Acrobat Reader (copiar texto)

¿Quieres continuar con el método manual?`;
        
        if (confirm(mensaje)) {
            permitirEntradaManual();
        }
    }
    
    // Permitir entrada manual de texto
    function permitirEntradaManual() {
        document.getElementById('paso3').style.display = 'block';
        const contenidoDiv = document.getElementById('contenidoExtraido');
        
        // Hacer el div editable
        contenidoDiv.contentEditable = true;
        contenidoDiv.style.border = '2px solid #6f42c1';
        contenidoDiv.style.minHeight = '200px';
        contenidoDiv.style.padding = '15px';
        contenidoDiv.innerHTML = `<p style="color:#6c757d; font-style:italic;">
📝 Pega aquí el contenido de tu PDF...

💡 Puedes:
• Copiar y pegar texto desde tu PDF
• Escribir directamente aquí
• Formatear el texto como prefieras

Cuando termines, haz clic en "Generar JSON"</p>`;
        
        contenidoDiv.addEventListener('input', function() {
            if (this.textContent.trim()) {
                contenidoPDFExtraido = this.textContent;
                document.getElementById('estadoConversion').textContent = `✅ Contenido listo (${this.textContent.length} caracteres)`;
            }
        });
        
        contenidoDiv.addEventListener('focus', function() {
            if (this.innerHTML.includes('Pega aquí el contenido')) {
                this.innerHTML = '';
            }
        });
    }
    
    // Generar JSON desde el texto extraído
    function generarJSONDesdeTexto() {
        const titulo = document.getElementById('tituloConvertidor').value.trim();
        const categoria = document.getElementById('categoriaConvertidor').value;
        const tipoDocumento = document.getElementById('tipoDocumentoConvertidor').value;
        const prioridad = document.getElementById('prioridadConvertidor').value;
        const tags = document.getElementById('tagsConvertidor').value.split(',').map(t => t.trim()).filter(t => t);
        
        // Obtener contenido del div editable
        const contenidoDiv = document.getElementById('contenidoExtraido');
        const contenido = contenidoDiv.textContent || contenidoDiv.innerText || '';
        
        // Validaciones
        if (!titulo) {
            mostrarMensajeTemp('⚠️ El título es obligatorio', '#ffc107');
            return;
        }
        
        if (!contenido || contenido.includes('Pega aquí el contenido')) {
            mostrarMensajeTemp('⚠️ Necesitas agregar contenido al artículo', '#ffc107');
            return;
        }
        
        if (contenido.length < 50) {
            mostrarMensajeTemp('⚠️ El contenido es muy corto. Agrega más información.', '#ffc107');
            return;
        }
        
        // Crear estructura JSON
        const articuloJSON = {
            articulos: [
                {
                    id: Date.now(),
                    titulo: titulo,
                    categoria: categoria,
                    tipoDocumento: tipoDocumento,
                    prioridad: prioridad,
                    tags: tags,
                    contenido: contenido,
                    autor: 'Importado desde PDF',
                    fecha: new Date().toISOString(),
                    vistas: 0,
                    comentarios: []
                }
            ],
            fechaExportacion: new Date().toISOString(),
            version: '1.0'
        };
        
        // Guardar para descarga
        window.datosJSONGenerados = articuloJSON;
        
        // Mostrar botón de descarga
        document.getElementById('btnDescargarJSON').style.display = 'inline-block';
        document.getElementById('estadoConversion').textContent = '✅ JSON generado correctamente';
        
        mostrarMensajeTemp('🎉 JSON generado exitosamente. ¡Ya puedes descargarlo!', '#28a745');
        
        console.log('📄 JSON generado desde PDF:', articuloJSON);
    }
    
    // Descargar archivo JSON
    function descargarJSON() {
        if (!window.datosJSONGenerados) {
            mostrarMensajeTemp('❌ No hay datos para descargar', '#dc3545');
            return;
        }
        
        const blob = new Blob([JSON.stringify(window.datosJSONGenerados, null, 2)], { 
            type: 'application/json' 
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        
        const nombreArchivo = document.getElementById('tituloConvertidor').value.trim()
            .toLowerCase()
            .replace(/[^a-z0-9]/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '');
        
        a.href = url;
        a.download = `${nombreArchivo || 'articulo'}-base-conocimientos.json`;
        a.click();
        
        URL.revokeObjectURL(url);
        
        mostrarMensajeTemp('💾 JSON descargado exitosamente', '#28a745');
        
        // Preguntar si quiere importar directamente
        setTimeout(() => {
            if (confirm('¿Quieres importar este artículo directamente a la Base de Conocimientos?')) {
                importarDirectamente();
            }
        }, 1000);
    }
    
    // Importar directamente a la base de conocimientos
    function importarDirectamente() {
        if (!window.datosJSONGenerados) return;
        
        try {
            const nuevosArticulos = window.datosJSONGenerados.articulos;
            
            // Agregar al array existente
            articulosWiki = [...nuevosArticulos, ...articulosWiki];
            
            // Guardar en localStorage
            guardarArticulosWiki();
            mostrarListaArticulos();
            actualizarEstadisticasWiki();
            
            // Cerrar modal del convertidor
            cerrarModalConvertidor();
            
            // Mostrar el artículo recién creado
            const primerArticulo = nuevosArticulos[0];
            verArticulo(primerArticulo.id);
            
            mostrarMensajeTemp('🎉 Artículo importado exitosamente a la Base de Conocimientos', '#28a745');
            
            console.log('📚 Artículo importado directamente:', primerArticulo);
        } catch (error) {
            console.error('❌ Error al importar:', error);
            mostrarMensajeTemp('❌ Error al importar el artículo', '#dc3545');
        }
    }

    // ===== SISTEMA DE RECLAMOS Y QUEJAS =====
    
    // Función para abrir el modal de reclamos
    function abrirModalReclamo() {
        const modal = document.getElementById('modalReclamo');
        if (modal) {
            modal.style.display = 'flex';
            modal.classList.add('mostrar');
            
            // Limpiar formulario al abrir
            limpiarFormularioReclamo();
            
            console.log('📢 Modal de reclamos abierto');
        } else {
            console.error('❌ Modal de reclamos no encontrado');
        }
    }
    
    // Función para cerrar el modal de reclamos
    function cerrarModalReclamo() {
        console.log('🔄 Intentando cerrar modal de reclamos...');
        const modal = document.getElementById('modalReclamo');
        if (modal) {
            modal.style.display = 'none';
            modal.classList.remove('mostrar');
            console.log('✅ Modal de reclamos cerrado exitosamente');
        } else {
            console.error('❌ Modal de reclamos no encontrado al intentar cerrar');
        }
    }
    
    // Función para configurar el botón de reclamos
    function configurarBotonReclamo() {
        const botonReclamo = document.getElementById('btnReclamo');
        if (botonReclamo) {
            botonReclamo.addEventListener('click', abrirModalReclamo);
            console.log('📢 Botón de reclamos configurado');
            
            // Configurar evento de teclado Escape para cerrar modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('modalReclamo');
                    if (modal && modal.style.display === 'flex') {
                        cerrarModalReclamo();
                    }
                }
            });
            
        } else {
            console.error('❌ Botón de reclamos no encontrado');
        }
    }
    
    // Función para limpiar el formulario de reclamos
    function limpiarFormularioReclamo() {
        const campos = [
            'nombreCliente', 'rutCliente', 'telefonoCliente', 'emailCliente',
            'tipoReclamo', 'prioridadReclamo', 'descripcionReclamo',
            'fechaIncidente', 'areaReclamo', 'ejecutivoReclamo',
            'casoReclamo', 'observacionesInternas', 'estadoReclamo'
        ];
        
        campos.forEach(campo => {
            const elemento = document.getElementById(campo);
            if (elemento) {
                elemento.value = '';
            }
        });
        
        console.log('🧹 Formulario de reclamos limpiado');
    }
    
    // Función para validar el formulario de reclamos
    function validarFormularioReclamo() {
        const camposRequeridos = [
            {id: 'nombreCliente', nombre: 'Nombre del Cliente'},
            {id: 'rutCliente', nombre: 'RUT del Cliente'},
            {id: 'tipoReclamo', nombre: 'Tipo de Reclamo'},
            {id: 'descripcionReclamo', nombre: 'Descripción del Reclamo'}
        ];
        
        const errores = [];
        
        camposRequeridos.forEach(campo => {
            const elemento = document.getElementById(campo.id);
            if (!elemento || !elemento.value.trim()) {
                errores.push(campo.nombre);
            }
        });
        
        // Validar RUT si está presente
        const rutCliente = document.getElementById('rutCliente');
        if (rutCliente && rutCliente.value.trim()) {
            if (!validarRut(rutCliente.value.trim())) {
                errores.push('RUT del Cliente (formato inválido)');
            }
        }
        
        // Validar email si está presente
        const emailCliente = document.getElementById('emailCliente');
        if (emailCliente && emailCliente.value.trim()) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailCliente.value.trim())) {
                errores.push('Email del Cliente (formato inválido)');
            }
        }
        
        if (errores.length > 0) {
            alert(`❌ Por favor complete los siguientes campos:\n\n${errores.join('\n')}`);
            return false;
        }
        
        return true;
    }
    
    // Función para obtener los datos del reclamo
    function obtenerDatosReclamo() {
        return {
            // Información del Cliente
            nombreCliente: document.getElementById('nombreCliente')?.value || '',
            rutCliente: document.getElementById('rutCliente')?.value || '',
            telefonoCliente: document.getElementById('telefonoCliente')?.value || '',
            emailCliente: document.getElementById('emailCliente')?.value || '',
            
            // Detalles del Reclamo
            tipoReclamo: document.getElementById('tipoReclamo')?.value || '',
            prioridadReclamo: document.getElementById('prioridadReclamo')?.value || '',
            descripcionReclamo: document.getElementById('descripcionReclamo')?.value || '',
            fechaIncidente: document.getElementById('fechaIncidente')?.value || '',
            
            // Información Interna ACHS
            areaReclamo: document.getElementById('areaReclamo')?.value || '',
            ejecutivoReclamo: document.getElementById('ejecutivoReclamo')?.value || '',
            casoReclamo: document.getElementById('casoReclamo')?.value || '',
            observacionesInternas: document.getElementById('observacionesInternas')?.value || '',
            estadoReclamo: document.getElementById('estadoReclamo')?.value || 'Ingresado',
            
            // Metadata
            fechaCreacion: new Date().toISOString(),
            id: Date.now().toString()
        };
    }
    
    // Función para guardar el reclamo localmente
    function guardarReclamo() {
        if (!validarFormularioReclamo()) {
            return false;
        }
        
        const datosReclamo = obtenerDatosReclamo();
        
        try {
            // Obtener reclamos existentes
            let reclamosGuardados = JSON.parse(localStorage.getItem('reclamosAchs') || '[]');
            
            // Agregar nuevo reclamo
            reclamosGuardados.push(datosReclamo);
            
            // Guardar en localStorage
            localStorage.setItem('reclamosAchs', JSON.stringify(reclamosGuardados));
            
            console.log('💾 Reclamo guardado:', datosReclamo);
            
            // Mostrar notificación de éxito
            if (typeof showNotification === 'function') {
                showNotification(
                    '✅ Reclamo Guardado',
                    'El reclamo ha sido guardado correctamente en el sistema local.',
                    'success'
                );
            }
            
            alert('✅ Reclamo guardado correctamente');
            return true;
        } catch (error) {
            console.error('❌ Error al guardar reclamo:', error);
            alert('❌ Error al guardar el reclamo. Inténtelo nuevamente.');
            return false;
        }
    }
    
    // Función para generar resumen del reclamo
    function generarResumenReclamo() {
        const datos = obtenerDatosReclamo();
        const fecha = new Date().toLocaleDateString();
        const hora = new Date().toLocaleTimeString();
        
        return `🏢 === RECLAMO ACHS - RESUMEN ===
📅 Fecha: ${fecha} - ${hora}

👤 === INFORMACIÓN DEL CLIENTE ===
Nombre: ${datos.nombreCliente}
RUT: ${datos.rutCliente}
Teléfono: ${datos.telefonoCliente}
Email: ${datos.emailCliente}

📢 === DETALLES DEL RECLAMO ===
Tipo: ${datos.tipoReclamo}
Prioridad: ${datos.prioridadReclamo}
Fecha del Incidente: ${datos.fechaIncidente || 'No especificada'}

Descripción:
${datos.descripcionReclamo}

🏢 === INFORMACIÓN INTERNA ACHS ===
Área/Departamento: ${datos.areaReclamo}
Ejecutivo: ${datos.ejecutivoReclamo}
N° de Caso: ${datos.casoReclamo}
Estado: ${datos.estadoReclamo}

Observaciones Internas:
${datos.observacionesInternas}

=== FIN DEL RESUMEN ===`;
    }
    
    // Función para enviar reclamo por Teams
    function enviarReclamoTeams() {
        if (!validarFormularioReclamo()) {
            return;
        }
        
        const resumen = generarResumenReclamo();
        
        try {
            // Crear URL para Teams
            const mensaje = encodeURIComponent(resumen);
            const urlTeams = `https://teams.microsoft.com/l/chat/0/0?users=&topicName=Reclamo%20ACHS&message=${mensaje}`;
            
            // Abrir Teams
            window.open(urlTeams, '_blank');
            
            // Guardar reclamo
            if (guardarReclamo()) {
                // Mostrar confirmación
                alert('✅ Reclamo enviado por Microsoft Teams.\n\nEl reclamo también ha sido guardado localmente.');
                
                // Cerrar modal
                cerrarModalReclamo();
            }
            
        } catch (error) {
            console.error('❌ Error al enviar por Teams:', error);
            alert('❌ Error al abrir Microsoft Teams. Inténtelo nuevamente.');
        }
    }
    
    // Función para enviar reclamo por email
    function enviarReclamoEmail() {
        if (!validarFormularioReclamo()) {
            return;
        }
        
        const datos = obtenerDatosReclamo();
        const resumen = generarResumenReclamo();
        
        try {
            // Configurar email
            const asunto = `Reclamo ACHS - ${datos.tipoReclamo} - ${datos.nombreCliente}`;
            const cuerpo = encodeURIComponent(resumen);
            
            // Crear URL mailto
            const urlEmail = `mailto:?subject=${encodeURIComponent(asunto)}&body=${cuerpo}`;
            
            // Abrir cliente de email
            window.location.href = urlEmail;
            
            // Guardar reclamo
            if (guardarReclamo()) {
                // Mostrar confirmación
                alert('✅ Cliente de email abierto con el reclamo.\n\nEl reclamo también ha sido guardado localmente.');
                
                // Cerrar modal
                cerrarModalReclamo();
            }
            
        } catch (error) {
            console.error('❌ Error al enviar por email:', error);
            alert('❌ Error al abrir cliente de email. Inténtelo nuevamente.');
        }
    }
    
    // Función para cargar reclamos guardados
    function cargarReclamosGuardados() {
        try {
            const reclamos = JSON.parse(localStorage.getItem('reclamosAchs') || '[]');
            console.log(`📢 Cargados ${reclamos.length} reclamos guardados`);
            return reclamos;
        } catch (error) {
            console.error('❌ Error al cargar reclamos:', error);
            return [];
        }
    }
    
    // Función para inicializar el sistema de reclamos
    function inicializarFormularioReclamo() {
        try {
            // Configurar botón de reclamos
            configurarBotonReclamo();
            
            // Configurar botones del modal
            const btnEnviarTeams = document.querySelector('#modalReclamo button[onclick*="enviarReclamoTeams"]');
            const btnEnviarEmail = document.querySelector('#modalReclamo button[onclick*="enviarReclamoEmail"]');
            const btnLimpiar = document.querySelector('#modalReclamo button[onclick*="limpiarFormularioReclamo"]');
            const btnCerrar = document.querySelector('#modalReclamo button[onclick*="cerrarModalReclamo"]');
            
            if (btnEnviarTeams) btnEnviarTeams.onclick = enviarReclamoTeams;
            if (btnEnviarEmail) btnEnviarEmail.onclick = enviarReclamoEmail;
            if (btnLimpiar) btnLimpiar.onclick = limpiarFormularioReclamo;
            if (btnCerrar) btnCerrar.onclick = cerrarModalReclamo;
            
            // Cargar reclamos existentes
            cargarReclamosGuardados();
            
            // Configurar cierre del modal al hacer clic fuera
            const modal = document.getElementById('modalReclamo');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        cerrarModalReclamo();
                    }
                });
            }
            
            console.log('📢 Sistema de reclamos inicializado correctamente');
            
        } catch (error) {
            console.error('❌ Error al inicializar sistema de reclamos:', error);
        }
    }
    
    // ===== FIN SISTEMA DE RECLAMOS =====

    // ===== SISTEMA DE RESPALDOS =====
    
    let backupConfig = {
        autoBackup: false,
        frequency: 'daily',
        time: '02:00',
        notifications: true,
        maxBackups: 10
    };
    
    let backupHistory = [];
    
    // Funciones principales del sistema de respaldos
    function abrirModalRespaldo() {
        const modal = document.getElementById('modalRespaldo');
        if (modal) {
            modal.style.display = 'block';
            modal.classList.add('show');
            actualizarEstadisticasRespaldo();
            actualizarHistorialRespaldo();
            cargarConfiguracionRespaldo();
        }
    }
    
    function cerrarModalRespaldo() {
        const modal = document.getElementById('modalRespaldo');
        if (modal) {
            modal.style.display = 'none';
            modal.classList.remove('show');
        }
    }
    
    function crearRespaldoCompleto() {
        const fechaActual = new Date();
        const timestamp = fechaActual.toISOString();
        
        try {
            // Recopilar todos los datos del sistema
            const datosRespaldo = {
                version: '1.0',
                fecha: timestamp,
                datos: {
                    ejecutivos: obtenerEjecutivos(),
                    estadisticas: obtenerEstadisticas(),
                    configuracion: obtenerConfiguracion(),
                    historial: obtenerHistorial(),
                    reclamos: obtenerReclamos(),
                    documentos: obtenerDocumentos(),
                    localStorage: { ...localStorage }
                }
            };
            
            // Crear archivo de respaldo
            const blob = new Blob([JSON.stringify(datosRespaldo, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `respaldo_completo_${fechaActual.toISOString().split('T')[0]}_${fechaActual.getHours()}${fechaActual.getMinutes()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Registrar en historial
            const respaldo = {
                id: Date.now(),
                tipo: 'Completo',
                fecha: fechaActual.toLocaleDateString('es-ES'),
                hora: fechaActual.toLocaleTimeString('es-ES'),
                tamaño: formatearTamaño(blob.size),
                estado: 'Exitoso'
            };
            
            backupHistory.unshift(respaldo);
            guardarHistorialRespaldo();
            actualizarHistorialRespaldo();
            actualizarEstadisticasRespaldo();
            
            mostrarNotificacion('✅ Respaldo completo creado exitosamente', 'success');
            
        } catch (error) {
            console.error('Error al crear respaldo completo:', error);
            mostrarNotificacion('❌ Error al crear respaldo completo', 'error');
        }
    }
    
    function crearRespaldoRapido() {
        const fechaActual = new Date();
        const timestamp = fechaActual.toISOString();
        
        try {
            // Recopilar datos esenciales
            const datosRespaldo = {
                version: '1.0-quick',
                fecha: timestamp,
                datos: {
                    ejecutivos: obtenerEjecutivos(),
                    estadisticas: obtenerEstadisticas(),
                    configuracion: obtenerConfiguracion()
                }
            };
            
            // Crear archivo de respaldo
            const blob = new Blob([JSON.stringify(datosRespaldo, null, 2)], {
                type: 'application/json'
            });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `respaldo_rapido_${fechaActual.toISOString().split('T')[0]}_${fechaActual.getHours()}${fechaActual.getMinutes()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Registrar en historial
            const respaldo = {
                id: Date.now(),
                tipo: 'Rápido',
                fecha: fechaActual.toLocaleDateString('es-ES'),
                hora: fechaActual.toLocaleTimeString('es-ES'),
                tamaño: formatearTamaño(blob.size),
                estado: 'Exitoso'
            };
            
            backupHistory.unshift(respaldo);
            guardarHistorialRespaldo();
            actualizarHistorialRespaldo();
            actualizarEstadisticasRespaldo();
            
            mostrarNotificacion('✅ Respaldo rápido creado exitosamente', 'success');
            
        } catch (error) {
            console.error('Error al crear respaldo rápido:', error);
            mostrarNotificacion('❌ Error al crear respaldo rápido', 'error');
        }
    }
    
    function programarRespaldoAutomatico() {
        const autoBackupToggle = document.getElementById('autoBackupToggle');
        
        if (autoBackupToggle && autoBackupToggle.checked) {
            backupConfig.autoBackup = true;
            
            // Calcular próximo respaldo
            const ahora = new Date();
            const [hora, minuto] = backupConfig.time.split(':');
            const proximoRespaldo = new Date();
            proximoRespaldo.setHours(parseInt(hora), parseInt(minuto), 0, 0);
            
            // Si la hora ya pasó hoy, programar para mañana
            if (proximoRespaldo <= ahora) {
                proximoRespaldo.setDate(proximoRespaldo.getDate() + 1);
            }
            
            // Calcular tiempo hasta el próximo respaldo
            const tiempoEspera = proximoRespaldo.getTime() - ahora.getTime();
            
            // Programar respaldo automático
            setTimeout(() => {
                if (backupConfig.autoBackup) {
                    crearRespaldoCompleto();
                    
                    if (backupConfig.notifications) {
                        mostrarNotificacion('🔄 Respaldo automático completado', 'info');
                    }
                    
                    // Programar siguiente respaldo según frecuencia
                    const siguienteIntervalo = backupConfig.frequency === 'daily' ? 24 * 60 * 60 * 1000 :
                                             backupConfig.frequency === 'weekly' ? 7 * 24 * 60 * 60 * 1000 :
                                             30 * 24 * 60 * 60 * 1000; // monthly
                    
                    setTimeout(() => programarRespaldoAutomatico(), siguienteIntervalo);
                }
            }, tiempoEspera);
            
            actualizarEstadisticasRespaldo();
            mostrarNotificacion('⏰ Respaldo automático programado', 'info');
            
        } else {
            backupConfig.autoBackup = false;
            mostrarNotificacion('⏹️ Respaldo automático desactivado', 'info');
        }
        
        guardarConfiguracionRespaldo();
    }
    
    function restaurarRespaldo() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const datosRespaldo = JSON.parse(event.target.result);
                    
                    if (confirm('⚠️ ¿Está seguro de restaurar este respaldo? Esto sobrescribirá todos los datos actuales.')) {
                        // Restaurar datos
                        if (datosRespaldo.datos.localStorage) {
                            Object.keys(datosRespaldo.datos.localStorage).forEach(key => {
                                localStorage.setItem(key, datosRespaldo.datos.localStorage[key]);
                            });
                        }
                        
                        // Registrar restauración en historial
                        const restauracion = {
                            id: Date.now(),
                            tipo: 'Restauración',
                            fecha: new Date().toLocaleDateString('es-ES'),
                            hora: new Date().toLocaleTimeString('es-ES'),
                            tamaño: formatearTamaño(JSON.stringify(datosRespaldo).length),
                            estado: 'Exitoso'
                        };
                        
                        backupHistory.unshift(restauracion);
                        guardarHistorialRespaldo();
                        
                        mostrarNotificacion('✅ Respaldo restaurado exitosamente. Recargando página...', 'success');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                    }
                    
                } catch (error) {
                    console.error('Error al restaurar respaldo:', error);
                    mostrarNotificacion('❌ Error al restaurar respaldo: Archivo inválido', 'error');
                }
            };
            
            reader.readAsText(file);
        };
        
        input.click();
    }
    
    // Funciones auxiliares del sistema de respaldos
    function actualizarEstadisticasRespaldo() {
        const totalRespaldos = backupHistory.length;
        const ultimoRespaldo = backupHistory[0];
        const respaldosExitosos = backupHistory.filter(r => r.estado === 'Exitoso').length;
        
        // Actualizar estadísticas en el modal
        const statsContainer = document.querySelector('#modalRespaldo .backup-stats');
        if (statsContainer) {
            statsContainer.innerHTML = `
                <div class="col-md-3">
                    <div class="stat-card">
                        <h5>Total de Respaldos</h5>
                        <span class="stat-number">${totalRespaldos}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h5>Respaldos Exitosos</h5>
                        <span class="stat-number text-success">${respaldosExitosos}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h5>Último Respaldo</h5>
                        <span class="stat-number">${ultimoRespaldo ? ultimoRespaldo.fecha : 'Nunca'}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card">
                        <h5>Próximo Automático</h5>
                        <span class="stat-number">${backupConfig.autoBackup ? 'Programado' : 'Desactivado'}</span>
                    </div>
                </div>
            `;
        }
    }
    
    function actualizarHistorialRespaldo() {
        const tbody = document.querySelector('#modalRespaldo #backupHistoryTable tbody');
        if (!tbody) return;
        
        tbody.innerHTML = '';
        
        backupHistory.slice(0, 20).forEach(respaldo => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${respaldo.tipo}</td>
                <td>${respaldo.fecha}</td>
                <td>${respaldo.hora}</td>
                <td>${respaldo.tamaño}</td>
                <td><span class="badge badge-${respaldo.estado === 'Exitoso' ? 'success' : 'danger'}">${respaldo.estado}</span></td>
            `;
            tbody.appendChild(tr);
        });
    }
    
    function cargarConfiguracionRespaldo() {
        const configGuardada = localStorage.getItem('backupConfig');
        if (configGuardada) {
            backupConfig = { ...backupConfig, ...JSON.parse(configGuardada) };
        }
        
        // Actualizar controles en el modal
        const autoBackupToggle = document.getElementById('autoBackupToggle');
        const backupFrequency = document.getElementById('backupFrequency');
        const backupTime = document.getElementById('backupTime');
        const backupNotifications = document.getElementById('backupNotifications');
        
        if (autoBackupToggle) autoBackupToggle.checked = backupConfig.autoBackup;
        if (backupFrequency) backupFrequency.value = backupConfig.frequency;
        if (backupTime) backupTime.value = backupConfig.time;
        if (backupNotifications) backupNotifications.checked = backupConfig.notifications;
    }
    
    function guardarConfiguracionRespaldo() {
        localStorage.setItem('backupConfig', JSON.stringify(backupConfig));
    }
    
    function guardarHistorialRespaldo() {
        localStorage.setItem('backupHistory', JSON.stringify(backupHistory));
    }
    
    function cargarHistorialRespaldo() {
        const historialGuardado = localStorage.getItem('backupHistory');
        if (historialGuardado) {
            backupHistory = JSON.parse(historialGuardado);
        }
    }
    
    function formatearTamaño(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // Funciones para obtener datos del sistema
    function obtenerEjecutivos() {
        return ejecutivos || [];
    }
    
    function obtenerEstadisticas() {
        return {
            llamadasAtendidas: document.querySelector('.stat-number')?.textContent || '0',
            satisfaccion: '95.2%',
            tiempoPromedio: '3:45',
            fecha: new Date().toISOString()
        };
    }
    
    function obtenerConfiguracion() {
        return {
            notificaciones: notificationConfig || {},
            respaldos: backupConfig,
            usuario: 'Administrador ACHS'
        };
    }
    
    function obtenerHistorial() {
        return historialActividades || [];
    }
    
    function obtenerReclamos() {
        return reclamos || [];
    }
    
    function obtenerDocumentos() {
        return documentos || [];
    }
    
    // Event Listeners para configuración
    document.addEventListener('DOMContentLoaded', function() {
        cargarHistorialRespaldo();
        
        // Configurar eventos de cambio en la configuración
        const autoBackupToggle = document.getElementById('autoBackupToggle');
        const backupFrequency = document.getElementById('backupFrequency');
        const backupTime = document.getElementById('backupTime');
        const backupNotifications = document.getElementById('backupNotifications');
        
        if (autoBackupToggle) {
            autoBackupToggle.addEventListener('change', function() {
                programarRespaldoAutomatico();
            });
        }
        
        if (backupFrequency) {
            backupFrequency.addEventListener('change', function() {
                backupConfig.frequency = this.value;
                guardarConfiguracionRespaldo();
            });
        }
        
        if (backupTime) {
            backupTime.addEventListener('change', function() {
                backupConfig.time = this.value;
                guardarConfiguracionRespaldo();
            });
        }
        
        if (backupNotifications) {
            backupNotifications.addEventListener('change', function() {
                backupConfig.notifications = this.checked;
                guardarConfiguracionRespaldo();
            });
        }
    });
    
    // ===== FIN SISTEMA DE RESPALDOS =====

    // ══════════════════════════════════════════════════════════════════════════════
    // ✅ JAVASCRIPT INTEGRADO DESDE app.js - 2025-11-11
    // ══════════════════════════════════════════════════════════════════════════════

    // ============================
    // ✅ BÚSQUEDA RÁPIDA (Ctrl+K)
    // ============================
    (() => {
        const elO = document.getElementById('busquedaRapidaOverlay');
        const elM = document.getElementById('busquedaRapidaModal');
        const elIn = document.getElementById('busquedaRapidaInput');
        const elRes = document.getElementById('busquedaResultados');
        const elHint = document.getElementById('busquedaRapidaHint');

        let indiceSeleccionado = -1;
        let resultados = [];

        function abrirBusqueda() {
            if (!elO || !elM || !elIn) return;
            elO.style.display = 'flex';
            setTimeout(() => {
                elM.classList.add('activo');
                elIn.focus();
            }, 10);
        }

        function cerrarBusqueda() {
            if (!elO || !elM || !elIn) return;
            elM.classList.remove('activo');
            setTimeout(() => {
                elO.style.display = 'none';
                elIn.value = '';
                if (elRes) elRes.innerHTML = '';
                if (elHint) elHint.style.display = 'block';
                indiceSeleccionado = -1;
                resultados = [];
            }, 200);
        }

        function buscarEnDOM(query) {
            const norm = query.toLowerCase();
            resultados = [];

            // Buscar en todos los <details> y <summary>
            const details = document.querySelectorAll('details');
            details.forEach((det) => {
                const sum = det.querySelector('summary');
                if (!sum) return;
                const texto = sum.textContent.toLowerCase();
                if (texto.includes(norm)) {
                    resultados.push({
                        tipo: 'Sección',
                        titulo: sum.textContent.trim(),
                        elemento: det
                    });
                }
            });

            // Buscar en h3 y otros headings
            const headings = document.querySelectorAll('h3, h4, h5');
            headings.forEach((h) => {
                const texto = h.textContent.toLowerCase();
                if (texto.includes(norm)) {
                    resultados.push({
                        tipo: 'Título',
                        titulo: h.textContent.trim(),
                        elemento: h
                    });
                }
            });

            // Buscar en botones
            const botones = document.querySelectorAll('button');
            botones.forEach((btn) => {
                const texto = btn.textContent.toLowerCase();
                if (texto.includes(norm)) {
                    resultados.push({
                        tipo: 'Botón',
                        titulo: btn.textContent.trim(),
                        elemento: btn
                    });
                }
            });

            mostrarResultados();
        }

        function mostrarResultados() {
            if (!elRes || !elHint) return;
            if (resultados.length === 0) {
                elRes.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">Sin resultados</div>';
                elHint.style.display = 'none';
                return;
            }

            elHint.style.display = 'none';
            elRes.innerHTML = '';
            resultados.forEach((r, idx) => {
                const div = document.createElement('div');
                div.className = 'busqueda-item';
                if (idx === indiceSeleccionado) div.classList.add('seleccionado');
                div.innerHTML = `<span class="tipo-resultado">${r.tipo}</span> ${r.titulo}`;
                div.addEventListener('click', () => {
                    navegarA(r);
                    cerrarBusqueda();
                });
                elRes.appendChild(div);
            });
        }

        function navegarA(resultado) {
            const el = resultado.elemento;
            if (!el) return;

            // Si es un details, abrirlo
            if (el.tagName === 'DETAILS') {
                el.open = true;
            }

            // Scroll suave
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Highlight temporal
            el.style.transition = 'background 0.3s';
            el.style.background = 'rgba(255, 235, 59, 0.3)';
            setTimeout(() => {
                el.style.background = '';
            }, 1500);
        }

        // Tecla global Ctrl+K
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                abrirBusqueda();
            }

            if (e.key === 'Escape' && elO && elO.style.display === 'flex') {
                e.preventDefault();
                cerrarBusqueda();
            }
        });

        // Input de búsqueda
        if (elIn) {
            elIn.addEventListener('input', (e) => {
                const val = e.target.value.trim();
                if (val.length > 1) {
                    buscarEnDOM(val);
                } else {
                    if (elRes) elRes.innerHTML = '';
                    if (elHint) elHint.style.display = 'block';
                    resultados = [];
                    indiceSeleccionado = -1;
                }
            });

            elIn.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (resultados.length > 0) {
                        indiceSeleccionado = Math.min(indiceSeleccionado + 1, resultados.length - 1);
                        mostrarResultados();
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (resultados.length > 0) {
                        indiceSeleccionado = Math.max(indiceSeleccionado - 1, 0);
                        mostrarResultados();
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (indiceSeleccionado >= 0 && indiceSeleccionado < resultados.length) {
                        navegarA(resultados[indiceSeleccionado]);
                        cerrarBusqueda();
                    }
                }
            });
        }

        // Click fuera cierra
        if (elO) {
            elO.addEventListener('click', (e) => {
                if (e.target === elO) cerrarBusqueda();
            });
        }
    })();

    // ============================
    // ✅ BOTÓN GRABAR
    // ============================
    (() => {
        const btn = document.getElementById('btnGrabar');
        if (!btn) return;

        btn.addEventListener('click', () => {
            const container = document.querySelector('.container');
            if (!container) {
                alert('No se encuentra el contenedor principal.');
                return;
            }

            const html = container.innerHTML;
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ACHS_Ejecutivo_${new Date().toISOString().split('T')[0]}.html`;
            a.click();
            URL.revokeObjectURL(url);

            // Animación de confirmación
            btn.textContent = '✅ Guardado';
            setTimeout(() => {
                btn.textContent = '💾 Grabar';
            }, 2000);
        });
    })();

    // ============================
    // ✅ CALENDARIO CHILE FLOTANTE
    // ============================
    (() => {
        const panel = document.getElementById('panelCalendarioCL');
        const grid = document.getElementById('calGrid');
        const titulo = document.getElementById('calTitulo');
        const pie = document.getElementById('calFooter');

        let mesActual = new Date().getMonth();
        let anioActual = new Date().getFullYear();

        const MESES = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                      'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

        const feriadosChile2025 = new Map([
            ['2025-01-01', 'Año Nuevo'],
            ['2025-04-18', 'Viernes Santo'],
            ['2025-04-19', 'Sábado Santo'],
            ['2025-05-01', 'Día del Trabajador'],
            ['2025-05-21', 'Día de las Glorias Navales'],
            ['2025-06-20', 'Día de los Pueblos Indígenas'],
            ['2025-06-29', 'San Pedro y San Pablo'],
            ['2025-07-16', 'Virgen del Carmen'],
            ['2025-08-15', 'Asunción de la Virgen'],
            ['2025-09-18', 'Primera Junta Nacional de Gobierno'],
            ['2025-09-19', 'Día de las Glorias del Ejército'],
            ['2025-10-12', 'Encuentro de Dos Mundos'],
            ['2025-10-31', 'Día de las Iglesias Evangélicas y Protestantes'],
            ['2025-11-01', 'Día de Todos los Santos'],
            ['2025-12-08', 'Inmaculada Concepción'],
            ['2025-12-25', 'Navidad']
        ]);

        function renderizarCalendario(mes, anio) {
            console.log('[ACHS_CALENDARIO] Renderizando calendario:', MESES[mes], anio);
            if (!grid || !titulo || !pie) {
                console.error('[ACHS_CALENDARIO] ERROR: Faltan elementos DOM:', {
                    grid: !!grid,
                    titulo: !!titulo,
                    pie: !!pie
                });
                return;
            }

            titulo.textContent = `${MESES[mes]} ${anio}`;

            const primerDia = new Date(anio, mes, 1).getDay();
            const diasEnMes = new Date(anio, mes + 1, 0).getDate();

            // Ajustar para que la semana comience en lunes (0=domingo, 1=lunes, etc.)
            const primerDiaAjustado = primerDia === 0 ? 6 : primerDia - 1;

            let html = '<div class="cal-header">Lu</div><div class="cal-header">Ma</div><div class="cal-header">Mi</div>' +
                      '<div class="cal-header">Ju</div><div class="cal-header">Vi</div><div class="cal-header">Sa</div>' +
                      '<div class="cal-header">Do</div>';

            for (let i = 0; i < primerDiaAjustado; i++) {
                html += '<div class="cal-day"></div>';
            }

            const hoy = new Date();
            const esHoyMesAnio = (hoy.getMonth() === mes && hoy.getFullYear() === anio);

            for (let dia = 1; dia <= diasEnMes; dia++) {
                const diaSemana = new Date(anio, mes, dia).getDay();
                const esDomingo = diaSemana === 0;
                const esHoy = esHoyMesAnio && dia === hoy.getDate();
                const fecha = `${anio}-${String(mes + 1).padStart(2, '0')}-${String(dia).padStart(2, '0')}`;
                const feriado = feriadosChile2025.get(fecha);

                let clase = 'cal-day';
                if (esHoy) clase += ' cal-hoy';
                if (esDomingo || feriado) clase += ' cal-feriado';

                let titulo = '';
                if (feriado) titulo = `title="${feriado}"`;

                html += `<div class="${clase}" ${titulo}>${dia}</div>`;
            }

            grid.innerHTML = html;
            pie.textContent = `Hoy: ${hoy.getDate()}/${hoy.getMonth() + 1}/${hoy.getFullYear()}`;
        }

        window.toggleCalendarioCL = function() {
            console.log('[ACHS_CALENDARIO] Toggle calendario');
            if (!panel) {
                console.error('[ACHS_CALENDARIO] ERROR: No se encuentra el panel #panelCalendarioCL');
                return;
            }
            const visible = panel.style.display === 'block';
            panel.style.display = visible ? 'none' : 'block';
            if (!visible) {
                renderizarCalendario(mesActual, anioActual);
            }
        };

        window.calCambiarMes = function(delta) {
            console.log('[ACHS_CALENDARIO] Cambiando mes:', delta);
            mesActual += delta;
            if (mesActual > 11) { mesActual = 0; anioActual++; }
            if (mesActual < 0) { mesActual = 11; anioActual--; }
            renderizarCalendario(mesActual, anioActual);
        };

        window.calIrAHoy = function() {
            console.log('[ACHS_CALENDARIO] Navegando a hoy');
            const hoy = new Date();
            mesActual = hoy.getMonth();
            anioActual = hoy.getFullYear();
            renderizarCalendario(mesActual, anioActual);
        };

        renderizarCalendario(mesActual, anioActual);
    })();

    // ============================
    // ✅ SISTEMA DE MODALES
    // ============================
    window.abrirModal = function(idModal) {
        const modal = document.getElementById(idModal);
        if (!modal) return;
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('activo'), 10);
    };

    window.cerrarModal = function(idModal) {
        const modal = document.getElementById(idModal);
        if (!modal) return;
        modal.classList.remove('activo');
        setTimeout(() => modal.style.display = 'none', 300);
    };

    document.querySelectorAll('[data-modal]').forEach(btn => {
        btn.addEventListener('click', () => {
            const idModal = btn.getAttribute('data-modal');
            abrirModal(idModal);
        });
    });

    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                cerrarModal(modal.id);
            }
        });

        const btnCerrar = modal.querySelector('.btn-cerrar-modal');
        if (btnCerrar) {
            btnCerrar.addEventListener('click', () => cerrarModal(modal.id));
        }
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            // Cerrar cualquier modal visible cuyo id comience con 'modal'
            document.querySelectorAll("div[id^='modal']").forEach(m => {
                const style = window.getComputedStyle(m);
                if (style.display !== 'none') {
                    m.style.display = 'none';
                }
            });

            // Intentar cerrar modales que usen la clase 'modal activo' y API cerrarModal
            document.querySelectorAll('.modal.activo').forEach(m => {
                try {
                    if (typeof cerrarModal === 'function') cerrarModal(m.id);
                } catch (_) {
                    /* noop */
                }
            });

            // Ocultar overlay de notificaciones si está visible
            const overlay = document.getElementById('notificationOverlay');
            if (overlay) overlay.style.display = 'none';
        }
    });

    // ============================
    // ✅ SUBMENU SNL
    // ============================
    (() => {
        const submenu = document.querySelector('.submenu-snl');
        const btnSNL = document.querySelector('button[onclick="toggleSubmenuSNL()"]');

        window.toggleSubmenuSNL = function() {
            if (!submenu) return;
            const visible = submenu.classList.contains('visible');
            submenu.classList.toggle('visible', !visible);
        };

        if (submenu) {
            submenu.addEventListener('keydown', (e) => {
                const items = Array.from(submenu.querySelectorAll('li'));
                const activo = document.activeElement;
                const idx = items.findIndex(li => li.contains(activo));

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    const siguiente = items[idx + 1] || items[0];
                    siguiente.querySelector('a, button')?.focus();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    const anterior = items[idx - 1] || items[items.length - 1];
                    anterior.querySelector('a, button')?.focus();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    submenu.classList.remove('visible');
                    btnSNL?.focus();
                }
            });
        }

        document.addEventListener('click', (e) => {
            if (submenu && !submenu.contains(e.target) && e.target !== btnSNL) {
                submenu.classList.remove('visible');
            }
        });
    })();

    // ══════════════════════════════════════════════════════════════════════════════
    // ✅ FIN JAVASCRIPT INTEGRADO
    // ══════════════════════════════════════════════════════════════════════════════

    </script>
<!-- Eliminado duplicado del botón/modal de ayuda: reubicado cerca del primer body -->
</body>

</html>